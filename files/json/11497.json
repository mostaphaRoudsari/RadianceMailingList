{"body": "\nI would suggest this:\n\n\n\n[loop over timebounds (can have a sun above horizon check here too, also\nif the day exists, like Feb 30)]\n[gensky with the day/time]\n\n[create/overwrite temp image making sure to have -ab 0]\n\n[pcomb -e 'lo=if(li(1)-100/WE,1,0' the image to make any value above\n100 lux be 1, any value below be 0 > month.day.hour.hdr]\n\n[loop over timebounds]\n\n[for every month]\n\n[for every day]\n\n[combine hours in day with pcomb > month.day.XX.hdr]\n\n[combine days in month with pcomb > month.XX.XX.hdr]\n\n[combine months in year with pcomb > sunhours.hdr]\n\n\n\nThe values in the final image will be in terms of sun-hours. It assumes\nthat any part of the image over 100 lux direct exterior illuminance is\nin the sun. The key to speed here, I think, is to make the octree quick\nto load.\n\n\n\nBonus points if you can create multiple threads/processes and run\nthrough the first loop in parallel...\n\n\n\n\n\n\n\nSent: Tuesday, February 15, 2011 10:41 AM\nTo: Radiance general discussion\n\n\nHi Giovanni and Lars!\nI think you guys have some good approaches.\nIf # of images it produces is an issue for the original \"brute force\"\nmethod you proposed for checking direct sun exposure on clear days, you\ncan overwrite the same image every-time after doing an image check and\nincrementing a variable.  Below is pseudo-code:\n\n[loop over timebounds (can have a sun above horizon check here too)]\n[create/overwrite image SunCheckImage]\n[if (pixel value of representative point in SunCheckImage >\nthreshold)\nnum_timesteps_in_sun++]\n[print \"I've been in the sun for \" + num_timesteps_in_sun + \" time\nsteps\"]\n[delete SunCheckImage]\n\nSorry, I do not know off-hand an easy command for reading pixel values\nof .hdr images with Radiance (pcomb ?...), but this can be done\nelsewhere (e.g. ImageMagick...).\nThresholds can be tricky, so take into account reflected, ambient, low\nangle, etc light (which is what you are doing with -ab...).\nYou can also try intersecting the line between the surface and sun\nwith the model geometry for each time-step...\nGood luck!\n\n- Dan\n\n\nOn 2/15/2011 5:28 AM, Giovanni Betti wrote:\n\n\n\nLars,\nthe number of about 300 comes from subdividing each tregenza patch in 4\nto increase angular resolution and then looking only at the occupied\npatches, sorry for the confusion.\n\nI would be interested as well in seeing how other people approached the\nsame problem though.\n\nThanks,\n\nGiovanni\n\n-----Original Message-----\nSent: 15 February 2011 12:16\nTo: Radiance general discussion\nHi Giovanni!\n\n\nI see how that's a possibility but it would mean running\nseparate\n\nimages\n\nand to filter each of them.\n\n\nI guess it would not be impossible, as renderings should complete very\nfast when considering only direct.\n\n\nsimulation with multiple sun positions. Eventually as an\noptimization\nthe sun position can be clustereed according to tregenza patches\nand\neach patch weighted based on the number of sun hours it\nrepresents (so\nyou don't even need 4000 sun but maybe only 300...)\nAny hint on that?\n\n\nThe tregenza sky introduces limitations of the angular resolution. You\nmay try a two-step approach:\n\nFirst, for each patch, find out at how many time intervals the sun is\ncovered by the patch. So a patch containing the sun solid angle 20 times\n\na year, you would set the patch value to 20.\n\nSecond, run rtcontrib to find out which patch contributes to which\npixel. Here you can apply your threshold just as described in my former\nemail, so any pixel that is lid by a patch is set to the value (in\nhours) for the patch from step 1.\n\nWith a Tregenza grid, you would end up with 145 images, each pixel value\n\ncorresponding to the number of hours of direct sun exposure from the\nrelated patch. Adding up all the 145 images in the third step should\nresult in pixel values of direct sun exposure (hours) for all patches.\n\nBTW if you follow an approach as typically used when working with\nTregenza skies, and split the sun over n neighbouring patches, you would\n\nof course set the pixel value to 1/n instead.\n\nI am not sure about better ways to achieve what you want to do, this is\njust one idea... any other proposals? I am sure others have done that\nbefore...\n\nCheers, Lars.\n\n\n_______________________________________________\nRadiance-general mailing list\nRadiance-general at radiance-online.org\nhttp://www.radiance-online.org/mailman/listinfo/radiance-general\n\n\n\n\n\n--\n\n\n\nDaniel C. Glaser, PhD, LEED AP, IES\n\nPrincipal\nLight Foundry, LLC\nT: 510.387.8890 | F: 315.410.2617\n\nwww.lightfoundryllc.com\n\n\n\n\n\n\n\n\n\nThis message has been scanned by MailController - www.MailController.altohiway.com\n-------------- next part --------------\nAn HTML attachment was scrubbed...\nURL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20110215/80bc7e9a/attachment.html>\n-------------- next part --------------\nA non-text attachment was scrubbed...\nName: image001.png\nType: image/png\nSize: 5569 bytes\nDesc: image001.png\nURL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20110215/80bc7e9a/attachment.png>\n\n", "replyTo": "Subject: [Radiance-general] Sunlight hours calculation in radiance", "sender": "grobe at gmx.net", "isquestion": false, "tags": [], "id": "<58E15A7AECA742499E0D566C95B03BD2115DA791@ex-be01.burohappold.com>", "refs": ["<AANLkTik9DO1qNL3sggYdUD4+6BGjuTBqOQkWW1E0bhW4@mail.gmail.com><98EC0CDF-0531-40A6-A94A-367A5724EB4C@lmi.net>\t<AANLkTinunUUG5yNWncAY1K1=Jn7UTP793r5bWDH+0ZN2@mail.gmail.com><6F5225D6E15F954BB4E58EC25F6736C30661E405@corp3005.CORPORATE.FOSTER.NETWORK>\t<4D5A5CE8.8000301@gmx.net><6F5225D6E15F954BB4E58EC25F6736C30661E40F@corp3005.CORPORATE.FOSTER.NETWORK>\t<4D5A6E8F.4000105@gmx.net><6F5225D6E15F954BB4E58EC25F6736C30661E415@corp3005.CORPORATE.FOSTER.NETWORK>", "<4D5A9E80.8070703@lightfoundryllc.com>"], "datetime": "Tue, 15 Feb 2011 16:15:22 -0000", "email": "Lars O. Grobe", "subject": "Re: [Radiance-general] Sunlight hours calculation in radiance"}