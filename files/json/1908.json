{"refs": [], "id": "<5910A0754536EA4AAD411AE8221C3962F482AC@nrccenexb1.nrc.ca>", "subject": "[Radiance-general] No more Mr. Nice Guy", "email": "adiance-general-bounces@radiance-online.org", "body": "\nDear all,\n\nGreg's email is not only relevant for Mac users but also for the\nfriendly but frequently overlooked WINDOWS crowd:)\n\nFor the Daysim Windows version, I am compiling a number of Radiance\nprograms. Specifically, I am calling rtrace via a C-Program called\ngen_dc to calculate a whole set of daylight coefficients. In case rtrace\nhas been compiled with NICE=, it runs with a \"low\" priority whereas\nwithout the NICE=, it runs with \"normal\" priority. In the latter case,\nthe simulation times can become substantial as just about any other job\nunder Windows runs with \"normal\" priority. In case you are using\nRadiance under Windows (cygwin etc.), this might be worthwhile looking\ninto as well. One of my students reported that the Lightstudio Radiance\nbinaries run significantly faster than Desktop Radiance (but this may be\nthe case for numerous other reasons as well).\n\nChristoph\n\n-----Original Message-----\n[mailto:radiance-general-bounces@radiance-online.org] On Behalf Of Greg\nWard\nSent: Thursday, December 15, 2005 11:51 PM\nTo: Radiance general discussion\nHi All,\n\nThis message is most relevant to Mac users, but introduces a change that\nmay affect rpict and rtrace performance in future releases on all\nplatforms.  Specifically, I have taken out the NICE= macro settings from\nthe Rmakefile in src/rt, so future builds will run all Radiance programs\nat the standard user priority.\n\nI made a fortuitous discovery whilst playing around with the very cool\n(no pun intended) TemperatureMonitor freeware <http://\nwww.bresink.com/osx/TemperatureMonitor.html> on my new PowerMac G5 quad.\nIt's lots of fun to watch the processor temps go up and down with load.\nThe funny thing I noticed was that changing the Energy Savings settings\nhad an unexpected effect on temperatures, which are in turn related to\npower consumption and (presumably) processor performance.\n\nThe Energy Saver options lists three processor performance settings,\n\"Highest,\" \"Automatic,\" and \"Reduced.\"  With the machine idle, there\nwere only slight differences between the three; I had expected to see\nmore, especially on the \"Highest\" setting...  The biggest difference was\nbetween \"Highest\" and \"Reduced\" with all four processors busy, and that\nwas no surprise.  What was a surprise was that when I had four rpict\njobs going in parallel, there was a big difference between\nthe temperatures using the \"Highest\" versus \"Automatic\" settings.\nApple documentation states that the performance penalty for using\n\"Automatic\" should be very small, so I figured the temperature change\nwould also be small.  That's when I decided to measure actual\nperformance.\n\nWhat a difference!  Between the \"Highest\" and \"Automatic\" settings, I\nnoticed a performance difference of over 60%, where I expected to see\nlittle or none.  What I did expect was a performance hit moving to the\n\"Reduced\" setting, which indeed there was, but it was only\nanother 13% worse than \"Automatic.\"  This really seemed wrong to me.\nThat's when I decided to start playing around with the \"nice\" level of\nrpict.\n\nThe \"nice\" setting on a process is a way to tell Unix that a job is not\na top priority, and interactive processes should be given more of the\nCPU if there are any running.  However, in the past, it hasn't much\naffected the performance of a process if there are no other jobs to\ncontend with.  I put nice() calls in Radiance way back when multi- user\nUnix's were the rule, and we had to peacefully coexist with a lot of\nother people who might get annoyed if I hogged all the system resources,\nas Radiance is wont to do.\n\nIn short, I found out that removing the nice() system call from rpict\nachieved the \"Highest\" performance figure even when the Energy Saver\nprocessor speed was set to \"Automatic.\"  (The \"Reduced\" performance was\nnot affected.)  Apparently, Mac OS X 10.4 (at least) uses the process\n\"nice\" setting to decide whether or not to kick the CPU speed up a\nnotch.  This might be a new feature of the OS, as I don't have access to\na maching running Jaguar or Panther to try it there.\n\nThe bottom line in all this is that if you own a Mac and you're running\nRadiance on it, be sure to use the \"Highest\" setting in the Energy Saver\ncontrol panel, because if you don't, your rendering might just be\nrunning 60% slower than you would like it to.  Option B is to remove the\n-DNICE= arguments from the build lines in src/rt/ Rmakefile and remove\nthe affected object files (rpmain.o and\nrtmain.o) then rerun \"rmake install\" in the rt directory.  Or, download\nSaturday's HEAD release and build that.  (I think I'm too late for\ntomorrow.)  Then, you can leave the processor performance on\n\"Automatic,\" which is the default for normal operation.\n\nI wish I had made this discovery a couple of years ago....\n\n-Greg\n\n\n_______________________________________________\nRadiance-general mailing list\nRadiance-general@radiance-online.org\nhttp://www.radiance-online.org/mailman/listinfo/radiance-general\n\n", "isquestion": true, "replyTo": "", "tags": [], "sender": "adiance-general-bounces@radiance-online.or", "datetime": "Mon Dec 19 14:35:39 2005"}