{"refs": [], "id": "", "subject": "Re: [Radiance-general] water simulation", "email": "\"Gregory J. Ward\"", "body": "<1CD1EC8C-0CF6-47D5-9CEB-95D5DA70D4E1@gmail.com>\nMessage-ID: <000901c674f4$5ca3aab0$0301a8c0@aisxeon>\n\nThanks Greg, i think i'm near to get it, but there is something that is not\nworking, i dont know if Rdot is the DOT product or the -DOT product, i tried\nthe two but it is still not working, i?ve been trying to do some tests with\ncalc and it seems to work but something must be wrong because rpict gives\nthe aiming error, what is the best tool in radiance to test this kind of\nthings, i say, testing cal files while sending rays\n\nvoid prism2 water\n9 transm dx dy dz reflect dxx dyy dzz water.cal\n0\n3 1 1 1\n\n####water.cal#####\nnrwater=1.3;\n\ncos1=if(Rdot,Rdot,-Rdot);\nnratio=if(Rdot,1/nrwater,nrwater);\ndnormx=if(Rdot,Nx,-Nx);\ndnormy=if(Rdot,Ny,-Ny);\ndnormz=if(Rdot,Nz,-Nz);\n\nd3=1.0-(nratio*nratio*(1.0 -(cos1*cos1)));\ncos2=sqrt(d3);\nd1bis=cos1;\nd2bis=nratio*cos2;\nd1t=(d1bis-d2bis)/(d1bis+d2bis);\nreflpp=d1t*d1t;\nd1p=1.0/cos1;\nd2=nratio/cos2;\nd1=(d1p-d2)/(d1p+d2);\nreflp=reflpp+(d1*d1);\nrefl=reflp*.5;\ntransp=1.0 -refl;\ntrans=transp*nratio*nratio;\n\n\nreflect=if(d3,refl,1.0);\ntransm=if(d3,trans,0.0);\n\ndm=nratio*cos1 - cos2;\n\ndx=nratio*Dx+dm*dnormx;\ndy=nratio*Dy+dm*dnormy;\ndz=nratio*Dz+dm*dnormz;\n\ndxx=Dx+2.0*cos1*dnormx;\ndyy=Dy+2.0*cos1*dnormy;\ndzz=Dz+2.0*cos1*dnormz;\n\n\n\n\n----- Original Message -----\nTo: \"Radiance general discussion\" <radiance-general@radiance-online.org>\nSent: Wednesday, May 10, 2006 10:02 PM\n\nHi Ignacio,\n\nYour problem stems from the fact that your modified angles do not\nobey reciprocity, which says that if you reverse the ray (light)\ndirection, then the angles remain the same on either side.  Both\nprisma and prism2 require this property to function.  Implementing\nSnell's law correctly, you should get a working material.\n\nThe vector version of Snell's law may be found in ray/src/\ndielectric.c, or in an easier-to-read form on Wikipedia:\n\nhttp://en.wikipedia.org/wiki/Snell's_law\n\nNote that the roles of the inside and outside indices of refraction,\nn1 and n2, reverse when you come from one side of the water verses\nthe other.  The n of water is about 1.3, and air is of course 1.0.\n(OK, quibblers, air is really 1.0003)\n\n-Greg\n\n\n_______________________________________________\nRadiance-general mailing list\nRadiance-general@radiance-online.org\nhttp://www.radiance-online.org/mailman/listinfo/radiance-general\n\n\n", "isquestion": true, "replyTo": "", "tags": [], "sender": "gregoryjward@gmail.com", "datetime": "Thu May 11 14:20:40 2006"}