{"refs": [], "id": "<10187.213.58.97.18.1170343073.squirrel@webmail2.londonmet.ac.uk>", "subject": "[Radiance-general] pcomb photometrically corr", "email": "a.jacobs at londonmet.ac.uk", "body": "\nDear all,\n\nI'm trying to process an HDR image to pick out the light source. The image\nwas taken with hdrgen:\nRGBE: http://luminance.londonmet.ac.uk/pickup/004.hdr\nfalsecolor: http://luminance.londonmet.ac.uk/pickup/004_fc.jpg\nHeader:\n$ head -10 004.hdr\n#?RADIANCE\nCAMERA= NIKON E990 version E990v1.1\nhdrgen created HDR image from '0129_012.jpg' '0129_011.jpg' '0129_010.jpg'\n'0129_009.jpg' '0129_008.jpg' '0129_007.jpg' '0129_006.jpg' '0129_005.jpg'\n'0129_004.jpg' '0129_003.jpg' '0129_002.jpg' '0129_001.jpg'\nRemoved lens flare\nEXPOSURE=4.175030e-01\nCAPDATE= 2007:01:29 17:33:57\nPRIMARIES= 0.6400 0.3300 0.3000 0.6000 0.1500 0.0600 0.3127 0.3290\nFORMAT=32-bit_rle_rgbe\n-Y 768 +X 1024\n\nWhat I'm after is to black out all pixels below a certain threshold, and\nleave all others, i.e. the ones that are part of the light source\nuntouched.\n\nFirstly, a quick test-run to warm up:\n$ pcomb -e 'lo=li(1)' -o 004.hdr > test.pic ; ximage test.pic &\nThis does nothing but show the brightness. The -o ensures I get\nphotometric units.\n\nFine so far. BUT: If I run the same command straight into ximage, the\npicture looks the same, but hitting 'L' displays a luminance of 0.0 for\nall pixels (the square light source should have a luminance of just under\n500 cd/m2):\n$ pcomb -e 'lo=li(1)' -o 004.hdr |ximage\nThis is the first thing that I don't understand.\n\nSecond question: To set the threshold to 400 cd/m2 like described above, I\nrun:\n$ pcomb -e 'lo=if(li(1)-400/WE,li(1),0)' -o 004.hdr > test.pic ; ximage\ntest.pic &\nWE is the white efficacy, which seems to be read-only: Setting WE=2000\ndoesn't do anything.\nURL: http://luminance.londonmet.ac.uk/pickup/400.png (the light only --\nrest is black)\n\n\"... WE gives the white efficacy (lumens/brightness) for pixel values,\nwhich may be used with the -o option or the  le(n) values to convert to\nabsolute photometric units (see below)\"\n\nThe exposure value le(n) is the same for the entire picture (in my case\njust over 0.4), so is it correct to say that I only have to worry about it\nwhen combining multiple images? And that WE is equally useful with li(n),\nnot just li(n) and -o?\n\nSo combining multiple images with different exposures would be done like so:\n$ pcomb -e 'lo=li(1)/le(1)+li(2)/le(2)' -o 004.hdr 006.hdr > test.pic\nRight?\n\nThanks for shedding some light on the issue.\n\nCheers\n\nAxel\n\n\n\n", "isquestion": true, "replyTo": "", "tags": [], "sender": "Axel Jacobs", "datetime": "Thu Feb  1 16:18:14 2007"}