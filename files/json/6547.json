{"body": "\nHello Marcin,\n\nI am struggling a little bit with the language barrier, but I'm going\nto assume you don't wish to continue the previous discussion, and are\ninstead focused on modifying rayparticipate to model the formula you\ngive below.  I won't ask why you want it, but here are the changes to\nget you there:\n\nextern void\nrayparticipate(            /* compute ray medium participation */\nregister RAY  *r\n)\n{\nCOLOR    ce, ca;\ndouble    re, ge, be;\ndouble    rv, gv, bv;\n/* modified to return: L(s)+[L(0)-L(s)]*[1-exp(-ext*s)] */\n/* not that this equals: L(0)*exp(-ext*s)+[L(0)-L(0)*exp(-ext*s)]*\n[1-exp(-ext*s)] */\n/* which reduces to: L(0)*[1 - exp(-ext*s) + exp(-2*ext*s)] */\nif (intens(r->cext) <= 1./FHUGE)\nreturn;                /* no medium */\nre = r->rot*colval(r->cext,RED);\nge = r->rot*colval(r->cext,GRN);\nbe = r->rot*colval(r->cext,BLU);\nif (r->crtype & SHADOW) {        /* no scattering for sources */\nre *= 1. - colval(r->albedo,RED);\nge *= 1. - colval(r->albedo,GRN);\nbe *= 1. - colval(r->albedo,BLU);\n}\nrv = 1. - (re<=FTINY ? 1. : re>92. ? 0. : exp(-re)) +\n(re<=FTINY ? 1. : re>46. ? 0. : exp(-2.*re));\ngv = 1. - (ge<=FTINY ? 1. : ge>92. ? 0. : exp(-ge)) +\n(ge<=FTINY ? 1. : ge>46. ? 0. : exp(-2.*ge));\nbv = 1. - (be<=FTINY ? 1. : be>92. ? 0. : exp(-be)) +\n(be<=FTINY ? 1. : be>46. ? 0. : exp(-2.*rebe);\nsetcolor(ce, rv, gv, bv);\nmultcolor(r->rcol, ce);            /* path extinction */\nif (r->crtype & SHADOW || intens(r->albedo) <= FTINY)\nreturn;                /* no scattering */\nsetcolor(ca,\ncolval(r->albedo,RED)*colval(ambval,RED)*(1.-colval(ce,RED)),\ncolval(r->albedo,GRN)*colval(ambval,GRN)*(1.-colval(ce,GRN)),\ncolval(r->albedo,BLU)*colval(ambval,BLU)*(1.-colval(ce,BLU)));\naddcolor(r->rcol, ca);            /* ambient in scattering */\nsrcscatter(r);                /* source in scattering */\n}\n\nHope this is useful.\n-Greg\n\n\n", "replyTo": "Subject: [Radiance-general] Re: rtrace: -ospec options", "sender": "Greg Ward", "isquestion": false, "tags": [], "id": "<F3B71CED-3E2C-4B82-AD8D-8EB16989FC6F@lmi.net>", "refs": ["<47F0C242.8000709@poczta.fm>", "<A1406DFC-B4FB-45AB-BF6C-8321010A3094@lmi.net>", "<48106DDB.8000200@poczta.fm>"], "datetime": "Fri Apr 25 21:08:47 2008", "email": "gregoryjward at gmail.com", "subject": "[Radiance-general] Re: rtrace: -ospec options"}