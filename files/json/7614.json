{"refs": [], "id": "", "subject": "[Radiance-general] Obtaining proper luminance values in scene imaggenerated using HDR sky-probe luminance data", "email": "kskonis at gmail.com", "body": "Message-ID: <CAAzVHq25fk5pcpZYBEAPNDqZiGgrh=fRfKVM-mLKkkht3xsyMg@mail.gmail.com>\n\nDear list,\n\nI am exploring image-based lighting in Radiance and have encountered\nseveral issues with the luminance values in the scene images i am\ngenerating. I am starting with a hemispherical fisheye image of the\nsky which must be cropped to a square format via pcompos.\n\nThis process leads to a header which puts the EXPOSURE=5.953331e-03 in\na location which creates a problem in that the pixel values, as viewed\nin Photosphere or when rendered via rpict to a test image (looking up\nfrom the origin at the sky), are much lower than the original HDR\nimage.\n\n#?RADIANCE\nCAPDATE= 2012:10:21 17:05:24\nGMT= 2012:10:22 00:05:24\n20111019_cloudy/201110191248.hdr:\nCAMERA= Canon Canon PowerShot A570 IS version v.0\nEXPOSURE=5.953331e-03\nVIEW= -vtv -vh 52.456387 -vv 40.558973\nCAPDATE= 2011:10:19 12:48:08\nhdrgen created HDR image from 'IMG_0685.JPG' 'IMG_0684.JPG'\n'IMG_0683.JPG' 'IMG_0682.JPG' 'IMG_0681.JPG'\nPRIMARIES= 0.6400 0.3300 0.3000 0.6000 0.1500 0.0600 0.3127 0.3290\npcompos -x 1280 -y 1280 20111019_cloudy/201110191248.hdr -340 -100\npfilt -1 -x 600 -y 600\npflip -v -c\npflip -h -c\nFORMAT=32-bit_rle_rgbe\nprotate -r -c\n\n-Y 600 +X 600\n\n\nIn other words, when the EXPOSURE=5.953331e-03 line is in its\noriginal position, e.g.:\n\n\n#?RADIANCE\nCAMERA= Canon Canon PowerShot A570 IS version v.0\nEXPOSURE=5.953331e-03\nVIEW= -vtv -vh 52.456387 -vv 40.558973\nCAPDATE= 2011:10:19 12:48:08\nhdrgen created HDR image from 'IMG_0685.JPG' 'IMG_0684.JPG'\n'IMG_0683.JPG' 'IMG_0682.JPG' 'IMG_0681.JPG'\nPRIMARIES= 0.6400 0.3300 0.3000 0.6000 0.1500 0.0600 0.3127 0.3290\nFORMAT=32-bit_rle_rgbe\n\n-Y 1536 +X 2048\n\n...... all is well, and the image displays the correct luminance\nvalues for the sky in Photosphere.  Because i need to crop this image\nto a square format to use it as a light probe, i cannot confirm that a\ntest image (again, looking up from the origin) would render with the\nproper luminance values, but my guess is that it would.\n\n\nI am using the following text to describe an image-based lighting\nenvironment consisting of a hemispherical fish-eye image of the sky.\n\n# Image-Based Lighting Environment\nvoid colorpict hdr_probe_image\n7 red green blue sky_image/HDR_sky_temp.hdr angmap_sky.cal u v\n0\n0\n\n# specify a \"glow\" material that will use this image\nhdr_probe_image glow light_probe\n0\n0\n4 1 1 1 0\n\nlight_probe source ibl_environment\n0\n0\n4 0 0 1 180\n\n\n\nI have tried a number of scripts to manipulate the header text to\nreturn the EXPOSURE=5.953331e-03 line to a location where it is again\nutilized.  In this example (below), which just sticks the line up at\nthe top, Photosphere reads the image and scales the pixels by the\nexposure value. However, when a scene is rendered using the image as a\nlight probe, the test image again has very low sky luminance values.\n\n\n#?RADIANCE\nEXPOSURE=5.953331e-03\n#?RADIANCE\nCAPDATE= 2012:10:21 17:05:24\nGMT= 2012:10:22 00:05:24\n20111019_cloudy/201110191248.hdr:\nCAMERA= Canon Canon PowerShot A570 IS version v.0\nEXPOSURE=5.953331e-03\nVIEW= -vtv -vh 52.456387 -vv 40.558973\nCAPDATE= 2011:10:19 12:48:08\nhdrgen created HDR image from 'IMG_0685.JPG' 'IMG_0684.JPG'\n'IMG_0683.JPG' 'IMG_0682.JPG' 'IMG_0681.JPG'\nPRIMARIES= 0.6400 0.3300 0.3000 0.6000 0.1500 0.0600 0.3127 0.3290\npcompos -x 1280 -y 1280 20111019_cloudy/201110191248.hdr -340 -100\npfilt -1 -x 600 -y 600\npflip -v -c\npflip -h -c\nFORMAT=32-bit_rle_rgbe\nprotate -r -c\n\n-Y 600 +X 600\n\n\nMy questions to the list, ultimately are:\n\n1) Does the colorpict pattern type, or image-based lighting process in\ngeneral, have any relationship to the EXPOSURE value of the HDR image?\nIf not, i suppose the solution is to scale all the pixel values in\nthe image and forget about where the EXPOSURE line is in the header.\n\n2) If the EXPOSURE line in the header is relevant, can anyone\nrecommend a scripting technique to cook up the proper header text and\nthen attach the binary image data from the manipulated (e.g. pcompos,\npflip, pfilt) HDR images? For example, i have used \"getinfo\" to grab\nthe header from the original image and \"grep\" to grab the EXPOSURE\nline, i write these to a new file (with #?RADIANCE) as the first line.\nI then cat the manipulated image file to this new file. This results\nin an inelegant header for the new file, works in Photosphere, but, as\nmentioned above, does not lead to a proper sky luminance results when\nused to generate scene images in radiance.\n\nAny suggestions would be appreciated!\n\n\n-Kyle\n\n\n", "isquestion": true, "replyTo": "", "tags": [], "sender": "Kyle Konis", "datetime": "Fri, 23 Nov 2012 16:19:25 -0800"}