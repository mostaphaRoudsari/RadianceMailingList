{"refs": [], "id": "<CA+dqh61o4Jpaz4XX=SiATVj+bsHakbeMHgLxMzaNCx027XKbHg@mail.gmail.com>", "subject": "[Radiance-general] 2.5-phase method and gendaymtx", "email": "jacobs.axel at gmail.com", "body": "\n(Couldn't come up with a sillier subject line for this)\n\nDear list,\n\nI am trying to use rcontrib and dctimestep in my only-just-invented\n2.5-phase method.  The idea is simple: Instead of relying on the patch\nbrightness to represent both sun and sky, I would like to only use the\npatches for the sky, and rely on 'real' suns for an annual simulation.\nThis is somewhat related to Andy's 5-phase method, but but I'm still\nat the stage where I have simple windows and no BSDF or Klems stuff.\nWhat I am hoping to find out is whether the inclusion of 'proper' suns\nmakes a difference compared to the old skool rcontrib approach where\nthe sky patches represent the sun + sky.\n\nI've tarred up the script and all the input files.  They are available here:\nhttp://www.jaloxa.eu/pickup/cbdm4_diffdir.tgz\n\nThe script is a bit lengthy:\n\n---------------------8<-----------------------\n#!/bin/bash\n\nPROJECT=\"dds4\"\nOPT=\"ab7rtc\"\nSKYOCT=\"octrees/${PROJECT}_sky.oct\"\nSUNOCT=\"octrees/${PROJECT}_sun.oct\"\nREINHART=1\nWEA=\"weather/gatwick.wea\"\nNPROC=5\n\n# Sensor results with header\nstmp=\"tmp\"\nif [ ! -d $stmp ]; then\nmkdir $stmp\nelse\nrm -f $stmp/*\nfi\n\nwbase=$(basename $WEA .wea)\nfsmx=\"$stmp/${wbase}_m$REINHART.fsmx\"     # annual diffuse sky matrix\ndsmx=\"$stmp/${wbase}_m$REINHART.dsmx\"     # annual direct sun matrix\ncsmx=\"$stmp/${wbase}_m$REINHART.csmx\"     # annual combined matrix\nsuns=\"$stmp/suns_m${REINHART}.rad\"        # annual suns\n\n# Build the diffuse sky matrix for Tregenza subdivision\n# -O1 (total solar irradiance), so we can compare against WEA file\necho \"  Building annual diffuse sky matrix $fsmx...\"\ngendaymtx -s -m $REINHART -c 1 1 1 -O1 $WEA > $fsmx\n\n# Build the direct suns\necho \"  Building annual suns $suns...\"\necho \"void light solar 0 0 3 1e6 1e6 1e6\" > $suns\nnpatch=$( echo 1 |rcalc -e MF:2 -f reinhart.cal -e '$1=Nrbins' )\ncnt $npatch |rcalc -e MF:$REINHART -f reinsrc.cal -e Rbin=recno \\\n-o 'solar source sun 0 0 4 ${ Dx } ${ Dy } ${ Dz } 0.533' >> $suns\ngendaymtx -5 -d -m $REINHART -c 1 1 1 -O1 $WEA > $dsmx\n\n# Build direct+diffuse (old skool)\necho \"  Building annual combined sun+sky matrix $csmx...\"\ngendaymtx -m $REINHART -c 1 1 1 -O1 $WEA > $csmx\n\necho \"    Compiling octrees...\"\noconv skies/sky_white.rad > $SKYOCT\noconv $suns > $SUNOCT\n\necho \"Grid: roof.pts\"\ngrid=roof.pts\nbase=$(basename roof .pts)\n\nskdc=\"$stmp/${PROJECT}_${OPT}_$base.skdc\"     # diffuse sky DC\nsndc=\"$stmp/${PROJECT}_${OPT}_$base.sndc\"     # direct sun DC\n\n# Run the DDS calculations: Daylight Matrix with header\necho \"  Calculating sky DC $skdc...\"\ncat $grid \\\n|rcontrib -n $NPROC @$OPT.opt \\\n-e MF:$REINHART -f reinhart.cal -bn Nrbins -b rbin \\\n-o $skdc -m sky_glow $SKYOCT\n\necho \"  Calculating sun DC $sndc...\"\ncat $grid \\\n|rcontrib -n $NPROC @$OPT.opt \\\n-e MF:$REINHART -f reinhart.cal -bn Nrbins -b rbin \\\n-o $sndc -m solar $SUNOCT\n\n\nfimx=\"$stmp/${PROJECT}_${OPT}_$base.fimx\"     # annual diffuse irradiance matrix\ndimx=\"$stmp/${PROJECT}_${OPT}_$base.dimx\"     # annual direct irradiance matrix\ncimx=\"$stmp/${PROJECT}_${OPT}_$base.cimx\"     # annual combined\nirradiance matrix\n\n# Produce annual (grey) sensor irradiance matrix\necho \"  Calculating annual direct irradiance $dimx...\"\ndctimestep -n 8760 $sndc $dsmx |tr '\\t' '\\n' |sed -e '/^\\s*$/d' \\\n|rcalc -e '$1=$1' > $dimx\n\necho \"  Calculating annual diffuse irradiance $fimx...\"\ndctimestep -n 8760 $skdc $fsmx |tr '\\t' '\\n' |sed -e '/^\\s*$/d' \\\n|rcalc -e '$1=$1' > $fimx\n\necho \"  Calculating annual combined irradiance $cimx...\"\ndctimestep -n 8760 $skdc $csmx |tr '\\t' '\\n' |sed -e '/^\\s*$/d' \\\n|rcalc -e '$1=$1' > $cimx\n\nimx2=\"$stmp/${PROJECT}_${OPT}_$base.imx2\"   # annual sky+sun irradiance matrix\nirr=\"$stmp/${PROJECT}_${OPT}_$base.irr\"    # annual grey irradiance\n\n# Add direct and diffuse\nrlam $fimx $dimx |rcalc -e '$1=$1+$2' > $imx2\n\necho -e \"month\\tday\\ttime\\tin_dir\\tin_diff\\tdir\\tdiff\\tdir+diff\\tcomb\" > $irr\ntail -n +7 $WEA |rlam - $dimx $fimx $imx2 $cimx >> $irr\n\n#EOF\n---------------------8<-----------------------\n\nThere is absolutely no geometry at all--just the sky/suns. The final\nresuls are stored under ./tmp/ in the file with the *.irr extension\n\nhere are the first few lines:\n\nmonth    day    time    in_dir    in_diff    dir    diff    dir+diff    comb\n1 1 0.500 0 0    0    0    0    0\n1 1 1.500 0 0    0    0    0    0\n1 1 2.500 0 0    0    0    0    0\n1 1 3.500 0 0    0    0    0    0\n1 1 4.500 0 0    0    0    0    0\n1 1 5.500 0 0    0    0    0    0\n1 1 6.500 0 0    0    0    0    0\n1 1 7.500 0 0    0    0    0    0\n1 1 8.500 0 19    6.01    6.01    12.02    6.01\n1 1 9.500 7 51    16.6    16.6    33.2    16.6\n1 1 10.500 17 88    28.2    28.2    56.4    28.2\n1 1 11.500 22 109    34.8    34.8    69.6    34.8\n1 1 12.500 22 110    35.2    35.2    70.4    35.2\n1 1 13.500 17 91    29.2    29.2    58.4    29.2\n1 1 14.500 4 56    18.2    18.2    36.4    18.2\n1 1 15.500 0 6    2.14    2.14    4.28    2.14\n1 1 16.500 0 0    0    0    0    0\n...\n\nWhat I am measuring is the horizontal unobstructed irradiance.\n\nThe first five columns are essentially the wea file:\nmonth    day    time    in_dir    in_diff\nto which the following have been laminated:\ndir:  gendaymtx -5 -d; no sky, just 145 suns\ndiff:  gendaymtx -s; no suns, Tregenza patches, only diffuse contribution\ndir+diff: dir + diff\ncomb: gendaymtx; no suns, Tregenza patches, diffuse and direct\ncontribution.  This is old skool for comparison.\n\nI simply cannot make any sense of the results,  so I'm wondering\nwhether I am misunderstanding the concept behind the -5 option to\ngendaymtx.\n\nTake, for instance, this row:\n1 1 8.500 0 19    6.01    6.01    12.02    6.01\nThere is no direct irradiance recorded in the wea file.  Yet, the\ngendaymtx/rcontrib calculation produces 6.01 W/m2 (very low-angle\nsun).\nAlso, I don't get why dir = diff = comb ???\n\nI am probably using gendaymtx and rcontrib improperly, but have been\nstaring at this for quite a few hours now, without being able to work\nout where I am making the mistakes.\n\nWould anybody be able to offer assistance with this?\n\nI have also tried doing the same think with genskyvec.  It doesn't\ncomplain when I give it the -5 option, but the results are simularly\nconfusing.\n\nMany thanks for your help\n\nBest regards\n\nAxel\n\n\n", "isquestion": true, "replyTo": "", "tags": [], "sender": "Axel Jacobs", "datetime": "Thu, 6 Feb 2014 16:09:54 +0000"}