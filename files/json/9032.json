{"refs": ["<BE219063-594C-4496-97DF-1259112872EB@coolshadow.com>", "<C3D724DF-A7E0-479E-A4ED-F5A783C60125@lmi.net>"], "id": "<005CD8D3-C4A3-4AD4-B82D-BCAFCA8D118E@gmail.com>", "subject": "[Radiance-general] Ambient File and BSDF", "email": "gregoryjward at gmail.com", "body": "\nHi Stephen,\n\nThis turned out to be a subtle problem that I've seen on rare occasions in the past related to the direct approximation in Radiance.  If you set -dt 0, the issue goes away (and accuracy improves).  In 1990 or so, I implemented an optimization in Radiance for many light sources that comes up with a statistical estimate of direct illumination.  It usually doesn't cause any issues, but in scenes with one or two sources and a lot of indirect illumination, it can result in systematic errors when you compute a scanline at a time.\n\nIn your scene, the indirect rays are all inside, and never see the sun directly.  (Even the rays that hit the window count as indirect.)  Thus, the statistical estimate of hitting the sun is very small or zero.  Once the rendering reaches the window, however, it treats it like a trans and computes direct rays from the opposite side, with nearly 100% of hitting the sun.  This causes a sudden shift in the statistical estimate, so that subsequent rays that forgo testing get this higher estimate.\n\nAs a fix, I've changed the code so with 4 or fewer sources, shadow rays will be sent every time, even when indirect dominates.  This should eliminate this problem and others like it.  I wish I had thought of this fix a long time ago....\n\nCheers,\n-Greg\n\n\n\n", "isquestion": false, "replyTo": "Subject: [Radiance-general] Ambient File and BSDF", "tags": [], "sender": "Gregory J. Ward", "datetime": "Sun, 14 Sep 2014 20:38:37 -0700"}