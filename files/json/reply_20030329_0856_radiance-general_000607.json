{"body": "Lars Grobe < grobe@gmx.net> writes:\n\n\n> While I am trying to get the solaris build ready, I have one problem \n> here with\n> Radiance 3.5, GCC 3.2.2 and Solaris 9:  the function disp_wait in \n> rhdisp.c gives\n> me an error:\n>\n> gcc -I../common -L../lib -O3 -mcpu=v9 -mtune=v9 -m32 -DSPEED=200\n> -ffast-math -Dlinux -L/usr/openwin/lib -I/usr/openwin/include \n> -DNOSTEREO\n> -DBIGMEM  -c  rhdisp.c\n> rhdisp.c: In function `disp_wait':\n> rhdisp.c:164: structure has no member named `_IO_read_end'\n> rhdisp.c:164: structure has no member named `_IO_read_ptr'\n> rhdisp.c:166: structure has no member named `_IO_read_end'\n> rhdisp.c:166: structure has no member named `_IO_read_ptr'\n> *** Error code 1\n\n\nThis is a nasty little bit of code that unfortunately is very difficult \nto find a portable solution for.  At the top of rhdisp.c there is a \nmacro called \"fbufcnt(f)\" that is supposed to return the number of \nunread bytes in a FILE f's input buffer.  There is no standard (or even \nconventional) way to do this, so I have a few different hacks in there \nthat work on a few different systems.  If this macro isn't operational, \nrholo could lock up in interactive mode.  The way around using such a \nmacro would be a lot of really ugly code, which is why I've done like \nthis.\n\n\nThe easist solution for solaris is to find the definition of the FILE \nstruct, which can be difficult to locate through the typical maze of \n#ifdef's that proliferated since the inception of 3 or more so-called \n\"standard\" UNIX's.  I usually get the output of the C preprocessor and \nscan it for the FILE struct that is brought in with stdio.h.  I then \nhave to make an educated guess as to how the pointers in this struct \nare used, and define the fbufcnt() macro accordingly.  It's a real \ntragedy they never standardized such a function, as it's invaluable for \noperations involving multiple input streams.\n\n\n-Greg\n___\n<sup>Automatically generated content from [radiance mailing-list](https://radiance-online.org/pipermail/radiance-general/2003-March/000607.html).</sup>", "attachments": [], "created_by_name": "Greg Ward", "created_at": "March 29, 2003 at 08:56AM", "created_by": "Greg_Ward", "parent_id": "radiance-general_000606", "id": "radiance-general_000607"}