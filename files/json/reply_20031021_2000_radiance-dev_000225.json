{"body": "Hi,\n\n\nradiance 3.5.0 will not build out of the box on my system (linux system\nwith glibc version 2.3.1 and gcc version 3.2.2).  The problem is that\nerrno.h is not always #include'ed in every file that uses the global errno\nvariable.  I'm surprised one can get away with this on any system but I\nguess some C compilers assume extern int for all unresolved references?  \nWho knows.  Anyway... the following patch adds errno.h where it seems to\nbe needed and gets radiance building fairly cleanly on my system.\n\n\nThis touches LOTS of files and probably doesn't add the #include's in ways\nthat make the maintainer(s) of those files happy (blank lines, etc.).  \nAlso, radiance has a bit of a header-file spaghetti thing going on so it's\nhard to tell what is actually including what.  In the end I got sick of\nadding one \"#incude <errno.h>\" at a time and testing with a rebuild so I\njust grepped for files that reference errno but don't have errno.h.  I did\ntry to decide if they might get errno.h through some other header file but\nonly checked this as far as my own patience could tolerate.  SOOO.... this\npatch might add a few that aren't really needed.\n\n\nGood luck, and thanks all for a very fun piece of software!\n\n\n\t\t\t\t\t\t\t-Kipp\n\n\n\n\ndiff -uNr ray-orig/src/cal/ev.c ray/src/cal/ev.c\n--- ray-orig/src/cal/ev.c\t2003-02-21 19:07:20.000000000 -0700\n+++ ray/src/cal/ev.c\t2003-10-05 00:04:09.000000000 -0600\n@@ -8,6 +8,7 @@\n  */\n\n\n #include  <stdio.h>\n+#include  <errno.h>\n\n\n #include  \"calcomp.h\"\n\n\ndiff -uNr ray-orig/src/gen/mkillum2.c ray/src/gen/mkillum2.c\n--- ray-orig/src/gen/mkillum2.c\t2003-02-21 19:07:24.000000000 -0700\n+++ ray/src/gen/mkillum2.c\t2003-10-05 00:07:34.000000000 -0600\n@@ -5,6 +5,7 @@\n  * Routines to do the actual calculation for mkillum\n  */\n\n\n+#include  <errno.h>\n #include  \"mkillum.h\"\n\n\n #include  \"face.h\"\ndiff -uNr ray-orig/src/gen/mkillum.c ray/src/gen/mkillum.c\n--- ray-orig/src/gen/mkillum.c\t2003-03-11 12:29:05.000000000 -0700\n+++ ray/src/gen/mkillum.c\t2003-10-05 00:06:23.000000000 -0600\n@@ -8,7 +8,7 @@\n #include  \"mkillum.h\"\n\n\n #include  <signal.h>\n\n\n+#include  <errno.h>\n #include  <ctype.h>\n\n\n \t\t\t\t/* default parameters */\ndiff -uNr ray-orig/src/hd/holofile.c ray/src/hd/holofile.c\n--- ray-orig/src/hd/holofile.c\t2003-02-21 19:07:24.000000000 -0700\n+++ ray/src/hd/holofile.c\t2003-10-05 00:08:22.000000000 -0600\n@@ -7,6 +7,7 @@\n  *\t9/30/97\tGWLarson\n  */\n\n\n+#include <errno.h>\n #include \"holo.h\"\n\n\n #ifndef CACHESIZE\ndiff -uNr ray-orig/src/hd/rhdisp.c ray/src/hd/rhdisp.c\n--- ray-orig/src/hd/rhdisp.c\t2003-02-21 19:07:24.000000000 -0700\n+++ ray/src/hd/rhdisp.c\t2003-10-05 00:08:37.000000000 -0600\n@@ -10,6 +10,7 @@\n #include \"rhdriver.h\"\n #include \"selcall.h\"\n #include <ctype.h>\n+#include <errno.h>\n\n\n #ifndef VIEWHISTLEN\n #define VIEWHISTLEN\t4\t/* number of remembered views */\ndiff -uNr ray-orig/src/hd/rholo2l.c ray/src/hd/rholo2l.c\n--- ray-orig/src/hd/rholo2l.c\t2003-02-21 19:07:25.000000000 -0700\n+++ ray/src/hd/rholo2l.c\t2003-10-05 00:08:49.000000000 -0600\n@@ -9,6 +9,7 @@\n #include \"random.h\"\n #include \"paths.h\"\n #include \"selcall.h\"\n+#include <errno.h>\n #include <signal.h>\n #include <sys/time.h>\n\n\ndiff -uNr ray-orig/src/hd/rholo4.c ray/src/hd/rholo4.c\n--- ray-orig/src/hd/rholo4.c\t2003-02-21 19:07:25.000000000 -0700\n+++ ray/src/hd/rholo4.c\t2003-10-05 00:09:02.000000000 -0600\n@@ -7,6 +7,7 @@\n\n\n #include \"rholo.h\"\n #include \"rhdisp.h\"\n+#include <errno.h>\n #include <sys/uio.h>\n\n\n #ifndef HDSUF\ndiff -uNr ray-orig/src/px/tiff/contrib/mfs/mfs_file.c ray/src/px/tiff/contrib/mfs/mfs_file.c\n--- ray-orig/src/px/tiff/contrib/mfs/mfs_file.c\t1997-08-29 16:56:40.000000000 -0600\n+++ ray/src/px/tiff/contrib/mfs/mfs_file.c\t2003-10-05 00:09:37.000000000 -0600\n@@ -44,6 +44,7 @@\n #include\t<stdio.h>\n #include\t<stdlib.h>\n #include\t<string.h>\n+#include\t<errno.h>\n\n\n /*\n\n\ndiff -uNr ray-orig/src/rt/aniso.c ray/src/rt/aniso.c\n--- ray-orig/src/rt/aniso.c\t2003-03-12 10:26:58.000000000 -0700\n+++ ray/src/rt/aniso.c\t2003-10-05 00:10:13.000000000 -0600\n@@ -5,6 +5,7 @@\n  *  Shading functions for anisotropic materials.\n  */\n\n\n+#include <errno.h>\n #include \"copyright.h\"\n\n\n #include  \"ray.h\"\ndiff -uNr ray-orig/src/rt/m_brdf.c ray/src/rt/m_brdf.c\n--- ray-orig/src/rt/m_brdf.c\t2003-03-05 09:16:53.000000000 -0700\n+++ ray/src/rt/m_brdf.c\t2003-10-05 00:10:37.000000000 -0600\n@@ -5,6 +5,7 @@\n  *  Shading for materials with arbitrary BRDF's\n  */\n\n\n+#include <errno.h>\n #include \"copyright.h\"\n\n\n #include  \"ray.h\"\ndiff -uNr ray-orig/src/rt/m_direct.c ray/src/rt/m_direct.c\n--- ray-orig/src/rt/m_direct.c\t2003-03-05 09:16:53.000000000 -0700\n+++ ray/src/rt/m_direct.c\t2003-10-05 00:10:47.000000000 -0600\n@@ -6,6 +6,7 @@\n  *   their associated virtual light sources\n  */\n\n\n+#include <errno.h>\n #include \"copyright.h\"\n\n\n #include  \"ray.h\"\ndiff -uNr ray-orig/src/rt/mx_data.c ray/src/rt/mx_data.c\n--- ray-orig/src/rt/mx_data.c\t2003-03-05 09:16:53.000000000 -0700\n+++ ray/src/rt/mx_data.c\t2003-10-05 00:11:01.000000000 -0600\n@@ -5,6 +5,7 @@\n  *  mx_data.c - routine for stored mixtures.\n  */\n\n\n+#include <errno.h>\n #include \"copyright.h\"\n\n\n #include  \"ray.h\"\ndiff -uNr ray-orig/src/rt/mx_func.c ray/src/rt/mx_func.c\n--- ray-orig/src/rt/mx_func.c\t2003-03-05 09:16:53.000000000 -0700\n+++ ray/src/rt/mx_func.c\t2003-10-05 00:11:10.000000000 -0600\n@@ -5,6 +5,7 @@\n  *  mx_func.c - routine for mixture functions.\n  */\n\n\n+#include <errno.h>\n #include \"copyright.h\"\n\n\n #include  \"ray.h\"\ndiff -uNr ray-orig/src/rt/p_data.c ray/src/rt/p_data.c\n--- ray-orig/src/rt/p_data.c\t2003-03-05 09:16:53.000000000 -0700\n+++ ray/src/rt/p_data.c\t2003-10-05 00:11:24.000000000 -0600\n@@ -5,6 +5,7 @@\n  *  p_data.c - routine for stored patterns.\n  */\n\n\n+#include <errno.h>\n #include \"copyright.h\"\n\n\n #include  \"ray.h\"\ndiff -uNr ray-orig/src/rt/p_func.c ray/src/rt/p_func.c\n--- ray-orig/src/rt/p_func.c\t2003-03-05 09:16:53.000000000 -0700\n+++ ray/src/rt/p_func.c\t2003-10-05 00:11:32.000000000 -0600\n@@ -5,6 +5,7 @@\n  *  p_func.c - routine for procedural patterns.\n  */\n\n\n+#include <errno.h>\n #include \"copyright.h\"\n\n\n #include  \"ray.h\"\ndiff -uNr ray-orig/src/rt/raypcalls.c ray/src/rt/raypcalls.c\n--- ray-orig/src/rt/raypcalls.c\t2003-02-24 19:47:23.000000000 -0700\n+++ ray/src/rt/raypcalls.c\t2003-10-05 00:11:48.000000000 -0600\n@@ -7,6 +7,7 @@\n  *  External symbols declared in ray.h\n  */\n\n\n+#include <errno.h>\n #include \"copyright.h\"\n\n\n /*\ndiff -uNr ray-orig/src/rt/rpict.c ray/src/rt/rpict.c\n--- ray-orig/src/rt/rpict.c\t2003-03-10 10:26:26.000000000 -0700\n+++ ray/src/rt/rpict.c\t2003-10-05 00:12:08.000000000 -0600\n@@ -9,6 +9,7 @@\n\n\n #include  \"ray.h\"\n\n\n+#include  <errno.h>\n #include  <sys/types.h>\n\n\n #ifndef NIX\ndiff -uNr ray-orig/src/rt/rpmain.c ray/src/rt/rpmain.c\n--- ray-orig/src/rt/rpmain.c\t2003-02-24 19:47:23.000000000 -0700\n+++ ray/src/rt/rpmain.c\t2003-10-05 00:12:29.000000000 -0600\n@@ -17,6 +17,7 @@\n\n\n #include  \"paths.h\"\n\n\n+#include  <errno.h>\n #include  <sys/types.h>\n\n\n #include  <signal.h>\ndiff -uNr ray-orig/src/rt/rtmain.c ray/src/rt/rtmain.c\n--- ray-orig/src/rt/rtmain.c\t2003-02-24 19:47:23.000000000 -0700\n+++ ray/src/rt/rtmain.c\t2003-10-05 00:12:42.000000000 -0600\n@@ -17,6 +17,7 @@\n\n\n #include  \"paths.h\"\n\n\n+#include  <errno.h>\n #include  <sys/types.h>\n\n\n #include  <signal.h>\ndiff -uNr ray-orig/src/rt/rview.c ray/src/rt/rview.c\n--- ray-orig/src/rt/rview.c\t2003-02-24 19:47:23.000000000 -0700\n+++ ray/src/rt/rview.c\t2003-10-05 00:12:53.000000000 -0600\n@@ -13,6 +13,7 @@\n\n\n #include  \"rpaint.h\"\n\n\n+#include  <errno.h>\n #include  <signal.h>\n\n\n #include  <ctype.h>\ndiff -uNr ray-orig/src/rt/rvmain.c ray/src/rt/rvmain.c\n--- ray-orig/src/rt/rvmain.c\t2003-02-24 19:47:23.000000000 -0700\n+++ ray/src/rt/rvmain.c\t2003-10-05 00:13:08.000000000 -0600\n@@ -17,6 +17,7 @@\n\n\n #include  \"paths.h\"\n\n\n+#include  <errno.h>\n #include  <signal.h>\n\n\n #include  \"view.h\"\ndiff -uNr ray-orig/src/rt/t_data.c ray/src/rt/t_data.c\n--- ray-orig/src/rt/t_data.c\t2003-03-05 09:16:53.000000000 -0700\n+++ ray/src/rt/t_data.c\t2003-10-05 00:13:26.000000000 -0600\n@@ -5,6 +5,7 @@\n  *  t_data.c - routine for stored textures\n  */\n\n\n+#include <errno.h>\n #include \"copyright.h\"\n\n\n #include  \"ray.h\"\ndiff -uNr ray-orig/src/rt/t_func.c ray/src/rt/t_func.c\n--- ray-orig/src/rt/t_func.c\t2003-03-05 09:16:53.000000000 -0700\n+++ ray/src/rt/t_func.c\t2003-10-05 00:13:35.000000000 -0600\n@@ -5,6 +5,7 @@\n  *  t_func.c - routine for procedural textures.\n  */\n\n\n+#include <errno.h>\n #include \"copyright.h\"\n\n\n #include  \"ray.h\"\ndiff -uNr ray-orig/src/util/ranimate.c ray/src/util/ranimate.c\n--- ray-orig/src/util/ranimate.c\t2003-02-24 19:47:24.000000000 -0700\n+++ ray/src/util/ranimate.c\t2003-10-05 00:13:46.000000000 -0600\n@@ -16,6 +16,7 @@\n #include \"copyright.h\"\n\n\n #include \"standard.h\"\n+#include <errno.h>\n #include <ctype.h>\n #include <sys/stat.h>\n #include \"view.h\"\ndiff -uNr ray-orig/src/util/rpiece.c ray/src/util/rpiece.c\n--- ray-orig/src/util/rpiece.c\t2003-02-21 19:07:30.000000000 -0700\n+++ ray/src/util/rpiece.c\t2003-10-05 00:13:59.000000000 -0600\n@@ -5,6 +5,7 @@\n  * Generate sections of a picture.\n  */\n\n\n+#include <errno.h>\n #include \"standard.h\"\n\n\n #ifndef F_SETLKW\n___\n<sup>Automatically generated content from [radiance mailing-list](https://radiance-online.org/pipermail/radiance-dev/2003-October/000225.html).</sup>", "attachments": [], "created_by_name": "Kipp C Cannon", "created_at": "October 21, 2003 at 08:00PM", "created_by": "Kipp_C_Cannon", "parent_id": "radiance-dev_000226", "id": "radiance-dev_000225"}