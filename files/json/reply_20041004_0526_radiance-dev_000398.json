{"body": "On Sun, Oct 03, 2004 at 08:12:56PM -0400, Georg Mischler wrote:\n> Randolph Fritz wrote:\n> \n> > >\n> > > But you're right. Even if most compilers allow it, by the books\n> > > it's not legal to do pointer arithmetic with void pointers.\n> >\n> > Not exactly...it's \"undefined\".\n> \n> That's the same thing for most pratical purposes.\n> \n\n\nNo, some environments (like gcc) define it.  The problem is that it\nonly works in some environments and it cannot be counted on to work in\nthe same way in environments where it does work.  \"void *\" does work\nwith gcc, whereas I'm not sure a \"char *\" version always will.\n\n\n> \n> >   That code is intended to improve virtual memory\n> > performance; such code is, unfortunately, system-dependent and belongs\n> > in the non-existant bottle we need to keep system-dependent stuff.\n> \n> I can't find anything system-dependent in that code, other\n> than it may help more on some platforms than on others.\n> \n\n\nYou have not had a youth wasted programming in too many weird\nassembler languages!  (At least, I hope not.)  The \"void *\" version\nonly works if \"void *\" is the address of a byte in a contiguous\naddress space.  That's actually not the case in some addressing models\non x86 machines, which is why the compiler rejects it.  The \"char *\"\nversion depends on BYTES_WORD being correct.  On, for instance, 64-bit\nsystems where \"double\" refers to a 128-bit quantity, it will allocate\na minimum of 16 bytes, rather than 8--a performance bug.  More\nseriously, one might encounter systems where the alignment requirement\nis \"long double\" rather than \"double\", and future code which attempted\nto cast the result of bmalloc() to \"long double\" would fail.  \n\n\nFor the moment, I think, it is probably best to choose the type of\nbposition with conditional compilation (wince), but I think in the\nlong run it's best to address the problem in a more general fashion; I\ncannot enough stress how unreliable conditional compilation makes\ncross-platform code.\n\n\nRandolph, wishing he had more time to spend on Radiance\n___\n<sup>Automatically generated content from [radiance mailing-list](https://radiance-online.org/pipermail/radiance-dev/2004-October/000398.html).</sup>", "attachments": [], "created_by_name": "Randolph Fritz", "created_at": "October 04, 2004 at 05:26AM", "created_by": "Randolph_Fritz", "parent_id": "radiance-dev_000395", "id": "radiance-dev_000398"}