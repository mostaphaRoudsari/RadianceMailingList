{"body": "Hi Mark,\n\n\nIf you use the variable output of vwright,  you actually don't need \nvwrays at all.  Taking the code from the viewray() routine in \nsrc/common/image.c:\n\n\n\tcase VT_PER:\t\t\t/* perspective view */\n\t\tdirec[0] = v->vdir[0] + x*v->hvec[0] + y*v->vvec[0];\n\t\tdirec[1] = v->vdir[1] + x*v->hvec[1] + y*v->vvec[1];\n\t\tdirec[2] = v->vdir[2] + x*v->hvec[2] + y*v->vvec[2];\n\t\torig[0] = v->vp[0] + v->vfore*direc[0];\n\t\torig[1] = v->vp[1] + v->vfore*direc[1];\n\t\torig[2] = v->vp[2] + v->vfore*direc[2];\n\t\td = normalize(direc);\n\n\nTo reproduce this in an rcalc script, we use the variables output from \nvwright to compute the origin and direction (with jitter) for your view \nusing the following file, which we'll call \"persp.cal\":\n\n\n\t\t\t\t\t\t{ Compute horizontal & vertical position on image }\nH = (x + rand(.3523*recno-20.2)*jitter)/xres - 0.5;\nV = (y + rand(-.1873*recno+400.3)*jitter)/yres - 0.5;\n\t\t\t\t\t\t{ Compute unnormalized view direction }\ndirx = idx + ihn*ihx*H + ivn*ivx*V;\ndiry = idy + ihn*ihy*H + ivn*ivy*V;\ndirz = idz + ihn*ihz*H + ivn*ivz*V;\n\t\t\t\t\t\t{ Compute view origin, including fore clipping plane }\norgx = ipx + io*dirx;\norgy = ipy + io*diry;\norgz = ipz + io*dirz;\n\n\n\n\nHere's how you apply it using rcalc:\n\n\ncnt 480 740 | rcalc -od -i 'x=$2;y=$1' -e \n'xres:740;yres:480;jitter:0.6' \\\n\t-e `vwright i < tempvf` -f persp.cal \\\n\t-e '$1=orgx;$2=orgy;$3=orgz;$4=dirx;$5=diry;$6=dirz' \\\n\t| rtrace -fdc -x 740 -y 480 @opts scene.oct > img.pic\n\n\nNaturally, you could shorten your rcalc command by sticking the various \nextra settings into persp.cal, but I thought you might like to leave \nthat file general.  I arbitrarily chose 0.6 as the jitter amount -- I \nwasn't sure what you wanted for this.  Also, I haven't tested this, so \nI probably screwed up or missed something, which hopefully you'll be \nable to sort out.  Let us know if it works.\n\n\n-Greg\n___\n<sup>Automatically generated content from [radiance mailing-list](https://radiance-online.org/pipermail/radiance-general/2004-November/002154.html).</sup>", "attachments": [], "created_by_name": "Greg Ward", "created_at": "November 15, 2004 at 06:43AM", "created_by": "Greg_Ward", "parent_id": "radiance-general_002152", "id": "radiance-general_002154"}