{"body": "Hi Kirk,\n\n\nHere's my own example of image-based lighting and the commands I used.  \nI have two processors to work with, which is why I run two renderings \nat the same time:\n\n\n#!/bin/csh -fex\n#\n# Render our image-based lighting example\n#\n#       Oct 2004        Greg Ward\n\n\n# Set parameters\nset res=(-x 2272 -y 1704)\nset vw=(-vf plate.vf -pa 0)\nset amb=(-ab 1 -aa 0 -ad 256 -as 0)\n\n\n# Render synthetic objects\noconv environ.rad railing.rad chess3d.rad \\\n         | rpict -ps 1 -pj 0 $vw $res $amb \\\n         > chess3d.hdr &\n\n\n# Determine foreground objects\noconv chess3d.rad > stencil.oct\nvwrays -ff $vw $res \\\n         | rtrace -fff -oL $res stencil.oct \\\n         | pvalue -r -df -b \\\n         | pcomb -e 'lo=if(gi(1)-1e5,0,1)' - \\\n         > stencil.pic\nrm stencil.oct\n\n\n# Render base for shadows\noconv environ.rad railing.rad \\\n         | rpict -ps 1 -pj 0 $vw $res $amb \\\n         > unshadowed.hdr\n\n\n# Wait for first render\nwait\n\n\n# Composite final image with shadow map and blurred foreground\npcomb -e 'ro=f(ri);go=f(gi);bo=f(bi)' \\\n         -e 'f(inp)=inp(1)*(gi(3) + (1-gi(3))*inp(2)/inp(4))' \\\n         '\\!pfilt -1 -r 1.35 chess3d.hdr' \\\n         -o SunrisePlate.hdr \\\n         '\\!pfilt -1 -r 1.35 stencil.pic' \\\n         '\\!pfilt -1 -r 1.35 unshadowed.hdr' \\\n         > composite.hdr\n\n\n\n\nResulting image (tone-mapped JPEG and gzip'ped input and picture files):\n\n\n\thttp://www.anyhere.com/gward/pickup/chess3d_balcony.jpg\n\thttp://www.anyhere.com/gward/pickup/chess2.tar.gz\n\n\nPillo's method works as well, but has problems sometimes for \ntransparent surfaces.  The -oL output of rtrace is the only truly \nreliable method I've found.  You also need the -ps 1 -pj 0 rendering \noptions shown to avoid disagreement between boundary pixels in the \nfinal composite.  My example includes blurring of the IBL objects to \nsimulate depth of field, which you probably don't want in general.  \n(The pfilt -1 -r 1.35 commands in the final pcomb can be replaced by \nthe straight files.)\n\n\n-Greg\n___\n<sup>Automatically generated content from [radiance mailing-list](https://radiance-online.org/pipermail/radiance-general/2004-November/002165.html).</sup>", "attachments": [], "created_by_name": "Greg Ward", "created_at": "November 19, 2004 at 06:17PM", "created_by": "Greg_Ward", "parent_id": "radiance-general_002156", "id": "radiance-general_002165"}