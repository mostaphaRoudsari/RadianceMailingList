{"body": "Hi Will,\n\n\n> converting to sharp RGB:\n> -i think i can just change some constants in the xyz_rgb.cal file,  \n> (values for sharp RGB are given in Sharp.cal) to change the clour  \n> space.\n\n\nYou can actually run the same command, inserting -f Sharp.cal after - \nf xyz_rgb.cal (putting it before would do nothing).\n\n\n> -i assume that all colours (ie of materials as well as sources)  \n> have to be converted?\n\n\nYes, in fact to get the full benefit of the method, you should start  \nwith spectral data and premultiply the spectral power and reflectance  \nof each surface material if it's available.\n\n\n> -the rendered picture will then be in th sharp RGB colour space,  \n> which ximage does not use, so every pixel in the image then has to  \n> be converted to back to the radiance RGB primaries. is this right?  \n> if so, is there a utility to apply the transformation to a .pic  \n> file or do i need to write a script?\n\n\nHere is one of the missing bits in the process.  Radiance doesn't  \ncare what color space it renders in, but the default of downstream  \npicture tools is to use the standard primaries defined in color.h if  \nnone are specified in the picture file.  Therefore, it is best if you  \nspecify the correct color primaries following your rendering using a  \nscript like so:\n\n\n#!/bin/csh -f\n# Add Sharp color primaries to Radiance picture header\nforeach f ($*)\n\tgetinfo < $f > tf$$\n\ted - tf$$ << '_EOF_'\n/^PRIMARIES=/d\n/^FORMAT=/i\nPRIMARIES= .6898 .3206 .0736 .9003 .1166 .0374 .3333 .3333\n.\nw\nq\n'_EOF_'\n\tgetinfo - < $f >> tf$$\n\tmv tf$$ $f\nend\n\n\nYou can accomplish the same thing manually using the \"vinfo\" script  \nthat comes with Radiance, but the above lets you convert a set of  \npictures more quickly and conveniently.  I would call it addSharp or  \nsomething like that.\n\n\nOnce your Radiance picture has the right primaries installed in its  \nheader, some but not all of the Radiance tools will know what to do  \nwith them.  To convert the image back to the standard Radiance color  \nspace, you can use:\n\n\n\tra_xyze -r sharp.pic standard.pic\n\n\nObviously, this would also work with an XYZE input picture.  The  \nconverters pcond, ra_bmp, and ra_tiff also understand the PRIMARIES=  \nheader line, as does Photosphere, which will display the images  \ncorrectly without preconversion.\n\n\n> white point adjustment:\n> -presumably the white point that radiance uses is the same as most  \n> monitors (D65 i think) so i need to transform from the white point  \n> of the XYZ colour space to that of the sharp RGB (or radiance RGB)  \n> colour space, but only because of this change in colour space.\n\n\nRadiance uses an equal-energy white (x,y)=(1/3,1/3) by default, and  \nthis is the default for the Sharp color space and XYZ as well, so no  \nneed to convert the white point for Radiance.\n\n\n> -can anyone start me off with how to apply the white point  \n> transformation? i assume it uses the vonKries.cal file, and that  \n> the inputs (initial and final white point cramaticities) are  \n> standard values for the colour spaces in question, but how is it  \n> used!?\n\n\nThankfully, ra_xyze and the other tools do a vonKries-style white  \npoint conversion for you, so you needn't worry about this bit.\n\n\n> -the XYZ data (and the xy coordinates) i have are given for both a  \n> C source (the CIE standard?) and for a tungsten lamp with colout  \n> temp 3200K, so i presume i should use the tungsten readings (as my  \n> lamps are tungsten).\n\n\nYes, indeed.\n\n\n> -the sources i am modelling are tungsten, but i want an accurate  \n> representation of what the colour will look like, so presumably i  \n> need some sort of white point transformatin to correct their slight  \n> orangeness, as the eye is quite good at correcting this, i believe.  \n> how should i specify this? i know the lamps' colour temperature  \n> (about 3200K).\n\n\nThe CIE (x,y) chromaticity for a 3200K black body is  \n(0.4234,0.3990).  You can use the formula in blackbody.cal to convert  \ncolor temperature to spectral power, and then the CIE standard  \nobservers to get to XYZ.\n\n\n> and finally, how should i apply the colour to my sources?\n\n\nYou can premultiply the illuminant and reflectance values (using  \nSharp RGB) and put neutral light sources for your dominant source  \n(tungsten 3200K).  This is spelled out towards the end of section 2  \nin the EGWR paper.\n\n\n> -i have XYZ tristimulus and xy cromaticity coordinate data for the  \n> filters i want to use, but i'm not sure of the best way to apply it.\n> (data comes from eg.  http://www.leefilters.com/LPFD.asp?PageID=248  )\n\n\nConvert to Sharp RGB and multiply this value if you don't have  \nspectral data.  If you have spectral data for the filters, you are  \nbetter off using that.  (I see they have a plot on their website, so  \nmaybe they'll give you data as well.)\n\n\n> -i could either the calculated RGB values to scale the output from  \n> my source primative (though would i have to take the Y value  \n> (reflectance/transmission depending on the context i believe) into  \n> account, or is this done automatically in the conversion?). This is  \n> what i did for my first test run earlier (converting XYZ values to  \n> radiance RGB primaries, and then not using the Y value again), and  \n> the result seemed to bright for the filter i was using (i had 2  \n> sources in the scene, one coloured, the other not, and they were  \n> both of similar brigtness).\n\n\nLuminance should pass through the conversion with minimal changes,  \nbut this is only really guaranteed if you use properly normalized  \nspectra rather than RGB multiplication.\n\n\n> -or i could use the RGB values to define the transmission of a thin  \n> piece of glass, and place this in front of the source (as a real  \n> filter is).\n\n\nThe net result would be (nearly) the same, but the glass would be  \nmore expensive to compute.\n\n\n-Greg\n___\n<sup>Automatically generated content from [radiance mailing-list](https://radiance-online.org/pipermail/radiance-general/2006-March/003528.html).</sup>", "attachments": [], "created_by_name": "Greg Ward", "created_at": "March 27, 2006 at 08:02PM", "created_by": "Greg_Ward", "parent_id": "radiance-general_003524", "id": "radiance-general_003528"}