{"body": "I did  not go through all the lines, but don't you want to use the -I swith\nin rcontrib!?\n(I hope I didn't miss anything in the lines I did not properly work\nthrough...)\n\n\nCheers,\nDavid\n\n\n\n\n2014-02-06 Axel Jacobs <jacobs.axel at gmail.com>:\n\n\n> (Couldn't come up with a sillier subject line for this)\n>\n> Dear list,\n>\n> I am trying to use rcontrib and dctimestep in my only-just-invented\n> 2.5-phase method.  The idea is simple: Instead of relying on the patch\n> brightness to represent both sun and sky, I would like to only use the\n> patches for the sky, and rely on 'real' suns for an annual simulation.\n>  This is somewhat related to Andy's 5-phase method, but but I'm still\n> at the stage where I have simple windows and no BSDF or Klems stuff.\n> What I am hoping to find out is whether the inclusion of 'proper' suns\n> makes a difference compared to the old skool rcontrib approach where\n> the sky patches represent the sun + sky.\n>\n> I've tarred up the script and all the input files.  They are available\n> here:\n> http://www.jaloxa.eu/pickup/cbdm4_diffdir.tgz\n>\n> The script is a bit lengthy:\n>\n> ---------------------8<-----------------------\n> #!/bin/bash\n>\n> PROJECT=\"dds4\"\n> OPT=\"ab7rtc\"\n> SKYOCT=\"octrees/${PROJECT}_sky.oct\"\n> SUNOCT=\"octrees/${PROJECT}_sun.oct\"\n> REINHART=1\n> WEA=\"weather/gatwick.wea\"\n> NPROC=5\n>\n> # Sensor results with header\n> stmp=\"tmp\"\n> if [ ! -d $stmp ]; then\n>     mkdir $stmp\n> else\n>     rm -f $stmp/*\n> fi\n>\n> wbase=$(basename $WEA .wea)\n> fsmx=\"$stmp/${wbase}_m$REINHART.fsmx\"     # annual diffuse sky matrix\n> dsmx=\"$stmp/${wbase}_m$REINHART.dsmx\"     # annual direct sun matrix\n> csmx=\"$stmp/${wbase}_m$REINHART.csmx\"     # annual combined matrix\n> suns=\"$stmp/suns_m${REINHART}.rad\"        # annual suns\n>\n> # Build the diffuse sky matrix for Tregenza subdivision\n> # -O1 (total solar irradiance), so we can compare against WEA file\n> echo \"  Building annual diffuse sky matrix $fsmx...\"\n> gendaymtx -s -m $REINHART -c 1 1 1 -O1 $WEA > $fsmx\n>\n> # Build the direct suns\n> echo \"  Building annual suns $suns...\"\n> echo \"void light solar 0 0 3 1e6 1e6 1e6\" > $suns\n> npatch=$( echo 1 |rcalc -e MF:2 -f reinhart.cal -e '$1=Nrbins' )\n> cnt $npatch |rcalc -e MF:$REINHART -f reinsrc.cal -e Rbin=recno \\\n>         -o 'solar source sun 0 0 4 ${ Dx } ${ Dy } ${ Dz } 0.533' >> $suns\n> gendaymtx -5 -d -m $REINHART -c 1 1 1 -O1 $WEA > $dsmx\n>\n> # Build direct+diffuse (old skool)\n> echo \"  Building annual combined sun+sky matrix $csmx...\"\n> gendaymtx -m $REINHART -c 1 1 1 -O1 $WEA > $csmx\n>\n> echo \"    Compiling octrees...\"\n> oconv skies/sky_white.rad > $SKYOCT\n> oconv $suns > $SUNOCT\n>\n> echo \"Grid: roof.pts\"\n> grid=roof.pts\n> base=$(basename roof .pts)\n>\n> skdc=\"$stmp/${PROJECT}_${OPT}_$base.skdc\"     # diffuse sky DC\n> sndc=\"$stmp/${PROJECT}_${OPT}_$base.sndc\"     # direct sun DC\n>\n> # Run the DDS calculations: Daylight Matrix with header\n> echo \"  Calculating sky DC $skdc...\"\n> cat $grid \\\n>         |rcontrib -n $NPROC @$OPT.opt \\\n>         -e MF:$REINHART -f reinhart.cal -bn Nrbins -b rbin \\\n>         -o $skdc -m sky_glow $SKYOCT\n>\n> echo \"  Calculating sun DC $sndc...\"\n> cat $grid \\\n>         |rcontrib -n $NPROC @$OPT.opt \\\n>         -e MF:$REINHART -f reinhart.cal -bn Nrbins -b rbin \\\n>         -o $sndc -m solar $SUNOCT\n>\n>\n> fimx=\"$stmp/${PROJECT}_${OPT}_$base.fimx\"     # annual diffuse irradiance\n> matrix\n> dimx=\"$stmp/${PROJECT}_${OPT}_$base.dimx\"     # annual direct irradiance\n> matrix\n> cimx=\"$stmp/${PROJECT}_${OPT}_$base.cimx\"     # annual combined\n> irradiance matrix\n>\n> # Produce annual (grey) sensor irradiance matrix\n> echo \"  Calculating annual direct irradiance $dimx...\"\n> dctimestep -n 8760 $sndc $dsmx |tr '\\t' '\\n' |sed -e '/^\\s*$/d' \\\n>         |rcalc -e '$1=$1' > $dimx\n>\n> echo \"  Calculating annual diffuse irradiance $fimx...\"\n> dctimestep -n 8760 $skdc $fsmx |tr '\\t' '\\n' |sed -e '/^\\s*$/d' \\\n>         |rcalc -e '$1=$1' > $fimx\n>\n> echo \"  Calculating annual combined irradiance $cimx...\"\n> dctimestep -n 8760 $skdc $csmx |tr '\\t' '\\n' |sed -e '/^\\s*$/d' \\\n>         |rcalc -e '$1=$1' > $cimx\n>\n> imx2=\"$stmp/${PROJECT}_${OPT}_$base.imx2\"   # annual sky+sun irradiance\n> matrix\n> irr=\"$stmp/${PROJECT}_${OPT}_$base.irr\"    # annual grey irradiance\n>\n> # Add direct and diffuse\n> rlam $fimx $dimx |rcalc -e '$1=$1+$2' > $imx2\n>\n> echo -e \"month\\tday\\ttime\\tin_dir\\tin_diff\\tdir\\tdiff\\tdir+diff\\tcomb\" >\n> $irr\n> tail -n +7 $WEA |rlam - $dimx $fimx $imx2 $cimx >> $irr\n>\n> #EOF\n> ---------------------8<-----------------------\n>\n> There is absolutely no geometry at all--just the sky/suns. The final\n> resuls are stored under ./tmp/ in the file with the *.irr extension\n>\n> here are the first few lines:\n>\n> month    day    time    in_dir    in_diff    dir    diff    dir+diff\n>  comb\n> 1 1 0.500 0 0    0    0    0    0\n> 1 1 1.500 0 0    0    0    0    0\n> 1 1 2.500 0 0    0    0    0    0\n> 1 1 3.500 0 0    0    0    0    0\n> 1 1 4.500 0 0    0    0    0    0\n> 1 1 5.500 0 0    0    0    0    0\n> 1 1 6.500 0 0    0    0    0    0\n> 1 1 7.500 0 0    0    0    0    0\n> 1 1 8.500 0 19    6.01    6.01    12.02    6.01\n> 1 1 9.500 7 51    16.6    16.6    33.2    16.6\n> 1 1 10.500 17 88    28.2    28.2    56.4    28.2\n> 1 1 11.500 22 109    34.8    34.8    69.6    34.8\n> 1 1 12.500 22 110    35.2    35.2    70.4    35.2\n> 1 1 13.500 17 91    29.2    29.2    58.4    29.2\n> 1 1 14.500 4 56    18.2    18.2    36.4    18.2\n> 1 1 15.500 0 6    2.14    2.14    4.28    2.14\n> 1 1 16.500 0 0    0    0    0    0\n> ...\n>\n> What I am measuring is the horizontal unobstructed irradiance.\n>\n> The first five columns are essentially the wea file:\n> month    day    time    in_dir    in_diff\n> to which the following have been laminated:\n> dir:  gendaymtx -5 -d; no sky, just 145 suns\n> diff:  gendaymtx -s; no suns, Tregenza patches, only diffuse contribution\n> dir+diff: dir + diff\n> comb: gendaymtx; no suns, Tregenza patches, diffuse and direct\n> contribution.  This is old skool for comparison.\n>\n> I simply cannot make any sense of the results,  so I'm wondering\n> whether I am misunderstanding the concept behind the -5 option to\n> gendaymtx.\n>\n> Take, for instance, this row:\n> 1 1 8.500 0 19    6.01    6.01    12.02    6.01\n> There is no direct irradiance recorded in the wea file.  Yet, the\n> gendaymtx/rcontrib calculation produces 6.01 W/m2 (very low-angle\n> sun).\n> Also, I don't get why dir = diff = comb ???\n>\n> I am probably using gendaymtx and rcontrib improperly, but have been\n> staring at this for quite a few hours now, without being able to work\n> out where I am making the mistakes.\n>\n> Would anybody be able to offer assistance with this?\n>\n> I have also tried doing the same think with genskyvec.  It doesn't\n> complain when I give it the -5 option, but the results are simularly\n> confusing.\n>\n> Many thanks for your help\n>\n> Best regards\n>\n> Axel\n>\n> _______________________________________________\n> Radiance-general mailing list\n> Radiance-general at radiance-online.org\n> http://www.radiance-online.org/mailman/listinfo/radiance-general\n>\n\n\n\n\n\n\n\n\nDipl.-Ing. Dr. David Geisler-Moroder\nHofwaldweg 14/20\n6020 Innsbruck\nAustria\n___\n<sup>Automatically generated content from [radiance mailing-list](https://radiance-online.org/pipermail/radiance-general/2014-February/010039.html).</sup>", "attachments": [], "created_by_name": "David Geisler-Moroder", "created_at": "February 06, 2014 at 09:19AM", "created_by": "David_Geisler-Moroder", "parent_id": "radiance-general_010037", "id": "radiance-general_010039"}