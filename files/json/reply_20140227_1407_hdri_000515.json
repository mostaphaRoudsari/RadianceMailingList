{"body": "Hi Kim,\n\n\nComments in-line below...\n\n\nOn 27/02/14 15:55, Jonghoon Kim wrote:\n> I appreciate your comment Axel!!\n>\n> I slightly modified my code and it is working now.\n>\n> However, I have one more question!\n>\n> My HDR process is like below.\n>\n> (Please, let me know if there is something wrong in my script.)\n>\n> =====================================================\n>\n> Cropping the original HDR image to match the size with the vignetting\n> filter file\n> ra_xyze -r -o -u Original.hdr | pcompos -x 4368 -y 2912 - -408 -272 >\n> Resized_for_Vignetting.hdr\n\n\nYou don't need the ra_xyze -r here.\n\n\nIf you're using a fisheye lens, then I'm not sure why the -x and -y of \npcompose are not the same.  Does this have to do with your vignetting \nfilter?\n\n\n> Applying the vignetting filter to the cropped HDRI\n> pcomb  -e  'ro=ri(1) / ri(2);go=gi(1) / gi(2);bo=bi(1) / bi(2)'\n> Resized_for_Vignetting.hdr Vignetting_Filter.hdr > Vignetting_Corrected.hdr\n>\n> Resizing the HDRI for glare analysis\n> pfilt -x 1200  -y 800 Vignetting_Corrected.hdr >\n> Vignetting_Corrected_resized.hdr\n\n\nDeriving glare metrics from a resized HDR images gives you somewhat \ndifferent values compared to getting them off the original, larger-res \nimage.  You might want to test this, and see how large the differences \nin UGR, DGP etc are.\n\n\n> Cropping the HDRI for glare analysis\n> ra_xyze -r -o -u Vignetting_Corrected_resized.hdr | pcompos -x 800 -y\n> 800 - -200 0 > Cropped.hdr\n\n\nOh, so now you're cropping it into a square.\n\n\n> Creating the cleaning filter\n> ra_tiff -r Cleaning_filter.tif Cleaning_filter.hdr\n\n\nIs this cleaning filter for removing hot or dead pixels?\n\n\n> Applying the cleaning filter on the resized HDRI\n> pcomb Cropped.hdr -s -1000 Cleaning_filter.hdr > Final.hdr\n>\n> Running the Evalglare analysis\n> evalglare -vta -vh 180 -vv 180 Final.hdr\n\n\nYou can streamline this a little:\n\n\na) crop and square and make the border black:\n\n\ndim=1234   # or whatever the diameter (in pixels) of the actual fisheye \non your large-size HDR\npcompos -x $dim -y $dim hdrgen.hdr -$xoffset -$yoffset \\\n|pcomb -e \n's(x):x*x;m=if(xmax*ymax/4-s(x-xmax/2)-s(y-ymax/2),1,0);ro=m*ri(1);go=m*gi(1);bo=m*bi(1)' \n\\\n- |pfilt > tidy.hdr\n\n\nb) do some QA\n\n\nBy the sounds of it, you're working under LINUX.  I suggest you check \nout webhdrtools.  This is some of the magic behind the WebHDR site, \npackaged as individual Perl scripts.\nhttp://www.jaloxa.eu/resources/hdr/webhdrtools\n\n\nBefore you move on to deriving the actual glare metrics, I suggest you\n\n\nb1) verify that the dynamic range that you've captured within your \nsequence is sufficient.  Use webhdr_jpgheatmap.pl for this.  If there \nare any red pixels on the heatmap, the sequence is not usable for glare \nstuff.\n\n\nb2) verify that the recovered RSP is good.  webhdr_rspplot.pl helps you \nplot it (relies on gnuplot).  The red, grn, and blu curve should be \nalmost identical, and there should be no weird wobbles.  It might be \nbest to take a number of calibration HDRs, and to derive an averaged RSP \nfrom them.  webhdr_rspavrg.pl is your friend here.\n\n\nc) fix the view\n\n\nI have a tool that does this, but since it hasn't been tested properly, \nI have not included it in the webhdrtools yet.  You might want to give \nit a try, and see if it works for you:\nhttp://www.jaloxa.eu/pickup/webhdr_hdrcalib.pl\n\n\nRun it like so:\n\n\nSTDVIEW=\"-vta -vp 0 0 0 -vd 0 1 0 -vu 0 0 1 -vv 180 -vh 180\"\nCF=1.0   # Your calibration factor.\n# See http://www.jaloxa.eu/webhdr/calibrate.shtml\nwebhdr_hdrcalib.pl $STDVIEW -m $CF tidy.hdr > tidy_fixed.hdr\n\n\nwebhdr_hdrcalib.pl also has a -f option that will attempt to recover a \nview that exists in the HDR header, but got corrupted by pcomb or \npcompos.  However, for images generated by hdrgen, it's best to not do \nthis, since hdrgen relies on the EXIF info from the photographs that \ndon't always give you accurate view angles.\n\n\nd) do your glare stuff...\n\n\nDone.  Now have a cup of tea and flick through my \"Glare measurement \nusing HDR photography\" presentation from the 2012 Radiance workshop:\nhttp://radiance-online.org/community/workshops/2012-copenhagen\n\n\nI hope you're not trying to measure glare from LED light sources...\n\n\nRegards\n\n\nAxel\n___\n<sup>Automatically generated content from [radiance mailing-list](https://radiance-online.org/pipermail/hdri/2014-February/000515.html).</sup>", "attachments": [], "created_by_name": "Axel Jacobs", "created_at": "February 27, 2014 at 02:07PM", "created_by": "Axel_Jacobs", "parent_id": "hdri_000512", "id": "hdri_000515"}