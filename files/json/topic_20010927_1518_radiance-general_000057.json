{"topic": "Tonemapping code...", "category": "radiance-general", "attachments": [], "created_by_name": "Erik Br\u00e4nnlund", "created_at": "September 27, 2001 at 03:18PM", "body": "Hi!\n\n\nI have tried to implement the tonemapping but the radiance site seems to\nbe down so I can't looak at all the code. All I have is tonemap.*. I\nhave managed to get something which compiles and runs but I seem to get\na linear mapping.\nEither my code is wrong, likely.\nOr the data I send into the mapping is wrong, even \"likelier\".\n\n\nThis is how it is done.\n Read an HDR file\n     Convert RGBE data like this\n        Procedure rgbe2float(var red, green, blue : Double; rgbe :\nrgbetype);\n        var\n          f : double;\n        begin\n          if (rgbe[3] <> 0) then\n          begin  //nonzero pixel\n            f := power(2,rgbe[3]-(128+8));\n            red := rgbe[0] * f;\n            green := rgbe[1] * f;\n            blue := rgbe[2] * f;\n          end\n          else\n          begin\n            red := 0;\n            green := 0;\n            blue := 0.0;\n          end;\n        end;\n\n\nFor all pixels in image\n  Get RGB as float values\n  Convert to XYZ\n  Y := Y * 100;\n  If Y = 0 then\n    Y := 1e-4\n  AddToHist(Y);\n\n\nComputeMap\n\n\nFor all pixels in image\n  Get RGB as float values\n  Convert to XYZ\n  Y := Y * 100;\n  If Y = 0 then\n    Y := 1e-4\n  Map(X, Y, Z);\n\n\nAm I totally wrong here or?\n\n\nMany thanx in advance/Erik\n___\n<sup>Automatically generated content from [radiance mailing-list](https://radiance-online.org/pipermail/radiance-general/2001-September/000057.html).</sup>", "id": "radiance-general_000057", "created_by": "Erik_Br\u00e4nnlund"}