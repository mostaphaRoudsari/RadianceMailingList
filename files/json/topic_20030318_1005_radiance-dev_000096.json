{"topic": "pre-release of Radiance 3.5", "category": "radiance-dev", "attachments": [], "created_by_name": "Greg Ward", "created_at": "March 18, 2003 at 10:05AM", "body": "I've put a pre-release of Radiance 3.5 up on radsite in the pickup \ndirectory, along with compiled Mac OS X binaries:\n\n\n\thttp://radsite.lbl.gov/pickup/rad3R5.tar.gz\n\thttp://radsite.lbl.gov/pickup/osxbin.tar.gz\n\n\nI would like to get feedback from people in the next week or so \nregarding compile problems on various platforms in hopes of sorting \nthese out before the official release.\n\n\nPeter A-B is working on a set of Linux binaries (and possibly even an \nRPM distribution) as well as getting CVS set up for wider access to \nwork in progress.\n\n\nThis release introduces substantial ANSI-fication of the code, and \nincludes the new animation program ranimove, and a new \"mesh\" primitive \nwith support by \"obj2mesh\" for Wavefront .OBJ files and a -o option to \ngensurf to output .OBJ rather than Radiance.  Attached is the relevant \nportion of ray/doc/notes/ReleaseNotes.\n\n\n-Greg\n\n\nP.S.  Apologies in advance to countries our renegade president has \ndecided to invade for reasons known only to him....\n\n\n\n\nVersion 3.5 (Released 3/14/03)\n\n\nFixed bug in replmarks pointed out by Georg Mischler, which caused\ngarbage to be output under specific conditions (unscaled, unrotated\ninstances).\n\n\nFixed bug in normtiff that caused occassional weird colors\non human tone-mapping of 32-bit LogLuv inputs (tmapluv.c).\n\n\nFixed -o option of pcomb so it resets le(i) and color exposure functions\nto unity.\n\n\nFixed a bug in Type B photometry in ies2rad source.cal introduced\nin last fix where spherical sources were getting symmetric\ndistributions front-to-back.\n\n\nFixed another bug in ies2rad for 90-270 bilaterally symmetric fixtures, \nwhich\nseems to have been there from the beginning.  Thanks to Jack de Valpine\nfor pointing it out.\n\n\nAdded NORANDOM symbol for tests with all random sampling turned off.\n\n\nFixed a bug in expression evaluation code that was causing unneeded\nevaluations of constants.  This is a fix on an earlier fix of a more\nserious bug prior to the 3.4 release, where the expression clock\nwas wrapping silently and allowing values to go stale.\n\n\nFixed an even more serious bug in ies2rad for thin fixtures, where\nit was using \"flatcorr\" without the proper correction for the\nemitting area.  Thanks again to Jack de Valpine for spotting this.\n\n\n--- All of the above was put into a 3.4.1 patch release 4/1/2002\n\n\nAdded a facility to gensurf to make holes in the mesh using a\nvalid(s,t) function.\n\n\nFixed bug in pcond that caused a bus error on images with large dark\nregions when acuity switch was set.\n\n\nFixed bug in pcomb that caused the S(n) function to return half\nthe solid angle value it should have.  (Thanks to John Mardaljevic\nfor discovering this error.)\n\n\nMade rpict/rpiece/vwrays -vf option accept \"-\" as a synonym\nfor standard input.\n\n\nFixed bug in persist functions (-P and -PP) with FreeBSD\n(including MacOS X) having to do with altered system function\nbehaviors.  Neither mknod() nor freopen() behave as they\nused to.\n\n\nImproved accuracy of irradiance gradient calculation near\nspecular surfaces by using the effective ray distance\nrather than the first surface intersection.  (John\nMardaljevic had pointed out some errors he was seeing\nwith a particular atrium model.)\n\n\nReinstated my favorite little Fresnel approximation for\nperfectly smooth materials, so grazing angles show an\naccurate gradient.  Simultaneously revised the computation\nof the direct component for proper energy balance.\n(Thanks to Phillip Greenup for nagging John M. who nagged me.)\n\n\nImproved the accuracy and appearance of indirect irradiance\ninterpolation for smoothed surfaces.  (Thanks to Bernhard\nSpanlang for noticing the problem.)\n\n\nFixed intolerance for carriage-returns in mkillum's input files,\nwhich caused problems for files imported from DOS/Windows.\n\n\nFixed apparent bug that I couldn't reproduce in rpict for very\nnarrow views, which sent it into an infinite loop under Linux.\n(Rich Gillibrand of Bristol Univ. pointed it out.)\n\n\nImproved movement in rholo for low-detail holodecks on fast\ngraphics processors by inserting 50 ms pause during motion\nfeedback.\n\n\nFinally fixed ages-old consistency error where ambient value\nlists were sorted incorrectly with the GNU-C compiler,\ncausing the dreaded \"address not found in avlmemi\" crash.  All\nthis time, I thought it was due to a faulty qsort(3) routine,\nwhen in fact it was due to the way GNU-C compares pointers.\nThe fix was to change a single word in ambient.c from \"AMBVAL\"\nto \"char\" and now it all magically works.  No more -Dtracktime=0,\nhurrah!\n\n\nFixed pcond veil behavior for scenes that have their contrast\nreduced by primary tone-mapping algorithms.  Previously, the\nveil would come out looking like a fog because it was applied\nprior to dynamic range compression and did not consider the\noverall effect.  In the new version, the veil is adjusted\nafter dynamic range compression so that the net reduction\nin visibility is approximately correct over the whole image.\n(Later made this optional on compile with the ADJ_VEIL symbol, as I\nnoticed more artifacts than improvements in the resulting images.)\n\n\nFixed bug in BRTDfunc that caused an error in the calculation\nof the diffuse transmitted ambient component.  This must have\nbeen introduced early on, but never noticed by me or anyone.\n\n\nWrote an interactive script called \"glaze\" (src/gen/glaze.csh)\nthat computes a good material model for fritted and low-E glazing\nsystems.  Thanks to Visarc (Jack de Valpine) for paying for its\ndevelopment and permitting it into the general distribution.\n\n\nIncreased scanline window in pcomb to 64 (+/- 32 pixels) to allow\nfor larger kernels in filtered images.\n\n\n****************** COMPATIBILITY CHANGE ***********************\nChanged behavior of pfilt gaussian blur to match more precise\ndefinition.  A blur radius of 0.6 is now preferred over the\nprevious value of 1.0.\n\n\nAdded ANSI function prototypes to the header files in\nsrc/common/ and src/rt/ and cleaned up the options processing\nin the rpict, rtrace, and rview main procedures so that the\ncore Radiance rendering code can be more easily\ncalled by new application programs.  Changed src/rt/Rmakefile\nto create a rendering library called \"libradiance.a\" and\nto install it in the src/lib/ directory along with the new\nraycalls.o module, which should facilitate the building\nof new applications outside the src/rt/ directory.  The\nraypcalls.o module, also installed in src/lib, manages\nparallel rendering on multiprocessors with shared memories.\n\n\nWrote new ranimove animation rendering program, which is an\nalternative to ranimate.  The key difference is that\nranimove is optimized for moving scenes, and includes\na complete blur simulation for camera and object motion.\nIt also incorporates an sophisticated model of perceivable\nerror based on visual focus, and allows progressive\nanimation so one can explicitly control rendering time\nand/or accuracy.  See the man page for details.\n\n\n****************** COMPATIBILITY CHANGE ***********************\nThe sense of the MBLUR setting has been changed for the ranimate\ncommand.  The first value is now the fraction of a frame during\nwhich the shutter is open, and the _second_ argument (which is\noptional) is the number of samples to specify to pmblur.\n\n\nEnhanced octree reader behavior so it will accept command\nspecifications preceded by an exclamation mark ('!').  This\nenables rtrace and rview to take octrees from commands similar\nto rpict reading its octree from the standard input.  All\nprograms taking octrees as arguments will be affected by this\nchange.  However, since rad needs to get the modified date\nfrom the octree, rad will refuse such an octree command\nspecification.\n\n\nFixed a bug in src/common/fgetline.c where it failed to elide\ncarriage-returns in Windows files.\n\n\nModified src/common/fgetword.c so it accepts single- or\ndouble-quoted words with spaces in preparation for the\nWindows version, which needs to allow spaces in file\npaths.  Since fgetword() is called by all programs that\nread in string arguments in scene files, these may now\nbe quoted with the expected behavior.  Also added a\nfputword() call to the library to automatically quote\nwords on output that contain white space.  This routine\nis now called from all the right places, I hope!  The\ncode does not support spaces in primitive identifiers,\nand you will get peculiar errors if you try them.\n\n\nEliminated virtually all symbolic links from the source\ntree, most of which were links to compatibility routines\nand the calcomp functions for expression parsing.\nReplaced -D* defines used in cal* routines with \"esupport\"\nglobal that allows calling programs to set which language\noptions they want to support at runtime.  More programs now\nlink against the -lrt library.  Consolidated the src/cal\nsubdirectories in the process.\n\n\nAdded -dw option to pvalue program to input and output\n16-bit word values (-dW for byte swapping).\n\n\nChanged call ordering in material shaders to ensure\nproper surface normal perturbation for two-sided,\ntextured surfaces.\n\n\nAdded a new \"mesh\" primitive, which permits very\ncomplicated geometries with associated (u,v) coordinates\nusing the new obj2mesh converter and the new -o option\nof gensurf for .OBJ output.  Mesh compilation takes\nroughly 500 bytes/triangle in obj2mesh, but memory\naccess is well-ordered compared to rendering, which\ntakes about 50 bytes/triangle with full surface normal\nand (u,v) coordinate interpolation.  (The actual mesh\nis represented in 15 bytes/triangle, and the rest is\ntaken by the octree structure and malloc overhead.)\nLocal coordinates are set with the \"vt\" statement\nin the Wavefront .OBJ file and accessed via the new\n\"Lu\" and \"Lv\" variables in a Radiance .cal file.\nMultiple instances of the same mesh with different\ntransformations take little additional space during\nrendering, permitting scanned relief surfaces and\ndisplacement-map-like effects to be repeated as desired.\n\n\nChanged internal representation of alias'es in order\nto maintain information about links for programs like\nrshow that work from frozen octrees.  Added a special\nalias modifier keyword, \"inherit\", to indicate that\nan alias should get the same modifier as the original\ntarget to simplify common alias usage for material\nsubstitution.\n\n\nIncreased default oconv -n value to 6.  Since triangle\nmeshes commonly have six faces joining at each vertex,\nvalues less than this cause resolution-limited voxel\nsubdivision.  Increased default -r option to 16384\nas well.  Also increased maximum internal set size\nfrom 127 to 511, to accommodate difficult mesh\nmodels where many faces come together at a point.\nThis required a little reprogramming in for couple\nof recursive routines using sets to avoid overrunning\nthe stack limit.\n___\n<sup>Automatically generated content from [radiance mailing-list](https://radiance-online.org/pipermail/radiance-dev/2003-March/000096.html).</sup>", "id": "radiance-dev_000096", "created_by": "Greg_Ward"}