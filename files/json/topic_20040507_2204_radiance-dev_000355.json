{"topic": "Adding a new BRTDF / BSDF", "category": "radiance-dev", "attachments": [], "created_by_name": "Roland Schregle", "created_at": "May 07, 2004 at 10:04PM", "body": "(N.b.: Moved to RADIANCE Dev)\n\n\nDavid wrote:\n> Hi,\n> \n> I am in the process of developing a new BRTDF / BSDF as a part of my PhD \n> \n> Does anyone have any advice or suggestions on how I go about \n> incorporating the algorithms into Radiance, and especially how I go \n> about incorporating Monte Carlo sampling into the BRTDF / BSDF within \n> Radiance?\n\n\nHi Dave,\n\n\nyou might wanna check normal.c for a simpler example. There, m_normal() \ndoes all the sampling, relegating calls to dirnorm() (via direct()), \ngaussamp(), and ambient() to sample the direct, indirect specular, and \nindirect diffuse components, respectively. You'll want to split your \nBRDF into similar components, with stratified sampling for the diffuse \nstuff and importance sampling for the specular (glossy?) stuff.\n\n\nNote that you'll need to enter the material and its sampling function in \nthe object function table in otypes.h and initotypes.c.\n\n\nStratified sampling is cos-weighted and trivial; see Dutre's Globillum \nCompendium (http://www.cs.kuleuven.ac.be/~phil/GI/) and Greg's \nimplementation (interpretation?) in divsample() in ambcomp.c.\n\n\nImportance sampling is a lot more involved. Basically you've got two \noptions:\n\n\n1) Perform the Monte Carlo inversion of your PDF (probability density \nfunction, in this case proportional to your BRDF * cos(theta_out)) \nanalytically. On paper. By hand. Looking at your list of specs for the \nBRDF, that should be *loads* of fun! :^)\n\n\n2) Invert the PDF numerically, the dumb and slow way, by uniformly \nchoosing intervals in a lookup table containing the CDF (cumulative \ndensity function). This is insanely slow, because the table must be \nconstructed for *every* reflection. However, If your BRDF defies \nanalytic inversion, this is the only way to go. (This is also the reason \nI never bothered to include support for user-defined BRDFs in the \nRADIANCE photon map).\n\n\nUm... happy sampling, mate. :^)\n\n\n--Roland\n\n\n\n\n\n\nRoland Schregle\nPhD candidate, Fraunhofer Institute for Solar Energy Systems\nRADIANCE Photon Map page: www.ise.fhg.de/radiance/photon-map\n\n\nEND OF LINE. (MCP)\n___\n<sup>Automatically generated content from [radiance mailing-list](https://radiance-online.org/pipermail/radiance-dev/2004-May/000355.html).</sup>", "id": "radiance-dev_000355", "created_by": "Roland_Schregle"}