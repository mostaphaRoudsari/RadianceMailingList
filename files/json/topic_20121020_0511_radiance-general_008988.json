{"topic": "possible inconsistency of bin numbers between BSDF and kelms_int.cal", "category": "radiance-general", "attachments": [], "created_by_name": "Jia Hu", "created_at": "October 20, 2012 at 05:11AM", "body": "Hi all:\n\n\nI have a question about the bin number.\n\n\nTo calculate view matrix:  (south-facing window)\n$ rtcontrib < test.pts -f klems_int.cal -bn Nkbins -b kbinS -bn Nkbins -m\nwindow_mat -I+ -ab 3 -ad 2000 -lw 1e-4 interior.oct > south.vmx\n\n\nkbinS uses the (0, 1, 0) as normal (pointing to inside room).\n\n\nFor a ray direction (-1, -1, 0), using klems_int.cal to calculate the bin\nnumber, the bin number is about #57 (I did it manually).\n\n\nKlems_int.cal (download\nKlems_init.cal<https://dl.dropbox.com/u/15562376/klems_int.cal>)\nseems use \"z\" hemisphere (see this figure:\nhttps://dl.dropbox.com/u/15562376/coordinate.jpg). From the figure, we can\nsee \"z\" hemisphere points to the room (that is, the hemisphere is located\nin the room) \"zr\" (z reverse) hemisphere is towards outside (the hemisphere\nis outside the room).\n\n\nThe possible inconsistency is:\n\n\n(1) Klems_int.cal uses \"z\" hemisphere to calculate the bin number, for\nexample,  for ray direction (-1, -1, 0), the bin number is #57 for \"z\"\nhemisphere coordinate. (see this figure:\nhttps://dl.dropbox.com/u/15562376/bin.jpg)\n\n\n(2) The \"Transmission Back\" data in the BSDF .XML is used in the three\nphase DC method (see Greg's\nexplanation<http://permalink.gmane.org/gmane.comp.graphics.radiance.general/2729>),\nand thus the calculation is based on \"zr\" (z reverse) hemisphere , for ray\ndirection (-1, -1, 0), the bin number is about #69 according to the \"z\nreverse\" hemisphere coordinate (see this figure:\nhttps://dl.dropbox.com/u/15562376/bin.jpg).\n\n\nSo my questions are:\n\n\n(a) Given the ray direction, which hemisphere ( \"z\" or \"zr\" ) does\n \"Klems_init.cal\" use?\n\n\n(b) whether the bin numbers (for the same ray direction) between\n\"Klems_int.cal\" and BSDF .xml  are inconsistent or not?\n\n\n(c) if they are using different bin numbers, how to handle ViewMatrix *\nBSDF in the calculation?\n\n\nThank you in advance,\n\n\nJia\n___\n<sup>Automatically generated content from [radiance mailing-list](https://radiance-online.org/pipermail/radiance-general/2012-October/008988.html).</sup>", "id": "radiance-general_008988", "created_by": "Jia_Hu"}