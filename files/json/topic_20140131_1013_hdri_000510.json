{"topic": "SMP file busy problem on iterative rendering in Linux", "category": "hdri", "attachments": [], "created_by_name": "Chris Kallie", "created_at": "January 31, 2014 at 10:13AM", "body": "Dear Radiance Users,\n\n\nI've assembled a simple script that iterates through a folder containing \noctrees, and renders using SMP. On Mac, everything works as expected. \nHowever, on Linux, I get errors suggesting both the syncfile and ppfile \nare still locked by the OS. I've attempted two solutions, including \nadding 'sleep 5' after pfilt (first attempt, shown below), and then by \nexternalizing the while loop, with an ending 'exit 0' (second attempt, \nnot shown here), but neither approach fixed the problem.\n\n\nHere is one version of code which works on Mac but not in Linux:\n\n\nfor file in obj/*.oct\ndo\n     filename=\"${file%.*}\"\n     rm -f syncfile argsfile ppfile\n     echo 1 64 > syncfile\n     cat syncfile\n     echo -F syncfile @arguments -vf room.vf -o $filename.unf \n$filename.oct > argsfile\n     cat argsfile\n     NCPU=2\n     while [ \"$NCPU\" -gt 0 ]\n     do\n         echo \"running proc $NCPU\"\n         rpiece -v -PP ppfile  @argsfile &\n         sleep 5\n         NCPU=`expr $NCPU - 1`\n     done\n     wait\n     echo \"Filtering File - $filename.unf\"\n     pfilt -1 -e -2 -m .25 -r .6 -x /3 -y /3 $filename.unf > $filename.hdr\n     sleep 5\n     rm -f syncfile argsfile ppfile\ndone\n\n\nInterestingly, I do not get an error saying \"cannot remove 'argsfile' \". \nAfter the first image is successfully rendered, I get the following \nerrors at each successive iteration, indicating the rm only works once \n(line 4) in the first iteration:\n\n\nrm: cannot remove 'syncfile': Text file busy\nrm: cannot remove 'ppfile': Text file busy\nrm: cannot remove 'syncfile': Text file busy\nrm: cannot remove 'ppfile': Text file busy\n\n\nSince the error isn't fatal, the machine keeps rendering, and ends up \nrendering the same (first) image over and over. Has anyone run into this \nproblem and found a solution? Any advice would be greatly appreciated.\n\n\nThanks,\nChris\n___\n<sup>Automatically generated content from [radiance mailing-list](https://radiance-online.org/pipermail/hdri/2014-January/000510.html).</sup>", "id": "hdri_000510", "created_by": "Chris_Kallie"}