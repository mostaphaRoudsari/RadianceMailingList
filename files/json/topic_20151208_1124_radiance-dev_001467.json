{"topic": "rounding problems? when writing colored images", "category": "radiance-dev", "attachments": [], "created_by_name": "Jan Wienold", "created_at": "December 08, 2015 at 11:24AM", "body": "Hi Greg,\n\n\nI'm not sure if I asked you this already... at least I could not find it \nin the discussion group...\nWhile modifying evalglare I encountered some slight deviations when \nwriting colored pixels in an hdr image using fwritescan (in common/color.c).\n\n\nI 'm coloring parts of the image and try to keep the luminance value. \nWithin evalglare this transformation is correct (I'm using the libraries \nin color.h/color.c). But as soon as I write the image, the color \nchannels are changed. So the values of each channel differ slightly:\n\n\ne.g. out of  r=263.133942   g=0.000000   b=1076.202148 (within \nevalglare)   it gets (in the image) r=2.600e+02    g=4.000e+00 b=1.076e+03\nso the luminance changes from 24970.5 to 25285.6\nThe deviation in that case is 1.25% of the corresponding luminance - I \nalso saw more than 2% in other cases.\n\n\nI guess it comes from the conversion into mantisse and exponent in \ncombination with large differences between the channels, or? Strangely a \nvalue of 0 is getting 4 for the green channel.\n\n\nIs there any possibility to avoid this or to reduce this deviation?\n\n\nthanks!\n\n\nbest,\n\n\nJan\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nDr.-Ing.  Jan Wienold\nEcole Polytechnique F\u00e9d\u00e9rale de Lausanne (EPFL)\nEPFL ENAC IA LIPID\n\n\nhttp://people.epfl.ch/jan.wienold\nLE 1 111 (Office)\nPhone    +41 21 69 30849\n___\n<sup>Automatically generated content from [radiance mailing-list](https://radiance-online.org/pipermail/radiance-dev/2015-December/001467.html).</sup>", "id": "radiance-dev_001467", "created_by": "Jan_Wienold"}