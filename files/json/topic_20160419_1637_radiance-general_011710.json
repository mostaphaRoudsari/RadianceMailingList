{"topic": "UDI script (speaking of obscure languages)", "category": "radiance-general", "attachments": [], "created_by_name": "Randolph M. Fritz", "created_at": "April 19, 2016 at 04:37PM", "body": "This is an awk script that, given a list of sensor locations and a 24\u00d7365\nline annual illuminance file, calculates 300/2000 UDI. I place it in the\npublic domain, but would appreciate credit.\n\n\n# Takes as input an 8760-line 3- or 5-phase annual illuminance file\n# and a sensor location file called photocells.pts\n#\n# Run with:\n#   getinfo - < ill-file | awk -f udi.awk\n\n\nBEGIN {\n    for (i = 1; (r = getline < \"photocells.pts\") > 0; i++) {\n        pt = \"(\" $1 \",\" $2 \")\"\n        pts[i] = pt\n    }\n    if (r < 0) {\n        print \"photocells.pts does not exist\" > \"/dev/stderr\"\n        error = 2\n        exit\n    }\n    npts = i - 1;\n    for (i = 1; i <= npts; i++)\n        under[i] = over[i] = within[i] = 0\n}\n\n\n{\n    # samples are every hour, at the half-hour\n    hr = (NR - 1) % 24\n    tod = hr + 0.5\n\n\n    # between 8:30am and 5:30pm\n    if (8.0 <= tod && tod <= 18.0) {\n        hours++\n        for (i = 1; i <= npts; i++)\n            if ($(i) < 300)\n                under[i]++\n            else if ($(i) > 2000)\n                over[i]++\n            else\n                within[i]++\n        }\n}\n\n\nEND {\n    if (error)\n        exit error\n    if (NR != 365 * 24) {\n        print \"Error: number of hours not 365 * 24\" >\"/dev/stderr\"\n        exit 1\n    }\n    OFS = \"\\t\"\n    print \"Location\", \"UDI\", \"Too Dark\", \"Too Bright\"\n    for (i = 1; i <= npts; i++)\n        print pts[i], within[i] / hours, under[i] / hours, over[i] / hours\n    exit 0\n}\n___\n<sup>Automatically generated content from [radiance mailing-list](https://radiance-online.org/pipermail/radiance-general/2016-April/011710.html).</sup>", "id": "radiance-general_011710", "created_by": "Randolph_M._Fritz"}