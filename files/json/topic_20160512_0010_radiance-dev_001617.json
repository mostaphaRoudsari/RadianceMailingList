{"topic": "NREL Radiance re-distribution", "category": "radiance-dev", "attachments": [], "created_by_name": "Georg Mischler", "created_at": "May 12, 2016 at 12:10AM", "body": "WARNING: At least one of the links in the message below goes to an .exe file, \nwhich could be malicious. To learn how to protect yourself, please go here:\nhttps://commons.lbl.gov/x/_591B\n\n\n\n\nThere's no way for this to be the same problem we recently identified.\nFor one, I don't think Robs gcc is using the MS Universal CRT from\nWindows 10 which caused that one. And secondly, the character that gets\neaten here is nowhere near a line ending.\n\n\nMostapha, can you send me your current test dataset? I only have the\nversion with 420 names, which does not seem to cause trouble anymore.\nThen I'll check if the SCons build has the same issue, and if so,\nwalk through it to see what really happens.\n\n\nCheers\n-schorsch\n\n\nPS: I'm following radiance-dev, no need for a seperate cc.\n\n\n\n\nAm 2016-05-12 00:39, schrieb Gregory J. Ward:\n> OK, this seems to happen when a Windows read operation ends halfway\n> through a \"\\r\\n\" sequence, leaving a '\\r' at the end of one buffer and\n> reading a '\\n' character at the beginning of the next read() call.  It\n> isn't a bug in my code as far as I'm concerned, as Unix handles this\n> case just fine.  Rather, I think there's a bug in the way Windows\n> replaces \"\\r\\n\" with \"\\n\" so that it ends up replacing \"\\ns\" in this\n> case with the empty string, effectively lobbing the first character\n> off the returned buffer.\n> \n> We can test this by running a couple of read() calls on an input\n> buffer such that the length of the read splits an EOL sequence.  This\n> may be the source of the occasional dropped characters Schorsch was\n> seeing in his earlier tests.  Microsoft said they will fix this at\n> some point....\n> \n> Meanwhile, we could try setting the _O_BINARY flag in the open()\n> command in wordfile(), assuming we won't run into the ^Z EOF marker\n> that Schorsch claims is just a childhood trauma of mine and nothing to\n> fear these days...\n> \n> If Rob is willing to re-compile the librt.a in src/common using the\n> attached version of wordfile.c and link it with the debug version of\n> rcontrib, we can see if it makes any difference to test my hypothesis.\n> \n> Cheers,\n> -Greg\n> \n> \n>> FROM: Mostapha Sadeghipour <sadeghipour at gmail.com>\n>> \n>> SUBJECT: Re: NREL Radiance re-distribution\n>> \n>> DATE: May 11, 2016 3:17:59 PM PDT\n> \n>> Thanks Greg! Let me know if there is anything that I can do on my\n>> side to help.\n>> Mostapha\n>> \n>> On Wed, May 11, 2016 at 6:09 PM, Gregory J. Ward\n>> <gregoryjward at gmail.com> wrote:\n>> \n>> Hi Mostapha,\n>> \n>> Your screen capture came through -- now we're getting somewhere!\n>> The error again happens near the boundary between read() calls, so\n>> it's a matter of figuring out what could be going wrong on Windows\n>> even after the earlier bug fix.\n>> \n>> Schorsch has noticed issues with dropped bytes on stdin, but I don't\n>> think we've seen this sort of problem with file input.  It could\n>> still have something to do with the conversion of \"\\r\\n\" EOL\n>> sequences to \"\\n\" in O_TEXT input files, but I need to think how\n>> this might happen.\n>> \n>> More later,\n>> -Greg\n>> \n>> FROM: Mostapha Sadeghipour <sadeghipour at gmail.com>\n>> \n>> DATE: May 11, 2016 2:44:18 PM PDT\n>> \n>> Thanks Rob! Dropbox link worked. Maybe I was doing something wrong.\n>> \n>> I think we're close. New rcontrib prints out some notes which show\n>> that solar1216 is picked up as 8-letter modifier `olar1216` missing\n>> the starting s. The rest are 9 letter modifiers. That should be why\n>> it never shows up?\n>> \n>> I almost never copy images in an email but I hope this one shows up\n>> right. Let me know if it wasn't and I can save and attach it.\n>> \n>> Mostapha\n>> \n>> On Wed, May 11, 2016 at 5:31 PM, Guglielmetti, Robert\n>> <Robert.Guglielmetti at nrel.gov> wrote:\n>> Mo, I'm confused. I double checked the build, and it's 64-bit. What\n>> makes you think it's 32-bit? I didn't run your specific test, but I\n>> ran it with the '-version' flag and it worked fine. Only thing I can\n>> think of is it somehow got messed up as an attachment.(?) Try\n>> downloading this re-re-rebuilt copy from Dropbox:\n>> \n>> https://www.dropbox.com/s/4qnqnd6cz5btppt/rcontrib.exe?dl=0\n>> \n>> A tutorial on how to use the CMake crap we put in there would be\n>> nice, wouldn't it? Someday...\n>> \n>> On 5/11/16, 1:26 PM, \"Mostapha Sadeghipour\"\n>> <sadeghipour at gmail.com<mailto:sadeghipour at gmail.com>> wrote:\n>> \n>> Thanks Rob. I couldn't get the new rcontrib to run. It gives me the\n>> same error. I will wait for you.\n>> \n>> PS: I should start to learn how to compile Radiance for Windows from\n>> source code. Is there a tutorial somewhere?\n>> \n>> On Wed, May 11, 2016 at 3:05 PM, Guglielmetti, Robert\n>> <Robert.Guglielmetti at nrel.gov<mailto:Robert.Guglielmetti at nrel.gov>>\n>> wrote:\n>> Sorry about that, it shouldn't have been (that's scary). I'm in a\n>> meeting right now but can look into this in a bit...\n>> \n>> On 5/11/16, 1:02 PM, \"Mostapha Sadeghipour\"\n>> \n> <sadeghipour at gmail.com<mailto:sadeghipour at gmail.com><mailto:sadeghipour at gmail.com<mailto:sadeghipour at gmail.com>>>\n>> wrote:\n>> \n>> Hello all,\n>> \n>> Thanks Greg and Rob. Sorry for the delay! I just saw this.\n>> \n>> Hey Rob. This is again 32-bit. =) I'm downloading the Radiance\n>> 32-bit built to test it again. I will report back shortly.\n>> \n>> Mostapha\n\n\n\n\nGeorg Mischler  --  simulations developer  --  schorsch at schorsch com\n+schorsch.com+  --  lighting design tools  --  http://www.schorsch.com/\n___\n<sup>Automatically generated content from [radiance mailing-list](https://radiance-online.org/pipermail/radiance-dev/2016-May/001617.html).</sup>", "id": "radiance-dev_001617", "created_by": "Georg_Mischler"}