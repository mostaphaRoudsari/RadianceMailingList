From chris at coolshadow.com  Mon Apr  2 14:56:52 2012
From: chris at coolshadow.com (Humann Chris)
Date: Mon, 2 Apr 2012 14:56:52 -0700
Subject: [Radiance-general] pcomb-masking color channels
In-Reply-To: <662C5A57-1405-41BC-A12B-E4110CA0F401@iebele.nl>
References: <jkfq67$rjv$1@dough.gmane.org>
	<427773F0-7BBD-4D33-85D2-9884B7264A98@lmi.net>
	<BAE8E899-19AB-4B1A-AFD1-E59176B0D353@coolshadow.com>
	<25CF3DB3-AD8D-42DA-BF7D-AE605519C092@lmi.net>
	<7F18F8EB-6171-437F-B48F-1FAC3FB4BC5F@iebele.nl>
	<662C5A57-1405-41BC-A12B-E4110CA0F401@iebele.nl>
Message-ID: <3CAC2473-6474-465A-BF24-9868AA0D9260@coolshadow.com>

Thanks Greg and Ieble,

Iebele, that's a great start for me to play around with.  Ultimately  
I'm trying to isolate the blue sky from white clouds in a single HDR  
image to get an approximation of how overcast the sky is.

Kind regards,
Chris

Christian Humann ~ Associate
LOISOS + UBBELOHDE
- - - - - - - - - - - - - - - - - - - - - - - - - - -
1917 Clement Avenue  Building 10A
Alameda, CA  94501 USA
- - - - - - - - - - - - - - - - - - - - - - - - - - -
510 521 3800 VOICE
510 521 3820 FAX
- - - - - - - - - - - - - - - - - - - - - - - - - - -
www.coolshadow.com



On Mar 30, 2012, at 4:11 AM, Iebele Abel wrote:

> Hi Chris,
>
> I made a mistake in last my mail, here the corrected line:
>
> If the value is too high (not too low), the result will be just a  
> copy of blue_sky.hdr.
>
> Iebele
>
>> Hi Chris,
>>
>> I had something similar a few weeks ago, and figured out this:
>>
>> pcomb -e 'sens=1.5;difr=(ri(1)-sens)-ri(2);difg=(gi(1)-sens)-gi(2);  
>> difb=(bi(1)-sens)-bi(2); ro=if(difr,ri(1),ri(2));  
>> go=if(difg,gi(1),gi(2)); bo=if(difb,bi(1),bi(2)); '  sun.hdr  
>> blue_sky.hdr   |   ximage
>>
>> You can tweak the "sens" variable to get the result you want. In my  
>> case (which was not a sky picture) the value was around 0.9 to get  
>> the result I was after. The value you need to mask the sun out of  
>> the sun.hdr image must probably be higher. If the value is too low,  
>> the result will be just a copy of blue_sky.hdr.
>>
>> The command first finds the difference between pixel values for  
>> red, green and blue in sun.hdr and blue_sky.hdr. The difference  
>> (tweaked by 'sens' ) determines from which input file the pixel  
>> component value is written to the output.
>>
>> If you are only interested in changing the luminance values of  
>> blue_sky.hdr at those spots where the sun (or clouds) are bright in  
>> sun.hdr you may try something like this:
>>
>> pcomb -e 'sens=1.5;difl=(li(1)-sens)-li(2);ro=if(difl,  
>> li(1)*ri(2),li(2)*ri(2) ); go=if(difl, li(1)*gi(2),li(2)*gi(2) );  
>> bo=if(difl, li(1)*bi(2),li(2)*bi(2) );  ' sun.hdr blue_sky.hdr |  
>> image
>>
>> Using these commands, the sun (and clouds) will appear with sharp  
>> boundary edges (not blurred) in the resulting composite image.
>>
>> Hope this helps a bit,
>>
>> Iebele
>>
>>
>>
>> Op 30 mrt. 2012, om 07:45 heeft Greg Ward het volgende geschreven:
>>
>>> Hi Chris,
>>>
>>> Seems no one answered this, but I believe there are experts out  
>>> there who have played with sky blending techniques.  I won't name  
>>> any names, you know who you are....
>>>
>>> I'm heading out on a little vacation tomorrow with a million  
>>> things to do first, otherwise I'd take a crack at it.  Maybe you  
>>> could explain a little more clearly the effect you are going for?
>>>
>>> Best,
>>> -Greg
>>>
>>>> From: Humann Chris <chris at coolshadow.com>
>>>> Date: March 27, 2012 3:19:15 PM PDT
>>>>
>>>> Dear group,
>>>>
>>>> I'd like to be able to generate two separate images from an HDR  
>>>> image of the sky vault: one with blue sky; the other with clouds  
>>>> and sun (assuming it's not occluded).  I'm not well versed in the  
>>>> usage of 'pcomb' but I'm assuming I'll need to somehow create a  
>>>> mask based on both color and brightness thresholds.  It seems  
>>>> from my archive search that a call to 'pgblur' with a high radius  
>>>> might help in defining sharper boundaries between clouds and blue  
>>>> sky. (http://www.radiance-online.org/pipermail/radiance-general/2008-May/005046.html 
>>>> )
>>>>
>>>> Has anyone been successful in achieving something similar?
>>>>
>>>> As always, thanks!
>>>>
>>>> Chris
>>>
>>> _______________________________________________
>>> Radiance-general mailing list
>>> Radiance-general at radiance-online.org
>>> http://www.radiance-online.org/mailman/listinfo/radiance-general
>>
>> _______________________________________________
>> Radiance-general mailing list
>> Radiance-general at radiance-online.org
>> http://www.radiance-online.org/mailman/listinfo/radiance-general
>
> _______________________________________________
> Radiance-general mailing list
> Radiance-general at radiance-online.org
> http://www.radiance-online.org/mailman/listinfo/radiance-general

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20120402/0532c87d/attachment.html>

From jacobs.axel at gmail.com  Tue Apr  3 16:08:16 2012
From: jacobs.axel at gmail.com (Axel Jacobs)
Date: Wed, 04 Apr 2012 00:08:16 +0100
Subject: [Radiance-general] pcomb-masking color channels
Message-ID: <4F7B82E0.2070206@gmail.com>

Hi Chris,

I don't have anything Radiance-specific to contribute to your question. 
However, I've been looking at using HDR photography and the Radiance 
tool kit for measuring glare. To measure glare, one needs to establish 
the projection of the lens that is used. I've measured this for the 
Sigma 4.5mm that I'm using. While googling around for 'fisheye 
projections', I've come across this rather interesting paper:

Almost a Century of "Imaging" Clouds Over the Whole-Sky Dome.
McGuffe, K.; Henderson-Sellers, A.
Bulletin of the American Meteorological Society, vol. 70, Issue 10, 
pp.1243-1253

PDF at:
http://journals.ametsoc.org/doi/abs/10.1175/1520-0477(1989)070%3C1243%3AAACOCO%3E2.0.CO%3B2

It has a pretty good list of references, too.

Before digital photography and computer-based image processing, cloud 
detection was done by human observers. In order to obtain the best 
possible contrast, black and white photographs were enhanced with red 
filters. This is something that you might want to look at with you 
Radiance approach. It looks as if some of the references in that paper 
might give some insight into auto-detecting clouds, but I have not 
followed them up.

Cheers

Axel


From bayanda at pjc.co.za  Wed Apr  4 00:50:31 2012
From: bayanda at pjc.co.za (Bayanda Mpauli)
Date: Wed, 4 Apr 2012 09:50:31 +0200
Subject: [Radiance-general] Ecotect, DIVA and Radiance
Message-ID: <001301cd1237$9e3224c0$da966e40$@pjc.co.za>

HI All,

 

I have installed the DIVA for Rhino plugin and since there I can no longer
run radiance grid analysis directly from Ecotect. I am getting the following
error message in the dos window:

 

"rtrace: fatal - command line error at '-sj'

 

Which then results in no data being written to the grid file. 

 

In addition I cannot recall how to reinstall everything to its original
state as it was operating before installing DIVA for Rhino. 

 

Any help with this would be appreciated.

 

Regards,

Bayanda

BAS (UCT)

Green Star SA Accredited Professional

 

PJ Carew Consulting

3rd floor 71 buitengraght Cape Town 8001

tel: 021 426 4051  fax: 021 426 5050  cell: 083 335 9365

 <mailto:bayanda at pjc.co.za> bayanda at pjc.co.za    <http://www.pjc.co.za/>
www.pjc.co.za 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20120404/43b6df88/attachment.html>

From iabel at iebele.nl  Wed Apr  4 01:03:10 2012
From: iabel at iebele.nl (Iebele Abel)
Date: Wed, 4 Apr 2012 11:03:10 +0300
Subject: [Radiance-general] Ecotect, DIVA and Radiance
In-Reply-To: <001301cd1237$9e3224c0$da966e40$@pjc.co.za>
References: <001301cd1237$9e3224c0$da966e40$@pjc.co.za>
Message-ID: <A5954CF8-BD08-4A40-A1E1-FB762BAFA64C@iebele.nl>


Hi Bayanda, 

I don't know if this is of any help (I never worked with DIVA), but your problems reminds me to the release note of Radiance 4.1 which says that the -sj option has been changed to -ss:

****** COMPATIBILITY CHANGE ********
Changed -sj (specular jitter) option to something called specular
sampling (-ss), which if set less than 1 has the same behavior as
the old -sj, but when set greater than 1, spawns multiple ray
samples from semi-specular surfaces.
For details see: http://radsite.lbl.gov/radiance/refer/Notes/ReleaseNotes.html#Version%204.1


My best, 

Iebele




Op 4 apr. 2012, om 10:50 heeft Bayanda Mpauli het volgende geschreven:

> HI All,
>  
> I have installed the DIVA for Rhino plugin and since there I can no longer run radiance grid analysis directly from Ecotect. I am getting the following error message in the dos window:
>  
> "rtrace: fatal - command line error at '-sj'
>  
> Which then results in no data being written to the grid file.
>  
> In addition I cannot recall how to reinstall everything to its original state as it was operating before installing DIVA for Rhino.
>  
> Any help with this would be appreciated.
>  
> Regards,
> Bayanda
> BAS (UCT)
> Green Star SA Accredited Professional
>  
> PJ Carew Consulting
> 3rd floor 71 buitengraght Cape Town 8001
> tel: 021 426 4051  fax: 021 426 5050  cell: 083 335 9365
> bayanda at pjc.co.za   www.pjc.co.za
>  
> _______________________________________________
> Radiance-general mailing list
> Radiance-general at radiance-online.org
> http://www.radiance-online.org/mailman/listinfo/radiance-general

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20120404/bad3cf01/attachment.html>

From RFritz at lbl.gov  Fri Apr  6 08:55:46 2012
From: RFritz at lbl.gov (Randolph M. Fritz)
Date: Fri, 6 Apr 2012 08:55:46 -0700
Subject: [Radiance-general] Ecotect, DIVA and Radiance
References: <001301cd1237$9e3224c0$da966e40$@pjc.co.za>
Message-ID: <jln3m3$sib$1@dough.gmane.org>

It looks like the version of Radiance shipped with DIVA is incompatible 
with the one required by Ecotect.  Since the version shipped with DIVA 
is the more current, I am not sure what to do.  Do you have an Autodesk 
support contract for Ecotect?

Randolph

On 2012-04-04 07:50:31 +0000, Bayanda Mpauli said:

> HI All,
> ?
> I have installed the DIVA for Rhino plugin and since there I can no 
> longer run radiance grid analysis directly from Ecotect. I am getting 
> the following error message in the dos window:
> ?
> "rtrace: fatal - command line error at '-sj'
> ?
> Which then results in no data being written to the grid file.
> ?
> In addition I cannot recall how to reinstall everything to its original 
> state as it was operating before installing DIVA for Rhino.
> ?
> Any help with this would be appreciated.
> ?
> Regards,
> Bayanda
> BAS (UCT)
> Green Star SA Accredited Professional
> ?
> PJ Carew Consulting
> 3rd floor 71 buitengraght Cape Town 8001
> tel: 021?426 4051? fax: 021?426 5050? cell: 083?335 9365
> bayanda at pjc.co.za?? www.pjc.co.za
> ?
> _______________________________________________
> Radiance-general mailing list
> Radiance-general at radiance-online.org
> http://www.radiance-online.org/mailman/listinfo/radiance-general


-- 
Randolph M. Fritz
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20120406/6988b13e/attachment.html>

From iabel at iebele.nl  Fri Apr  6 15:20:43 2012
From: iabel at iebele.nl (Iebele)
Date: Sat, 7 Apr 2012 01:20:43 +0300
Subject: [Radiance-general] Optimizing Radiance
In-Reply-To: <4F7B82E0.2070206@gmail.com>
References: <4F7B82E0.2070206@gmail.com>
Message-ID: <81CEA7EA-0D5B-489B-BEAB-2652E4803395@iebele.nl>

Hi group, 

I'm setting up Radiance on a computer cluster with lots of nodes. Tweeking gcc flags is not my best quality(understatement), so I bring it here. 
Playing a bit with options which I found on Marc's benchmark page, I got rendering times per core over twice as long as on my 2.2 Ghz macbook. Doesn't make me happy :) 
Below I've pasted the cpuinfo from a node on the cluster. Does anyone in the group has an idea what flags I should give to gcc to optimize Radiance? 
The flags I've used so far - are:   -march=native -m64 -msse -msse2 -funroll-loops -ffast-math  -O3  -Dlinux -D_FILE_OFFSET_BITS=64

Cheers, 

iebele


cat /proc/cpuinfo:

processor	: 7
vendor_id	: GenuineIntel
cpu family	: 6
model		: 23
model name	: Intel(R) Xeon(R) CPU           L5420  @ 2.50GHz
stepping	: 10
cpu MHz		: 2493.445
cache size	: 6144 KB
physical id	: 0
siblings	: 4
core id		: 2
cpu cores	: 4
apicid		: 2
initial apicid	: 2
fpu		: yes
fpu_exception	: yes
cpuid level	: 13
wp		: yes
flags		: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx lm constant_tsc arch_perfmon pebs bts rep_good aperfmperf pni dtes64 monitor ds_cpl vmx est tm2 ssse3 cx16 xtpr pdcm dca sse4_1 xsave lahf_lm tpr_shadow vnmi flexpriority
bogomips	: 4987.90
clflush size	: 64
cache_alignment	: 64
address sizes	: 38 bits physical, 48 bits virtual

From RFritz at lbl.gov  Mon Apr  9 12:29:40 2012
From: RFritz at lbl.gov (Randolph M. Fritz)
Date: Mon, 9 Apr 2012 12:29:40 -0700
Subject: [Radiance-general] "Broken pipe" message from rpiece on
	multi-core Linux system
References: <iv5g21$jnc$1@dough.gmane.org>
	<4188C437-AE0A-48A6-A4C2-22D1AB992CEA@lmi.net>
	<iv5lit$hkp$1@dough.gmane.org>
Message-ID: <jlvdb5$ljf$1@dough.gmane.org>

This problem is back for a sequel, and it would really help my work if 
I could get it going.

It's been a few months since I last asked about this.  Has anyone else 
experienced this in a Linux environment?  Anyone have any ideas what to 
do about it or how to debug it?

/proc/version reports:
  Linux version 2.6.18-274.18.1.el5 (mockbuild at builder10.centos.org) 
(gcc version 4.1.2 20080704 (Red Hat 4.1.2-51)) #1 SMP Thu Feb 9 
12:45:44 EST 2012

Randolph

On 2011-07-08 01:13:01 +0000, Randolph M. Fritz said:

> On 2011-07-07 16:54:06 -0700, Greg Ward said:
> 
>> Hi Randolph,
>> 
>> This shouldn't happen, unless one of the rpict processes died
>> unexpectedly.  Even then, I would expect some other kind of error to be
>> reported as well.
>> 
>> -Greg
> 
> Thanks, Greg.  I think that's what happenned; in fact seven of the
> eight died in two cases.  Wierdly, the third succeeded.  If I run it as
> a single-processor job, it works.  Here's a piece of the log:
> 
>> rpiece -F bl_blinds_rpsync.txt -PP pfLF5M90 -vtv -vp 60.0 -2.0 66.0 -vd
>> 12.0 0.0 0.0 -vu 0 0 1 -vh 60 -x 1024 -y 1024 -dp 512 -ar 42 -ms 3.6
>> -ds .3 -dt .1 -dc .5 -dr 1 -ss 1 -st .1 -af bl.amb -aa .1 -ad 1536 -as
>> 392 -av 10 10 10 -lr 8 -lw 1e-4 -ps 6 -pt .08 -o bl_blinds.unf bl.oct
> 
>> rpict: warning - no output produced
> 
>> rpict: system - write error in io_process: Broken pipe
>> rpict: 0 rays, 0.00% after 0.000u 0.000s 0.001r hours on n0065.lr1
>> rad: error rendering view blinds


-- 
Randolph M. Fritz




From jedev at visarc.com  Mon Apr  9 13:46:03 2012
From: jedev at visarc.com (Jack de Valpine)
Date: Mon, 09 Apr 2012 16:46:03 -0400
Subject: [Radiance-general] "Broken pipe" message from rpiece on
 multi-core Linux system
In-Reply-To: <jlvdb5$ljf$1@dough.gmane.org>
References: <iv5g21$jnc$1@dough.gmane.org>
	<4188C437-AE0A-48A6-A4C2-22D1AB992CEA@lmi.net>
	<iv5lit$hkp$1@dough.gmane.org> <jlvdb5$ljf$1@dough.gmane.org>
Message-ID: <4F834A8B.7020704@visarc.com>

Hey Randolph,

I have run into this before. Unfortunately I have had limited success in 
tracking down the issue and also have not really looked at it for some 
time. If I recall correctly, a couple of things that I have noticed:

  * possible problem if a piece finishes before the first set of pieces
    are parcelled out out by rpiece - so if it 8 pieces are being
    distributed at startup and piece 2 (for example) finishes before one
    of pieces 1, 3, 4, 5, 6, 7, 8 has even been processed by rpiece or
    while rpiece is still forking off the initial jobs.

Sorry I cannot offer more, I have spent some time in the code on this 
one and it is not for the faint of heart to say the least.

-Jack

-- 
# Jack de Valpine
# president
#
# visarc incorporated
# http://www.visarc.com
#
# channeling technology for superior design and construction


On 4/9/2012 3:29 PM, Randolph M. Fritz wrote:
> This problem is back for a sequel, and it would really help my work if 
> I could get it going.
>
> It's been a few months since I last asked about this.  Has anyone else 
> experienced this in a Linux environment?  Anyone have any ideas what 
> to do about it or how to debug it?
>
> /proc/version reports:
>  Linux version 2.6.18-274.18.1.el5 (mockbuild at builder10.centos.org) 
> (gcc version 4.1.2 20080704 (Red Hat 4.1.2-51)) #1 SMP Thu Feb 9 
> 12:45:44 EST 2012
>
> Randolph
>
> On 2011-07-08 01:13:01 +0000, Randolph M. Fritz said:
>
>> On 2011-07-07 16:54:06 -0700, Greg Ward said:
>>
>>> Hi Randolph,
>>>
>>> This shouldn't happen, unless one of the rpict processes died
>>> unexpectedly.  Even then, I would expect some other kind of error to be
>>> reported as well.
>>>
>>> -Greg
>>
>> Thanks, Greg.  I think that's what happenned; in fact seven of the
>> eight died in two cases.  Wierdly, the third succeeded.  If I run it as
>> a single-processor job, it works.  Here's a piece of the log:
>>
>>> rpiece -F bl_blinds_rpsync.txt -PP pfLF5M90 -vtv -vp 60.0 -2.0 66.0 -vd
>>> 12.0 0.0 0.0 -vu 0 0 1 -vh 60 -x 1024 -y 1024 -dp 512 -ar 42 -ms 3.6
>>> -ds .3 -dt .1 -dc .5 -dr 1 -ss 1 -st .1 -af bl.amb -aa .1 -ad 1536 -as
>>> 392 -av 10 10 10 -lr 8 -lw 1e-4 -ps 6 -pt .08 -o bl_blinds.unf bl.oct
>>
>>> rpict: warning - no output produced
>>
>>> rpict: system - write error in io_process: Broken pipe
>>> rpict: 0 rays, 0.00% after 0.000u 0.000s 0.001r hours on n0065.lr1
>>> rad: error rendering view blinds
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20120409/26dc6a34/attachment.html>

From gregoryjward at gmail.com  Mon Apr  9 14:52:47 2012
From: gregoryjward at gmail.com (Greg Ward)
Date: Mon, 9 Apr 2012 14:52:47 -0700
Subject: [Radiance-general] "Broken pipe" message from rpiece on
	multi-core Linux system
In-Reply-To: <4F834A8B.7020704@visarc.com>
References: <iv5g21$jnc$1@dough.gmane.org>
	<4188C437-AE0A-48A6-A4C2-22D1AB992CEA@lmi.net>
	<iv5lit$hkp$1@dough.gmane.org> <jlvdb5$ljf$1@dough.gmane.org>
	<4F834A8B.7020704@visarc.com>
Message-ID: <B7A9CAA2-4DFB-48A2-B0A9-5D811124465C@lmi.net>

If it is a startup issue as Jack suggests, you might try inserting a few seconds of delay between the spawning of each new rpiece process using "sleep 5" or similar.  This allows time for the sync file to be updated without contention between processes.  This is what I do in rad with the -N option.  I actually wait 10 seconds between each new rpiece process.

This isn't to say that I understand the source of your error, which still puzzles me.

-Greg

> From: Jack de Valpine <jedev at visarc.com>
> Date: April 9, 2012 1:46:03 PM PDT
> 
> Hey Randolph,
> 
> I have run into this before. Unfortunately I have had limited success in tracking down the issue and also have not really looked at it for some time. If I recall correctly, a couple of things that I have noticed:
> possible problem if a piece finishes before the first set of pieces are parcelled out out by rpiece - so if it 8 pieces are being distributed at startup and piece 2 (for example) finishes before one of pieces 1, 3, 4, 5, 6, 7, 8 has even been processed by rpiece or while rpiece is still forking off the initial jobs.
> Sorry I cannot offer more, I have spent some time in the code on this one and it is not for the faint of heart to say the least. 
> -Jack
> -- 
> # Jack de Valpine
> # president
> #
> # visarc incorporated
> # http://www.visarc.com
> #
> # channeling technology for superior design and construction
> 
> On 4/9/2012 3:29 PM, Randolph M. Fritz wrote:
>> 
>> This problem is back for a sequel, and it would really help my work if I could get it going. 
>> 
>> It's been a few months since I last asked about this.  Has anyone else experienced this in a Linux environment?  Anyone have any ideas what to do about it or how to debug it? 
>> 
>> /proc/version reports: 
>>  Linux version 2.6.18-274.18.1.el5 (mockbuild at builder10.centos.org) (gcc version 4.1.2 20080704 (Red Hat 4.1.2-51)) #1 SMP Thu Feb 9 12:45:44 EST 2012 
>> 
>> Randolph 
>> 
>> On 2011-07-08 01:13:01 +0000, Randolph M. Fritz said: 
>> 
>>> On 2011-07-07 16:54:06 -0700, Greg Ward said: 
>>> 
>>>> Hi Randolph, 
>>>> 
>>>> This shouldn't happen, unless one of the rpict processes died 
>>>> unexpectedly.  Even then, I would expect some other kind of error to be 
>>>> reported as well. 
>>>> 
>>>> -Greg 
>>> 
>>> Thanks, Greg.  I think that's what happenned; in fact seven of the 
>>> eight died in two cases.  Wierdly, the third succeeded.  If I run it as 
>>> a single-processor job, it works.  Here's a piece of the log: 
>>> 
>>>> rpiece -F bl_blinds_rpsync.txt -PP pfLF5M90 -vtv -vp 60.0 -2.0 66.0 -vd 
>>>> 12.0 0.0 0.0 -vu 0 0 1 -vh 60 -x 1024 -y 1024 -dp 512 -ar 42 -ms 3.6 
>>>> -ds .3 -dt .1 -dc .5 -dr 1 -ss 1 -st .1 -af bl.amb -aa .1 -ad 1536 -as 
>>>> 392 -av 10 10 10 -lr 8 -lw 1e-4 -ps 6 -pt .08 -o bl_blinds.unf bl.oct 
>>> 
>>>> rpict: warning - no output produced 
>>> 
>>>> rpict: system - write error in io_process: Broken pipe 
>>>> rpict: 0 rays, 0.00% after 0.000u 0.000s 0.001r hours on n0065.lr1 
>>>> rad: error rendering view blinds 
>> 
>> 
> _______________________________________________
> Radiance-general mailing list
> Radiance-general at radiance-online.org
> http://www.radiance-online.org/mailman/listinfo/radiance-general
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20120409/0e769763/attachment.html>

From RFritz at lbl.gov  Tue Apr 10 22:27:58 2012
From: RFritz at lbl.gov (Randolph M. Fritz)
Date: Tue, 10 Apr 2012 22:27:58 -0700
Subject: [Radiance-general] "Broken pipe" message from rpiece on
	multi-core Linux system
References: <iv5g21$jnc$1@dough.gmane.org>
	<4188C437-AE0A-48A6-A4C2-22D1AB992CEA@lmi.net>
	<iv5lit$hkp$1@dough.gmane.org> <jlvdb5$ljf$1@dough.gmane.org>
	<4F834A8B.7020704@visarc.com>
	<B7A9CAA2-4DFB-48A2-B0A9-5D811124465C@lmi.net>
Message-ID: <jm34ov$1n4$1@dough.gmane.org>

Thanks Jack, Greg.

Jack, what kernel were you using?  Was it also Linux?

Greg, I was using rad, so those delays are already in there, alas.  I 
wonder if there is some subtle difference between the Mac OS Mach 
kernel and the Linux kernel that's causing the problem, or if it occurs 
on all platforms, just more frequently in the very fast cluster nodes.

Or, it could be an NFS locking problem, bah.

If I find time, maybe I can dig into it some more.  Right now, I may 
just finesse it by running multiple *different* simulations on the same 
cluster node.

Randolph

On 2012-04-09 21:52:47 +0000, Greg Ward said:

> If it is a startup issue as Jack suggests, you might try inserting a 
> few seconds of delay between the spawning of each new rpiece process 
> using "sleep 5" or similar. ?This allows time for the sync file to be 
> updated without contention between processes. ?This is what I do in rad 
> with the -N option. ?I actually wait 10 seconds between each new rpiece 
> process.
> 
> This isn't to say that I understand the source of your error, which 
> still puzzles me.
> 
> -Greg
>>>> From: Jack de Valpine <jedev at visarc.com>
>>> Date: April 9, 2012 1:46:03 PM PDT
>> 
> Hey Randolph,
> 
> I have run into this before. Unfortunately I have had limited success 
> in tracking down the issue and also have not really looked at it for 
> some time. If I recall correctly, a couple of things that I have 
> noticed:
>>>> 	?	possible problem if a piece finishes before the first set of pieces 
>>>> are parcelled out out by rpiece - so if it 8 pieces are being 
>>>> distributed at startup and piece 2 (for example) finishes before one of 
>>>> pieces 1, 3, 4, 5, 6, 7, 8 has even been processed by rpiece or while 
>>>> rpiece is still forking off the initial jobs.
> Sorry I cannot offer more, I have spent some time in the code on this 
> one and it is not for the faint of heart to say the least. 
> -Jack
> -- 
> # Jack de Valpine
> # president
> #
> # visarc incorporated
> # http://www.visarc.com
> #
> # channeling technology for superior design and construction
> 
> On 4/9/2012 3:29 PM, Randolph M. Fritz wrote:
> This problem is back for a sequel, and it would really help my work if 
> I could get it going. 
> 
> It's been a few months since I last asked about this.? Has anyone else 
> experienced this in a Linux environment?? Anyone have any ideas what to 
> do about it or how to debug it? 
> 
> /proc/version reports: 
> ?Linux version 2.6.18-274.18.1.el5 
> (mockbuild at builder10.centos.org) (gcc 
> version 4.1.2 20080704 (Red Hat 4.1.2-51)) #1 SMP Thu Feb 9 12:45:44 
> EST 2012 
> 
> Randolph 
> 
> On 2011-07-08 01:13:01 +0000, Randolph M. Fritz said: 
> 
> On 2011-07-07 16:54:06 -0700, Greg Ward said: 
> 
> Hi Randolph, 
> 
> This shouldn't happen, unless one of the rpict processes died 
> unexpectedly.? Even then, I would expect some other kind of error to be 
> reported as well. 
> 
> -Greg 
> 
> Thanks, Greg.? I think that's what happenned; in fact seven of the 
> eight died in two cases.? Wierdly, the third succeeded.? If I run it as 
> a single-processor job, it works.? Here's a piece of the log: 
> 
> rpiece -F bl_blinds_rpsync.txt -PP pfLF5M90 -vtv -vp 60.0 -2.0 66.0 -vd 
> 12.0 0.0 0.0 -vu 0 0 1 -vh 60 -x 1024 -y 1024 -dp 512 -ar 42 -ms 3.6 
> -ds .3 -dt .1 -dc .5 -dr 1 -ss 1 -st .1 -af bl.amb -aa .1 -ad 1536 -as 
> 392 -av 10 10 10 -lr 8 -lw 1e-4 -ps 6 -pt .08 -o bl_blinds.unf bl.oct 
> 
> rpict: warning - no output produced 
> 
> rpict: system - write error in io_process: Broken pipe 
> rpict: 0 rays, 0.00% after 0.000u 0.000s 0.001r hours on n0065.lr1 
> rad: error rendering view blinds 
> 
> 
> _______________________________________________
> Radiance-general mailing list
> Radiance-general at radiance-online.org
> http://www.radiance-online.org/mailman/listinfo/radiance-general
> _______________________________________________
> Radiance-general mailing list
> Radiance-general at radiance-online.org
> http://www.radiance-online.org/mailman/listinfo/radiance-general


-- 
Randolph M. Fritz
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20120410/bdb663e6/attachment.html>

From jedev at visarc.com  Wed Apr 11 05:54:58 2012
From: jedev at visarc.com (Jack de Valpine)
Date: Wed, 11 Apr 2012 08:54:58 -0400
Subject: [Radiance-general] "Broken pipe" message from rpiece on
 multi-core Linux system
In-Reply-To: <jm34ov$1n4$1@dough.gmane.org>
References: <iv5g21$jnc$1@dough.gmane.org>
	<4188C437-AE0A-48A6-A4C2-22D1AB992CEA@lmi.net>
	<iv5lit$hkp$1@dough.gmane.org> <jlvdb5$ljf$1@dough.gmane.org>
	<4F834A8B.7020704@visarc.com>
	<B7A9CAA2-4DFB-48A2-B0A9-5D811124465C@lmi.net>
	<jm34ov$1n4$1@dough.gmane.org>
Message-ID: <4F857F22.1010403@visarc.com>

Hi Randolph,

All I have is Linux. Not sure what kernels at this point. But I have 
noticed this over multiple kernels and distributions. Although I have 
not run anything on the most recent kernels.

I know that one thing I did was to disable the fork and wait 
functionality in rpiece to wait for a job to finish. I do not recall 
though if this was related to this problem, nfs locking, or running on a 
cluster with job distribution queuing....? Sorry I do not remember more 
right now.

Just thinking out loud here, but if you are running on a cluster then 
could network latency also be an issue?

Here is my suspicion/theory, which I have not been able to test. I think 
that somehow there is a race condition in the way jobs get forked off 
and status of pieces gets recorded in the syncfile...

For testing/debugging purposes, a few things to look at compare might be:

  * big scene - slow load time
  * small scene - fast load time
  * "fast" parameters - small image size with lots of divisions
  * "slow" parameters - small image size with lots of divisions

On my cluster, I ended up setting up things so that any initial small 
image run for building the ambient cache would actually just run as a 
single rpict process and then large images would get distributed across 
nodes/cores.

As an aside, perhaps Rob G. has some thoughts on Radiance/Clusters as I 
think they have a large one also. What is the cluster set up at LBNL? I 
believe that at one point they were using a provisioning system called 
Warewulf which has now evolved to Perceus. I have the former setup and 
have not gotten around to the latter. LBNL may also be using a job 
queuing system called Slurm which they developed (or maybe that was at 
LLNL)?

Hopefully this is not leading you off on the wrong track though. 
Probably would be useful to figure out if the problem is indeed rpiece 
related or something else entirely.

-Jack

-- 
# Jack de Valpine
# president
#
# visarc incorporated
# http://www.visarc.com
#
# channeling technology for superior design and construction


On 4/11/2012 1:27 AM, Randolph M. Fritz wrote:
>
> Thanks Jack, Greg.
>
>
> Jack, what kernel were you using?Was it also Linux?
>
>
> Greg, I was using rad, so those delays are already in there, alas.I 
> wonder if there is some subtle difference between the Mac OS Mach 
> kernel and the Linux kernel that's causing the problem, or if it 
> occurs on all platforms, just more frequently in the very fast cluster 
> nodes.
>
>
> Or, it could be an NFS locking problem, bah.
>
>
> If I find time, maybe I can dig into it some more.Right now, I may 
> just finesse it by running multiple *different* simulations on the 
> same cluster node.
>
>
> Randolph
>
>
> On 2012-04-09 21:52:47 +0000, Greg Ward said:
>
>
> If it is a startup issue as Jack suggests, you might try inserting a 
> few seconds of delay between the spawning of each new rpiece process 
> using "sleep 5" or similar.  This allows time for the sync file to be 
> updated without contention between processes.  This is what I do in 
> rad with the -N option.  I actually wait 10 seconds between each new 
> rpiece process.
>
>
> This isn't to say that I understand the source of your error, which 
> still puzzles me.
>
>
> -Greg
>
> From: Jack de Valpine <jedev at visarc.com <mailto:jedev at visarc.com>>
>
> Date: April 9, 2012 1:46:03 PM PDT
>
>
> Hey Randolph,
>
>
> I have run into this before. Unfortunately I have had limited success 
> in tracking down the issue and also have not really looked at it for 
> some time. If I recall correctly, a couple of things that I have noticed:
>
>   * possible problem if a piece finishes before the first set of
>     pieces are parcelled out out by rpiece - so if it 8 pieces are
>     being distributed at startup and piece 2 (for example) finishes
>     before one of pieces 1, 3, 4, 5, 6, 7, 8 has even been processed
>     by rpiece or while rpiece is still forking off the initial jobs.
>
> Sorry I cannot offer more, I have spent some time in the code on this 
> one and it is not for the faint of heart to say the least.
>
> -Jack
>
> --
>
> # Jack de Valpine
>
> # president
>
> #
>
> # visarc incorporated
>
> # http://www.visarc.com <http://www.visarc.com/>
>
> #
>
> # channeling technology for superior design and construction
>
>
> On 4/9/2012 3:29 PM, Randolph M. Fritz wrote:
>
> This problem is back for a sequel, and it would really help my work if 
> I could get it going.
>
>
> It's been a few months since I last asked about this.  Has anyone else 
> experienced this in a Linux environment?  Anyone have any ideas what 
> to do about it or how to debug it?
>
>
> /proc/version reports:
>
>  Linux version 2.6.18-274.18.1.el5 
> (mockbuild-t2f/um9L7dhDWr0U+X5jBOG/Ez6ZCGd0 at public.gmane.orgorg 
> <mailto:mockbuild at builder10.centos.org>) (gcc version 4.1.2 20080704 
> (Red Hat 4.1.2-51)) #1 SMP Thu Feb 9 12:45:44 EST 2012
>
>
> Randolph
>
>
> On 2011-07-08 01:13:01 +0000, Randolph M. Fritz said:
>
>
> On 2011-07-07 16:54:06 -0700, Greg Ward said:
>
>
> Hi Randolph,
>
>
> This shouldn't happen, unless one of the rpict processes died
>
> unexpectedly.  Even then, I would expect some other kind of error to be
>
> reported as well.
>
>
> -Greg
>
>
> Thanks, Greg.  I think that's what happenned; in fact seven of the
>
> eight died in two cases.  Wierdly, the third succeeded.  If I run it as
>
> a single-processor job, it works.  Here's a piece of the log:
>
>
> rpiece -F bl_blinds_rpsync.txt -PP pfLF5M90 -vtv -vp 60.0 -2.0 66.0 -vd
>
> 12.0 0.0 0.0 -vu 0 0 1 -vh 60 -x 1024 -y 1024 -dp 512 -ar 42 -ms 3.6
>
> -ds .3 -dt .1 -dc .5 -dr 1 -ss 1 -st .1 -af bl.amb -aa .1 -ad 1536 -as
>
> 392 -av 10 10 10 -lr 8 -lw 1e-4 -ps 6 -pt .08 -o bl_blinds.unf bl.oct
>
>
> rpict: warning - no output produced
>
>
> rpict: system - write error in io_process: Broken pipe
>
> rpict: 0 rays, 0.00% after 0.000u 0.000s 0.001r hours on n0065.lr1
>
> rad: error rendering view blinds
>
>
>
> _______________________________________________
>
> Radiance-general mailing list
>
> Radiance-general at radiance-online.org<mailto:Radiance-general at radiance-online.org>
>
> http://www.radiance-online.org/mailman/listinfo/radiance-general
>
> _______________________________________________
>
> Radiance-general mailing list
>
> Radiance-general at radiance-online.org
>
> http://www.radiance-online.org/mailman/listinfo/radiance-general
>
>
>
> --
>
> Randolph M. Fritz
>
>
>
> _______________________________________________
> Radiance-general mailing list
> Radiance-general at radiance-online.org
> http://www.radiance-online.org/mailman/listinfo/radiance-general
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20120411/ea195513/attachment-0001.html>

From amcneil at lbl.gov  Wed Apr 11 10:04:57 2012
From: amcneil at lbl.gov (Andy McNeil)
Date: Wed, 11 Apr 2012 10:04:57 -0700
Subject: [Radiance-general] "Broken pipe" message from rpiece on
	multi-core Linux system
In-Reply-To: <4F857F22.1010403@visarc.com>
References: <iv5g21$jnc$1@dough.gmane.org>
	<4188C437-AE0A-48A6-A4C2-22D1AB992CEA@lmi.net>
	<iv5lit$hkp$1@dough.gmane.org> <jlvdb5$ljf$1@dough.gmane.org>
	<4F834A8B.7020704@visarc.com>
	<B7A9CAA2-4DFB-48A2-B0A9-5D811124465C@lmi.net>
	<jm34ov$1n4$1@dough.gmane.org> <4F857F22.1010403@visarc.com>
Message-ID: <995E2963-96E2-48C4-BC7E-C89FD5EF32B7@lbl.gov>

Hi Randolph,

For what it's worth I don't use rpiece when I render on the cluster.  I have a script that takes divides takes a view file, tile number and number of rows an columns and will render the assigned tile number (run_render.csh).   In the job submit script I distribute these tile rendering tasks to multiple cores on multiple nodes.  I can't use the ambient cache with this method, but i typically use rtcontrib so I would be able to use it regardless.  There is also the problem that some processors sit idle after they've finished their tile while other processes are running, but I don't worry about it because computing time on lawrencium is cheap and available.

Snippets from my scripts are below.

Andy



### job_submitt.bsh #####

 #!/bin/bash
 #    specify the queue: lr_debug, lr_batch  
 #PBS -q lr_batch
 #PBS -A ac_rad71t
 #PBS -l nodes=16:ppn=8:lr1
 #PBS -l walltime=24:00:00
 #PBS -m be
 #PBS -M amcneil at lbl.gov
 #PBS -e run_v4a.err
 #PBS -o run_v4a.out

#   change to working directory & run the program
cd ~/models/wwr60

for i in {0..127}; do 
pbsdsh -n $i $PBS_O_WORKDIR/run_render.csh views/v4a.vf $(printf "%03d" $i) 8 16 &
done

wait




### run_render.csh ######
#! /bin/csh 

cd $PBS_O_WORKDIR
set path=($path ~/applications/Radiance/bin/ )

set oxres = 512
set oyres = 512

set view = $argv[1]
set thispiece = $argv[2]
set numcols = $argv[3]
set numrows = $argv[4]
set numpieces = `ev "$numcols * $numrows"`

set pxres = `vwrays -vf $view -x $oxres -y $oyres -d | awk '{print int($2/'$numcols'+.5)}'`
set pyres = `vwrays -vf $view -x $oxres -y $oyres -d | awk '{print int($4/'$numrows'+.5)}'`

set vtype = `awk '{for(i=1;i<NF;i++) if(match($i,"-vt")==1) split($i,vt,"")} END { print vt[4] }' $view`
set vshift = `ev "$thispiece - $numcols * floor( $thispiece / $numcols) - $numcols / 2 + .5"`
set vlift = `ev "floor( $thispiece / $numcols ) - $numrows / 2 + .5"`

if ($vtype == "v") then
set vhoriz = `awk 'BEGIN{PI=3.14159265} \
			{for(i=1;i<NF;i++) if($i=="-vh") vh=$(i+1)*PI/180 } \
			END{print atan2(sin(vh/2)/'$numcols',cos(vh/2))*180/PI*2}' $view`
set vvert = `awk 'BEGIN{PI=3.14159265} \
			{for(i=1;i<NF;i++) if($i=="-vv") vv=$(i+1)*PI/180 } \
			END{print atan2(sin(vv/2)/'$numrows',cos(vv/2))*180/PI*2}' $view`
endif

vwrays -ff -vf $view -vv $vvert -vh $vhoriz -vs $vshift -vl $vlift -x $pxres -y $pyres \
| rtcontrib -n 1 `vwrays -vf $view -vv $vvert -vh $vhoriz -vs $vshift -vl $vlift -x $pxres -y $pyres -d` \
	-ffc -fo \
	-o binpics/wwr60/${view:t:r}/${view:t:r}_wwr60_%s_%04d_${thispiece}.hdr \
	-f klems_horiz.cal -bn Nkbins \
	-b 'kbin(0,1,0,0,0,1)' -m GlDay -b 'kbin(0,1,0,0,0,1)' -m GlView \
	-w -ab 6 -ad 6000 -lw 1e-7 -ds .07 -dc 1 oct/vmx.oct







On Apr 11, 2012, at 5:54 AM, Jack de Valpine wrote:

> Hi Randolph,
> 
> All I have is Linux. Not sure what kernels at this point. But I have noticed this over multiple kernels and distributions. Although I have not run anything on the most recent kernels.
> 
> I know that one thing I did was to disable the fork and wait functionality in rpiece to wait for a job to finish. I do not recall though if this was related to this problem, nfs locking, or running on a cluster with job distribution queuing....? Sorry I do not remember more right now.
> 
> Just thinking out loud here, but if you are running on a cluster then could network latency also be an issue?
> 
> Here is my suspicion/theory, which I have not been able to test. I think that somehow there is a race condition in the way jobs get forked off and status of pieces gets recorded in the syncfile... 
> 
> For testing/debugging purposes, a few things to look at compare might be:
> big scene - slow load time 
> small scene - fast load time
> "fast" parameters - small image size with lots of divisions
> "slow" parameters - small image size with lots of divisions
> On my cluster, I ended up setting up things so that any initial small image run for building the ambient cache would actually just run as a single rpict process and then large images would get distributed across nodes/cores.
> 
> As an aside, perhaps Rob G. has some thoughts on Radiance/Clusters as I think they have a large one also. What is the cluster set up at LBNL? I believe that at one point they were using a provisioning system called Warewulf which has now evolved to Perceus. I have the former setup and have not gotten around to the latter. LBNL may also be using a job queuing system called Slurm which they developed (or maybe that was at LLNL)?
> 
> Hopefully this is not leading you off on the wrong track though. Probably would be useful to figure out if the problem is indeed rpiece related or something else entirely.
> 
> -Jack
> -- 
> # Jack de Valpine
> # president
> #
> # visarc incorporated
> # http://www.visarc.com
> #
> # channeling technology for superior design and construction
> 
> On 4/11/2012 1:27 AM, Randolph M. Fritz wrote:
>> 
>> Thanks Jack, Greg.
>> 
>> Jack, what kernel were you using?  Was it also Linux?
>> 
>> Greg, I was using rad, so those delays are already in there, alas.  I wonder if there is some subtle difference between the Mac OS Mach kernel and the Linux kernel that's causing the problem, or if it occurs on all platforms, just more frequently in the very fast cluster nodes.
>> 
>> Or, it could be an NFS locking problem, bah.
>> 
>> If I find time, maybe I can dig into it some more.  Right now, I may just finesse it by running multiple *different* simulations on the same cluster node.
>> 
>> Randolph
>> 
>> On 2012-04-09 21:52:47 +0000, Greg Ward said:
>> 
>> If it is a startup issue as Jack suggests, you might try inserting a few seconds of delay between the spawning of each new rpiece process using "sleep 5" or similar.  This allows time for the sync file to be updated without contention between processes.  This is what I do in rad with the -N option.  I actually wait 10 seconds between each new rpiece process.
>> 
>> This isn't to say that I understand the source of your error, which still puzzles me.
>> 
>> -Greg
>> From: Jack de Valpine <jedev at visarc.com>
>> Date: April 9, 2012 1:46:03 PM PDT
>> 
>> Hey Randolph,
>> 
>> I have run into this before. Unfortunately I have had limited success in tracking down the issue and also have not really looked at it for some time. If I recall correctly, a couple of things that I have noticed:
>> possible problem if a piece finishes before the first set of pieces are parcelled out out by rpiece - so if it 8 pieces are being distributed at startup and piece 2 (for example) finishes before one of pieces 1, 3, 4, 5, 6, 7, 8 has even been processed by rpiece or while rpiece is still forking off the initial jobs.
>> Sorry I cannot offer more, I have spent some time in the code on this one and it is not for the faint of heart to say the least. 
>> 
>> -Jack
>> 
>> -- 
>> # Jack de Valpine
>> # president
>> #
>> # visarc incorporated
>> # http://www.visarc.com
>> #
>> # channeling technology for superior design and construction
>> 
>> On 4/9/2012 3:29 PM, Randolph M. Fritz wrote:
>> This problem is back for a sequel, and it would really help my work if I could get it going. 
>> 
>> It's been a few months since I last asked about this.  Has anyone else experienced this in a Linux environment?  Anyone have any ideas what to do about it or how to debug it? 
>> 
>> /proc/version reports: 
>>  Linux version 2.6.18-274.18.1.el5 (mockbuild-t2f/um9L7dhDWr0U+X5jBOG/Ez6ZCGd0 at public.gmane.orgorg) (gcc version 4.1.2 20080704 (Red Hat 4.1.2-51)) #1 SMP Thu Feb 9 12:45:44 EST 2012 
>> 
>> Randolph 
>> 
>> On 2011-07-08 01:13:01 +0000, Randolph M. Fritz said: 
>> 
>> On 2011-07-07 16:54:06 -0700, Greg Ward said: 
>> 
>> Hi Randolph, 
>> 
>> This shouldn't happen, unless one of the rpict processes died 
>> unexpectedly.  Even then, I would expect some other kind of error to be 
>> reported as well. 
>> 
>> -Greg 
>> 
>> Thanks, Greg.  I think that's what happenned; in fact seven of the 
>> eight died in two cases.  Wierdly, the third succeeded.  If I run it as 
>> a single-processor job, it works.  Here's a piece of the log: 
>> 
>> rpiece -F bl_blinds_rpsync.txt -PP pfLF5M90 -vtv -vp 60.0 -2.0 66.0 -vd 
>> 12.0 0.0 0.0 -vu 0 0 1 -vh 60 -x 1024 -y 1024 -dp 512 -ar 42 -ms 3.6 
>> -ds .3 -dt .1 -dc .5 -dr 1 -ss 1 -st .1 -af bl.amb -aa .1 -ad 1536 -as 
>> 392 -av 10 10 10 -lr 8 -lw 1e-4 -ps 6 -pt .08 -o bl_blinds.unf bl.oct 
>> 
>> rpict: warning - no output produced 
>> 
>> rpict: system - write error in io_process: Broken pipe 
>> rpict: 0 rays, 0.00% after 0.000u 0.000s 0.001r hours on n0065.lr1 
>> rad: error rendering view blinds 
>> 
>> 
>> _______________________________________________
>> Radiance-general mailing list
>> Radiance-general at radiance-online.org
>> http://www.radiance-online.org/mailman/listinfo/radiance-general
>> _______________________________________________
>> Radiance-general mailing list
>> Radiance-general at radiance-online.org
>> http://www.radiance-online.org/mailman/listinfo/radiance-general
>> 
>> 
>> -- 
>> Randolph M. Fritz
>> 
>> 
>> _______________________________________________
>> Radiance-general mailing list
>> Radiance-general at radiance-online.org
>> http://www.radiance-online.org/mailman/listinfo/radiance-general
> _______________________________________________
> Radiance-general mailing list
> Radiance-general at radiance-online.org
> http://www.radiance-online.org/mailman/listinfo/radiance-general

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20120411/b4efa6aa/attachment-0001.html>

From Robert.Guglielmetti at nrel.gov  Wed Apr 11 10:39:14 2012
From: Robert.Guglielmetti at nrel.gov (Guglielmetti, Robert)
Date: Wed, 11 Apr 2012 11:39:14 -0600
Subject: [Radiance-general] "Broken pipe" message from rpiece on
 multi-core Linux system
In-Reply-To: <995E2963-96E2-48C4-BC7E-C89FD5EF32B7@lbl.gov>
Message-ID: <CBAB1D93.F5B8%robert.guglielmetti@nrel.gov>

Hey Andy,

Thanks as always for sharing this. I tried to do something similar a couple years ago, and Greg even pointed me to the bit of code in rpiece that does the tiling, but I could never get it to work for me. This is great.

- Rob


On 4/11/12 11:04 AM, "Andy McNeil" <amcneil at lbl.gov<mailto:amcneil at lbl.gov>> wrote:

Hi Randolph,

For what it's worth I don't use rpiece when I render on the cluster.  I have a script that takes divides takes a view file, tile number and number of rows an columns and will render the assigned tile number (run_render.csh).   In the job submit script I distribute these tile rendering tasks to multiple cores on multiple nodes.  I can't use the ambient cache with this method, but i typically use rtcontrib so I would be able to use it regardless.  There is also the problem that some processors sit idle after they've finished their tile while other processes are running, but I don't worry about it because computing time on lawrencium is cheap and available.

Snippets from my scripts are below.

Andy



### job_submitt.bsh #####

 #!/bin/bash
 #    specify the queue: lr_debug, lr_batch
 #PBS -q lr_batch
 #PBS -A ac_rad71t
 #PBS -l nodes=16:ppn=8:lr1
 #PBS -l walltime=24:00:00
 #PBS -m be
 #PBS -M amcneil at lbl.gov<mailto:amcneil at lbl.gov>
 #PBS -e run_v4a.err
 #PBS -o run_v4a.out

#   change to working directory & run the program
cd ~/models/wwr60

for i in {0..127}; do
pbsdsh -n $i $PBS_O_WORKDIR/run_render.csh views/v4a.vf $(printf "%03d" $i) 8 16 &
done

wait




### run_render.csh ######
#! /bin/csh

cd $PBS_O_WORKDIR
set path=($path ~/applications/Radiance/bin/ )

set oxres = 512
set oyres = 512

set view = $argv[1]
set thispiece = $argv[2]
set numcols = $argv[3]
set numrows = $argv[4]
set numpieces = `ev "$numcols * $numrows"`

set pxres = `vwrays -vf $view -x $oxres -y $oyres -d | awk '{print int($2/'$numcols'+.5)}'`
set pyres = `vwrays -vf $view -x $oxres -y $oyres -d | awk '{print int($4/'$numrows'+.5)}'`

set vtype = `awk '{for(i=1;i<NF;i++) if(match($i,"-vt")==1) split($i,vt,"")} END { print vt[4] }' $view`
set vshift = `ev "$thispiece - $numcols * floor( $thispiece / $numcols) - $numcols / 2 + .5"`
set vlift = `ev "floor( $thispiece / $numcols ) - $numrows / 2 + .5"`

if ($vtype == "v") then
set vhoriz = `awk 'BEGIN{PI=3.14159265} \
{for(i=1;i<NF;i++) if($i=="-vh") vh=$(i+1)*PI/180 } \
END{print atan2(sin(vh/2)/'$numcols',cos(vh/2))*180/PI*2}' $view`
set vvert = `awk 'BEGIN{PI=3.14159265} \
{for(i=1;i<NF;i++) if($i=="-vv") vv=$(i+1)*PI/180 } \
END{print atan2(sin(vv/2)/'$numrows',cos(vv/2))*180/PI*2}' $view`
endif

vwrays -ff -vf $view -vv $vvert -vh $vhoriz -vs $vshift -vl $vlift -x $pxres -y $pyres \
| rtcontrib -n 1 `vwrays -vf $view -vv $vvert -vh $vhoriz -vs $vshift -vl $vlift -x $pxres -y $pyres -d` \
-ffc -fo \
-o binpics/wwr60/${view:t:r}/${view:t:r}_wwr60_%s_%04d_${thispiece}.hdr \
-f klems_horiz.cal -bn Nkbins \
-b 'kbin(0,1,0,0,0,1)' -m GlDay -b 'kbin(0,1,0,0,0,1)' -m GlView \
-w -ab 6 -ad 6000 -lw 1e-7 -ds .07 -dc 1 oct/vmx.oct







On Apr 11, 2012, at 5:54 AM, Jack de Valpine wrote:

Hi Randolph,

All I have is Linux. Not sure what kernels at this point. But I have noticed this over multiple kernels and distributions. Although I have not run anything on the most recent kernels.

I know that one thing I did was to disable the fork and wait functionality in rpiece to wait for a job to finish. I do not recall though if this was related to this problem, nfs locking, or running on a cluster with job distribution queuing....? Sorry I do not remember more right now.

Just thinking out loud here, but if you are running on a cluster then could network latency also be an issue?

Here is my suspicion/theory, which I have not been able to test. I think that somehow there is a race condition in the way jobs get forked off and status of pieces gets recorded in the syncfile...

For testing/debugging purposes, a few things to look at compare might be:

 *   big scene - slow load time
 *   small scene - fast load time
 *   "fast" parameters - small image size with lots of divisions
 *   "slow" parameters - small image size with lots of divisions

On my cluster, I ended up setting up things so that any initial small image run for building the ambient cache would actually just run as a single rpict process and then large images would get distributed across nodes/cores.

As an aside, perhaps Rob G. has some thoughts on Radiance/Clusters as I think they have a large one also. What is the cluster set up at LBNL? I believe that at one point they were using a provisioning system called Warewulf which has now evolved to Perceus. I have the former setup and have not gotten around to the latter. LBNL may also be using a job queuing system called Slurm which they developed (or maybe that was at LLNL)?

Hopefully this is not leading you off on the wrong track though. Probably would be useful to figure out if the problem is indeed rpiece related or something else entirely.

-Jack

--
# Jack de Valpine
# president
#
# visarc incorporated
# http://www.visarc.com<http://www.visarc.com/>
#
# channeling technology for superior design and construction

On 4/11/2012 1:27 AM, Randolph M. Fritz wrote:

Thanks Jack, Greg.


Jack, what kernel were you using?  Was it also Linux?


Greg, I was using rad, so those delays are already in there, alas.  I wonder if there is some subtle difference between the Mac OS Mach kernel and the Linux kernel that's causing the problem, or if it occurs on all platforms, just more frequently in the very fast cluster nodes.


Or, it could be an NFS locking problem, bah.


If I find time, maybe I can dig into it some more.  Right now, I may just finesse it by running multiple *different* simulations on the same cluster node.


Randolph


On 2012-04-09 21:52:47 +0000, Greg Ward said:


If it is a startup issue as Jack suggests, you might try inserting a few seconds of delay between the spawning of each new rpiece process using "sleep 5" or similar.  This allows time for the sync file to be updated without contention between processes.  This is what I do in rad with the -N option.  I actually wait 10 seconds between each new rpiece process.


This isn't to say that I understand the source of your error, which still puzzles me.


-Greg

From: Jack de Valpine <jedev at visarc.com<mailto:jedev at visarc.com>>

Date: April 9, 2012 1:46:03 PM PDT


Hey Randolph,


I have run into this before. Unfortunately I have had limited success in tracking down the issue and also have not really looked at it for some time. If I recall correctly, a couple of things that I have noticed:

 *   possible problem if a piece finishes before the first set of pieces are parcelled out out by rpiece - so if it 8 pieces are being distributed at startup and piece 2 (for example) finishes before one of pieces 1, 3, 4, 5, 6, 7, 8 has even been processed by rpiece or while rpiece is still forking off the initial jobs.

Sorry I cannot offer more, I have spent some time in the code on this one and it is not for the faint of heart to say the least.

-Jack

--

# Jack de Valpine

# president

#

# visarc incorporated

# http://www.visarc.com<http://www.visarc.com/>

#

# channeling technology for superior design and construction


On 4/9/2012 3:29 PM, Randolph M. Fritz wrote:

This problem is back for a sequel, and it would really help my work if I could get it going.


It's been a few months since I last asked about this.  Has anyone else experienced this in a Linux environment?  Anyone have any ideas what to do about it or how to debug it?


/proc/version reports:

 Linux version 2.6.18-274.18.1.el5 (mockbuild-t2f/um9L7dhDWr0U+X5jBOG/Ez6ZCGd0 at public.gmane.orgorg<mailto:mockbuild at builder10.centos.org>) (gcc version 4.1.2 20080704 (Red Hat 4.1.2-51)) #1 SMP Thu Feb 9 12:45:44 EST 2012


Randolph


On 2011-07-08 01:13:01 +0000, Randolph M. Fritz said:


On 2011-07-07 16:54:06 -0700, Greg Ward said:


Hi Randolph,


This shouldn't happen, unless one of the rpict processes died

unexpectedly.  Even then, I would expect some other kind of error to be

reported as well.


-Greg


Thanks, Greg.  I think that's what happenned; in fact seven of the

eight died in two cases.  Wierdly, the third succeeded.  If I run it as

a single-processor job, it works.  Here's a piece of the log:


rpiece -F bl_blinds_rpsync.txt -PP pfLF5M90 -vtv -vp 60.0 -2.0 66.0 -vd

12.0 0.0 0.0 -vu 0 0 1 -vh 60 -x 1024 -y 1024 -dp 512 -ar 42 -ms 3.6

-ds .3 -dt .1 -dc .5 -dr 1 -ss 1 -st .1 -af bl.amb -aa .1 -ad 1536 -as

392 -av 10 10 10 -lr 8 -lw 1e-4 -ps 6 -pt .08 -o bl_blinds.unf bl.oct


rpict: warning - no output produced


rpict: system - write error in io_process: Broken pipe

rpict: 0 rays, 0.00% after 0.000u 0.000s 0.001r hours on n0065.lr1

rad: error rendering view blinds



_______________________________________________

Radiance-general mailing list

Radiance-general at radiance-online.org<mailto:Radiance-general at radiance-online.org>

http://www.radiance-online.org/mailman/listinfo/radiance-general

_______________________________________________

Radiance-general mailing list

Radiance-general at radiance-online.org<mailto:Radiance-general at radiance-online.org>

http://www.radiance-online.org/mailman/listinfo/radiance-general



--

Randolph M. Fritz



_______________________________________________
Radiance-general mailing list
Radiance-general at radiance-online.org<mailto:Radiance-general at radiance-online.org>http://www.radiance-online.org/mailman/listinfo/radiance-general

_______________________________________________
Radiance-general mailing list
Radiance-general at radiance-online.org<mailto:Radiance-general at radiance-online.org>
http://www.radiance-online.org/mailman/listinfo/radiance-general



From jedev at visarc.com  Wed Apr 11 10:22:52 2012
From: jedev at visarc.com (Jack de Valpine)
Date: Wed, 11 Apr 2012 13:22:52 -0400
Subject: [Radiance-general] "Broken pipe" message from rpiece on
 multi-core Linux system
In-Reply-To: <995E2963-96E2-48C4-BC7E-C89FD5EF32B7@lbl.gov>
References: <iv5g21$jnc$1@dough.gmane.org>
	<4188C437-AE0A-48A6-A4C2-22D1AB992CEA@lmi.net>
	<iv5lit$hkp$1@dough.gmane.org> <jlvdb5$ljf$1@dough.gmane.org>
	<4F834A8B.7020704@visarc.com>
	<B7A9CAA2-4DFB-48A2-B0A9-5D811124465C@lmi.net>
	<jm34ov$1n4$1@dough.gmane.org> <4F857F22.1010403@visarc.com>
	<995E2963-96E2-48C4-BC7E-C89FD5EF32B7@lbl.gov>
Message-ID: <4F85BDEC.2080609@visarc.com>

Hey Andy,

This jogs my memory a bit. Perhaps a different topic at this point not 
sure as this is more about clusters, radiance and rpiece. Another 
problem that I encountered with using rpiece on my cluster was sometimes 
the time tiles/pieces would get written into the image in the wrong 
place when using stock rpiece. My solution if I remember correctly was 
to customize rpiece so that each running instance of rpiece would write 
out its pieces each to their image file. These would all then get 
assembled as a post process. I think my idea behind this was to take 
advantage of the functionality that rpiece does offer.

-Jack

-- 
# Jack de Valpine
# president
#
# visarc incorporated
# http://www.visarc.com
#
# channeling technology for superior design and construction


On 4/11/2012 1:04 PM, Andy McNeil wrote:
> Hi Randolph,
>
> For what it's worth I don't use rpiece when I render on the cluster. 
>  I have a script that takes divides takes a view file, tile number and 
> number of rows an columns and will render the assigned tile number 
> (run_render.csh).   In the job submit script I distribute these tile 
> rendering tasks to multiple cores on multiple nodes.  I can't use the 
> ambient cache with this method, but i typically use rtcontrib so I 
> would be able to use it regardless.  There is also the problem that 
> some processors sit idle after they've finished their tile while other 
> processes are running, but I don't worry about it because computing 
> time on lawrencium is cheap and available.
>
> Snippets from my scripts are below.
>
> Andy
>
>
>
> ### job_submitt.bsh #####
>
>  #!/bin/bash
>  #    specify the queue: lr_debug, lr_batch
>  #PBS -q lr_batch
>  #PBS -A ac_rad71t
>  #PBS -l nodes=16:ppn=8:lr1
>  #PBS -l walltime=24:00:00
>  #PBS -m be
>  #PBS -M amcneil at lbl.gov <mailto:amcneil at lbl.gov>
>  #PBS -e run_v4a.err
>  #PBS -o run_v4a.out
>
> #   change to working directory & run the program
> cd ~/models/wwr60
>
> for i in {0..127}; do
> pbsdsh -n $i $PBS_O_WORKDIR/run_render.csh views/v4a.vf $(printf 
> "%03d" $i) 8 16 &
> done
>
> wait
>
>
>
>
> ### run_render.csh ######
> #! /bin/csh
>
> cd $PBS_O_WORKDIR
> set path=($path ~/applications/Radiance/bin/ )
>
> set oxres = 512
> set oyres = 512
>
> set view = $argv[1]
> set thispiece = $argv[2]
> set numcols = $argv[3]
> set numrows = $argv[4]
> set numpieces = `ev "$numcols * $numrows"`
>
> set pxres = `vwrays -vf $view -x $oxres -y $oyres -d | awk '{print 
> int($2/'$numcols'+.5)}'`
> set pyres = `vwrays -vf $view -x $oxres -y $oyres -d | awk '{print 
> int($4/'$numrows'+.5)}'`
>
> set vtype = `awk '{for(i=1;i<NF;i++) if(match($i,"-vt")==1) 
> split($i,vt,"")} END { print vt[4] }' $view`
> set vshift = `ev "$thispiece - $numcols * floor( $thispiece / 
> $numcols) - $numcols / 2 + .5"`
> set vlift = `ev "floor( $thispiece / $numcols ) - $numrows / 2 + .5"`
>
> if ($vtype == "v") then
> set vhoriz = `awk 'BEGIN{PI=3.14159265} \
> {for(i=1;i<NF;i++) if($i=="-vh") vh=$(i+1)*PI/180 } \
> END{print atan2(sin(vh/2)/'$numcols',cos(vh/2))*180/PI*2}' $view`
> set vvert = `awk 'BEGIN{PI=3.14159265} \
> {for(i=1;i<NF;i++) if($i=="-vv") vv=$(i+1)*PI/180 } \
> END{print atan2(sin(vv/2)/'$numrows',cos(vv/2))*180/PI*2}' $view`
> endif
>
> vwrays -ff -vf $view -vv $vvert -vh $vhoriz -vs $vshift -vl $vlift -x 
> $pxres -y $pyres \
> | rtcontrib -n 1 `vwrays -vf $view -vv $vvert -vh $vhoriz -vs $vshift 
> -vl $vlift -x $pxres -y $pyres -d` \
> -ffc -fo \
> -o binpics/wwr60/${view:t:r}/${view:t:r}_wwr60_%s_%04d_${thispiece}.hdr \
> -f klems_horiz.cal -bn Nkbins \
> -b 'kbin(0,1,0,0,0,1)' -m GlDay -b 'kbin(0,1,0,0,0,1)' -m GlView \
> -w -ab 6 -ad 6000 -lw 1e-7 -ds .07 -dc 1 oct/vmx.oct
>
>
>
>
>
>
>
> On Apr 11, 2012, at 5:54 AM, Jack de Valpine wrote:
>
>> Hi Randolph,
>>
>> All I have is Linux. Not sure what kernels at this point. But I have 
>> noticed this over multiple kernels and distributions. Although I have 
>> not run anything on the most recent kernels.
>>
>> I know that one thing I did was to disable the fork and wait 
>> functionality in rpiece to wait for a job to finish. I do not recall 
>> though if this was related to this problem, nfs locking, or running 
>> on a cluster with job distribution queuing....? Sorry I do not 
>> remember more right now.
>>
>> Just thinking out loud here, but if you are running on a cluster then 
>> could network latency also be an issue?
>>
>> Here is my suspicion/theory, which I have not been able to test. I 
>> think that somehow there is a race condition in the way jobs get 
>> forked off and status of pieces gets recorded in the syncfile...
>>
>> For testing/debugging purposes, a few things to look at compare might be:
>>
>>   * big scene - slow load time
>>   * small scene - fast load time
>>   * "fast" parameters - small image size with lots of divisions
>>   * "slow" parameters - small image size with lots of divisions
>>
>> On my cluster, I ended up setting up things so that any initial small 
>> image run for building the ambient cache would actually just run as a 
>> single rpict process and then large images would get distributed 
>> across nodes/cores.
>>
>> As an aside, perhaps Rob G. has some thoughts on Radiance/Clusters as 
>> I think they have a large one also. What is the cluster set up at 
>> LBNL? I believe that at one point they were using a provisioning 
>> system called Warewulf which has now evolved to Perceus. I have the 
>> former setup and have not gotten around to the latter. LBNL may also 
>> be using a job queuing system called Slurm which they developed (or 
>> maybe that was at LLNL)?
>>
>> Hopefully this is not leading you off on the wrong track though. 
>> Probably would be useful to figure out if the problem is indeed 
>> rpiece related or something else entirely.
>>
>> -Jack
>> -- 
>> # Jack de Valpine
>> # president
>> #
>> # visarc incorporated
>> #http://www.visarc.com
>> #
>> # channeling technology for superior design and construction
>>
>> On 4/11/2012 1:27 AM, Randolph M. Fritz wrote:
>>>
>>> Thanks Jack, Greg.
>>>
>>>
>>> Jack, what kernel were you using?Was it also Linux?
>>>
>>>
>>> Greg, I was using rad, so those delays are already in there, alas.I 
>>> wonder if there is some subtle difference between the Mac OS Mach 
>>> kernel and the Linux kernel that's causing the problem, or if it 
>>> occurs on all platforms, just more frequently in the very fast 
>>> cluster nodes.
>>>
>>>
>>> Or, it could be an NFS locking problem, bah.
>>>
>>>
>>> If I find time, maybe I can dig into it some more.Right now, I may 
>>> just finesse it by running multiple *different* simulations on the 
>>> same cluster node.
>>>
>>>
>>> Randolph
>>>
>>>
>>> On 2012-04-09 21:52:47 +0000, Greg Ward said:
>>>
>>>
>>> If it is a startup issue as Jack suggests, you might try inserting a 
>>> few seconds of delay between the spawning of each new rpiece process 
>>> using "sleep 5" or similar.  This allows time for the sync file to 
>>> be updated without contention between processes.  This is what I do 
>>> in rad with the -N option.  I actually wait 10 seconds between each 
>>> new rpiece process.
>>>
>>>
>>> This isn't to say that I understand the source of your error, which 
>>> still puzzles me.
>>>
>>>
>>> -Greg
>>>
>>> From: Jack de Valpine <jedev at visarc.com <mailto:jedev at visarc.com>>
>>>
>>> Date: April 9, 2012 1:46:03 PM PDT
>>>
>>>
>>> Hey Randolph,
>>>
>>>
>>> I have run into this before. Unfortunately I have had limited 
>>> success in tracking down the issue and also have not really looked 
>>> at it for some time. If I recall correctly, a couple of things that 
>>> I have noticed:
>>>
>>>   * possible problem if a piece finishes before the first set of
>>>     pieces are parcelled out out by rpiece - so if it 8 pieces are
>>>     being distributed at startup and piece 2 (for example) finishes
>>>     before one of pieces 1, 3, 4, 5, 6, 7, 8 has even been processed
>>>     by rpiece or while rpiece is still forking off the initial jobs.
>>>
>>> Sorry I cannot offer more, I have spent some time in the code on 
>>> this one and it is not for the faint of heart to say the least.
>>>
>>> -Jack
>>>
>>> --
>>>
>>> # Jack de Valpine
>>>
>>> # president
>>>
>>> #
>>>
>>> # visarc incorporated
>>>
>>> # http://www.visarc.com <http://www.visarc.com/>
>>>
>>> #
>>>
>>> # channeling technology for superior design and construction
>>>
>>>
>>> On 4/9/2012 3:29 PM, Randolph M. Fritz wrote:
>>>
>>> This problem is back for a sequel, and it would really help my work 
>>> if I could get it going.
>>>
>>>
>>> It's been a few months since I last asked about this.  Has anyone 
>>> else experienced this in a Linux environment?  Anyone have any ideas 
>>> what to do about it or how to debug it?
>>>
>>>
>>> /proc/version reports:
>>>
>>>  Linux version 2.6.18-274.18.1.el5 
>>> (mockbuild-t2f/um9L7dhDWr0U+X5jBOG/Ez6ZCGd0 at public.gmane.orgorg 
>>> <mailto:mockbuild at builder10.centos.org>) (gcc version 4.1.2 20080704 
>>> (Red Hat 4.1.2-51)) #1 SMP Thu Feb 9 12:45:44 EST 2012
>>>
>>>
>>> Randolph
>>>
>>>
>>> On 2011-07-08 01:13:01 +0000, Randolph M. Fritz said:
>>>
>>>
>>> On 2011-07-07 16:54:06 -0700, Greg Ward said:
>>>
>>>
>>> Hi Randolph,
>>>
>>>
>>> This shouldn't happen, unless one of the rpict processes died
>>>
>>> unexpectedly.  Even then, I would expect some other kind of error to be
>>>
>>> reported as well.
>>>
>>>
>>> -Greg
>>>
>>>
>>> Thanks, Greg.  I think that's what happenned; in fact seven of the
>>>
>>> eight died in two cases.  Wierdly, the third succeeded.  If I run it as
>>>
>>> a single-processor job, it works.  Here's a piece of the log:
>>>
>>>
>>> rpiece -F bl_blinds_rpsync.txt -PP pfLF5M90 -vtv -vp 60.0 -2.0 66.0 -vd
>>>
>>> 12.0 0.0 0.0 -vu 0 0 1 -vh 60 -x 1024 -y 1024 -dp 512 -ar 42 -ms 3.6
>>>
>>> -ds .3 -dt .1 -dc .5 -dr 1 -ss 1 -st .1 -af bl.amb -aa .1 -ad 1536 -as
>>>
>>> 392 -av 10 10 10 -lr 8 -lw 1e-4 -ps 6 -pt .08 -o bl_blinds.unf bl.oct
>>>
>>>
>>> rpict: warning - no output produced
>>>
>>>
>>> rpict: system - write error in io_process: Broken pipe
>>>
>>> rpict: 0 rays, 0.00% after 0.000u 0.000s 0.001r hours on n0065.lr1
>>>
>>> rad: error rendering view blinds
>>>
>>>
>>>
>>> _______________________________________________
>>>
>>> Radiance-general mailing list
>>>
>>> Radiance-general at radiance-online.org<mailto:Radiance-general at radiance-online.org>
>>>
>>> http://www.radiance-online.org/mailman/listinfo/radiance-general
>>>
>>> _______________________________________________
>>>
>>> Radiance-general mailing list
>>>
>>> Radiance-general at radiance-online.org
>>>
>>> http://www.radiance-online.org/mailman/listinfo/radiance-general
>>>
>>>
>>>
>>> --
>>>
>>> Randolph M. Fritz
>>>
>>>
>>>
>>> _______________________________________________
>>> Radiance-general mailing list
>>> Radiance-general at radiance-online.org
>>> http://www.radiance-online.org/mailman/listinfo/radiance-general
>> _______________________________________________
>> Radiance-general mailing list
>> Radiance-general at radiance-online.org 
>> <mailto:Radiance-general at radiance-online.org>
>> http://www.radiance-online.org/mailman/listinfo/radiance-general
>
>
>
> _______________________________________________
> Radiance-general mailing list
> Radiance-general at radiance-online.org
> http://www.radiance-online.org/mailman/listinfo/radiance-general
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20120411/51f92c91/attachment-0001.html>

From iabel at iebele.nl  Sun Apr 15 03:45:18 2012
From: iabel at iebele.nl (Iebele)
Date: Sun, 15 Apr 2012 13:45:18 +0300
Subject: [Radiance-general] Optimizing Radiance for cluster rendering
In-Reply-To: <81CEA7EA-0D5B-489B-BEAB-2652E4803395@iebele.nl>
References: <4F7B82E0.2070206@gmail.com>
	<81CEA7EA-0D5B-489B-BEAB-2652E4803395@iebele.nl>
Message-ID: <0602B923-AD59-4806-AD2D-48AFDA0843EB@iebele.nl>

Hi All, 

Nobody responded to the mail below yet. In the meanwhile I tried to build Radiance with Intels icc compiler. Binaries compiled with icc (many warnings) work for a simple scene, but fail when I render complex scenes (Segmentation fault). So I went back to gcc compiled binaries, but still I wonder if somebody can give me hints on what compiler to use, which flags, etc..

Support from the cluster engineers suggested I should make local copies of my files to the scratch discs of the nodes where I start Radiance processes. This, because otherwise networked i/o would slow down the process, and the cluster in general. Concerning the output of the rpict/ranimate process I understand what to do. But concerning the input files, I always thought that Radiance loads all input files (geometry, image patters etc) in memory only one time for each input file.  If the latter is true, I think it does not make much difference to load scene data from my home directory over the network, or first copy the input files (about 3 GB) to scratch disc and load them in rpict/ranimate thereafter.  The input files have to be copied over the network anyways. Or am I wrong here?  

Concerning the binaries, I have a question alike: would it be better to make a local install of the binaries for each node?   

Any hints are most appreciated

Iebele



oconv.c(322): (col. 5) remark: PARTIAL LOOP WAS VECTORIZED.



Op 7 apr. 2012, om 01:20 heeft Iebele het volgende geschreven:

> Hi group, 
> 
> I'm setting up Radiance on a computer cluster with lots of nodes. Tweeking gcc flags is not my best quality(understatement), so I bring it here. 
> Playing a bit with options which I found on Marc's benchmark page, I got rendering times per core over twice as long as on my 2.2 Ghz macbook. Doesn't make me happy :) 
> Below I've pasted the cpuinfo from a node on the cluster. Does anyone in the group has an idea what flags I should give to gcc to optimize Radiance? 
> The flags I've used so far - are:   -march=native -m64 -msse -msse2 -funroll-loops -ffast-math  -O3  -Dlinux -D_FILE_OFFSET_BITS=64
> 
> Cheers, 
> 
> iebele
> 
> 
> cat /proc/cpuinfo:
> 
> processor	: 7
> vendor_id	: GenuineIntel
> cpu family	: 6
> model		: 23
> model name	: Intel(R) Xeon(R) CPU           L5420  @ 2.50GHz
> stepping	: 10
> cpu MHz		: 2493.445
> cache size	: 6144 KB
> physical id	: 0
> siblings	: 4
> core id		: 2
> cpu cores	: 4
> apicid		: 2
> initial apicid	: 2
> fpu		: yes
> fpu_exception	: yes
> cpuid level	: 13
> wp		: yes
> flags		: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx lm constant_tsc arch_perfmon pebs bts rep_good aperfmperf pni dtes64 monitor ds_cpl vmx est tm2 ssse3 cx16 xtpr pdcm dca sse4_1 xsave lahf_lm tpr_shadow vnmi flexpriority
> bogomips	: 4987.90
> clflush size	: 64
> cache_alignment	: 64
> address sizes	: 38 bits physical, 48 bits virtual
> _______________________________________________
> Radiance-general mailing list
> Radiance-general at radiance-online.org
> http://www.radiance-online.org/mailman/listinfo/radiance-general



From grobe at gmx.net  Sun Apr 15 10:12:12 2012
From: grobe at gmx.net (Lars O. Grobe)
Date: Sun, 15 Apr 2012 19:12:12 +0200
Subject: [Radiance-general] Optimizing Radiance for cluster rendering
In-Reply-To: <0602B923-AD59-4806-AD2D-48AFDA0843EB@iebele.nl>
References: <4F7B82E0.2070206@gmail.com>
	<81CEA7EA-0D5B-489B-BEAB-2652E4803395@iebele.nl>
	<0602B923-AD59-4806-AD2D-48AFDA0843EB@iebele.nl>
Message-ID: <4F8B016C.7040102@gmx.net>

Hi,

I never compiled using icc, but on the cluster topic I have some comments.

First, I would make sure that you use frozen octrees. Compiling the same
scene from scratch on each node does not make sense.

As you say, copying the scene to the computing nodes before running the
processes does not make much difference, though that may depend on the
cluster archicecture you are building up on. I had an Openmosix cluster,
where I could start all processes on one node, which were then
automatically "migrated away" to other available nodes (no shared
memory, each process had a full set of scene data in that case). As
rpict/rtrace processes typically load the scene data once before
spawning sub-processes (by copying the process data), there is not
really more io involved then copying the data separately before starting
the processes. If you start processes over ssh, sharing data by nfs
mounts, it may help to have some delays so that not all nodes try to
fetch the data at the same moment.

My guess is that the one critical point in sharing data is access to
ambient cache and image data. You are probably aware of this.

Cheers, Lars.


From RFritz at lbl.gov  Mon Apr 16 08:32:43 2012
From: RFritz at lbl.gov (Randolph M. Fritz)
Date: Mon, 16 Apr 2012 08:32:43 -0700
Subject: [Radiance-general] "Broken pipe" message from rpiece on
	multi-core Linux system
References: <iv5g21$jnc$1@dough.gmane.org>
	<4188C437-AE0A-48A6-A4C2-22D1AB992CEA@lmi.net>
	<iv5lit$hkp$1@dough.gmane.org> <jlvdb5$ljf$1@dough.gmane.org>
	<4F834A8B.7020704@visarc.com>
	<B7A9CAA2-4DFB-48A2-B0A9-5D811124465C@lmi.net>
	<jm34ov$1n4$1@dough.gmane.org> <4F857F22.1010403@visarc.com>
	<995E2963-96E2-48C4-BC7E-C89FD5EF32B7@lbl.gov>
	<4F85BDEC.2080609@visarc.com>
Message-ID: <jmhe2q$7k1$1@dough.gmane.org>

I've gathered little more information Thursday and Friday.  

First off, I am so far only using single nodes on our cluster for 
renderings and instead taking advantage of multiple nodes to run more 
renderings.  Each node in the Lawrencium cluster has two six-core 
Xeons, and they are very capable.

I ran a rendering on a different model in the same cluster environment, 
which worked perfectly.  My experience so far leads me to the following 
conclusion: whatever the problem is, it is dependent on the model and 
the simulation parameters.  The model where it worked used mkillum; the 
two where it doesn't, don't.  This may--or may not--be significant.

I think adding mkillum surfaces to the models that failed would be an 
interesting experiment.  Maybe I can find some time to do it next week.

Randolph

On 2012-04-11 17:22:52 +0000, Jack de Valpine said:

> Hey Andy,
> 
> This jogs my memory a bit. Perhaps a different topic at this point not 
> sure as this is more about clusters, radiance and rpiece. Another 
> problem that I encountered with using rpiece on my cluster was 
> sometimes the time tiles/pieces would get written into the image in the 
> wrong place when using stock rpiece. My solution if I remember 
> correctly was to customize rpiece so that each running instance of 
> rpiece would write out its pieces each to their image file. These would 
> all then get assembled as a post process. I think my idea behind this 
> was to take advantage of the functionality that rpiece does offer.
> 
> -Jack
> -- 
> # Jack de Valpine
> # president
> #
> # visarc incorporated
> # http://www.visarc.com
> #
> # channeling technology for superior design and construction
> 
> On 4/11/2012 1:04 PM, Andy McNeil wrote:
> Hi Randolph,
> 
> For what it's worth I don't use rpiece when I render on the cluster. ?I 
> have a script that takes divides takes a view file, tile number and 
> number of rows an columns and will render the assigned tile number 
> (run_render.csh). ? In the job submit script I distribute these tile 
> rendering tasks to multiple cores on multiple nodes. ?I can't use the 
> ambient cache with this method, but i typically use rtcontrib so I 
> would be able to use it regardless. ?There is also the problem that 
> some processors sit idle after they've finished their tile while other 
> processes are running, but I don't worry about it because computing 
> time on lawrencium is cheap and available.
> 
> Snippets from my scripts are below.
> 
> Andy
> 
> 
> 
> ### job_submitt.bsh #####
> 
> ?#!/bin/bash
> ?# ? ?specify the queue: lr_debug, lr_batch ?
> ?#PBS -q lr_batch
> ?#PBS -A ac_rad71t
> ?#PBS -l nodes=16:ppn=8:lr1
> ?#PBS -l walltime=24:00:00
> ?#PBS -m be
> ?#PBS -M amcneil at lbl.gov
> ?#PBS -e run_v4a.err
> ?#PBS -o run_v4a.out
> 
> # ? change to working directory & run the program
> cd ~/models/wwr60
> 
> for i in {0..127}; do?
> pbsdsh -n $i $PBS_O_WORKDIR/run_render.csh views/v4a.vf $(printf "%03d" 
> $i) 8 16 &
> done
> 
> wait
> 
> 
> 
> 
> ### run_render.csh ######
> #! /bin/csh?
> 
> cd $PBS_O_WORKDIR
> set path=($path ~/applications/Radiance/bin/ )
> 
> set oxres = 512
> set oyres = 512
> 
> set view = $argv[1]
> set thispiece = $argv[2]
> set numcols = $argv[3]
> set numrows = $argv[4]
> set numpieces = `ev "$numcols * $numrows"`
> 
> set pxres = `vwrays -vf $view -x $oxres -y $oyres -d | awk '{print 
> int($2/'$numcols'+.5)}'`
> set pyres = `vwrays -vf $view -x $oxres -y $oyres -d | awk '{print 
> int($4/'$numrows'+.5)}'`
> 
> set vtype = `awk '{for(i=1;i<NF;i++) if(match($i,"-vt")==1) 
> split($i,vt,"")} END { print vt[4] }' $view`
> set vshift = `ev "$thispiece - $numcols * floor( $thispiece / $numcols) 
> - $numcols / 2 + .5"`
> set vlift = `ev "floor( $thispiece / $numcols ) - $numrows / 2 + .5"`
> 
> if ($vtype == "v") then
> set vhoriz = `awk 'BEGIN{PI=3.14159265} \
>  {for(i=1;i<NF;i++) if($i=="-vh") vh=$(i+1)*PI/180 } \
>  END{print atan2(sin(vh/2)/'$numcols',cos(vh/2))*180/PI*2}' $view`
> set vvert = `awk 'BEGIN{PI=3.14159265} \
>  {for(i=1;i<NF;i++) if($i=="-vv") vv=$(i+1)*PI/180 } \
>  END{print atan2(sin(vv/2)/'$numrows',cos(vv/2))*180/PI*2}' $view`
> endif
> 
> vwrays -ff -vf $view -vv $vvert -vh $vhoriz -vs $vshift -vl $vlift -x 
> $pxres -y $pyres \
> | rtcontrib -n 1 `vwrays -vf $view -vv $vvert -vh $vhoriz -vs $vshift 
> -vl $vlift -x $pxres -y $pyres -d` \
>             -ffc -fo \
>             -o 
> binpics/wwr60/${view:t:r}/${view:t:r}_wwr60_%s_%04d_${thispiece}.hdr \
>             -f klems_horiz.cal -bn Nkbins \
>             -b 'kbin(0,1,0,0,0,1)' -m GlDay -b 'kbin(0,1,0,0,0,1)' -m GlView \
>             -w -ab 6 -ad 6000 -lw 1e-7 -ds .07 -dc 1 oct/vmx.oct
> 
> 
> 
> 
> 
> 
> 
> On Apr 11, 2012, at 5:54 AM, Jack de Valpine wrote:
> Hi Randolph,
> 
> All I have is Linux. Not sure what kernels at this point. But I have 
> noticed this over multiple kernels and distributions. Although I have 
> not run anything on the most recent kernels.
> 
> I know that one thing I did was to disable the fork and wait 
> functionality in rpiece to wait for a job to finish. I do not recall 
> though if this was related to this problem, nfs locking, or running on 
> a cluster with job distribution queuing....? Sorry I do not remember 
> more right now.
> 
> Just thinking out loud here, but if you are running on a cluster then 
> could network latency also be an issue?
> 
> Here is my suspicion/theory, which I have not been able to test. I 
> think that somehow there is a race condition in the way jobs get forked 
> off and status of pieces gets recorded in the syncfile... 
> 
> For testing/debugging purposes, a few things to look at compare might be:
>>>> 	?	big scene - slow load time 
>>>> 	?	small scene - fast load time
>>>> 	?	"fast" parameters - small image size with lots of divisions
>>>> 	?	"slow" parameters - small image size with lots of divisions
> On my cluster, I ended up setting up things so that any initial small 
> image run for building the ambient cache would actually just run as a 
> single rpict process and then large images would get distributed across 
> nodes/cores.
> 
> As an aside, perhaps Rob G. has some thoughts on Radiance/Clusters as I 
> think they have a large one also. What is the cluster set up at LBNL? I 
> believe that at one point they were using a provisioning system called 
> Warewulf which has now evolved to Perceus. I have the former setup and 
> have not gotten around to the latter. LBNL may also be using a job 
> queuing system called Slurm which they developed (or maybe that was at 
> LLNL)?
> 
> Hopefully this is not leading you off on the wrong track though. 
> Probably would be useful to figure out if the problem is indeed rpiece 
> related or something else entirely.
> 
> -Jack
> -- 
> # Jack de Valpine
> # president
> #
> # visarc incorporated
> # http://www.visarc.com
> #
> # channeling technology for superior design and construction
> 
> On 4/11/2012 1:27 AM, Randolph M. Fritz wrote:
> Thanks Jack, Greg.
> 
> Jack, what kernel were you using?  Was it also Linux?
> 
> Greg, I was using rad, so those delays are already in there, alas.  I 
> wonder if there is some subtle difference between the Mac OS Mach 
> kernel and the Linux kernel that's causing the problem, or if it occurs 
> on all platforms, just more frequently in the very fast cluster nodes.
> 
> Or, it could be an NFS locking problem, bah.
> 
> If I find time, maybe I can dig into it some more.  Right now, I may 
> just finesse it by running multiple *different* simulations on the same 
> cluster node.
> 
> Randolph
> 
> On 2012-04-09 21:52:47 +0000, Greg Ward said:
> 
>> If it is a startup issue as Jack suggests, you might try inserting a 
>> few seconds of delay between the spawning of each new rpiece process 
>> using "sleep 5" or similar. ?This allows time for the sync file to be 
>> updated without contention between processes. ?This is what I do in rad 
>> with the -N option. ?I actually wait 10 seconds between each new rpiece 
>> process.
>> 
>> This isn't to say that I understand the source of your error, which 
>> still puzzles me.
>> 
>> -Greg
>>>>> From: Jack de Valpine <jedev at visarc.com>
>>>> Date: April 9, 2012 1:46:03 PM PDT
>>> 
>> Hey Randolph,
>> 
>> I have run into this before. Unfortunately I have had limited success 
>> in tracking down the issue and also have not really looked at it for 
>> some time. If I recall correctly, a couple of things that I have 
>> noticed:
>>>> 	?	possible problem if a piece finishes before the first set of pieces 
>>>> are parcelled out out by rpiece - so if it 8 pieces are being 
>>>> distributed at startup and piece 2 (for example) finishes before one of 
>>>> pieces 1, 3, 4, 5, 6, 7, 8 has even been processed by rpiece or while 
>>>> rpiece is still forking off the initial jobs.
>> Sorry I cannot offer more, I have spent some time in the code on this 
>> one and it is not for the faint of heart to say the least. 
>> -Jack
>> -- 
>> # Jack de Valpine
>> # president
>> #
>> # visarc incorporated
>> # http://www.visarc.com
>> #
>> # channeling technology for superior design and construction
>> 
>> On 4/9/2012 3:29 PM, Randolph M. Fritz wrote:
>> This problem is back for a sequel, and it would really help my work if 
>> I could get it going. 
>> 
>> It's been a few months since I last asked about this.? Has anyone else 
>> experienced this in a Linux environment?? Anyone have any ideas what to 
>> do about it or how to debug it? 
>> 
>> /proc/version reports: 
>> ?Linux version 2.6.18-274.18.1.el5 
>> (mockbuild-t2f/um9L7dhDWr0U+X5jBOG/Ez6ZCGd0 at public.gmane.orgorg) 
>> (gcc version 4.1.2 20080704 (Red Hat 4.1.2-51)) #1 SMP Thu Feb 9 
>> 12:45:44 EST 2012 
>> 
>> Randolph 
>> 
>> On 2011-07-08 01:13:01 +0000, Randolph M. Fritz said: 
>> 
>> On 2011-07-07 16:54:06 -0700, Greg Ward said: 
>> 
>> Hi Randolph, 
>> 
>> This shouldn't happen, unless one of the rpict processes died 
>> unexpectedly.? Even then, I would expect some other kind of error to be 
>> reported as well. 
>> 
>> -Greg 
>> 
>> Thanks, Greg.? I think that's what happenned; in fact seven of the 
>> eight died in two cases.? Wierdly, the third succeeded.? If I run it as 
>> a single-processor job, it works.? Here's a piece of the log: 
>> 
>> rpiece -F bl_blinds_rpsync.txt -PP pfLF5M90 -vtv -vp 60.0 -2.0 66.0 -vd 
>> 12.0 0.0 0.0 -vu 0 0 1 -vh 60 -x 1024 -y 1024 -dp 512 -ar 42 -ms 3.6 
>> -ds .3 -dt .1 -dc .5 -dr 1 -ss 1 -st .1 -af bl.amb -aa .1 -ad 1536 -as 
>> 392 -av 10 10 10 -lr 8 -lw 1e-4 -ps 6 -pt .08 -o bl_blinds.unf bl.oct 
>> 
>> rpict: warning - no output produced 
>> 
>> rpict: system - write error in io_process: Broken pipe 
>> rpict: 0 rays, 0.00% after 0.000u 0.000s 0.001r hours on n0065.lr1 
>> rad: error rendering view blinds 
>> 
>> 
>> _______________________________________________
>> Radiance-general mailing list
>> Radiance-general at radiance-online.org
>> http://www.radiance-online.org/mailman/listinfo/radiance-general
>> _______________________________________________
>> Radiance-general mailing list
>> Radiance-general at radiance-online.org
>> http://www.radiance-online.org/mailman/listinfo/radiance-general
> 
> 
> -- 
> Randolph M. Fritz
> 
> 
> 
> _______________________________________________
> Radiance-general mailing list
> Radiance-general at radiance-online.org
> http://www.radiance-online.org/mailman/listinfo/radiance-general
> _______________________________________________
> Radiance-general mailing list
> Radiance-general at radiance-online.org
> http://www.radiance-online.org/mailman/listinfo/radiance-general
> 
> 
> 
> 
> _______________________________________________
> Radiance-general mailing list
> Radiance-general at radiance-online.org
> http://www.radiance-online.org/mailman/listinfo/radiance-general
> _______________________________________________
> Radiance-general mailing list
> Radiance-general at radiance-online.org
> http://www.radiance-online.org/mailman/listinfo/radiance-general


-- 
Randolph M. Fritz
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20120416/2aff1e13/attachment-0001.html>

From RFritz at lbl.gov  Mon Apr 16 08:37:56 2012
From: RFritz at lbl.gov (Randolph M. Fritz)
Date: Mon, 16 Apr 2012 08:37:56 -0700
Subject: [Radiance-general] Optimizing Radiance for cluster rendering
References: <4F7B82E0.2070206@gmail.com>
	<81CEA7EA-0D5B-489B-BEAB-2652E4803395@iebele.nl>
	<0602B923-AD59-4806-AD2D-48AFDA0843EB@iebele.nl>
Message-ID: <jmhecj$a15$1@dough.gmane.org>

On 2012-04-15 10:45:18 +0000, Iebele said:

> Hi All,
> 
> Nobody responded to the mail below yet. In the meanwhile I tried to 
> build Radiance with Intels icc compiler. Binaries compiled with icc 
> (many warnings) work for a simple scene, but fail when I render complex 
> scenes (Segmentation fault). So I went back to gcc compiled binaries, 
> but still I wonder if somebody can give me hints on what compiler to 
> use, which flags, etc..

There's some compiler interaction with the code which no-one has yet 
dug into that makes icc compilation of Radiance fail for some 
compilation settings.  For the moment, stick with gcc.

> Concerning the binaries, I have a question alike: would it be better to 
> make a local install of the binaries for each node?

Depends on the cluster.  I suspect not much, though; the program 
binaries are going to be cached in RAM in the nodes.

-- 
Randolph M. Fritz




From jedev at visarc.com  Mon Apr 16 08:54:53 2012
From: jedev at visarc.com (Jack de Valpine)
Date: Mon, 16 Apr 2012 11:54:53 -0400
Subject: [Radiance-general] Optimizing Radiance for cluster rendering
In-Reply-To: <jmhecj$a15$1@dough.gmane.org>
References: <4F7B82E0.2070206@gmail.com>
	<81CEA7EA-0D5B-489B-BEAB-2652E4803395@iebele.nl>
	<0602B923-AD59-4806-AD2D-48AFDA0843EB@iebele.nl>
	<jmhecj$a15$1@dough.gmane.org>
Message-ID: <4F8C40CD.4090507@visarc.com>

Hi,

I think that binaries should be centrally located. It is not that big a 
problem to load over a network for this.

Likewise I think that scene files (octrees, etc) should be centrally 
located. It is just easier to manage.

I think a main problem is each process/node/core writing back image 
data. This can really slow things down on the nfs server if image pieces 
are being written back into one image. I think that it is better to have 
each process write out its output to its own file, which can be on the 
nfs server, and then assemble the pieces as a post process. Ambient 
cache data can still be shared and written to by multiple processes 
although I would recommend using one process to pre-populate the cache 
initially. And if as Andy mentions you are using something like 
rtcontrib then the shared ambient cache is a non-issue.

As far as compiler optimizations. While this could be nice, I think the 
real benefit is spreading things out over the cluster... that is 
hopefully where you get more opportunity to speed things up as opposed 
to some incremental increase due to compiler optimization.

-Jack

-- 
# Jack de Valpine
# president
#
# visarc incorporated
# http://www.visarc.com
#
# channeling technology for superior design and construction


On 4/16/2012 11:37 AM, Randolph M. Fritz wrote:
> On 2012-04-15 10:45:18 +0000, Iebele said:
>
>> Hi All,
>>
>> Nobody responded to the mail below yet. In the meanwhile I tried to 
>> build Radiance with Intels icc compiler. Binaries compiled with icc 
>> (many warnings) work for a simple scene, but fail when I render 
>> complex scenes (Segmentation fault). So I went back to gcc compiled 
>> binaries, but still I wonder if somebody can give me hints on what 
>> compiler to use, which flags, etc..
>
> There's some compiler interaction with the code which no-one has yet 
> dug into that makes icc compilation of Radiance fail for some 
> compilation settings.  For the moment, stick with gcc.
>
>> Concerning the binaries, I have a question alike: would it be better 
>> to make a local install of the binaries for each node?
>
> Depends on the cluster.  I suspect not much, though; the program 
> binaries are going to be cached in RAM in the nodes.
>


From mstock at umich.edu  Mon Apr 16 08:58:17 2012
From: mstock at umich.edu (Mark Stock)
Date: Mon, 16 Apr 2012 11:58:17 -0400 (EDT)
Subject: [Radiance-general] Optimizing Radiance
In-Reply-To: <81CEA7EA-0D5B-489B-BEAB-2652E4803395@iebele.nl>
References: <4F7B82E0.2070206@gmail.com>
	<81CEA7EA-0D5B-489B-BEAB-2652E4803395@iebele.nl>
Message-ID: <Pine.LNX.4.64.1204161154370.19825@rygar.gpcc.itd.umich.edu>

Iebele,

You've picked what are probably the best compile options for 
performance. You may or may not see a difference by adding 
"-fomit-frame-pointer". You may also see a difference by using 
the gcc 4.6 compilers instead of any earlier versions. 4.6 seems 
to impart a 5% advantage over even gcc 4.4.

But like Jack mentioned, these compiler options can, at best, 
give you incremental performance improvements. Whenever I have 
real work to do, I always use rpiece and a script similar to the 
"runsmp" that is in the bench4.tar.gz.

If you have the results from some of your tests, I'd like to put 
them on the Radiance benchmark page.

Mark

On Sat, 7 Apr 2012, Iebele wrote:

> Hi group,
>
> I'm setting up Radiance on a computer cluster with lots of 
> nodes. Tweeking gcc flags is not my best 
> quality(understatement), so I bring it here. Playing a bit with 
> options which I found on Marc's benchmark page, I got rendering 
> times per core over twice as long as on my 2.2 Ghz macbook. 
> Doesn't make me happy :) Below I've pasted the cpuinfo from a 
> node on the cluster. Does anyone in the group has an idea what 
> flags I should give to gcc to optimize Radiance? The flags I've 
> used so far - are:  -march=native -m64 -msse -msse2 
> -funroll-loops -ffast-math -O3 -Dlinux -D_FILE_OFFSET_BITS=64
>
> Cheers,
>
> iebele
>
>
> cat /proc/cpuinfo:
>
> processor	: 7
> vendor_id	: GenuineIntel
> cpu family	: 6
> model		: 23
> model name	: Intel(R) Xeon(R) CPU           L5420  @ 2.50GHz
> stepping	: 10
> cpu MHz		: 2493.445
> cache size	: 6144 KB
> physical id	: 0
> siblings	: 4
> core id		: 2
> cpu cores	: 4
> apicid		: 2
> initial apicid	: 2
> fpu		: yes
> fpu_exception	: yes
> cpuid level	: 13
> wp		: yes
> flags		: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx lm constant_tsc arch_perfmon pebs bts rep_good aperfmperf pni dtes64 monitor ds_cpl vmx est tm2 ssse3 cx16 xtpr pdcm dca sse4_1 xsave lahf_lm tpr_shadow vnmi flexpriority
> bogomips	: 4987.90
> clflush size	: 64
> cache_alignment	: 64
> address sizes	: 38 bits physical, 48 bits virtual
> _______________________________________________
> Radiance-general mailing list
> Radiance-general at radiance-online.org
> http://www.radiance-online.org/mailman/listinfo/radiance-general
>
>
>


From gbetti at fosterandpartners.com  Tue Apr 17 12:30:36 2012
From: gbetti at fosterandpartners.com (Giovanni Betti)
Date: Tue, 17 Apr 2012 20:30:36 +0100
Subject: [Radiance-general] Composing multiple radiance images
In-Reply-To: <Pine.LNX.4.64.1204161154370.19825@rygar.gpcc.itd.umich.edu>
References: <4F7B82E0.2070206@gmail.com><81CEA7EA-0D5B-489B-BEAB-2652E4803395@iebele.nl>
	<Pine.LNX.4.64.1204161154370.19825@rygar.gpcc.itd.umich.edu>
Message-ID: <6F5225D6E15F954BB4E58EC25F6736C308AA93A3@corp3005.CORPORATE.FOSTER.NETWORK>

Hi All,

I have what I think might be a simple question.

I am trying to recompose a series of images rendered using the -vs and
-vl options of rpict (horizontal and vertical view shift). 

I thought that pcompos would have done the job just right but
unfortunately it seems it changes the exposure in each image, having the
final result to look rather patchy. 

Has anyone got round this (maybe some pcomb command? but (quote) 'Pcomb
combines equal-sized RADIANCE pictures and sends the result to the
standard output')

thanks in advance for your help,

best regards,


Giovanni


From jedev at visarc.com  Tue Apr 17 12:54:49 2012
From: jedev at visarc.com (Jack de Valpine)
Date: Tue, 17 Apr 2012 15:54:49 -0400
Subject: [Radiance-general] Composing multiple radiance images
In-Reply-To: <6F5225D6E15F954BB4E58EC25F6736C308AA93A3@corp3005.CORPORATE.FOSTER.NETWORK>
References: <4F7B82E0.2070206@gmail.com><81CEA7EA-0D5B-489B-BEAB-2652E4803395@iebele.nl>
	<Pine.LNX.4.64.1204161154370.19825@rygar.gpcc.itd.umich.edu>
	<6F5225D6E15F954BB4E58EC25F6736C308AA93A3@corp3005.CORPORATE.FOSTER.NETWORK>
Message-ID: <4F8DCA89.2060104@visarc.com>

Hi Giovanni,

Are the images being filtered in any way before pcompos? If so this is 
where your variation is coming from....

-Jack

-- 
# Jack de Valpine
# president
#
# visarc incorporated
# http://www.visarc.com
#
# channeling technology for superior design and construction


On 4/17/2012 3:30 PM, Giovanni Betti wrote:
> Hi All,
>
> I have what I think might be a simple question.
>
> I am trying to recompose a series of images rendered using the -vs and
> -vl options of rpict (horizontal and vertical view shift).
>
> I thought that pcompos would have done the job just right but
> unfortunately it seems it changes the exposure in each image, having the
> final result to look rather patchy.
>
> Has anyone got round this (maybe some pcomb command? but (quote) 'Pcomb
> combines equal-sized RADIANCE pictures and sends the result to the
> standard output')
>
> thanks in advance for your help,
>
> best regards,
>
>
> Giovanni
>
> _______________________________________________
> Radiance-general mailing list
> Radiance-general at radiance-online.org
> http://www.radiance-online.org/mailman/listinfo/radiance-general


From gbetti at fosterandpartners.com  Wed Apr 18 02:07:13 2012
From: gbetti at fosterandpartners.com (Giovanni Betti)
Date: Wed, 18 Apr 2012 10:07:13 +0100
Subject: [Radiance-general] Composing multiple radiance images
In-Reply-To: <4F8DCA89.2060104@visarc.com>
References: <4F7B82E0.2070206@gmail.com><81CEA7EA-0D5B-489B-BEAB-2652E4803395@iebele.nl><Pine.LNX.4.64.1204161154370.19825@rygar.gpcc.itd.umich.edu><6F5225D6E15F954BB4E58EC25F6736C308AA93A3@corp3005.CORPORATE.FOSTER.NETWORK>
	<4F8DCA89.2060104@visarc.com>
Message-ID: <6F5225D6E15F954BB4E58EC25F6736C308AA93F1@corp3005.CORPORATE.FOSTER.NETWORK>

Hi Jack, thanks for the quick reply, 

I am not performing any filtering but maybe there is something happening
behind the scenes...
I simply set up a job generating 9 images using rad and then a simple
pcompos line to tile them together

	pcompos -a 3 test00*.pic > composite.pic

is this offering more insights?

Thanks,

G

----Original Message-----
From: Jack de Valpine [mailto:jedev at visarc.com] 
Sent: 17 April 2012 20:55
To: Radiance general discussion
Subject: Re: [Radiance-general] Composing multiple radiance images

Hi Giovanni,

Are the images being filtered in any way before pcompos? If so this is 
where your variation is coming from....

-Jack

-- 
# Jack de Valpine
# president
#
# visarc incorporated
# http://www.visarc.com
#
# channeling technology for superior design and construction


On 4/17/2012 3:30 PM, Giovanni Betti wrote:
> Hi All,
>
> I have what I think might be a simple question.
>
> I am trying to recompose a series of images rendered using the -vs and
> -vl options of rpict (horizontal and vertical view shift).
>
> I thought that pcompos would have done the job just right but
> unfortunately it seems it changes the exposure in each image, having
the
> final result to look rather patchy.
>
> Has anyone got round this (maybe some pcomb command? but (quote)
'Pcomb
> combines equal-sized RADIANCE pictures and sends the result to the
> standard output')
>
> thanks in advance for your help,
>
> best regards,
>
>
> Giovanni
>
> _______________________________________________
> Radiance-general mailing list
> Radiance-general at radiance-online.org
> http://www.radiance-online.org/mailman/listinfo/radiance-general

_______________________________________________
Radiance-general mailing list
Radiance-general at radiance-online.org
http://www.radiance-online.org/mailman/listinfo/radiance-general


From gbetti at fosterandpartners.com  Wed Apr 18 02:17:10 2012
From: gbetti at fosterandpartners.com (Giovanni Betti)
Date: Wed, 18 Apr 2012 10:17:10 +0100
Subject: [Radiance-general] Composing multiple radiance images
In-Reply-To: <6F5225D6E15F954BB4E58EC25F6736C308AA93F1@corp3005.CORPORATE.FOSTER.NETWORK>
References: <4F7B82E0.2070206@gmail.com><81CEA7EA-0D5B-489B-BEAB-2652E4803395@iebele.nl><Pine.LNX.4.64.1204161154370.19825@rygar.gpcc.itd.umich.edu><6F5225D6E15F954BB4E58EC25F6736C308AA93A3@corp3005.CORPORATE.FOSTER.NETWORK><4F8DCA89.2060104@visarc.com>
	<6F5225D6E15F954BB4E58EC25F6736C308AA93F1@corp3005.CORPORATE.FOSTER.NETWORK>
Message-ID: <6F5225D6E15F954BB4E58EC25F6736C308AA93F8@corp3005.CORPORATE.FOSTER.NETWORK>


The other thing that happens is that the images lose their original
luminance values and seem to be remapped between 1 and 179cd/m2... this
means that there is definitely some filtering going on. Is this the
correct pcompos behaviour or there is something I am doing wrong?

Best,

Giovanni


-----Original Message-----
From: Giovanni Betti [mailto:gbetti at fosterandpartners.com] 
Sent: 18 April 2012 10:07
To: Radiance general discussion
Subject: Re: [Radiance-general] Composing multiple radiance images

Hi Jack, thanks for the quick reply, 

I am not performing any filtering but maybe there is something happening
behind the scenes...
I simply set up a job generating 9 images using rad and then a simple
pcompos line to tile them together

	pcompos -a 3 test00*.pic > composite.pic

is this offering more insights?

Thanks,

G

----Original Message-----
From: Jack de Valpine [mailto:jedev at visarc.com] 
Sent: 17 April 2012 20:55
To: Radiance general discussion
Subject: Re: [Radiance-general] Composing multiple radiance images

Hi Giovanni,

Are the images being filtered in any way before pcompos? If so this is 
where your variation is coming from....

-Jack

-- 
# Jack de Valpine
# president
#
# visarc incorporated
# http://www.visarc.com
#
# channeling technology for superior design and construction


On 4/17/2012 3:30 PM, Giovanni Betti wrote:
> Hi All,
>
> I have what I think might be a simple question.
>
> I am trying to recompose a series of images rendered using the -vs and
> -vl options of rpict (horizontal and vertical view shift).
>
> I thought that pcompos would have done the job just right but
> unfortunately it seems it changes the exposure in each image, having
the
> final result to look rather patchy.
>
> Has anyone got round this (maybe some pcomb command? but (quote)
'Pcomb
> combines equal-sized RADIANCE pictures and sends the result to the
> standard output')
>
> thanks in advance for your help,
>
> best regards,
>
>
> Giovanni
>
> _______________________________________________
> Radiance-general mailing list
> Radiance-general at radiance-online.org
> http://www.radiance-online.org/mailman/listinfo/radiance-general

_______________________________________________
Radiance-general mailing list
Radiance-general at radiance-online.org
http://www.radiance-online.org/mailman/listinfo/radiance-general

_______________________________________________
Radiance-general mailing list
Radiance-general at radiance-online.org
http://www.radiance-online.org/mailman/listinfo/radiance-general


From grobe at gmx.net  Wed Apr 18 03:19:13 2012
From: grobe at gmx.net (Lars O. Grobe)
Date: Wed, 18 Apr 2012 12:19:13 +0200
Subject: [Radiance-general] Composing multiple radiance images
In-Reply-To: <6F5225D6E15F954BB4E58EC25F6736C308AA93F1@corp3005.CORPORATE.FOSTER.NETWORK>
References: <4F7B82E0.2070206@gmail.com><81CEA7EA-0D5B-489B-BEAB-2652E4803395@iebele.nl><Pine.LNX.4.64.1204161154370.19825@rygar.gpcc.itd.umich.edu><6F5225D6E15F954BB4E58EC25F6736C308AA93A3@corp3005.CORPORATE.FOSTER.NETWORK>
	<4F8DCA89.2060104@visarc.com>
	<6F5225D6E15F954BB4E58EC25F6736C308AA93F1@corp3005.CORPORATE.FOSTER.NETWORK>
Message-ID: <4F8E9521.4090707@gmx.net>

Hi Giovanni!
> I am not performing any filtering but maybe there is something happening
> behind the scenes...
> I simply set up a job generating 9 images using rad and then a simple
> pcompos line to tile them together
>
> 	pcompos -a 3 test00*.pic>  composite.pic
>
> is this offering more insights?
rad will typically call pfilt

1) to filter down resolution (at any quality setting not equal to LOW) 
to achieve antialiasing as well as
2) to apply a useful exposure (at any quality setting).

If you want to assemble the filtered images, you should set a common 
exposure value to all of them. See the manpage of rad, where the 
EXPOSURE variable is explained as well as how to find a suitable value.

You can also simply keep the unfiltered images as generated by rpict. 
You could then assemble the raw images and filter the complete, 
assembled mosaic. Tell rad to keep the unfiltered images by specifying a 
name pattern using the RAWFILE variable. Again, the details are 
explained in the manpage of rad.

If you want to read numerical values from filtered images, usually the 
-o option are of help. This gives you access to the original pixel 
values by reversing the exposure mapping performed by e.g. pfilt. See 
e.g. the manpage of pvalue.

Cheers, Lars.


From joao.portugal.santos at gmail.com  Wed Apr 18 03:16:07 2012
From: joao.portugal.santos at gmail.com (=?ISO-8859-1?Q?Jo=E3o_Santos?=)
Date: Wed, 18 Apr 2012 11:16:07 +0100
Subject: [Radiance-general] Radiance ESP-r coupling
Message-ID: <CAHdUKVVs84yWBfkEsh104Y0+ni1j5frkKqhntwiUHQOYiAb7UQ@mail.gmail.com>

Hi everyone

I?ve been trying to use the ESP_r / Radiance coupling but encountered some
errors.
I?m working on Windows7 64 bits, and with the lastest esp-r
development_branch.

After installing the mingw-radiance_setup-3R9 from
http://www.bozzograo.net/radiance  (which sets the environment variables
automatically, I confirmed)
I opened the esp-r file from the /cfg folder.
But while simulating its presents the following:

Simulation has now commenced.
Removing existing transfer file.
Lighting simulation has now commenced.
Fatal error: Radiance simulation produced no data.

So it seems that esp-r isn?t linked with radiance.
Does the location matters? Because I?ve tried C:/Program Files/ ,
C:/Esru/bin and also C:/Radiance
Is the above radiance package complete?
What is the best way to install Radiance in a Windows machine?

Thanks in advance
Joao
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20120418/0db285ea/attachment.html>

From Santiago.Torres at arup.com  Wed Apr 18 06:11:24 2012
From: Santiago.Torres at arup.com (Santiago Torres)
Date: Wed, 18 Apr 2012 13:11:24 +0000
Subject: [Radiance-general] pcomb-masking color channels
In-Reply-To: <7F18F8EB-6171-437F-B48F-1FAC3FB4BC5F@iebele.nl>
References: <jkfq67$rjv$1@dough.gmane.org>
	<427773F0-7BBD-4D33-85D2-9884B7264A98@lmi.net>
	<BAE8E899-19AB-4B1A-AFD1-E59176B0D353@coolshadow.com>
	<25CF3DB3-AD8D-42DA-BF7D-AE605519C092@lmi.net>
	<7F18F8EB-6171-437F-B48F-1FAC3FB4BC5F@iebele.nl>
Message-ID: <F680DBC15ACC484FA2089674923B4C8905F6B846@EURXMBS05.global.arup.com>

Hi Chris,

I have used pcomb to blend different sky images that were capturing different luminance ranges. The result was never very good as the flare around the sun was always a problem.

Iebele's answer below is a great example, but please note this is merging two images (one with the sun and one with the sky) into one full sky. If you need the reverse, the command will be very similar, only that instead of using the input from the second image, you can just use a zero value.

So you can replace ri(2), bi(2), gi(2), etc. with 0, which will give you an image with only values that are above the threshold, and zero for the rest (or below the threshold, if you invert "difr=sens-ri(1)"... etc.)

pcomb -e 'sens=1.5;difr=ri(1)-sens;difg=gi(1)-sens; difb=bi(1)-sens; ro=if(difr,ri(1),0); go=if(difg,gi(1),0); bo=if(difb,bi(1),0); '  full_sky.hdr   |   ximage

I can imagine the cloud edge can be difficult to separate. One solution might be to use the difference between blue and red channels to try and separate the blue sky from the rest (like using a red filter, as Axel suggested, this will probably also include the circumsolar region, which can be separated in a second step). It might look something like this:

pcomb -e 'sens=0.5; dif=bi(1)-ri(1)-sens; ro=if(dif,ri(1),0); go=if(dif,gi(1),0); bo=if(dif,bi(1),0); '  full_sky.hdr   |   ximage

I've never tried something like this, so most probably there are some errors, also I have no idea what might be an appropriate threshold, but I hope this helps.
Cheers,
Santiago


From: Iebele Abel [mailto:iabel at iebele.nl]
Sent: 30 March 2012 11:51
To: Radiance general discussion
Subject: Re: [Radiance-general] pcomb-masking color channels

Hi Chris,

I had something similar a few weeks ago, and figured out this:

pcomb -e 'sens=1.5;difr=(ri(1)-sens)-ri(2);difg=(gi(1)-sens)-gi(2); difb=(bi(1)-sens)-bi(2); ro=if(difr,ri(1),ri(2)); go=if(difg,gi(1),gi(2)); bo=if(difb,bi(1),bi(2)); '  sun.hdr blue_sky.hdr   |   ximage

You can tweak the "sens" variable to get the result you want. In my case (which was not a sky picture) the value was around 0.9 to get the result I was after. The value you need to mask the sun out of the sun.hdr image must probably be higher. If the value is too low, the result will be just a copy of blue_sky.hdr.

The command first finds the difference between pixel values for red, green and blue in sun.hdr and blue_sky.hdr. The difference (tweaked by 'sens' ) determines from which input file the pixel component value is written to the output.

If you are only interested in changing the luminance values of blue_sky.hdr at those spots where the sun (or clouds) are bright in sun.hdr you may try something like this:

pcomb -e 'sens=1.5;difl=(li(1)-sens)-li(2);ro=if(difl, li(1)*ri(2),li(2)*ri(2) ); go=if(difl, li(1)*gi(2),li(2)*gi(2) ); bo=if(difl, li(1)*bi(2),li(2)*bi(2) );  ' sun.hdr blue_sky.hdr | image

Using these commands, the sun (and clouds) will appear with sharp boundary edges (not blurred) in the resulting composite image.

Hope this helps a bit,

Iebele



Op 30 mrt. 2012, om 07:45 heeft Greg Ward het volgende geschreven:


Hi Chris,

Seems no one answered this, but I believe there are experts out there who have played with sky blending techniques.  I won't name any names, you know who you are....

I'm heading out on a little vacation tomorrow with a million things to do first, otherwise I'd take a crack at it.  Maybe you could explain a little more clearly the effect you are going for?

Best,
-Greg


From: Humann Chris <chris at coolshadow.com<mailto:chris at coolshadow.com>>
Date: March 27, 2012 3:19:15 PM PDT

Dear group,

I'd like to be able to generate two separate images from an HDR image of the sky vault: one with blue sky; the other with clouds and sun (assuming it's not occluded).  I'm not well versed in the usage of 'pcomb' but I'm assuming I'll need to somehow create a mask based on both color and brightness thresholds.  It seems from my archive search that a call to 'pgblur' with a high radius might help in defining sharper boundaries between clouds and blue sky. (http://www.radiance-online.org/pipermail/radiance-general/2008-May/005046.html)

Has anyone been successful in achieving something similar?

As always, thanks!

Chris

_______________________________________________
Radiance-general mailing list
Radiance-general at radiance-online.org<mailto:Radiance-general at radiance-online.org>
http://www.radiance-online.org/mailman/listinfo/radiance-general

____________________________________________________________
Electronic mail messages entering and leaving Arup  business
systems are scanned for acceptability of content and viruses
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20120418/08d03cea/attachment-0001.html>

From jedev at visarc.com  Wed Apr 18 06:12:02 2012
From: jedev at visarc.com (Jack de Valpine)
Date: Wed, 18 Apr 2012 09:12:02 -0400
Subject: [Radiance-general] Composing multiple radiance images
In-Reply-To: <4F8E9521.4090707@gmx.net>
References: <4F7B82E0.2070206@gmail.com><81CEA7EA-0D5B-489B-BEAB-2652E4803395@iebele.nl><Pine.LNX.4.64.1204161154370.19825@rygar.gpcc.itd.umich.edu><6F5225D6E15F954BB4E58EC25F6736C308AA93A3@corp3005.CORPORATE.FOSTER.NETWORK>
	<4F8DCA89.2060104@visarc.com>
	<6F5225D6E15F954BB4E58EC25F6736C308AA93F1@corp3005.CORPORATE.FOSTER.NETWORK>
	<4F8E9521.4090707@gmx.net>
Message-ID: <4F8EBDA2.7060404@visarc.com>

Hi Giovanni,

As Lars has pointed out, rad typically ends an image with a call to 
pfilt, which WILL adjust the exposure either implicitly per image 
(likely the source of your variations) or explicitly by
specifying what pfilt should do in your rif file.

-Jack


-- 
# Jack de Valpine
# president
#
# visarc incorporated
# http://www.visarc.com
#
# channeling technology for superior design and construction


On 4/18/2012 6:19 AM, Lars O. Grobe wrote:
> Hi Giovanni!
>> I am not performing any filtering but maybe there is something happening
>> behind the scenes...
>> I simply set up a job generating 9 images using rad and then a simple
>> pcompos line to tile them together
>>
>>     pcompos -a 3 test00*.pic>  composite.pic
>>
>> is this offering more insights?
> rad will typically call pfilt
>
> 1) to filter down resolution (at any quality setting not equal to LOW) 
> to achieve antialiasing as well as
> 2) to apply a useful exposure (at any quality setting).
>
> If you want to assemble the filtered images, you should set a common 
> exposure value to all of them. See the manpage of rad, where the 
> EXPOSURE variable is explained as well as how to find a suitable value.
>
> You can also simply keep the unfiltered images as generated by rpict. 
> You could then assemble the raw images and filter the complete, 
> assembled mosaic. Tell rad to keep the unfiltered images by specifying 
> a name pattern using the RAWFILE variable. Again, the details are 
> explained in the manpage of rad.
>
> If you want to read numerical values from filtered images, usually the 
> -o option are of help. This gives you access to the original pixel 
> values by reversing the exposure mapping performed by e.g. pfilt. See 
> e.g. the manpage of pvalue.
>
> Cheers, Lars.
>
> _______________________________________________
> Radiance-general mailing list
> Radiance-general at radiance-online.org
> http://www.radiance-online.org/mailman/listinfo/radiance-general


From gbetti at fosterandpartners.com  Wed Apr 18 07:43:30 2012
From: gbetti at fosterandpartners.com (Giovanni Betti)
Date: Wed, 18 Apr 2012 15:43:30 +0100
Subject: [Radiance-general] Composing multiple radiance images
In-Reply-To: <4F8EBDA2.7060404@visarc.com>
References: <4F7B82E0.2070206@gmail.com><81CEA7EA-0D5B-489B-BEAB-2652E4803395@iebele.nl><Pine.LNX.4.64.1204161154370.19825@rygar.gpcc.itd.umich.edu><6F5225D6E15F954BB4E58EC25F6736C308AA93A3@corp3005.CORPORATE.FOSTER.NETWORK><4F8DCA89.2060104@visarc.com><6F5225D6E15F954BB4E58EC25F6736C308AA93F1@corp3005.CORPORATE.FOSTER.NETWORK><4F8E9521.4090707@gmx.net>
	<4F8EBDA2.7060404@visarc.com>
Message-ID: <6F5225D6E15F954BB4E58EC25F6736C308AA9467@corp3005.CORPORATE.FOSTER.NETWORK>

Thanks a lot both Lars and Jack,

I thought it was something rather simple I was missing!

Using the unfiltered raw images just did the trick;

Thanks,

G


-----Original Message-----
From: Jack de Valpine [mailto:jedev at visarc.com] 
Sent: 18 April 2012 14:12
To: Radiance general discussion
Subject: Re: [Radiance-general] Composing multiple radiance images

Hi Giovanni,

As Lars has pointed out, rad typically ends an image with a call to 
pfilt, which WILL adjust the exposure either implicitly per image 
(likely the source of your variations) or explicitly by
specifying what pfilt should do in your rif file.

-Jack


-- 
# Jack de Valpine
# president
#
# visarc incorporated
# http://www.visarc.com
#
# channeling technology for superior design and construction


On 4/18/2012 6:19 AM, Lars O. Grobe wrote:
> Hi Giovanni!
>> I am not performing any filtering but maybe there is something
happening
>> behind the scenes...
>> I simply set up a job generating 9 images using rad and then a simple
>> pcompos line to tile them together
>>
>>     pcompos -a 3 test00*.pic>  composite.pic
>>
>> is this offering more insights?
> rad will typically call pfilt
>
> 1) to filter down resolution (at any quality setting not equal to LOW)

> to achieve antialiasing as well as
> 2) to apply a useful exposure (at any quality setting).
>
> If you want to assemble the filtered images, you should set a common 
> exposure value to all of them. See the manpage of rad, where the 
> EXPOSURE variable is explained as well as how to find a suitable
value.
>
> You can also simply keep the unfiltered images as generated by rpict. 
> You could then assemble the raw images and filter the complete, 
> assembled mosaic. Tell rad to keep the unfiltered images by specifying

> a name pattern using the RAWFILE variable. Again, the details are 
> explained in the manpage of rad.
>
> If you want to read numerical values from filtered images, usually the

> -o option are of help. This gives you access to the original pixel 
> values by reversing the exposure mapping performed by e.g. pfilt. See 
> e.g. the manpage of pvalue.
>
> Cheers, Lars.
>
> _______________________________________________
> Radiance-general mailing list
> Radiance-general at radiance-online.org
> http://www.radiance-online.org/mailman/listinfo/radiance-general

_______________________________________________
Radiance-general mailing list
Radiance-general at radiance-online.org
http://www.radiance-online.org/mailman/listinfo/radiance-general


From iabel at iebele.nl  Wed Apr 18 08:23:10 2012
From: iabel at iebele.nl (Iebele)
Date: Wed, 18 Apr 2012 18:23:10 +0300
Subject: [Radiance-general] Optimizing Radiance
In-Reply-To: <Pine.LNX.4.64.1204161154370.19825@rygar.gpcc.itd.umich.edu>
References: <4F7B82E0.2070206@gmail.com>
	<81CEA7EA-0D5B-489B-BEAB-2652E4803395@iebele.nl>
	<Pine.LNX.4.64.1204161154370.19825@rygar.gpcc.itd.umich.edu>
Message-ID: <03527BD9-B142-48E6-A96A-7EBF1F0019C9@iebele.nl>

Hi Jack, Lars and Marc,

Thanks a lot for your input, it has been very much supportive. 

Marc, I'll run the benchmark one of these weeks and send the results to you,

Iebele



Op 16 apr. 2012, om 18:58 heeft Mark Stock het volgende geschreven:

> Iebele,
> 
> You've picked what are probably the best compile options for performance. You may or may not see a difference by adding "-fomit-frame-pointer". You may also see a difference by using the gcc 4.6 compilers instead of any earlier versions. 4.6 seems to impart a 5% advantage over even gcc 4.4.
> 
> But like Jack mentioned, these compiler options can, at best, give you incremental performance improvements. Whenever I have real work to do, I always use rpiece and a script similar to the "runsmp" that is in the bench4.tar.gz.
> 
> If you have the results from some of your tests, I'd like to put them on the Radiance benchmark page.
> 
> Mark
> 
> On Sat, 7 Apr 2012, Iebele wrote:
> 
>> Hi group,
>> 
>> I'm setting up Radiance on a computer cluster with lots of nodes. Tweeking gcc flags is not my best quality(understatement), so I bring it here. Playing a bit with options which I found on Marc's benchmark page, I got rendering times per core over twice as long as on my 2.2 Ghz macbook. Doesn't make me happy :) Below I've pasted the cpuinfo from a node on the cluster. Does anyone in the group has an idea what flags I should give to gcc to optimize Radiance? The flags I've used so far - are:  -march=native -m64 -msse -msse2 -funroll-loops -ffast-math -O3 -Dlinux -D_FILE_OFFSET_BITS=64
>> 
>> Cheers,
>> 
>> iebele
>> 
>> 
>> cat /proc/cpuinfo:
>> 
>> processor	: 7
>> vendor_id	: GenuineIntel
>> cpu family	: 6
>> model		: 23
>> model name	: Intel(R) Xeon(R) CPU           L5420  @ 2.50GHz
>> stepping	: 10
>> cpu MHz		: 2493.445
>> cache size	: 6144 KB
>> physical id	: 0
>> siblings	: 4
>> core id		: 2
>> cpu cores	: 4
>> apicid		: 2
>> initial apicid	: 2
>> fpu		: yes
>> fpu_exception	: yes
>> cpuid level	: 13
>> wp		: yes
>> flags		: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx lm constant_tsc arch_perfmon pebs bts rep_good aperfmperf pni dtes64 monitor ds_cpl vmx est tm2 ssse3 cx16 xtpr pdcm dca sse4_1 xsave lahf_lm tpr_shadow vnmi flexpriority
>> bogomips	: 4987.90
>> clflush size	: 64
>> cache_alignment	: 64
>> address sizes	: 38 bits physical, 48 bits virtual
>> _______________________________________________
>> Radiance-general mailing list
>> Radiance-general at radiance-online.org
>> http://www.radiance-online.org/mailman/listinfo/radiance-general
>> 
>> 
>> 
> 
> _______________________________________________
> Radiance-general mailing list
> Radiance-general at radiance-online.org
> http://www.radiance-online.org/mailman/listinfo/radiance-general



From amcneil at lbl.gov  Thu Apr 19 10:30:42 2012
From: amcneil at lbl.gov (Andy McNeil)
Date: Thu, 19 Apr 2012 10:30:42 -0700
Subject: [Radiance-general] Building Simulation & Optimization Conference
Message-ID: <D70EA3B9-F6DF-4632-9FD8-2EC21A2630B0@lbl.gov>

Hi Everyone,

It's the time of year when those of us on the opposite continent start to think about convincing our bosses to send us to the Radiance Workshop.  I just stumbled upon the Building Simulation & Optimization Conference in Loughborough, UK which fits nicely in the same week as the Radiance Workshop.  I thought I'd share in case anyone wanted to round out the week or needed more justification for a long distance trip: http://www.bso12.org/

Andy




From minki.sung at gmail.com  Thu Apr 19 19:44:37 2012
From: minki.sung at gmail.com (Minki Sung)
Date: Fri, 20 Apr 2012 11:44:37 +0900
Subject: [Radiance-general] Spherical sensor
Message-ID: <CANi9k9Rs9h-pXm0gaQ14sHsHWsnGYT9fPi89vVBPML4SO9gZhw@mail.gmail.com>

Hi Greg,

I am sorry for my too late response to your kind comment. I read your
script and it is so helpful. I am using Radiance to calculate ultraviolet
intensity. So I don't need to convert radiance to illuminance, but need to
revise the script for multiply points sampling.
Thank you as always.

Best,
Minki


-----------------------------------------------------------

Hi Minki,

If this quantity is equal to the integral of luminance over the full
sphere, then it would be the same as 4*PI times the average luminance in
all directions.  You can compute the latter quantity by averaging the
output of an appropriate rtrace calculation of random rays over the sphere.
 Something like the following should work:

set N=10000
set orig=(0 0 0)
cnt $N | rcalc -of -e 'Dz=1-2*($1+rand(.77-.61*recno))/'$N -e
'phi=2*PI*($1+rand(-.10+.39*recno))'/$N \
               -e 'rxy=sqrt(1-Dz*Dz);Dx=rxy*cos(phi);Dy=rxy*sin(phi)' \
               -e "Ox:$orig[1];Oy:$orig[2];Oz:$orig[3]" \
               -e '$1=Ox;$2=Oy;$3=Oz;$4=Dx;$5=Dy;$6=Dz' \
       | rtrace -h -ff [options] scene.oct \
       | total -if3 -m \
       | rcalc -e '$1=179*4*PI*($1*.265+$2*.670+$3*.065)'

This should take ray samples in a stratified random spiral over the sphere.
 The 3 averaged radiance values (RGB) output should be multiplied by 179
and 4*PI as above, unless I misunderstand the definition of spherical
illuminance.

Best,
-Greg

> From: Minki Sung <minki.sung at gmail.com>
> Date: December 14, 2011 7:02:14 PM PST
>
> Hi all,
>
> I am calculating spherical illuminance(lux) or irradiance (W/m2), that is
the irradiance of a small spherical sensor in a room. I think it might be
possible if the cosine-correction process for light meter is modifiable. Do
you have any idea?
>
> Best,
> Minki


-- 
Minki Sung, Ph.D.

Building Technology Team
Korea Institute of Construction Technology
TEL.+82-31-9100-586
FAX.+82-31-9100-361
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20120420/f439c746/attachment.html>

From grobe at gmx.net  Fri Apr 20 01:56:27 2012
From: grobe at gmx.net (Lars O. Grobe)
Date: Fri, 20 Apr 2012 10:56:27 +0200
Subject: [Radiance-general] Spherical sensor
In-Reply-To: <CANi9k9Rs9h-pXm0gaQ14sHsHWsnGYT9fPi89vVBPML4SO9gZhw@mail.gmail.com>
References: <CANi9k9Rs9h-pXm0gaQ14sHsHWsnGYT9fPi89vVBPML4SO9gZhw@mail.gmail.com>
Message-ID: <4F9124BB.2060402@gmx.net>

Hi Minki!
> I am sorry for my too late response to your kind comment. I read your 
> script and it is so helpful. I am using Radiance to calculate 
> ultraviolet intensity. So I don't need to convert radiance to 
> illuminance, but need to revise the script for multiply points sampling.
> Thank you as always.
The script can do that, you just need to remove the multiplication with 
Radiance's assumed luminous efficacy (179) and the color weighting 
(R*.265+G*.670+B*.065) in the last line. So let the script end as

(...)
| total -if3 -m

And remove the backslash and the last line. I am assuming that you have 
set equal values in all channels (R=G=B in all source, material 
definitions).

Unfortunately, especially for small light sources of high intensity, you 
must set a rather high sampling density N not to miss out important 
sources. The script sends out rays to random directions, other then 
Radiance's integrated direct calculation which keeps a list of sources 
with known locations to check.

Cheers, Lars.


From tito_ at mit.edu  Fri Apr 20 11:29:14 2012
From: tito_ at mit.edu (Christoph Reinhart)
Date: Fri, 20 Apr 2012 18:29:14 +0000
Subject: [Radiance-general] DIVA 2.0
Message-ID: <1B23446CBF250648A2FC775DE3FE7E8009E92F@OC11expo28.exchange.mit.edu>

Dear colleagues,

It is our pleasure to announce the release of DIVA-for-Rhino 2.0, a daylighting and energy modeling plug-in for Rhinoceros based on Radiance/Daysim and EnergyPlus.  We began working on the tool about 2 years ago while we were at Harvard's Graduate School of Design. Following our departure/graduation from Harvard we formed a company called Solemma with exclusive rights from Harvard to distribute and further develop DIVA.  DIVA 2.0 is the commercial version of DIVA and includes key new features such as: annual glare maps, dynamic shading and electric lighting modules, a thermal load calculation module based on EnergyPlus version 7.0.0 and graphical simulation reports, as well as LEED and CHPS simulations. We have further updated our DIVA-for-Grasshopper components, which can now launch parametric daylighting simulations without having to be 'primed' by the toolbar. Details of the new features follow below. We hope that some of you will enjoy using DIVA, and that you will join us in exchanging ideas, projects and thoughts on our new website: www.diva4rhino.com<http://www.diva4rhino.com>.

Happy Simulations,

Christoph Reinhart, Alstan Jakubiec, Jeff Niemasz, Jonnie Sargent and Kera Lagios


Annual glare maps
This feature uses the gen_dgp_profile program written by Jan Wienold that comes with Daysim. It generates an annual glare map that predicts for all view points in a scene the hours in the year when glare is disturbing or intolerable. The results are displayed as an html report with embedded images. Please note, if annual dgp profiles have been calculated, they are used in the climate based metric calculations if a dynamic shading system has been specified. more>><http://diva4rhino.com/user-guide/simulation-types/annual-glare>

Dynamic Shading Module
The module allows users to specify up to two independently controlled dynamic shading systems. A shading system may be mechanical (venetian blinds) or switchable (electrochromics). Various manual or automated control options are available. When a dynamic shading system has been specified, it is considered during an annual climate based metric calculation and the status of the shading system over the year is displayed in an html report with embedded images. more>><http://diva4rhino.com/user-guide/rhino/advanced-shading>

Electric Lighting Module
The module allows uses to specify up to ten electric lighting zones in a scene. Any lighting zone may be manually or automatically controlled. The electric lighting calculation is fully integrated with the shading calculation and resulting hourly load profiles for electric lighting can be linked to EnergyPlus or other thermal simulation programs. more>><http://diva4rhino.com/user-guide/rhino/lighting-controls>

Thermal Load Calculation
The thermal load calculation allow users to set up a single thermal zone in Rhino and specify some basic thermal construction properties and usage patterns. The occupancy, lighting and shading schedules are taken from the daylighting module. Simulation results  are displayed in an html report with embedded images. more>><http://diva4rhino.com/user-guide/simulation-types/thermal-analysis>

Grasshopper Improvements
The daylighting analysis component has been overhauled to give users parametric control over project location and simulation type and settings.  This means you don't need to 'prime' the components with a toolbar run every time you want to initiate or change your analysis. The thermal components have also been updated with several bug fixes since the last release.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20120420/1fbbe7d2/attachment.html>

From minki.sung at gmail.com  Sat Apr 21 11:48:41 2012
From: minki.sung at gmail.com (Minki Sung)
Date: Sun, 22 Apr 2012 03:48:41 +0900
Subject: [Radiance-general] Spherical sensor
Message-ID: <CANi9k9SVoTFEtv7QfyHCDohMXzeg5TMgqddGeuM8kDwuJA6MWg@mail.gmail.com>

Hi Lars~

I modified the script as follows, because i use just one channel out of RGB
channels.

set N=10000
cnt 10 10 10 $N | rcalc -of -e 'Dz=1-2*($4+rand(.77-.61*recno))/'$N \
              -e 'phi=2*PI*($4+rand(-.10+.39*recno))'/$N \
              -e 'rxy=sqrt(1-Dz*Dz);Dx=rxy*cos(phi);Dy=rxy*sin(phi)' \
              -e 'Ox=$1*.02+0.02;Oy=$2*0.02+0.02;Oz=$3*0.02+0.02' \
              -e '$1=Ox;$2=Oy;$3=Oz;$4=Dx;$5=Dy;$6=Dz' \
      | rtrace -h -ff -oov -ar 256 -as 256 -ad 512 -ab 3 scene.oct \
      | total -if4 -10000 -m \
      | rcalc -e '$1=$1;$2=$2;$3=$3;$4=4*PI*$4' > fluence.dat

I checked appropriate number of rays to trace for some positions and
changes below 1% in results were observed between 10000 and more rays, but
less than 10000 was not desirable. I need to check for all the positions
concerned.

Many thank you~

Best,
Minki

-----------------------------------------------------------------------------------------------------------

Hi Minki!
> I am sorry for my too late response to your kind comment. I read your
> script and it is so helpful. I am using Radiance to calculate
> ultraviolet intensity. So I don't need to convert radiance to
> illuminance, but need to revise the script for multiply points sampling.
> Thank you as always.
The script can do that, you just need to remove the multiplication with
Radiance's assumed luminous efficacy (179) and the color weighting
(R*.265+G*.670+B*.065) in the last line. So let the script end as

(...)
| total -if3 -m

And remove the backslash and the last line. I am assuming that you have
set equal values in all channels (R=G=B in all source, material
definitions).

Unfortunately, especially for small light sources of high intensity, you
must set a rather high sampling density N not to miss out important
sources. The script sends out rays to random directions, other then
Radiance's integrated direct calculation which keeps a list of sources
with known locations to check.

Cheers, Lars.

-- 
Minki Sung, Ph.D.

Building Technology Team
Korea Institute of Construction Technology
TEL.+82-31-9100-586
FAX.+82-31-9100-361
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20120422/dcd56d52/attachment.html>

From gregoryjward at gmail.com  Sat Apr 21 12:35:01 2012
From: gregoryjward at gmail.com (Greg Ward)
Date: Sat, 21 Apr 2012 12:35:01 -0700
Subject: [Radiance-general] Spherical sensor
In-Reply-To: <CANi9k9SVoTFEtv7QfyHCDohMXzeg5TMgqddGeuM8kDwuJA6MWg@mail.gmail.com>
References: <CANi9k9SVoTFEtv7QfyHCDohMXzeg5TMgqddGeuM8kDwuJA6MWg@mail.gmail.com>
Message-ID: <73C5F65E-59E3-4F12-BCC6-B26FEE988B6B@lmi.net>

Hi Minki,

There's a small error in your script.  It should read:

set N=10000
cnt 10 10 10 $N | rcalc -of -e 'Dz=1-2*($4+rand(.77-.61*recno))/'$N \
              -e 'phi=2*PI*($4+rand(-.10+.39*recno))'/$N \
              -e 'rxy=sqrt(1-Dz*Dz);Dx=rxy*cos(phi);Dy=rxy*sin(phi)' \
              -e 'Ox=$1*.02+0.02;Oy=$2*0.02+0.02;Oz=$3*0.02+0.02' \
              -e '$1=Ox;$2=Oy;$3=Oz;$4=Dx;$5=Dy;$6=Dz' \
      | rtrace -h -ff -oov -ar 256 -as 256 -ad 512 -ab 3 scene.oct \
      | total -if6 -10000 -m \
      | rcalc -e '$1=$1;$2=$2;$3=$3;$4=4*PI*($4+$5+$6)/3' > fluence.dat

The "-oov" option of rtrace will output 6 floating point values, the XYZ origin for the ray and the RGB value.  Your "total" command with "-if4" was not matching record boundaries, so the results would be all wrong.

Best,
-Greg

> From: Minki Sung <minki.sung at gmail.com>
> Date: April 21, 2012 11:48:41 AM PDT
> 
> Hi Lars~
> 
> I modified the script as follows, because i use just one channel out of RGB channels.
> 
> set N=10000
> cnt 10 10 10 $N | rcalc -of -e 'Dz=1-2*($4+rand(.77-.61*recno))/'$N \
>               -e 'phi=2*PI*($4+rand(-.10+.39*recno))'/$N \
>               -e 'rxy=sqrt(1-Dz*Dz);Dx=rxy*cos(phi);Dy=rxy*sin(phi)' \
>               -e 'Ox=$1*.02+0.02;Oy=$2*0.02+0.02;Oz=$3*0.02+0.02' \
>               -e '$1=Ox;$2=Oy;$3=Oz;$4=Dx;$5=Dy;$6=Dz' \
>       | rtrace -h -ff -oov -ar 256 -as 256 -ad 512 -ab 3 scene.oct \
>       | total -if4 -10000 -m \
>       | rcalc -e '$1=$1;$2=$2;$3=$3;$4=4*PI*$4' > fluence.dat
> 
> I checked appropriate number of rays to trace for some positions and changes below 1% in results were observed between 10000 and more rays, but less than 10000 was not desirable. I need to check for all the positions concerned.
> 
> Many thank you~
> 
> Best,
> Minki
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20120421/c6bb5341/attachment.html>

From minki.sung at gmail.com  Sun Apr 22 18:39:57 2012
From: minki.sung at gmail.com (Minki Sung)
Date: Mon, 23 Apr 2012 10:39:57 +0900
Subject: [Radiance-general] Spherical sensor
Message-ID: <CANi9k9TxXR_wNLz+WVm+429JsAZoUW=gypQQ558sjBTniav3+Q@mail.gmail.com>

Hi Greg,

That's because I use only one channel out of three; R in my sample script.
But I noticed that all the six records should be read using 'total -if6'
even if only four (ox, oy, oz, R) out of six would be used.

Thank you a lot!

Best,
Minki
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20120423/78cf908e/attachment.html>

From gregoryjward at gmail.com  Sun Apr 22 20:17:33 2012
From: gregoryjward at gmail.com (Greg Ward)
Date: Sun, 22 Apr 2012 20:17:33 -0700
Subject: [Radiance-general] Spherical sensor
In-Reply-To: <CANi9k9TxXR_wNLz+WVm+429JsAZoUW=gypQQ558sjBTniav3+Q@mail.gmail.com>
References: <CANi9k9TxXR_wNLz+WVm+429JsAZoUW=gypQQ558sjBTniav3+Q@mail.gmail.com>
Message-ID: <766688B3-1FC0-4ECC-BE81-78F1A20627BA@lmi.net>

Yes, Minki.  That is exactly right.

Best,
-Greg

> From: Minki Sung <minki.sung at gmail.com>
> Date: April 22, 2012 6:39:57 PM PDT
> 
> Hi Greg,
> 
> That's because I use only one channel out of three; R in my sample script. But I noticed that all the six records should be read using 'total -if6' even if only four (ox, oy, oz, R) out of six would be used.
> 
> Thank you a lot!
> 
> Best,
> Minki
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20120422/c7e5f913/attachment.html>

From tito_ at mit.edu  Wed Apr 25 08:38:41 2012
From: tito_ at mit.edu (Christoph Reinhart)
Date: Wed, 25 Apr 2012 15:38:41 +0000
Subject: [Radiance-general] July 20-22: 3 days of Daylighting Training
Message-ID: <1B23446CBF250648A2FC775DE3FE7E800A3DDD@OC11expo28.exchange.mit.edu>

Dear Radiance aficionados,

Some of you and/or your associates might be interested in a three day program on 'Daylighting Buildings' that we will once again be offering on June 20-22, 2012 through Harvard's Executive Education Program. Course participants will acquire a range of daylighting design analysis techniques ranging from rules of thumb to state-of-the-art computer simulations and high dynamic range photography for glare analysis. The main simulation programs used will be Rhino combined with our DIVA 2.0 plug-in<http://diva4rhino.com/> that exports Rhino scenes into Radiance, Daysim, Evalglare and EnergyPlus. Simulation outputs include:


-          Daylight factor and indoor illuminance distributions for LEED IEQ Credit 8.1 Compliance (Radiance) more>><http://diva4rhino.com/user-guide/simulation-types/LEED-IEQ>

-          Annual radiation maps for urban studies (Radiance/GenCumulativeSky) more>><diva4rhino.com/user-guide/simulation-types/radiation-maps>

-          Climate-based metrics including daylight autonomy and useful daylight illuminance (Radiance/Daysim) more>><http://diva4rhino.com/user-guide/simulation-types/climate-based>

-          Physically based scene visualizations (Radiance) more>><http://diva4rhino.com/user-guide/simulation-types/visualizations>

-          Point in time glare analysis under selected sky conditions (Radiance/Evalglare) more>><http://diva4rhino.com/user-guide/simulation-types/point-in-time-glare>

-          Annual glare maps (Daysim/Evalglare) more>><http://diva4rhino.com/user-guide/simulation-types/annual-glare>

-          Thermal loads calculations (EnergyPlus and Radiance/Daysim) more>><http://diva4rhino.com/user-guide/simulation-types/thermal-analysis>

-          Electric lighting  load profiles for manual and automatic control systems (Daysim) more>><http://diva4rhino.com/user-guide/rhino/lighting-controls>

-          Dynamics shading system analysis for venetian blinds and electrochromics systems (Daysim) more>><http://diva4rhino.com/user-guide/rhino/advanced-shading>


The physical assumptions underlying these simulation programs and performance metrics will be discussed in detail. The first two days will consist of formal instructions, in-class discussions, hands-on software tutorials, and exercises. Day two will start with a lecture on circadian effects of light by Professor Stephen Lockley form the Harvard Medical School. Participants will be given the opportunity to calibrate their personal digital cameras to take HDR images and learn several ways of how to quantitatively evaluate these images. During the last day, participants will be given the opportunity to apply the newly acquired analysis techniques to ongoing projects of their own and to go over specific problems or simulation challenges with the instructor.

You can sign up for the program at http://execed.gsd.harvard.edu/programs/daylighting-buildings-0. Please direct any content-related questions to me. Administrational/logistics questions can be answered by Ms. Margaret Moore De Chicojay (margaret_moore_dechicojay at harvard.edu<mailto:margaret_moore_dechicojay at harvard.edu>).

We are looking forward to welcoming some of you to Cambridge this July.

Best,

Christoph and Alstan


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20120425/72af1b6f/attachment.html>

From jan.wienold at ise.fraunhofer.de  Thu Apr 26 04:20:25 2012
From: jan.wienold at ise.fraunhofer.de (Jan Wienold)
Date: Thu, 26 Apr 2012 13:20:25 +0200
Subject: [Radiance-general] new evalglare version
Message-ID: <4F992F79.1010404@ise.fraunhofer.de>

Dear all,

this is a short announcement, that a new evalglare version (v1.04) is 
available (download here: http://www.ise.fraunhofer.de/radiance) .

Some important bugs are fixed now which were introduced to the v1.0 
version. They could cause completely wrong results, especially with its 
use together with gen_dgp_profile (within Daysim and DIVA). So I 
strongly recommend to use the v1.04 version (or the old 0.9f) -

It should compile now also under MAC - those users should add the 
-fnested-functions to the flags.


Best,

Jan



-- 
Dr.-Ing. Jan Wienold
Head of Team Passive Systems and Daylighting
Fraunhofer-Institut f?r Solare Energiesysteme
Thermal Systems and Buildings
Heidenhofstr. 2, 79110 Freiburg, Germany
Phone: +49(0)761 4588 5133 Fax:+49(0)761 4588 9133
jan.wienold at ise.fraunhofer.de
http://www.ise.fraunhofer.de

In office:
Mo,Tue: 8:30-18:00
We,Thu: 8:30-16:00
Fr:  8:30-15:30




From grobe at gmx.net  Thu Apr 26 04:44:51 2012
From: grobe at gmx.net (Lars O. Grobe)
Date: Thu, 26 Apr 2012 13:44:51 +0200
Subject: [Radiance-general] new evalglare version
In-Reply-To: <4F992F79.1010404@ise.fraunhofer.de>
References: <4F992F79.1010404@ise.fraunhofer.de>
Message-ID: <4F993533.2000007@gmx.net>

Hi Jan!
> It should compile now also under MAC - those users should add the 
> -fnested-functions to the flags.
>
Confirmed - with the modification to CFLAGS (added -fnested-functions), 
evalglare compiles without any warning on OS X 10.5, gcc 4.0.1, at least.

Thank you for the new release! Cheers, Lars.


From Robert.Guglielmetti at nrel.gov  Thu Apr 26 07:34:39 2012
From: Robert.Guglielmetti at nrel.gov (Guglielmetti, Robert)
Date: Thu, 26 Apr 2012 08:34:39 -0600
Subject: [Radiance-general] new evalglare version
In-Reply-To: <4F993533.2000007@gmx.net>
Message-ID: <CBBEB917.FF49%robert.guglielmetti@nrel.gov>

Yep. 10.6 too.
 

Rob Guglielmetti  IESNA, LEED AP
Commercial Buildings Research Group
National Renewable Energy Laboratory
15013 Denver West Parkway MS:RSF202
Golden, CO 80401
303.275.4319
robert.guglielmetti at nrel.gov





On 4/26/12 5:44 AM, "Lars O. Grobe" <grobe at gmx.net> wrote:

>Hi Jan!
>> It should compile now also under MAC - those users should add the
>> -fnested-functions to the flags.
>>
>Confirmed - with the modification to CFLAGS (added -fnested-functions),
>evalglare compiles without any warning on OS X 10.5, gcc 4.0.1, at least.
>
>Thank you for the new release! Cheers, Lars.
>
>_______________________________________________
>Radiance-general mailing list
>Radiance-general at radiance-online.org
>http://www.radiance-online.org/mailman/listinfo/radiance-general



From valeriadegiuli at gmail.com  Fri Apr 27 13:34:54 2012
From: valeriadegiuli at gmail.com (Valeria De Giuli)
Date: Fri, 27 Apr 2012 22:34:54 +0200
Subject: [Radiance-general] modeling an insulating glass with an integrated
	capillary slab
Message-ID: <FF64C124-E5C3-40CF-9B99-C15140D5E9D5@gmail.com>

Dear all,
I have to model a two-pane glass make up with a selective 6mm outer pane with an integrated capillary slab (it is called kapilux), white tinted. The obtained effect is a uniform and diffuse light transmittance. The only technical data that I have are: 30% of direct visible transmittance  and 15% of diffuse visible transmittance. I think I should model it with "trans" material, but I don't know which parameters I have to use. Does anybody has an idea?
Thanks in advance. Best regards,
Valeria

From amcneil at lbl.gov  Fri Apr 27 14:31:14 2012
From: amcneil at lbl.gov (Andy McNeil)
Date: Fri, 27 Apr 2012 14:31:14 -0700
Subject: [Radiance-general] modeling an insulating glass with an
	integrated capillary slab
In-Reply-To: <FF64C124-E5C3-40CF-9B99-C15140D5E9D5@gmail.com>
References: <FF64C124-E5C3-40CF-9B99-C15140D5E9D5@gmail.com>
Message-ID: <D25D89EE-E23A-4B70-B215-CCDF1AB03419@lbl.gov>

Hi Valeria,
Trans is a quick and easy way to model this type of glazing.  
You can use this widget to generate a trans material definition by entering your transmission and reflection parameters: http://gaia.lbl.gov/people/andy/public/transwidget/

However trans does not account for Fresnel effects that reduce transmission of glass at non-normal incidence angles (http://en.wikipedia.org/wiki/File:Amptitude_Ratios_air_to_glass.JPG).  So treat trans results with some degree of caution.

If you want to include fresnell effects and diffusion, you might consider use a glass surface and a trans surface one in front of the other.  Or you could generate a BSDF and use the new BSDF material.

Hope this helps,
Andy





On Apr 27, 2012, at 1:34 PM, Valeria De Giuli wrote:

> Dear all,
> I have to model a two-pane glass make up with a selective 6mm outer pane with an integrated capillary slab (it is called kapilux), white tinted. The obtained effect is a uniform and diffuse light transmittance. The only technical data that I have are: 30% of direct visible transmittance  and 15% of diffuse visible transmittance. I think I should model it with "trans" material, but I don't know which parameters I have to use. Does anybody has an idea?
> Thanks in advance. Best regards,
> Valeria
> _______________________________________________
> Radiance-general mailing list
> Radiance-general at radiance-online.org
> http://www.radiance-online.org/mailman/listinfo/radiance-general



From valeriadegiuli at gmail.com  Fri Apr 27 14:47:31 2012
From: valeriadegiuli at gmail.com (Valeria De Giuli)
Date: Fri, 27 Apr 2012 23:47:31 +0200
Subject: [Radiance-general] modeling an insulating glass with an
	integrated capillary slab
In-Reply-To: <D25D89EE-E23A-4B70-B215-CCDF1AB03419@lbl.gov>
References: <FF64C124-E5C3-40CF-9B99-C15140D5E9D5@gmail.com>
	<D25D89EE-E23A-4B70-B215-CCDF1AB03419@lbl.gov>
Message-ID: <05E84B24-89B6-406C-87EF-D17464CF7B44@gmail.com>

Thank you Andy, this is a quick and useful widget, however in this case I have only direct and diffuse visible transmission, therefore I can only assign the diffuse transmission. Am I right?
Thanks,
Valeria

Il giorno 27/apr/2012, alle ore 23:31, Andy McNeil ha scritto:

> Hi Valeria,
> Trans is a quick and easy way to model this type of glazing.  
> You can use this widget to generate a trans material definition by entering your transmission and reflection parameters: http://gaia.lbl.gov/people/andy/public/transwidget/
> 
> However trans does not account for Fresnel effects that reduce transmission of glass at non-normal incidence angles (http://en.wikipedia.org/wiki/File:Amptitude_Ratios_air_to_glass.JPG).  So treat trans results with some degree of caution.
> 
> If you want to include fresnell effects and diffusion, you might consider use a glass surface and a trans surface one in front of the other.  Or you could generate a BSDF and use the new BSDF material.
> 
> Hope this helps,
> Andy
> 
> 
> 
> 
> 
> On Apr 27, 2012, at 1:34 PM, Valeria De Giuli wrote:
> 
>> Dear all,
>> I have to model a two-pane glass make up with a selective 6mm outer pane with an integrated capillary slab (it is called kapilux), white tinted. The obtained effect is a uniform and diffuse light transmittance. The only technical data that I have are: 30% of direct visible transmittance  and 15% of diffuse visible transmittance. I think I should model it with "trans" material, but I don't know which parameters I have to use. Does anybody has an idea?
>> Thanks in advance. Best regards,
>> Valeria
>> _______________________________________________
>> Radiance-general mailing list
>> Radiance-general at radiance-online.org
>> http://www.radiance-online.org/mailman/listinfo/radiance-general
> 
> 
> _______________________________________________
> Radiance-general mailing list
> Radiance-general at radiance-online.org
> http://www.radiance-online.org/mailman/listinfo/radiance-general



From zrogers at daylightinginnovations.com  Fri Apr 27 15:17:46 2012
From: zrogers at daylightinginnovations.com (Zack Rogers)
Date: Fri, 27 Apr 2012 16:17:46 -0600
Subject: [Radiance-general] modeling an insulating glass with an
 integrated capillary slab
In-Reply-To: <D25D89EE-E23A-4B70-B215-CCDF1AB03419@lbl.gov>
References: <FF64C124-E5C3-40CF-9B99-C15140D5E9D5@gmail.com>
	<D25D89EE-E23A-4B70-B215-CCDF1AB03419@lbl.gov>
Message-ID: <CAAP856zT8pfJW39tpHJ1WyTBQagnkRU1OgdXpsQFv7mkSuF1mg@mail.gmail.com>

Hi Andy,

I think your roughness and absorption input labels are switched in this
widget.  This is a nice little tool - thanks!

Zack

On Fri, Apr 27, 2012 at 3:31 PM, Andy McNeil <amcneil at lbl.gov> wrote:

> Hi Valeria,
> Trans is a quick and easy way to model this type of glazing.
> You can use this widget to generate a trans material definition by
> entering your transmission and reflection parameters:
> http://gaia.lbl.gov/people/andy/public/transwidget/
>
> However trans does not account for Fresnel effects that reduce
> transmission of glass at non-normal incidence angles (
> http://en.wikipedia.org/wiki/File:Amptitude_Ratios_air_to_glass.JPG).  So
> treat trans results with some degree of caution.
>
> If you want to include fresnell effects and diffusion, you might consider
> use a glass surface and a trans surface one in front of the other.  Or you
> could generate a BSDF and use the new BSDF material.
>
> Hope this helps,
> Andy
>
>
>
>
>
> On Apr 27, 2012, at 1:34 PM, Valeria De Giuli wrote:
>
> > Dear all,
> > I have to model a two-pane glass make up with a selective 6mm outer pane
> with an integrated capillary slab (it is called kapilux), white tinted. The
> obtained effect is a uniform and diffuse light transmittance. The only
> technical data that I have are: 30% of direct visible transmittance  and
> 15% of diffuse visible transmittance. I think I should model it with
> "trans" material, but I don't know which parameters I have to use. Does
> anybody has an idea?
> > Thanks in advance. Best regards,
> > Valeria
> > _______________________________________________
> > Radiance-general mailing list
> > Radiance-general at radiance-online.org
> > http://www.radiance-online.org/mailman/listinfo/radiance-general
>
>
> _______________________________________________
> Radiance-general mailing list
> Radiance-general at radiance-online.org
> http://www.radiance-online.org/mailman/listinfo/radiance-general
>



-- 
Zack Rogers, P.E., LEED AP BD+C
Daylighting Innovations, LLC
211 North Public Road, Suite 220
Lafayette, CO 80026
(303)946-2310
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20120427/9ce71d95/attachment.html>

From amcneil at lbl.gov  Fri Apr 27 15:27:58 2012
From: amcneil at lbl.gov (Andy McNeil)
Date: Fri, 27 Apr 2012 15:27:58 -0700
Subject: [Radiance-general] modeling an insulating glass with an
	integrated capillary slab
In-Reply-To: <CAAP856zT8pfJW39tpHJ1WyTBQagnkRU1OgdXpsQFv7mkSuF1mg@mail.gmail.com>
References: <FF64C124-E5C3-40CF-9B99-C15140D5E9D5@gmail.com>
	<D25D89EE-E23A-4B70-B215-CCDF1AB03419@lbl.gov>
	<CAAP856zT8pfJW39tpHJ1WyTBQagnkRU1OgdXpsQFv7mkSuF1mg@mail.gmail.com>
Message-ID: <DC137188-463F-4012-92C7-55B90E53AE7E@lbl.gov>

Thanks Zack.  you're right.  I just switched the labels.
I should also mention that this widget only works on browsers that support web kit:  safari & chrome.  not firefox.  I don't know about IE.
If you're on a mac, you can get it as a dashboard widget here: http://software.mcneilorama.com/Gen_Trans_Widget.html


On Apr 27, 2012, at 3:17 PM, Zack Rogers wrote:

> Hi Andy,
> 
> I think your roughness and absorption input labels are switched in this widget.  This is a nice little tool - thanks!
> 
> Zack
> 
> On Fri, Apr 27, 2012 at 3:31 PM, Andy McNeil <amcneil at lbl.gov> wrote:
> Hi Valeria,
> Trans is a quick and easy way to model this type of glazing.
> You can use this widget to generate a trans material definition by entering your transmission and reflection parameters: http://gaia.lbl.gov/people/andy/public/transwidget/
> 
> However trans does not account for Fresnel effects that reduce transmission of glass at non-normal incidence angles (http://en.wikipedia.org/wiki/File:Amptitude_Ratios_air_to_glass.JPG).  So treat trans results with some degree of caution.
> 
> If you want to include fresnell effects and diffusion, you might consider use a glass surface and a trans surface one in front of the other.  Or you could generate a BSDF and use the new BSDF material.
> 
> Hope this helps,
> Andy
> 
> 
> 
> 
> 
> On Apr 27, 2012, at 1:34 PM, Valeria De Giuli wrote:
> 
> > Dear all,
> > I have to model a two-pane glass make up with a selective 6mm outer pane with an integrated capillary slab (it is called kapilux), white tinted. The obtained effect is a uniform and diffuse light transmittance. The only technical data that I have are: 30% of direct visible transmittance  and 15% of diffuse visible transmittance. I think I should model it with "trans" material, but I don't know which parameters I have to use. Does anybody has an idea?
> > Thanks in advance. Best regards,
> > Valeria
> > _______________________________________________
> > Radiance-general mailing list
> > Radiance-general at radiance-online.org
> > http://www.radiance-online.org/mailman/listinfo/radiance-general
> 
> 
> _______________________________________________
> Radiance-general mailing list
> Radiance-general at radiance-online.org
> http://www.radiance-online.org/mailman/listinfo/radiance-general
> 
> 
> 
> -- 
> Zack Rogers, P.E., LEED AP BD+C    
> Daylighting Innovations, LLC
> 211 North Public Road, Suite 220
> Lafayette, CO 80026
> (303)946-2310
> 
> 
> 
> _______________________________________________
> Radiance-general mailing list
> Radiance-general at radiance-online.org
> http://www.radiance-online.org/mailman/listinfo/radiance-general

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20120427/3f3c9b2f/attachment-0001.html>

From amcneil at lbl.gov  Fri Apr 27 15:42:25 2012
From: amcneil at lbl.gov (Andy McNeil)
Date: Fri, 27 Apr 2012 15:42:25 -0700
Subject: [Radiance-general] modeling an insulating glass with an
	integrated capillary slab
In-Reply-To: <05E84B24-89B6-406C-87EF-D17464CF7B44@gmail.com>
References: <FF64C124-E5C3-40CF-9B99-C15140D5E9D5@gmail.com>
	<D25D89EE-E23A-4B70-B215-CCDF1AB03419@lbl.gov>
	<05E84B24-89B6-406C-87EF-D17464CF7B44@gmail.com>
Message-ID: <4789D41D-020C-40A4-A222-0A315C4157DA@lbl.gov>

It's really tough to say without knowing what they mean by direct and diffuse transmission.  From their website I understand that by "direct" they mean normal incidence direct-hemispherical transmission and by "diffuse" they mean hemispherical-hemispherical transmission.  I would suggest setting Td to 30% and know that for non-normal incidence angles you will over estimate overall transmission.

This product, with it's capillary tubes and diffusing papers, is a perfect example of a system that should be modeled with a BSDF.  Unfortunately your options for BSDF characterization are murky at best right now.

Andy




On Apr 27, 2012, at 2:47 PM, Valeria De Giuli wrote:

> Thank you Andy, this is a quick and useful widget, however in this case I have only direct and diffuse visible transmission, therefore I can only assign the diffuse transmission. Am I right?
> Thanks,
> Valeria
> 
> Il giorno 27/apr/2012, alle ore 23:31, Andy McNeil ha scritto:
> 
>> Hi Valeria,
>> Trans is a quick and easy way to model this type of glazing.  
>> You can use this widget to generate a trans material definition by entering your transmission and reflection parameters: http://gaia.lbl.gov/people/andy/public/transwidget/
>> 
>> However trans does not account for Fresnel effects that reduce transmission of glass at non-normal incidence angles (http://en.wikipedia.org/wiki/File:Amptitude_Ratios_air_to_glass.JPG).  So treat trans results with some degree of caution.
>> 
>> If you want to include fresnell effects and diffusion, you might consider use a glass surface and a trans surface one in front of the other.  Or you could generate a BSDF and use the new BSDF material.
>> 
>> Hope this helps,
>> Andy
>> 
>> 
>> 
>> 
>> 
>> On Apr 27, 2012, at 1:34 PM, Valeria De Giuli wrote:
>> 
>>> Dear all,
>>> I have to model a two-pane glass make up with a selective 6mm outer pane with an integrated capillary slab (it is called kapilux), white tinted. The obtained effect is a uniform and diffuse light transmittance. The only technical data that I have are: 30% of direct visible transmittance  and 15% of diffuse visible transmittance. I think I should model it with "trans" material, but I don't know which parameters I have to use. Does anybody has an idea?
>>> Thanks in advance. Best regards,
>>> Valeria
>>> _______________________________________________
>>> Radiance-general mailing list
>>> Radiance-general at radiance-online.org
>>> http://www.radiance-online.org/mailman/listinfo/radiance-general
>> 
>> 
>> _______________________________________________
>> Radiance-general mailing list
>> Radiance-general at radiance-online.org
>> http://www.radiance-online.org/mailman/listinfo/radiance-general
> 
> 
> _______________________________________________
> Radiance-general mailing list
> Radiance-general at radiance-online.org
> http://www.radiance-online.org/mailman/listinfo/radiance-general



From gregoryjward at gmail.com  Fri Apr 27 19:28:13 2012
From: gregoryjward at gmail.com (Greg Ward)
Date: Fri, 27 Apr 2012 19:28:13 -0700
Subject: [Radiance-general] modeling an insulating glass with an
	integrated capillary slab
In-Reply-To: <4789D41D-020C-40A4-A222-0A315C4157DA@lbl.gov>
References: <FF64C124-E5C3-40CF-9B99-C15140D5E9D5@gmail.com>
	<D25D89EE-E23A-4B70-B215-CCDF1AB03419@lbl.gov>
	<05E84B24-89B6-406C-87EF-D17464CF7B44@gmail.com>
	<4789D41D-020C-40A4-A222-0A315C4157DA@lbl.gov>
Message-ID: <17A56393-E51A-4DDC-A12C-9D5AA8FA2B8F@lmi.net>

Is this similar to the translucent panel modeled by Christoph Reinhart and Marilyne Andersen in the following paper?

	http://www.nrc-cnrc.gc.ca/obj/irc/doc/pubs/nrcc48165/nrcc48165.pdf

I believe they developed a Radiance description for it.

Cheers,
-Greg

> From: Andy McNeil <amcneil at lbl.gov>
> Date: April 27, 2012 3:42:25 PM PDT
> 
> It's really tough to say without knowing what they mean by direct and diffuse transmission.  From their website I understand that by "direct" they mean normal incidence direct-hemispherical transmission and by "diffuse" they mean hemispherical-hemispherical transmission.  I would suggest setting Td to 30% and know that for non-normal incidence angles you will over estimate overall transmission.
> 
> This product, with it's capillary tubes and diffusing papers, is a perfect example of a system that should be modeled with a BSDF.  Unfortunately your options for BSDF characterization are murky at best right now.
> 
> Andy
> 
> On Apr 27, 2012, at 2:47 PM, Valeria De Giuli wrote:
> 
>> Thank you Andy, this is a quick and useful widget, however in this case I have only direct and diffuse visible transmission, therefore I can only assign the diffuse transmission. Am I right?
>> Thanks,
>> Valeria
>> 
>> Il giorno 27/apr/2012, alle ore 23:31, Andy McNeil ha scritto:
>> 
>>> Hi Valeria,
>>> Trans is a quick and easy way to model this type of glazing.  
>>> You can use this widget to generate a trans material definition by entering your transmission and reflection parameters: http://gaia.lbl.gov/people/andy/public/transwidget/
>>> 
>>> However trans does not account for Fresnel effects that reduce transmission of glass at non-normal incidence angles (http://en.wikipedia.org/wiki/File:Amptitude_Ratios_air_to_glass.JPG).  So treat trans results with some degree of caution.
>>> 
>>> If you want to include fresnell effects and diffusion, you might consider use a glass surface and a trans surface one in front of the other.  Or you could generate a BSDF and use the new BSDF material.
>>> 
>>> Hope this helps,
>>> Andy
>>> 
>>> 
>>> On Apr 27, 2012, at 1:34 PM, Valeria De Giuli wrote:
>>> 
>>>> Dear all,
>>>> I have to model a two-pane glass make up with a selective 6mm outer pane with an integrated capillary slab (it is called kapilux), white tinted. The obtained effect is a uniform and diffuse light transmittance. The only technical data that I have are: 30% of direct visible transmittance  and 15% of diffuse visible transmittance. I think I should model it with "trans" material, but I don't know which parameters I have to use. Does anybody has an idea?
>>>> Thanks in advance. Best regards,
>>>> Valeria


From valeriadegiuli at gmail.com  Fri Apr 27 23:44:46 2012
From: valeriadegiuli at gmail.com (Valeria De Giuli)
Date: Sat, 28 Apr 2012 08:44:46 +0200
Subject: [Radiance-general] modeling an insulating glass with an
	integrated capillary slab
In-Reply-To: <17A56393-E51A-4DDC-A12C-9D5AA8FA2B8F@lmi.net>
References: <FF64C124-E5C3-40CF-9B99-C15140D5E9D5@gmail.com>
	<D25D89EE-E23A-4B70-B215-CCDF1AB03419@lbl.gov>
	<05E84B24-89B6-406C-87EF-D17464CF7B44@gmail.com>
	<4789D41D-020C-40A4-A222-0A315C4157DA@lbl.gov>
	<17A56393-E51A-4DDC-A12C-9D5AA8FA2B8F@lmi.net>
Message-ID: <D5B0231A-3FEF-4BFA-95F1-72FCD5AC2586@gmail.com>

Thank you all! Yes, the product I have to model is the Kapilux. I'm going through the report of Christoph and Marilyne: I think that product is very similar to the one I have to simulate. I have decided to model it following the second option (trans 16%), using the diffuse-diffuse transmittance instead of the direct normal hemispherical (30% in my case). I then put the same values for the other parameters. Do you think it is correct?
Thanks a lot,
Valeria


Il giorno 28/apr/2012, alle ore 04:28, Greg Ward ha scritto:

> Is this similar to the translucent panel modeled by Christoph Reinhart and Marilyne Andersen in the following paper?
> 
> 	http://www.nrc-cnrc.gc.ca/obj/irc/doc/pubs/nrcc48165/nrcc48165.pdf
> 
> I believe they developed a Radiance description for it.
> 
> Cheers,
> -Greg
> 
>> From: Andy McNeil <amcneil at lbl.gov>
>> Date: April 27, 2012 3:42:25 PM PDT
>> 
>> It's really tough to say without knowing what they mean by direct and diffuse transmission.  From their website I understand that by "direct" they mean normal incidence direct-hemispherical transmission and by "diffuse" they mean hemispherical-hemispherical transmission.  I would suggest setting Td to 30% and know that for non-normal incidence angles you will over estimate overall transmission.
>> 
>> This product, with it's capillary tubes and diffusing papers, is a perfect example of a system that should be modeled with a BSDF.  Unfortunately your options for BSDF characterization are murky at best right now.
>> 
>> Andy
>> 
>> On Apr 27, 2012, at 2:47 PM, Valeria De Giuli wrote:
>> 
>>> Thank you Andy, this is a quick and useful widget, however in this case I have only direct and diffuse visible transmission, therefore I can only assign the diffuse transmission. Am I right?
>>> Thanks,
>>> Valeria
>>> 
>>> Il giorno 27/apr/2012, alle ore 23:31, Andy McNeil ha scritto:
>>> 
>>>> Hi Valeria,
>>>> Trans is a quick and easy way to model this type of glazing.  
>>>> You can use this widget to generate a trans material definition by entering your transmission and reflection parameters: http://gaia.lbl.gov/people/andy/public/transwidget/
>>>> 
>>>> However trans does not account for Fresnel effects that reduce transmission of glass at non-normal incidence angles (http://en.wikipedia.org/wiki/File:Amptitude_Ratios_air_to_glass.JPG).  So treat trans results with some degree of caution.
>>>> 
>>>> If you want to include fresnell effects and diffusion, you might consider use a glass surface and a trans surface one in front of the other.  Or you could generate a BSDF and use the new BSDF material.
>>>> 
>>>> Hope this helps,
>>>> Andy
>>>> 
>>>> 
>>>> On Apr 27, 2012, at 1:34 PM, Valeria De Giuli wrote:
>>>> 
>>>>> Dear all,
>>>>> I have to model a two-pane glass make up with a selective 6mm outer pane with an integrated capillary slab (it is called kapilux), white tinted. The obtained effect is a uniform and diffuse light transmittance. The only technical data that I have are: 30% of direct visible transmittance  and 15% of diffuse visible transmittance. I think I should model it with "trans" material, but I don't know which parameters I have to use. Does anybody has an idea?
>>>>> Thanks in advance. Best regards,
>>>>> Valeria
> 
> _______________________________________________
> Radiance-general mailing list
> Radiance-general at radiance-online.org
> http://www.radiance-online.org/mailman/listinfo/radiance-general



From hope.zh at gmail.com  Sun Apr 29 11:15:49 2012
From: hope.zh at gmail.com (Ji Zhang)
Date: Mon, 30 Apr 2012 02:15:49 +0800
Subject: [Radiance-general] visualize position index
Message-ID: <CAD83LVK3XBki1DBfsyCBwgRqQ_UcsytqPC9BFPULBWjxwFQtxQ@mail.gmail.com>

Dear Radiance experts,

Learning glare related analysis, I write a .cal file to define the position
index for every point on the sky in relation to a given view vector based
on the position index formula. I also prepared a batch file to visualize it.

However, the image I got is not a circular fisheye one and the upper half
of the pattern doesn't seem to resemble what appeared on page 753 in Dr
Wienold and Dr Christoffersen's paper:
Wienold, J., & Christoffersen, J. (2006). Evaluation methods and
development of a new glare prediction model for daylight environments with
the use of CCD cameras. Energy and Buildings, 38(7), 743-757.

Images are shown here:
http://episode-hopezh.blogspot.com/2012/04/viz-position-index.html

The .cal and batch files can be downloaded from:
https://sites.google.com/site/episodehopezh/files/viz_sg.rar?attredirects=0&d=1

Two folders are included, one for visualizing the position index and the
other one for visualizing the inverted position index.

The view is a horizontal one towards due south. The image extracted from Dr
Wienold and Dr Christoffersen's paper is also included as a reference.

Can you kindly take a look of the .cal and batch file and advise me on:
1) why I can't get a circular fisheye image (I assume there's simple rookie
error in the script...)?
2) whether the position index pattern as visualized is correct?
3) how to convert the image into one using position index value as color
legend?


Would greatly appreciate if Dr Wienold can kindly provide some suggestions!

Thank you very much in advance!

- Ji
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20120430/7ef59e30/attachment.html>

From hope.zh at gmail.com  Sun Apr 29 11:18:24 2012
From: hope.zh at gmail.com (Ji Zhang)
Date: Mon, 30 Apr 2012 02:18:24 +0800
Subject: [Radiance-general] visualize position index
In-Reply-To: <CAD83LVK3XBki1DBfsyCBwgRqQ_UcsytqPC9BFPULBWjxwFQtxQ@mail.gmail.com>
References: <CAD83LVK3XBki1DBfsyCBwgRqQ_UcsytqPC9BFPULBWjxwFQtxQ@mail.gmail.com>
Message-ID: <CAD83LVJhtGkMPOPVSkoPH5o_HWST_vyutMZGx4Pft=3PuYEwYQ@mail.gmail.com>

Sorry, the download link should be:
https://sites.google.com/site/episodehopezh/files/viz_pos_index_test.rar?attredirects=0&d=1

Apologize!

- JI


On Mon, Apr 30, 2012 at 2:15 AM, Ji Zhang <hope.zh at gmail.com> wrote:

> Dear Radiance experts,
>
> Learning glare related analysis, I write a .cal file to define the
> position index for every point on the sky in relation to a given view
> vector based on the position index formula. I also prepared a batch file to
> visualize it.
>
> However, the image I got is not a circular fisheye one and the upper half
> of the pattern doesn't seem to resemble what appeared on page 753 in Dr
> Wienold and Dr Christoffersen's paper:
> Wienold, J., & Christoffersen, J. (2006). Evaluation methods and
> development of a new glare prediction model for daylight environments with
> the use of CCD cameras. Energy and Buildings, 38(7), 743-757.
>
> Images are shown here:
> http://episode-hopezh.blogspot.com/2012/04/viz-position-index.html
>
> The .cal and batch files can be downloaded from:
>
> https://sites.google.com/site/episodehopezh/files/viz_sg.rar?attredirects=0&d=1
>
> Two folders are included, one for visualizing the position index and the
> other one for visualizing the inverted position index.
>
> The view is a horizontal one towards due south. The image extracted from
> Dr Wienold and Dr Christoffersen's paper is also included as a reference.
>
> Can you kindly take a look of the .cal and batch file and advise me on:
> 1) why I can't get a circular fisheye image (I assume there's simple
> rookie error in the script...)?
> 2) whether the position index pattern as visualized is correct?
> 3) how to convert the image into one using position index value as color
> legend?
>
>
> Would greatly appreciate if Dr Wienold can kindly provide some suggestions!
>
> Thank you very much in advance!
>
> - Ji
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20120430/8cabd692/attachment.html>

From jan.wienold at ise.fraunhofer.de  Mon Apr 30 04:12:44 2012
From: jan.wienold at ise.fraunhofer.de (Jan Wienold)
Date: Mon, 30 Apr 2012 13:12:44 +0200
Subject: [Radiance-general] visualize position index
In-Reply-To: <CAD83LVK3XBki1DBfsyCBwgRqQ_UcsytqPC9BFPULBWjxwFQtxQ@mail.gmail.com>
References: <CAD83LVK3XBki1DBfsyCBwgRqQ_UcsytqPC9BFPULBWjxwFQtxQ@mail.gmail.com>
Message-ID: <4F9E73AC.8050903@ise.fraunhofer.de>

Dear Ji,

there is an undocumented option in evalglare (-p), which replaces the 
luminance values to the position-index values. So you can directly 
generate an image just with the position index with just one command line...
You have to use evalglare in the normal manner (-> feed in image and 
specify output image. The content of the input image doesn't matter, 
just the header options must be correct.)

example: evalglare -p -c position_index.hdr  inputimage.hdr

Good luck,

Jan



On 04/29/2012 08:15 PM, Ji Zhang wrote:
> Dear Radiance experts,
>
> Learning glare related analysis, I write a .cal file to define the
> position index for every point on the sky in relation to a given view
> vector based on the position index formula. I also prepared a batch
> file to visualize it.
>
> However, the image I got is not a circular fisheye one and the upper
> half of the pattern doesn't seem to resemble what appeared on page 753
> in Dr Wienold and Dr Christoffersen's paper:
> Wienold, J., & Christoffersen, J. (2006). Evaluation methods and
> development of a new glare prediction model for daylight environments
> with the use of CCD cameras. Energy and Buildings, 38(7), 743-757.
>
> Images are shown here:
> http://episode-hopezh.blogspot.com/2012/04/viz-position-index.html
>
> The .cal and batch files can be downloaded from:
> https://sites.google.com/site/episodehopezh/files/viz_sg.rar?attredirects=0&d=1
> <https://sites.google.com/site/episodehopezh/files/viz_sg.rar?attredirects=0&d=1>
>
> Two folders are included, one for visualizing the position index and
> the other one for visualizing the inverted position index.
>
> The view is a horizontal one towards due south. The image extracted
> from Dr Wienold and Dr Christoffersen's paper is also included as a
> reference.
>
> Can you kindly take a look of the .cal and batch file and advise me on:
> 1) why I can't get a circular fisheye image (I assume there's simple
> rookie error in the script...)?
> 2) whether the position index pattern as visualized is correct?
> 3) how to convert the image into one using position index value as
> color legend?
>
>
> Would greatly appreciate if Dr Wienold can kindly provide some
> suggestions!
>
> Thank you very much in advance!
>
> - Ji
>
>
>
>


-- 
Dr.-Ing. Jan Wienold
Head of Team Passive Systems and Daylighting
Fraunhofer-Institut f?r Solare Energiesysteme
Thermal Systems and Buildings
Heidenhofstr. 2, 79110 Freiburg, Germany
Phone: +49(0)761 4588 5133 Fax:+49(0)761 4588 9133
jan.wienold at ise.fraunhofer.de
http://www.ise.fraunhofer.de

In office:
Mo,Tue: 8:30-18:00
We,Thu: 8:30-16:00
Fr:  8:30-15:30



From achim.geissler at fhnw.ch  Wed Apr 18 05:36:32 2012
From: achim.geissler at fhnw.ch (Geissler Achim)
Date: Wed, 18 Apr 2012 12:36:32 -0000
Subject: [Radiance-general] Radiance ESP-r coupling
In-Reply-To: <CAHdUKVVs84yWBfkEsh104Y0+ni1j5frkKqhntwiUHQOYiAb7UQ@mail.gmail.com>
References: <CAHdUKVVs84yWBfkEsh104Y0+ni1j5frkKqhntwiUHQOYiAb7UQ@mail.gmail.com>
Message-ID: <0F4309A75967A944A1E3C19469796698EA19B9CCFC@MXAMU12.adm.ds.fhnw.ch>

Dear Jo?o

I'm afraid I have never used the coupling on Windows, however, the message must not mean that Radiance is not installed correctly or that it is not "linked".


-          Where do you fire up ESP-r? On Unix / Cygwin, best results with Radiance coupling are usually obtained when starting esp-r in the /cfg/ folder of the model of interest

-          Do you get any "chatter" from the / a console? Possibly, Radiance and / or ESP-r gives some messages which could help

-          There seems to be a glitch in the current development_branch which leads to missing .opt files with Radiance coupling. Possibly add such a file manually (see a similar problem some weeks ago, I sent an example .opt to the group)

Best
Achim


Von: Jo?o Santos [mailto:joao.portugal.santos at gmail.com]
Gesendet: Mittwoch, 18. April 2012 12:16
An: radiance-general at radiance-online.org
Betreff: [Radiance-general] Radiance ESP-r coupling

Hi everyone

I?ve been trying to use the ESP_r / Radiance coupling but encountered some errors.
I?m working on Windows7 64 bits, and with the lastest esp-r development_branch.

After installing the mingw-radiance_setup-3R9 from http://www.bozzograo.net/radiance  (which sets the environment variables automatically, I confirmed)
I opened the esp-r file from the /cfg folder.
But while simulating its presents the following:

Simulation has now commenced.
Removing existing transfer file.
Lighting simulation has now commenced.
Fatal error: Radiance simulation produced no data.

So it seems that esp-r isn?t linked with radiance.
Does the location matters? Because I?ve tried C:/Program Files/ ,  C:/Esru/bin and also C:/Radiance
Is the above radiance package complete?
What is the best way to install Radiance in a Windows machine?

Thanks in advance
Joao
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20120418/c7b24b55/attachment.html>

