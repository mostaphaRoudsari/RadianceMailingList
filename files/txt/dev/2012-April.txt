From grobe at gmx.net  Mon Apr  9 13:45:04 2012
From: grobe at gmx.net (Lars O. Grobe)
Date: Mon, 09 Apr 2012 22:45:04 +0200
Subject: [Radiance-dev] vwright and stereoscopic image generation
Message-ID: <4F834A50.1080603@gmx.net>

Hi all,

I just found that vwright, which looked like the perfect tool to support
stereoscopic image pair generation, generates a new view by simply
moving the view-point -vp. This does not consider the fact that our eyes
(hopefully) are able to focus on an object, not looking parallel into
infinity. So my resulting frames do not really match (I tried it and it
looked ugly...). Paul Bourke provides a great page explaining the
background of such stereo pairs on his website:

http://paulbourke.net/miscellaneous/stereographics/stereorender/

To correct this, I would propose to manipulate the -vs and -vh
parameters in the view file generated by vwright. I am not that great in
doing reprojections, but from what I understand, this should work. I
have made a simple sketch to visually explain what I attempted to do
(and probably what I did wrong):

web-browsers with svg-support
http://static.larsgrobe.de/stereoscopic_vwright.svg

pdf of the same sketch
http://static.larsgrobe.de/stereoscopic_vwright.pdf

Here is my approach:

e [scene units]: eye seperation
is given as input to vwright, known

f [scene units]: distance from either eye point to the image plane
can simply be calculated from view direction vector vd_x, vd_y, vd_z:
f = sqrt(vd_x^2+vd_y^2+vd_z^2)

alpha [degrees]: half horizontal view angle
can simply be calculated from view's vh: alpha = vh/2

a [scene units]: alpha projected on the image plane
a = f * tan(alpha)

1) Calculate horizontal shift value vs for views:

vs [] : shift fraction (eye separation e / projected image width 2*a)
can be calculated from above as vs = e / 2*a

For the left view, I modify vs as above, for the right view I use its
negative value.

2) Correct the horizontal field of view vh for views:

The stereoscopic image can be displayed only the overlapping image area
for both views. Thus we need to cut the left border from the left and
the right border from the right view.

beta [degrees]: the angle corresponding to this border (having the same
width as the eye separation, but being located in the image plane)
calculated as beta = alpha - atan ( (a-e)/f )

This allows calculating the corrected horizontal view angle vh_corr,
which will replace the vh in my view files:

vh_corr [degrees]: corrected horizontal field of view
as vh_corr = vh - beta

3) The full procedure:

- take a view, derive left and right views from it by running vwright
(+/-) e/2

- calculate vs and vh_corr and replace the corresponding values in both
views

- render, take on your glasses, and enjoy stereoscopic 3d images....

I hope this is correct, for me it gave results looking much better then
those by simply using vwright's view parameters. I think that having
this in vwright as an option (either active by default, or, to preserve
backwards compatibility, switched by e.g. -s as stereographic) would
make rendering of stereo pairs with Radiance much more fun.

Any comments? Cheers, Lars.


From gregoryjward at gmail.com  Mon Apr  9 15:07:05 2012
From: gregoryjward at gmail.com (Gregory J. Ward)
Date: Mon, 9 Apr 2012 15:07:05 -0700
Subject: [Radiance-dev] vwright and stereoscopic image generation
In-Reply-To: <4F834A50.1080603@gmx.net>
References: <4F834A50.1080603@gmx.net>
Message-ID: <92392DD3-B116-4F18-B230-3E088CBD9A2F@gmail.com>

Hi Lars,

I only ever created stereo slide pairs using vwright, in which case, simply moving the slides closer together a small amount alleviated any discomfort.  It amounts to the same as -vs (modulo the image borders).

I wrote vwright before introducing the notion of viewing distance (the length of the -vd vector).  I could add an option to vwright for the screen distance that would take the view distance and turn on the kind of automatic adjustment you propose.  I don't have any way to test it, unfortunately.

Do you think the adjustment of -vh is really necessary?  Regardless of what  you do with it, the borders will not match for all objects, anyway.

Cheers,
-Greg

> From: "Lars O. Grobe" <grobe at gmx.net>
> Date: April 9, 2012 1:45:04 PM PDT
> 
> Hi all,
> 
> I just found that vwright, which looked like the perfect tool to support
> stereoscopic image pair generation, generates a new view by simply
> moving the view-point -vp. This does not consider the fact that our eyes
> (hopefully) are able to focus on an object, not looking parallel into
> infinity. So my resulting frames do not really match (I tried it and it
> looked ugly...). Paul Bourke provides a great page explaining the
> background of such stereo pairs on his website:
> 
> http://paulbourke.net/miscellaneous/stereographics/stereorender/
> 
> To correct this, I would propose to manipulate the -vs and -vh
> parameters in the view file generated by vwright. I am not that great in
> doing reprojections, but from what I understand, this should work. I
> have made a simple sketch to visually explain what I attempted to do
> (and probably what I did wrong):
> 
> web-browsers with svg-support
> http://static.larsgrobe.de/stereoscopic_vwright.svg
> 
> pdf of the same sketch
> http://static.larsgrobe.de/stereoscopic_vwright.pdf
> 
> Here is my approach:
> 
> e [scene units]: eye seperation
> is given as input to vwright, known
> 
> f [scene units]: distance from either eye point to the image plane
> can simply be calculated from view direction vector vd_x, vd_y, vd_z:
> f = sqrt(vd_x^2+vd_y^2+vd_z^2)
> 
> alpha [degrees]: half horizontal view angle
> can simply be calculated from view's vh: alpha = vh/2
> 
> a [scene units]: alpha projected on the image plane
> a = f * tan(alpha)
> 
> 1) Calculate horizontal shift value vs for views:
> 
> vs [] : shift fraction (eye separation e / projected image width 2*a)
> can be calculated from above as vs = e / 2*a
> 
> For the left view, I modify vs as above, for the right view I use its
> negative value.
> 
> 2) Correct the horizontal field of view vh for views:
> 
> The stereoscopic image can be displayed only the overlapping image area
> for both views. Thus we need to cut the left border from the left and
> the right border from the right view.
> 
> beta [degrees]: the angle corresponding to this border (having the same
> width as the eye separation, but being located in the image plane)
> calculated as beta = alpha - atan ( (a-e)/f )
> 
> This allows calculating the corrected horizontal view angle vh_corr,
> which will replace the vh in my view files:
> 
> vh_corr [degrees]: corrected horizontal field of view
> as vh_corr = vh - beta
> 
> 3) The full procedure:
> 
> - take a view, derive left and right views from it by running vwright
> (+/-) e/2
> 
> - calculate vs and vh_corr and replace the corresponding values in both
> views
> 
> - render, take on your glasses, and enjoy stereoscopic 3d images....
> 
> I hope this is correct, for me it gave results looking much better then
> those by simply using vwright's view parameters. I think that having
> this in vwright as an option (either active by default, or, to preserve
> backwards compatibility, switched by e.g. -s as stereographic) would
> make rendering of stereo pairs with Radiance much more fun.
> 
> Any comments? Cheers, Lars.
> 


From grobe at gmx.net  Mon Apr  9 15:56:14 2012
From: grobe at gmx.net (Lars O. Grobe)
Date: Tue, 10 Apr 2012 01:56:14 +0300
Subject: [Radiance-dev] vwright and stereoscopic image generation
In-Reply-To: <92392DD3-B116-4F18-B230-3E088CBD9A2F@gmail.com>
References: <4F834A50.1080603@gmx.net>
	<92392DD3-B116-4F18-B230-3E088CBD9A2F@gmail.com>
Message-ID: <B191F446-DA4B-41C9-8C94-92CCFEF1848F@gmx.net>

Hi Greg!

My guess is that targeting a 3d-tv format (which is what I did) is rather different then working with slides, where adjustments can be made on display. In my example, especially objects close to the observer were hard to view with standard vwright settings, while the modified vs and vh views led to a rather clear result. I may need to try some more scenes before claiming this to be true in general. To give an idea of the changes for vh, my initial 75 degrees became 72 degrees for a simple test scene, eye distance 0.065m and distance about one meter.

I can dig some more into this, but only after Friday. I wanted to share my work though, so that maybe others can comment or correct me.

Cheers, Lars.
--
Dipl.-Ing. Architect Lars O. Grobe

On Apr 10, 2012, at 1:07, "Gregory J. Ward" <gregoryjward at gmail.com> wrote:

> Hi Lars,
> 
> I only ever created stereo slide pairs using vwright, in which case, simply moving the slides closer together a small amount alleviated any discomfort.  It amounts to the same as -vs (modulo the image borders).
> 
> I wrote vwright before introducing the notion of viewing distance (the length of the -vd vector).  I could add an option to vwright for the screen distance that would take the view distance and turn on the kind of automatic adjustment you propose.  I don't have any way to test it, unfortunately.
> 
> Do you think the adjustment of -vh is really necessary?  Regardless of what  you do with it, the borders will not match for all objects, anyway.
> 
> Cheers,
> -Greg
> 
>> From: "Lars O. Grobe" <grobe at gmx.net>
>> Date: April 9, 2012 1:45:04 PM PDT
>> 
>> Hi all,
>> 
>> I just found that vwright, which looked like the perfect tool to support
>> stereoscopic image pair generation, generates a new view by simply
>> moving the view-point -vp. This does not consider the fact that our eyes
>> (hopefully) are able to focus on an object, not looking parallel into
>> infinity. So my resulting frames do not really match (I tried it and it
>> looked ugly...). Paul Bourke provides a great page explaining the
>> background of such stereo pairs on his website:
>> 
>> http://paulbourke.net/miscellaneous/stereographics/stereorender/
>> 
>> To correct this, I would propose to manipulate the -vs and -vh
>> parameters in the view file generated by vwright. I am not that great in
>> doing reprojections, but from what I understand, this should work. I
>> have made a simple sketch to visually explain what I attempted to do
>> (and probably what I did wrong):
>> 
>> web-browsers with svg-support
>> http://static.larsgrobe.de/stereoscopic_vwright.svg
>> 
>> pdf of the same sketch
>> http://static.larsgrobe.de/stereoscopic_vwright.pdf
>> 
>> Here is my approach:
>> 
>> e [scene units]: eye seperation
>> is given as input to vwright, known
>> 
>> f [scene units]: distance from either eye point to the image plane
>> can simply be calculated from view direction vector vd_x, vd_y, vd_z:
>> f = sqrt(vd_x^2+vd_y^2+vd_z^2)
>> 
>> alpha [degrees]: half horizontal view angle
>> can simply be calculated from view's vh: alpha = vh/2
>> 
>> a [scene units]: alpha projected on the image plane
>> a = f * tan(alpha)
>> 
>> 1) Calculate horizontal shift value vs for views:
>> 
>> vs [] : shift fraction (eye separation e / projected image width 2*a)
>> can be calculated from above as vs = e / 2*a
>> 
>> For the left view, I modify vs as above, for the right view I use its
>> negative value.
>> 
>> 2) Correct the horizontal field of view vh for views:
>> 
>> The stereoscopic image can be displayed only the overlapping image area
>> for both views. Thus we need to cut the left border from the left and
>> the right border from the right view.
>> 
>> beta [degrees]: the angle corresponding to this border (having the same
>> width as the eye separation, but being located in the image plane)
>> calculated as beta = alpha - atan ( (a-e)/f )
>> 
>> This allows calculating the corrected horizontal view angle vh_corr,
>> which will replace the vh in my view files:
>> 
>> vh_corr [degrees]: corrected horizontal field of view
>> as vh_corr = vh - beta
>> 
>> 3) The full procedure:
>> 
>> - take a view, derive left and right views from it by running vwright
>> (+/-) e/2
>> 
>> - calculate vs and vh_corr and replace the corresponding values in both
>> views
>> 
>> - render, take on your glasses, and enjoy stereoscopic 3d images....
>> 
>> I hope this is correct, for me it gave results looking much better then
>> those by simply using vwright's view parameters. I think that having
>> this in vwright as an option (either active by default, or, to preserve
>> backwards compatibility, switched by e.g. -s as stereographic) would
>> make rendering of stereo pairs with Radiance much more fun.
>> 
>> Any comments? Cheers, Lars.
>> 
> 
> _______________________________________________
> Radiance-dev mailing list
> Radiance-dev at radiance-online.org
> http://www.radiance-online.org/mailman/listinfo/radiance-dev


From dlr1 at cox.net  Mon Apr  9 17:24:40 2012
From: dlr1 at cox.net (Doug Reeder)
Date: Mon, 9 Apr 2012 18:24:40 -0600
Subject: [Radiance-dev] vwright and stereoscopic image generation
In-Reply-To: <B191F446-DA4B-41C9-8C94-92CCFEF1848F@gmx.net>
References: <4F834A50.1080603@gmx.net>
	<92392DD3-B116-4F18-B230-3E088CBD9A2F@gmail.com>
	<B191F446-DA4B-41C9-8C94-92CCFEF1848F@gmx.net>
Message-ID: <A31C2091-8659-47BF-B60C-ABBA1FDA4B59@cox.net>

Lars,

I haven't looked at your code, however, I have looked at the code for VisIt (3D renderer from LLNL) and in vis5d (renderer for weather models) and in both cases they had what I remember to be a simple algorithm for eye location/separation. Both renderers work well in 3D while panning zooming etc. 

Doug Reeder
On Apr 9, 2012, at 4:56 PM, Lars O. Grobe wrote:

> Hi Greg!
> 
> My guess is that targeting a 3d-tv format (which is what I did) is rather different then working with slides, where adjustments can be made on display. In my example, especially objects close to the observer were hard to view with standard vwright settings, while the modified vs and vh views led to a rather clear result. I may need to try some more scenes before claiming this to be true in general. To give an idea of the changes for vh, my initial 75 degrees became 72 degrees for a simple test scene, eye distance 0.065m and distance about one meter.
> 
> I can dig some more into this, but only after Friday. I wanted to share my work though, so that maybe others can comment or correct me.
> 
> Cheers, Lars.
> --
> Dipl.-Ing. Architect Lars O. Grobe
> 
> On Apr 10, 2012, at 1:07, "Gregory J. Ward" <gregoryjward at gmail.com> wrote:
> 
>> Hi Lars,
>> 
>> I only ever created stereo slide pairs using vwright, in which case, simply moving the slides closer together a small amount alleviated any discomfort.  It amounts to the same as -vs (modulo the image borders).
>> 
>> I wrote vwright before introducing the notion of viewing distance (the length of the -vd vector).  I could add an option to vwright for the screen distance that would take the view distance and turn on the kind of automatic adjustment you propose.  I don't have any way to test it, unfortunately.
>> 
>> Do you think the adjustment of -vh is really necessary?  Regardless of what  you do with it, the borders will not match for all objects, anyway.
>> 
>> Cheers,
>> -Greg
>> 
>>> From: "Lars O. Grobe" <grobe at gmx.net>
>>> Date: April 9, 2012 1:45:04 PM PDT
>>> 
>>> Hi all,
>>> 
>>> I just found that vwright, which looked like the perfect tool to support
>>> stereoscopic image pair generation, generates a new view by simply
>>> moving the view-point -vp. This does not consider the fact that our eyes
>>> (hopefully) are able to focus on an object, not looking parallel into
>>> infinity. So my resulting frames do not really match (I tried it and it
>>> looked ugly...). Paul Bourke provides a great page explaining the
>>> background of such stereo pairs on his website:
>>> 
>>> http://paulbourke.net/miscellaneous/stereographics/stereorender/
>>> 
>>> To correct this, I would propose to manipulate the -vs and -vh
>>> parameters in the view file generated by vwright. I am not that great in
>>> doing reprojections, but from what I understand, this should work. I
>>> have made a simple sketch to visually explain what I attempted to do
>>> (and probably what I did wrong):
>>> 
>>> web-browsers with svg-support
>>> http://static.larsgrobe.de/stereoscopic_vwright.svg
>>> 
>>> pdf of the same sketch
>>> http://static.larsgrobe.de/stereoscopic_vwright.pdf
>>> 
>>> Here is my approach:
>>> 
>>> e [scene units]: eye seperation
>>> is given as input to vwright, known
>>> 
>>> f [scene units]: distance from either eye point to the image plane
>>> can simply be calculated from view direction vector vd_x, vd_y, vd_z:
>>> f = sqrt(vd_x^2+vd_y^2+vd_z^2)
>>> 
>>> alpha [degrees]: half horizontal view angle
>>> can simply be calculated from view's vh: alpha = vh/2
>>> 
>>> a [scene units]: alpha projected on the image plane
>>> a = f * tan(alpha)
>>> 
>>> 1) Calculate horizontal shift value vs for views:
>>> 
>>> vs [] : shift fraction (eye separation e / projected image width 2*a)
>>> can be calculated from above as vs = e / 2*a
>>> 
>>> For the left view, I modify vs as above, for the right view I use its
>>> negative value.
>>> 
>>> 2) Correct the horizontal field of view vh for views:
>>> 
>>> The stereoscopic image can be displayed only the overlapping image area
>>> for both views. Thus we need to cut the left border from the left and
>>> the right border from the right view.
>>> 
>>> beta [degrees]: the angle corresponding to this border (having the same
>>> width as the eye separation, but being located in the image plane)
>>> calculated as beta = alpha - atan ( (a-e)/f )
>>> 
>>> This allows calculating the corrected horizontal view angle vh_corr,
>>> which will replace the vh in my view files:
>>> 
>>> vh_corr [degrees]: corrected horizontal field of view
>>> as vh_corr = vh - beta
>>> 
>>> 3) The full procedure:
>>> 
>>> - take a view, derive left and right views from it by running vwright
>>> (+/-) e/2
>>> 
>>> - calculate vs and vh_corr and replace the corresponding values in both
>>> views
>>> 
>>> - render, take on your glasses, and enjoy stereoscopic 3d images....
>>> 
>>> I hope this is correct, for me it gave results looking much better then
>>> those by simply using vwright's view parameters. I think that having
>>> this in vwright as an option (either active by default, or, to preserve
>>> backwards compatibility, switched by e.g. -s as stereographic) would
>>> make rendering of stereo pairs with Radiance much more fun.
>>> 
>>> Any comments? Cheers, Lars.
>>> 
>> 
>> _______________________________________________
>> Radiance-dev mailing list
>> Radiance-dev at radiance-online.org
>> http://www.radiance-online.org/mailman/listinfo/radiance-dev
> 
> _______________________________________________
> Radiance-dev mailing list
> Radiance-dev at radiance-online.org
> http://www.radiance-online.org/mailman/listinfo/radiance-dev



From apian at pab.eu  Thu Apr 12 05:18:04 2012
From: apian at pab.eu (Peter Apian-Bennewitz)
Date: Thu, 12 Apr 2012 14:18:04 +0200
Subject: [Radiance-dev] BRDF website updated
Message-ID: <201204121218.q3CCIRqN021880@mta3.lbl.gov>

Hi folks,

quick note to those interested in BRDF/BSDF measured data:

The collection of BRDF data at 
http://www.pab.eu/gonio-photometer/demodata/bme/  got an updated set of 
visualisations of the out-of-plane data, using a newer version of my 
mountain tool. The new one is more quantitative, which should help 
getting the message to folks not so familiar with BRDFs. Feedback as to 
that aim is appreciated, on- or off-list.

For those newer on the list, here's last year's talk which mentions the 
bme data:  
http://www.pab-opto.de/radiance/vortrag_september_2011/brtf-talk-2011.web.pdf 


And while we're at it: Anyone actually used that data to motivate or 
test other BSDF models in Radiance (or other renderers) ?

thanks, best
Peter

-- 
pab advanced technologies Ltd, http://www.pab.eu



From gregoryjward at gmail.com  Fri Apr 13 16:28:51 2012
From: gregoryjward at gmail.com (Gregory J. Ward)
Date: Fri, 13 Apr 2012 16:28:51 -0700
Subject: [Radiance-dev] BRDF website updated
In-Reply-To: <201204121218.q3CCIRqN021880@mta3.lbl.gov>
References: <201204121218.q3CCIRqN021880@mta3.lbl.gov>
Message-ID: <03ED8D3D-030F-446E-A3E3-E90C045390F0@gmail.com>

Hi Peter,

We've been working on an interpolation method for filling in missing measurements in anisotropic data.  We currently need a certain number of incident angles to interpolate from, which is a bit limiting....

Cheers,
-Greg

> From: Peter Apian-Bennewitz <apian at pab.eu>
> Date: April 12, 2012 5:18:04 AM PDT
> 
> Hi folks,
> 
> quick note to those interested in BRDF/BSDF measured data:
> 
> The collection of BRDF data at http://www.pab.eu/gonio-photometer/demodata/bme/  got an updated set of visualisations of the out-of-plane data, using a newer version of my mountain tool. The new one is more quantitative, which should help getting the message to folks not so familiar with BRDFs. Feedback as to that aim is appreciated, on- or off-list.
> 
> For those newer on the list, here's last year's talk which mentions the bme data:  http://www.pab-opto.de/radiance/vortrag_september_2011/brtf-talk-2011.web.pdf 
> 
> And while we're at it: Anyone actually used that data to motivate or test other BSDF models in Radiance (or other renderers) ?
> 
> thanks, best
> Peter
> 
> -- 
> pab advanced technologies Ltd, http://www.pab.eu


From david.moroder at gmail.com  Mon Apr 23 05:48:29 2012
From: david.moroder at gmail.com (David Geisler-Moroder)
Date: Mon, 23 Apr 2012 14:48:29 +0200
Subject: [Radiance-dev] Error using BSDF material (ezxml.c)
Message-ID: <CAL-bo5FHUrvGn9wH-zKnuF0zhmSkbf7H6z62cne4YWB_chZAsg@mail.gmail.com>

Hi Greg, hi list,

I just wanted to use a BSDF material with an XML-file created by genBSDF,
but rvu throws the following error:

*rvu: fatal - File format error: BSDF "./test.xml" [error near line 1]:
root tag missing*

I could trace back the problem to line 499 in common/ezxml.c from where the
error
is returned:

* if (! *s) return ezxml_err(root, s, "root tag missing");*

The problematic call to the function *ezxml_parse_str* is the one in line
655. I checked
if using the else-branch there (i.e. "mmap failed, read file into memory")
solves the problem --
yes and no. The process throws other errors then:

*rvu: warning - Illegal argument: BSDF "test": unsupported
IncidentDataStructure for BSDF "tst"*
(for a Klems matrix BSDF)

*rvu: warning - Illegal argument for BSDF "test"*
(for a variable resolution BSDF isotropic and anisotropic)

The line numbers refer to the current head version...

Any clue what's going on here??

Cheers,
David
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-dev/attachments/20120423/8159f56a/attachment.html>

From gregoryjward at gmail.com  Tue Apr 24 08:39:54 2012
From: gregoryjward at gmail.com (Gregory J. Ward)
Date: Tue, 24 Apr 2012 08:39:54 -0700
Subject: [Radiance-dev] Error using BSDF material (ezxml.c)
In-Reply-To: <CAL-bo5EuixLmfnk6uStHifEEmuTDm6Y9OT-_SC6Z-ohyHeA+vg@mail.gmail.com>
References: <CAL-bo5FHUrvGn9wH-zKnuF0zhmSkbf7H6z62cne4YWB_chZAsg@mail.gmail.com>
	<13CD1EB7-F250-44DC-963D-B4D03960F5DF@gmail.com>
	<CAL-bo5EuixLmfnk6uStHifEEmuTDm6Y9OT-_SC6Z-ohyHeA+vg@mail.gmail.com>
Message-ID: <6D524669-7DF1-4F4D-A616-0E06BAD2E7B9@gmail.com>

Hi David,

Thanks for sharing your files.  The only problem I found was that your orientation vector was perpendicular to the plane of your BSDF.  The error I got was a fairly useless "Illegal argument" warning.  I just checked in a new version of src/rt/m_bsdf.c that offers a more accurate warning.

Meanwhile, try changing the orientation vector on your test BSDF to "0 1 0" or "1 0 0" so that it is in the plane of the surface and see if you still have problems.

Thanks for your help -- always appreciated!
-Greg

> From: David Geisler-Moroder <david.moroder at gmail.com>
> Date: April 24, 2012 12:30:47 AM PDT
> 
> Hi Greg,
> 
> I attached 4 BSDFs that I used yesterday:
> klems_old.xml: a Klems-Matrix BSDF that I generated last year 
> klems.xml: a test Klems-Matrix BSDF I generated yesterday with the latest head distribution
> tree_iso.xml: a test isotropic tensor tree BSDF I generated yesterday with the latest head distribution (-t3)
> tree_aniso.xml: a test anisotropic tensor tree BSDF I generated yesterday with the latest head distribution (-t4)
> 
> Running objview check.rad crashed with the described errors...
> 
> I used binaries that I compiled yesterday on a 32bit Ubuntu 10.04 LTS running in a Virtual Box
> [Linux version 2.6.32-31-generic (buildd at rothera) (gcc version 4.4.3 (Ubuntu 4.4.3-4ubuntu5) )].
> 
> Today in the morning I also tried running it on our compute server (64bit OpenSUSE):
> Linux version 2.6.37.6-0.11-desktop (geeko at buildhost) (gcc version 4.5.1 20101208 [gcc-4_5-branch revision 167585] (SUSE Linux) )
> The binaries there were compiled from the HEAD distribution of March 12.
> There the "root tag missing" error does not occur, but the other two do.
> 
> Hope that's of any help...
> 
> Best,
> David
> 
> 
> Am 23. April 2012 18:05 schrieb Gregory J. Ward <gregoryjward at gmail.com>:
> Hi David,
> 
> Thanks for reporting this error.  Can you send me the XML file that is giving you trouble?
> 
> What machine are you running on?
> 
> Cheers,
> -Greg
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-dev/attachments/20120424/1e083363/attachment.html>

From david.moroder at gmail.com  Tue Apr 24 13:02:52 2012
From: david.moroder at gmail.com (David Geisler-Moroder)
Date: Tue, 24 Apr 2012 22:02:52 +0200
Subject: [Radiance-dev] Error using BSDF material (ezxml.c)
In-Reply-To: <6D524669-7DF1-4F4D-A616-0E06BAD2E7B9@gmail.com>
References: <CAL-bo5FHUrvGn9wH-zKnuF0zhmSkbf7H6z62cne4YWB_chZAsg@mail.gmail.com>
	<13CD1EB7-F250-44DC-963D-B4D03960F5DF@gmail.com>
	<CAL-bo5EuixLmfnk6uStHifEEmuTDm6Y9OT-_SC6Z-ohyHeA+vg@mail.gmail.com>
	<6D524669-7DF1-4F4D-A616-0E06BAD2E7B9@gmail.com>
Message-ID: <CAL-bo5GfuqPjXYVgFai+Q=VR9-hz+guM+0Q_iko1RZoGPD6Duw@mail.gmail.com>

Hi Greg,

thanks for spotting my stupid mistake!!!
A corrected orientation vector solves the "illegal argument" problems and
thus everything
works fine on the OpenSuse machine.

However, the error "root tag missing" is still thrown at the Ubuntu
machine. I did not have
enough time today, but I'll try to compile the newest head
- on the OpenSuse machine (and check if it still works)
- on the Ubuntu machine using a newer version of gcc
tomorrow.

I'll get back to you when I have the results.

Cheers,
David

Am 24. April 2012 17:39 schrieb Gregory J. Ward <gregoryjward at gmail.com>:

> Hi David,
>
> Thanks for sharing your files.  The only problem I found was that your
> orientation vector was perpendicular to the plane of your BSDF.  The error
> I got was a fairly useless "Illegal argument" warning.  I just checked in a
> new version of src/rt/m_bsdf.c that offers a more accurate warning.
>
> Meanwhile, try changing the orientation vector on your test BSDF to "0 1
> 0" or "1 0 0" so that it is in the plane of the surface and see if you
> still have problems.
>
> Thanks for your help -- always appreciated!
> -Greg
>
> *From: *David Geisler-Moroder <david.moroder at gmail.com>
>
> *Date: *April 24, 2012 12:30:47 AM PDT
>
> *
> *
>
> Hi Greg,
>
> I attached 4 BSDFs that I used yesterday:
> klems_old.xml: a Klems-Matrix BSDF that I generated last year
> klems.xml: a test Klems-Matrix BSDF I generated yesterday with the latest
> head distribution
> tree_iso.xml: a test isotropic tensor tree BSDF I generated yesterday with
> the latest head distribution (-t3)
> tree_aniso.xml: a test anisotropic tensor tree BSDF I generated yesterday
> with the latest head distribution (-t4)
>
> Running objview check.rad crashed with the described errors...
>
> I used binaries that I compiled yesterday on a 32bit Ubuntu 10.04 LTS
> running in a Virtual Box
> [Linux version 2.6.32-31-generic (buildd at rothera) (gcc version 4.4.3
> (Ubuntu 4.4.3-4ubuntu5) )].
>
> Today in the morning I also tried running it on our compute server (64bit
> OpenSUSE):
> Linux version 2.6.37.6-0.11-desktop (geeko at buildhost) (gcc version 4.5.1
> 20101208 [gcc-4_5-branch revision 167585] (SUSE Linux) )
> The binaries there were compiled from the HEAD distribution of March 12.
> There the "*root tag missing*" error does not occur, but the other two do.
>
> Hope that's of any help...
>
> Best,
> David
>
>
> Am 23. April 2012 18:05 schrieb Gregory J. Ward <gregoryjward at gmail.com>:
>
>> Hi David,
>>
>> Thanks for reporting this error.  Can you send me the XML file that is
>> giving you trouble?
>>
>> What machine are you running on?
>>
>> Cheers,
>> -Greg
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-dev/attachments/20120424/b8fc2f2c/attachment.html>

From david.moroder at gmail.com  Wed Apr 25 02:19:29 2012
From: david.moroder at gmail.com (David Geisler-Moroder)
Date: Wed, 25 Apr 2012 11:19:29 +0200
Subject: [Radiance-dev] Error using BSDF material (ezxml.c)
In-Reply-To: <CAL-bo5GfuqPjXYVgFai+Q=VR9-hz+guM+0Q_iko1RZoGPD6Duw@mail.gmail.com>
References: <CAL-bo5FHUrvGn9wH-zKnuF0zhmSkbf7H6z62cne4YWB_chZAsg@mail.gmail.com>
	<13CD1EB7-F250-44DC-963D-B4D03960F5DF@gmail.com>
	<CAL-bo5EuixLmfnk6uStHifEEmuTDm6Y9OT-_SC6Z-ohyHeA+vg@mail.gmail.com>
	<6D524669-7DF1-4F4D-A616-0E06BAD2E7B9@gmail.com>
	<CAL-bo5GfuqPjXYVgFai+Q=VR9-hz+guM+0Q_iko1RZoGPD6Duw@mail.gmail.com>
Message-ID: <CAL-bo5FwVRWMeZi4ho1ja8OH27i-+6Cu86FiC0dx1k8GMLNUow@mail.gmail.com>

Hi Greg,

new/old head versions and different gcc versions do not matter.

The difference is still between 32bit and 64bit.
Printing out the pointer adress and first char before line 498 in ezxml.c
*
        fprintf(stderr, " s = %p\n", s);
        fprintf(stderr, " s[0] = %c\n", s[0]);
498   while (*s && *s != '<') s++; /* find first tag */
*
yields:
(on 32bit):*
 s = 0xb76fe000
 s[0] =
*(on 64bit):*
 s = 0x7f1179377000
 s[0] = <
*
It seems that the contents of the XML-File are not parsed correctly on the
32bit system.

Maybe you have some idea what/where the problem could be?

Best,
David


Am 24. April 2012 22:02 schrieb David Geisler-Moroder <
david.moroder at gmail.com>:

> Hi Greg,
>
> thanks for spotting my stupid mistake!!!
> A corrected orientation vector solves the "illegal argument" problems and
> thus everything
> works fine on the OpenSuse machine.
>
> However, the error "root tag missing" is still thrown at the Ubuntu
> machine. I did not have
> enough time today, but I'll try to compile the newest head
> - on the OpenSuse machine (and check if it still works)
> - on the Ubuntu machine using a newer version of gcc
> tomorrow.
>
> I'll get back to you when I have the results.
>
> Cheers,
> David
>
> Am 24. April 2012 17:39 schrieb Gregory J. Ward <gregoryjward at gmail.com>:
>
> Hi David,
>>
>> Thanks for sharing your files.  The only problem I found was that your
>> orientation vector was perpendicular to the plane of your BSDF.  The error
>> I got was a fairly useless "Illegal argument" warning.  I just checked in a
>> new version of src/rt/m_bsdf.c that offers a more accurate warning.
>>
>> Meanwhile, try changing the orientation vector on your test BSDF to "0 1
>> 0" or "1 0 0" so that it is in the plane of the surface and see if you
>> still have problems.
>>
>> Thanks for your help -- always appreciated!
>> -Greg
>>
>> *From: *David Geisler-Moroder <david.moroder at gmail.com>
>>
>> *Date: *April 24, 2012 12:30:47 AM PDT
>>
>> *
>> *
>>
>> Hi Greg,
>>
>> I attached 4 BSDFs that I used yesterday:
>> klems_old.xml: a Klems-Matrix BSDF that I generated last year
>> klems.xml: a test Klems-Matrix BSDF I generated yesterday with the latest
>> head distribution
>> tree_iso.xml: a test isotropic tensor tree BSDF I generated yesterday
>> with the latest head distribution (-t3)
>> tree_aniso.xml: a test anisotropic tensor tree BSDF I generated yesterday
>> with the latest head distribution (-t4)
>>
>> Running objview check.rad crashed with the described errors...
>>
>> I used binaries that I compiled yesterday on a 32bit Ubuntu 10.04 LTS
>> running in a Virtual Box
>> [Linux version 2.6.32-31-generic (buildd at rothera) (gcc version 4.4.3
>> (Ubuntu 4.4.3-4ubuntu5) )].
>>
>> Today in the morning I also tried running it on our compute server (64bit
>> OpenSUSE):
>> Linux version 2.6.37.6-0.11-desktop (geeko at buildhost) (gcc version 4.5.1
>> 20101208 [gcc-4_5-branch revision 167585] (SUSE Linux) )
>> The binaries there were compiled from the HEAD distribution of March 12.
>> There the "*root tag missing*" error does not occur, but the other two
>> do.
>>
>> Hope that's of any help...
>>
>> Best,
>> David
>>
>>
>> Am 23. April 2012 18:05 schrieb Gregory J. Ward <gregoryjward at gmail.com>:
>>
>>> Hi David,
>>>
>>> Thanks for reporting this error.  Can you send me the XML file that is
>>> giving you trouble?
>>>
>>> What machine are you running on?
>>>
>>> Cheers,
>>> -Greg
>>>
>>
>>
>
>
>


-- 
DI Dr. David Geisler-Moroder
Hofwaldweg 14/20
6020 Innsbruck
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-dev/attachments/20120425/0e17701d/attachment.html>

From gregoryjward at gmail.com  Wed Apr 25 08:50:12 2012
From: gregoryjward at gmail.com (Gregory J. Ward)
Date: Wed, 25 Apr 2012 08:50:12 -0700
Subject: [Radiance-dev] Error using BSDF material (ezxml.c)
In-Reply-To: <CAL-bo5FwVRWMeZi4ho1ja8OH27i-+6Cu86FiC0dx1k8GMLNUow@mail.gmail.com>
References: <CAL-bo5FHUrvGn9wH-zKnuF0zhmSkbf7H6z62cne4YWB_chZAsg@mail.gmail.com>
	<13CD1EB7-F250-44DC-963D-B4D03960F5DF@gmail.com>
	<CAL-bo5EuixLmfnk6uStHifEEmuTDm6Y9OT-_SC6Z-ohyHeA+vg@mail.gmail.com>
	<6D524669-7DF1-4F4D-A616-0E06BAD2E7B9@gmail.com>
	<CAL-bo5GfuqPjXYVgFai+Q=VR9-hz+guM+0Q_iko1RZoGPD6Duw@mail.gmail.com>
	<CAL-bo5FwVRWMeZi4ho1ja8OH27i-+6Cu86FiC0dx1k8GMLNUow@mail.gmail.com>
Message-ID: <9541D400-0962-4681-A226-0A7B657FB765@gmail.com>

Hi David,

I have no idea what's going wrong.  You did a test before where you forced the program to take the "else" clause to avoid mmap(), and ended up with a different set of errors.  Do you not get those errors when you pass the same BSDF through the 64-bit version?  This is puzzling to me.

The fact that mmap() is not returning the file contents in 32-bit mode is very disturbing.  This sounds like a header issue, but I have no way to debug it without downloading and installing ubuntu on a virtual machine.  You could try commenting out the madvise() calls, not that I expect it to make a difference...  

Avoiding the mmap() call should fix the problem, so it's worth trying that again.

Cheers,
-Greg

> From: David Geisler-Moroder <david.moroder at gmail.com>
> Date: April 25, 2012 2:19:29 AM PDT
> 
> Hi Greg,
> 
> new/old head versions and different gcc versions do not matter.
> 
> The difference is still between 32bit and 64bit.
> Printing out the pointer adress and first char before line 498 in ezxml.c 
> 
>         fprintf(stderr, " s = %p\n", s); 
>         fprintf(stderr, " s[0] = %c\n", s[0]); 
> 498   while (*s && *s != '<') s++; /* find first tag */
> 
> yields:
> (on 32bit):
>  s = 0xb76fe000
>  s[0] = 
> (on 64bit):
>  s = 0x7f1179377000
>  s[0] = <
> 
> It seems that the contents of the XML-File are not parsed correctly on the 32bit system.
> 
> Maybe you have some idea what/where the problem could be?
> 
> Best,
> David
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-dev/attachments/20120425/51faddb9/attachment-0001.html>

From david.moroder at gmail.com  Wed Apr 25 09:30:32 2012
From: david.moroder at gmail.com (David Geisler-Moroder)
Date: Wed, 25 Apr 2012 18:30:32 +0200
Subject: [Radiance-dev] Error using BSDF material (ezxml.c)
In-Reply-To: <9541D400-0962-4681-A226-0A7B657FB765@gmail.com>
References: <CAL-bo5FHUrvGn9wH-zKnuF0zhmSkbf7H6z62cne4YWB_chZAsg@mail.gmail.com>
	<13CD1EB7-F250-44DC-963D-B4D03960F5DF@gmail.com>
	<CAL-bo5EuixLmfnk6uStHifEEmuTDm6Y9OT-_SC6Z-ohyHeA+vg@mail.gmail.com>
	<6D524669-7DF1-4F4D-A616-0E06BAD2E7B9@gmail.com>
	<CAL-bo5GfuqPjXYVgFai+Q=VR9-hz+guM+0Q_iko1RZoGPD6Duw@mail.gmail.com>
	<CAL-bo5FwVRWMeZi4ho1ja8OH27i-+6Cu86FiC0dx1k8GMLNUow@mail.gmail.com>
	<9541D400-0962-4681-A226-0A7B657FB765@gmail.com>
Message-ID: <CAL-bo5G7mxDDAd7AGxraF0ps-W738RhueRExatN57qZQn55EQA@mail.gmail.com>

Hi Greg,

the other set of errors was only related to the wrong orientation vector
specified for the BSDF material.
So the only difference that is really there is the one related to mmap().

I also thought about avoiding mmap() on the 32bit machine. For Cygwin this
is done similarly in
common/ezxml.h by defining EZXML_NOMMAP. Maybe that's the best solution for
now.

Thanks for your help!

Cheers,
David



Am 25. April 2012 17:50 schrieb Gregory J. Ward <gregoryjward at gmail.com>:

> Hi David,
>
> I have no idea what's going wrong.  You did a test before where you forced
> the program to take the "else" clause to avoid mmap(), and ended up with a
> different set of errors.  Do you not get those errors when you pass the
> same BSDF through the 64-bit version?  This is puzzling to me.
>
> The fact that mmap() is not returning the file contents in 32-bit mode is
> very disturbing.  This sounds like a header issue, but I have no way to
> debug it without downloading and installing ubuntu on a virtual machine.
>  You could try commenting out the madvise() calls, not that I expect it to
> make a difference...
>
> Avoiding the mmap() call should fix the problem, so it's worth trying that
> again.
>
> Cheers,
> -Greg
>
> *From: *David Geisler-Moroder <david.moroder at gmail.com>
>
> *Date: *April 25, 2012 2:19:29 AM PDT
>
> *
> *
>
> Hi Greg,
>
> new/old head versions and different gcc versions do not matter.
>
> The difference is still between 32bit and 64bit.
> Printing out the pointer adress and first char before line 498 in ezxml.c
> *
>         fprintf(stderr, " s = %p\n", s);
>         fprintf(stderr, " s[0] = %c\n", s[0]);
> 498   while (*s && *s != '<') s++; /* find first tag */
> *
> yields:
> (on 32bit):*
>  s = 0xb76fe000
>  s[0] =
> *(on 64bit):*
>  s = 0x7f1179377000
>  s[0] = <
> *
> It seems that the contents of the XML-File are not parsed correctly on the
> 32bit system.
>
> Maybe you have some idea what/where the problem could be?
>
> Best,
> David
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-dev/attachments/20120425/572d7d54/attachment.html>

From gregoryjward at gmail.com  Wed Apr 25 10:29:57 2012
From: gregoryjward at gmail.com (Gregory J. Ward)
Date: Wed, 25 Apr 2012 10:29:57 -0700
Subject: [Radiance-dev] Error using BSDF material (ezxml.c)
In-Reply-To: <CAL-bo5G7mxDDAd7AGxraF0ps-W738RhueRExatN57qZQn55EQA@mail.gmail.com>
References: <CAL-bo5FHUrvGn9wH-zKnuF0zhmSkbf7H6z62cne4YWB_chZAsg@mail.gmail.com>
	<13CD1EB7-F250-44DC-963D-B4D03960F5DF@gmail.com>
	<CAL-bo5EuixLmfnk6uStHifEEmuTDm6Y9OT-_SC6Z-ohyHeA+vg@mail.gmail.com>
	<6D524669-7DF1-4F4D-A616-0E06BAD2E7B9@gmail.com>
	<CAL-bo5GfuqPjXYVgFai+Q=VR9-hz+guM+0Q_iko1RZoGPD6Duw@mail.gmail.com>
	<CAL-bo5FwVRWMeZi4ho1ja8OH27i-+6Cu86FiC0dx1k8GMLNUow@mail.gmail.com>
	<9541D400-0962-4681-A226-0A7B657FB765@gmail.com>
	<CAL-bo5G7mxDDAd7AGxraF0ps-W738RhueRExatN57qZQn55EQA@mail.gmail.com>
Message-ID: <4E7BF85F-F2D1-4067-BC85-F9B73C3A75D5@gmail.com>

Hi David,

I tend to agree that the easiest fix is to take out the mmap() call for your system.  We should log a bug to the Ubuntu developers, though.

You can put a -DEZXML_NOMMAP option in your rmake if you don't want to mess with the header.

Best,
-Greg

> From: David Geisler-Moroder <david.moroder at gmail.com>
> Date: April 25, 2012 9:30:32 AM PDT
> 
> Hi Greg,
> 
> the other set of errors was only related to the wrong orientation vector specified for the BSDF material. 
> So the only difference that is really there is the one related to mmap().
> 
> I also thought about avoiding mmap() on the 32bit machine. For Cygwin this is done similarly in 
> common/ezxml.h by defining EZXML_NOMMAP. Maybe that's the best solution for now. 
> 
> Thanks for your help!
> 
> Cheers,
> David
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-dev/attachments/20120425/3a4a8a07/attachment.html>

From david.moroder at gmail.com  Wed Apr 25 23:28:47 2012
From: david.moroder at gmail.com (David Geisler-Moroder)
Date: Thu, 26 Apr 2012 08:28:47 +0200
Subject: [Radiance-dev] Error using BSDF material (ezxml.c)
In-Reply-To: <4E7BF85F-F2D1-4067-BC85-F9B73C3A75D5@gmail.com>
References: <CAL-bo5FHUrvGn9wH-zKnuF0zhmSkbf7H6z62cne4YWB_chZAsg@mail.gmail.com>
	<13CD1EB7-F250-44DC-963D-B4D03960F5DF@gmail.com>
	<CAL-bo5EuixLmfnk6uStHifEEmuTDm6Y9OT-_SC6Z-ohyHeA+vg@mail.gmail.com>
	<6D524669-7DF1-4F4D-A616-0E06BAD2E7B9@gmail.com>
	<CAL-bo5GfuqPjXYVgFai+Q=VR9-hz+guM+0Q_iko1RZoGPD6Duw@mail.gmail.com>
	<CAL-bo5FwVRWMeZi4ho1ja8OH27i-+6Cu86FiC0dx1k8GMLNUow@mail.gmail.com>
	<9541D400-0962-4681-A226-0A7B657FB765@gmail.com>
	<CAL-bo5G7mxDDAd7AGxraF0ps-W738RhueRExatN57qZQn55EQA@mail.gmail.com>
	<4E7BF85F-F2D1-4067-BC85-F9B73C3A75D5@gmail.com>
Message-ID: <CAL-bo5EdT2rHr_MyHWw7nO3TnCTp5Ot=zT2HGGW2uUngh1DFQQ@mail.gmail.com>

Hi Greg,

I recompiled the head with the NOMMAP define and everything works fine now.
Thanks again for all your help!!

By the way, I just ran the same rvu-command using the 32bit Windows
binaries provided
by NREL on
http://openstudio.nrel.gov/getting-started-developer/getting-started-radiance
(Rob G. - thanks a lot for offering those!!) -- no problems there as well.

Cheers,
David

Am 25. April 2012 19:29 schrieb Gregory J. Ward <gregoryjward at gmail.com>:

> Hi David,
>
> I tend to agree that the easiest fix is to take out the mmap() call for
> your system.  We should log a bug to the Ubuntu developers, though.
>
> You can put a -DEZXML_NOMMAP option in your rmake if you don't want to
> mess with the header.
>
> Best,
> -Greg
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-dev/attachments/20120426/35095c35/attachment.html>

From gregoryjward at gmail.com  Thu Apr 26 07:21:23 2012
From: gregoryjward at gmail.com (Gregory J. Ward)
Date: Thu, 26 Apr 2012 07:21:23 -0700
Subject: [Radiance-dev] Error using BSDF material (ezxml.c)
In-Reply-To: <CAL-bo5EdT2rHr_MyHWw7nO3TnCTp5Ot=zT2HGGW2uUngh1DFQQ@mail.gmail.com>
References: <CAL-bo5FHUrvGn9wH-zKnuF0zhmSkbf7H6z62cne4YWB_chZAsg@mail.gmail.com>
	<13CD1EB7-F250-44DC-963D-B4D03960F5DF@gmail.com>
	<CAL-bo5EuixLmfnk6uStHifEEmuTDm6Y9OT-_SC6Z-ohyHeA+vg@mail.gmail.com>
	<6D524669-7DF1-4F4D-A616-0E06BAD2E7B9@gmail.com>
	<CAL-bo5GfuqPjXYVgFai+Q=VR9-hz+guM+0Q_iko1RZoGPD6Duw@mail.gmail.com>
	<CAL-bo5FwVRWMeZi4ho1ja8OH27i-+6Cu86FiC0dx1k8GMLNUow@mail.gmail.com>
	<9541D400-0962-4681-A226-0A7B657FB765@gmail.com>
	<CAL-bo5G7mxDDAd7AGxraF0ps-W738RhueRExatN57qZQn55EQA@mail.gmail.com>
	<4E7BF85F-F2D1-4067-BC85-F9B73C3A75D5@gmail.com>
	<CAL-bo5EdT2rHr_MyHWw7nO3TnCTp5Ot=zT2HGGW2uUngh1DFQQ@mail.gmail.com>
Message-ID: <37060127-1C0A-4D60-AF78-5084580A7F1B@gmail.com>

Hi David,

I'm pretty sure the guys who developed the build system for NREL didn't use the NOMMAP #define, so must be their system doesn't have whatever header issues yours is running afoul of in 32-bit mode.

Thanks for the update -- glad it's working for you now!

Cheers,
-Greg

P.S.  A side note on ezxml is that I found a problem after the 4.1 release that caused very long XML files with DOS eol (CR-LF) to be impossibly slow to load.  This is fixed in the latest HEAD, which NREL is using.

> From: David Geisler-Moroder <david.moroder at gmail.com>
> Date: April 25, 2012 11:28:47 PM PDT
> 
> Hi Greg,
> 
> I recompiled the head with the NOMMAP define and everything works fine now.
> Thanks again for all your help!!
> 
> By the way, I just ran the same rvu-command using the 32bit Windows binaries provided 
> by NREL on http://openstudio.nrel.gov/getting-started-developer/getting-started-radiance
> (Rob G. - thanks a lot for offering those!!) -- no problems there as well.
> 
> Cheers,
> David
> 
> Am 25. April 2012 19:29 schrieb Gregory J. Ward <gregoryjward at gmail.com>:
> Hi David,
> 
> I tend to agree that the easiest fix is to take out the mmap() call for your system.  We should log a bug to the Ubuntu developers, though.
> 
> You can put a -DEZXML_NOMMAP option in your rmake if you don't want to mess with the header.
> 
> Best,
> -Greg
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-dev/attachments/20120426/7bd69192/attachment.html>

From Robert.Guglielmetti at nrel.gov  Thu Apr 26 07:37:33 2012
From: Robert.Guglielmetti at nrel.gov (Guglielmetti, Robert)
Date: Thu, 26 Apr 2012 08:37:33 -0600
Subject: [Radiance-dev] Error using BSDF material (ezxml.c)
In-Reply-To: <CAL-bo5EdT2rHr_MyHWw7nO3TnCTp5Ot=zT2HGGW2uUngh1DFQQ@mail.gmail.com>
Message-ID: <CBBEB95F.FF4B%robert.guglielmetti@nrel.gov>


By the way, I just ran the same rvu-command using the 32bit Windows binaries provided
by NREL on http://openstudio.nrel.gov/getting-started-developer/getting-started-radiance
(Rob G. - thanks a lot for offering those!!) -- no problems there as well.

Thank DOE and the Bonneville Power Authority for funding the work! Greg just merged all the changes we've made to get Radiance reliably building on all platforms with CMake, and I hope to post updated packages today.  =)


From david.moroder at gmail.com  Mon Apr 30 05:35:36 2012
From: david.moroder at gmail.com (David Geisler-Moroder)
Date: Mon, 30 Apr 2012 14:35:36 +0200
Subject: [Radiance-dev] mgf2inv VRML export
Message-ID: <CAL-bo5Gtg=YfhQEm_MGCWj6hsuk8keFzsHcuMoqEq5__TRx8kg@mail.gmail.com>

Hi Greg, hi list,

from time to time I am using mgf2inv with the "-vrml" option to export and
view my models.

This time I wanted to do the conversion with rad2mgf and mgf2inv -vrml on
Windows using the
NREL binaries. However, the resulting files are corrupt due to bad number
representations and
normal descriptions.

For example the description of a face in the VRML-file created with the
Linux binaries is:*

DEF ceil_fac_001 Group {
  Separator {
    USE ceil_mat
    Coordinate3 {
      point [ -2.000000000e+00 +4.500000000e+00 +2.162119874e+00,
              -1.500000000e+00 +4.500000000e+00 +3.000000000e+00,
              -1.500000000e+00 +5.000000000e+00 +1.461123454e+00,
              -2.000000000e+00 +5.000000000e+00 +6.232433278e-01 ]
    }
    IndexedFaceSet {
      coordIndex [ 0, 1, 2, 3 ]
    }
  }
}
*

In the files created with the Windows version the same face is described as:
*
DEF ceil_fac_001 Group {
  Separator {
    USE ceil_mat
    Coordinate3 {
      point [ -2.000000000e+000 +4.500000000e+000 +2.162119874e+,
              -1.500000000e+000 +4.500000000e+000 +3.000000000e+,
              -1.500000000e+000 +5.000000000e+000 +1.461123454e+,
              -2.000000000e+000 +5.000000000e+000 +6.232433278e- ]
    }
    Normal {
      vector [ 00
+0.000 +0.000 +0.0-1.500000000e+000 +4.500000000e+000 +3.000000000e+,
               00
+0.000 +0.000 +0.0-1.500000000e+000 +5.000000000e+000 +1.461123454e+,
               00
+0.000 +0.000 +0.0-2.000000000e+000 +5.000000000e+000 +6.232433278e-,
               01
+0.000 +0.000 +0.000 ]
    }
    IndexedFaceSet {
      coordIndex [ 0, 1, 2, 3 ]
      normalIndex [ 0, 1, 2, 3 ]
    }
  }
}


*Obviously, two things are corrupt:
- the z-coordinates are missing their exponents
- the normal vector coordinates are messed up

Moreover, for me it's unclear why normal vectors are written (needed ??) in
the Windows version, while
they are completely missing in the Linux version.

I believe that all this has something to do with de definition of VERTFMT
in src/cv/mgf2inv.c
*#define VERTFMT        "%+16.9e %+16.9e %+16.9e\n%+6.3f %+6.3f %+6.3f"*

Any ideas how to solve that for both platforms??

Cheers,
David
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-dev/attachments/20120430/36f3ddbe/attachment.html>

From Robert.Guglielmetti at nrel.gov  Mon Apr 30 08:41:17 2012
From: Robert.Guglielmetti at nrel.gov (Guglielmetti, Robert)
Date: Mon, 30 Apr 2012 09:41:17 -0600
Subject: [Radiance-dev] mgf2inv VRML export
In-Reply-To: <CAL-bo5Gtg=YfhQEm_MGCWj6hsuk8keFzsHcuMoqEq5__TRx8kg@mail.gmail.com>
Message-ID: <CBC40E2E.104FE%robert.guglielmetti@nrel.gov>

Hi David,

AFAIK, the sources for those two programs were not touched in the Windows binary project. I don't fully understand the behavior of this program right now. I will check with Kitware to see if any changes were in fact made to that source in order to get it to work on Windows.

Rob Guglielmetti  IESNA, LEED AP
Commercial Buildings Research Group
National Renewable Energy Laboratory
15013 Denver West Parkway MS:RSF202
Golden, CO 80401
303.275.4319
robert.guglielmetti at nrel.gov


On 4/30/12 6:35 AM, "David Geisler-Moroder" <david.moroder at gmail.com<mailto:david.moroder at gmail.com>> wrote:

Hi Greg, hi list,

from time to time I am using mgf2inv with the "-vrml" option to export and view my models.

This time I wanted to do the conversion with rad2mgf and mgf2inv -vrml on Windows using the
NREL binaries. However, the resulting files are corrupt due to bad number representations and
normal descriptions.

For example the description of a face in the VRML-file created with the Linux binaries is:

DEF ceil_fac_001 Group {
  Separator {
    USE ceil_mat
    Coordinate3 {
      point [ -2.000000000e+00 +4.500000000e+00 +2.162119874e+00,
              -1.500000000e+00 +4.500000000e+00 +3.000000000e+00,
              -1.500000000e+00 +5.000000000e+00 +1.461123454e+00,
              -2.000000000e+00 +5.000000000e+00 +6.232433278e-01 ]
    }
    IndexedFaceSet {
      coordIndex [ 0, 1, 2, 3 ]
    }
  }
}


In the files created with the Windows version the same face is described as:

DEF ceil_fac_001 Group {
  Separator {
    USE ceil_mat
    Coordinate3 {
      point [ -2.000000000e+000 +4.500000000e+000 +2.162119874e+,
              -1.500000000e+000 +4.500000000e+000 +3.000000000e+,
              -1.500000000e+000 +5.000000000e+000 +1.461123454e+,
              -2.000000000e+000 +5.000000000e+000 +6.232433278e- ]
    }
    Normal {
      vector [ 00
+0.000 +0.000 +0.0-1.500000000e+000 +4.500000000e+000 +3.000000000e+,
               00
+0.000 +0.000 +0.0-1.500000000e+000 +5.000000000e+000 +1.461123454e+,
               00
+0.000 +0.000 +0.0-2.000000000e+000 +5.000000000e+000 +6.232433278e-,
               01
+0.000 +0.000 +0.000 ]
    }
    IndexedFaceSet {
      coordIndex [ 0, 1, 2, 3 ]
      normalIndex [ 0, 1, 2, 3 ]
    }
  }
}


Obviously, two things are corrupt:
- the z-coordinates are missing their exponents
- the normal vector coordinates are messed up

Moreover, for me it's unclear why normal vectors are written (needed ??) in the Windows version, while
they are completely missing in the Linux version.

I believe that all this has something to do with de definition of VERTFMT in src/cv/mgf2inv.c
#define VERTFMT        "%+16.9e %+16.9e %+16.9e\n%+6.3f %+6.3f %+6.3f"

Any ideas how to solve that for both platforms??

Cheers,
David




From gregoryjward at gmail.com  Mon Apr 30 09:57:46 2012
From: gregoryjward at gmail.com (Gregory J. Ward)
Date: Mon, 30 Apr 2012 09:57:46 -0700
Subject: [Radiance-dev] mgf2inv VRML export
In-Reply-To: <CBC40E2E.104FE%robert.guglielmetti@nrel.gov>
References: <CBC40E2E.104FE%robert.guglielmetti@nrel.gov>
Message-ID: <DB6CAFEE-ACD0-4E4D-BC90-FCADFF41B3EC@gmail.com>

Hi David,

I found the problem, and can figure out how to fix it.  The code assumes that exponents have two digits only, which is still true on most Unix machines.  I guess they're making room for "long double's" (128-bit IEEE float) and don't have different code for that than the "regular" doubles.

I will check in a fix later today -- thanks so much for spotting this.

Cheers,
-Greg

> From: "Guglielmetti, Robert" <Robert.Guglielmetti at nrel.gov>
> Date: April 30, 2012 8:41:17 AM PDT
> 
> Hi David,
> 
> AFAIK, the sources for those two programs were not touched in the Windows binary project. I don't fully understand the behavior of this program right now. I will check with Kitware to see if any changes were in fact made to that source in order to get it to work on Windows.
> 
> Rob Guglielmetti  IESNA, LEED AP
> 
> 
> On 4/30/12 6:35 AM, "David Geisler-Moroder" <david.moroder at gmail.com<mailto:david.moroder at gmail.com>> wrote:
> 
> Hi Greg, hi list,
> 
> from time to time I am using mgf2inv with the "-vrml" option to export and view my models.
> 
> This time I wanted to do the conversion with rad2mgf and mgf2inv -vrml on Windows using the
> NREL binaries. However, the resulting files are corrupt due to bad number representations and
> normal descriptions.
> 
> For example the description of a face in the VRML-file created with the Linux binaries is:
> 
> DEF ceil_fac_001 Group {
>  Separator {
>    USE ceil_mat
>    Coordinate3 {
>      point [ -2.000000000e+00 +4.500000000e+00 +2.162119874e+00,
>              -1.500000000e+00 +4.500000000e+00 +3.000000000e+00,
>              -1.500000000e+00 +5.000000000e+00 +1.461123454e+00,
>              -2.000000000e+00 +5.000000000e+00 +6.232433278e-01 ]
>    }
>    IndexedFaceSet {
>      coordIndex [ 0, 1, 2, 3 ]
>    }
>  }
> }
> 
> 
> In the files created with the Windows version the same face is described as:
> 
> DEF ceil_fac_001 Group {
>  Separator {
>    USE ceil_mat
>    Coordinate3 {
>      point [ -2.000000000e+000 +4.500000000e+000 +2.162119874e+,
>              -1.500000000e+000 +4.500000000e+000 +3.000000000e+,
>              -1.500000000e+000 +5.000000000e+000 +1.461123454e+,
>              -2.000000000e+000 +5.000000000e+000 +6.232433278e- ]
>    }
>    Normal {
>      vector [ 00
> +0.000 +0.000 +0.0-1.500000000e+000 +4.500000000e+000 +3.000000000e+,
>               00
> +0.000 +0.000 +0.0-1.500000000e+000 +5.000000000e+000 +1.461123454e+,
>               00
> +0.000 +0.000 +0.0-2.000000000e+000 +5.000000000e+000 +6.232433278e-,
>               01
> +0.000 +0.000 +0.000 ]
>    }
>    IndexedFaceSet {
>      coordIndex [ 0, 1, 2, 3 ]
>      normalIndex [ 0, 1, 2, 3 ]
>    }
>  }
> }
> 
> 
> Obviously, two things are corrupt:
> - the z-coordinates are missing their exponents
> - the normal vector coordinates are messed up
> 
> Moreover, for me it's unclear why normal vectors are written (needed ??) in the Windows version, while
> they are completely missing in the Linux version.
> 
> I believe that all this has something to do with de definition of VERTFMT in src/cv/mgf2inv.c
> #define VERTFMT        "%+16.9e %+16.9e %+16.9e\n%+6.3f %+6.3f %+6.3f"
> 
> Any ideas how to solve that for both platforms??
> 
> Cheers,
> David


From david.moroder at gmail.com  Mon Apr 30 13:11:10 2012
From: david.moroder at gmail.com (David Geisler-Moroder)
Date: Mon, 30 Apr 2012 22:11:10 +0200
Subject: [Radiance-dev] mgf2inv VRML export
In-Reply-To: <DB6CAFEE-ACD0-4E4D-BC90-FCADFF41B3EC@gmail.com>
References: <CBC40E2E.104FE%robert.guglielmetti@nrel.gov>
	<DB6CAFEE-ACD0-4E4D-BC90-FCADFF41B3EC@gmail.com>
Message-ID: <CAL-bo5F+eJghh=5x4=itNB2+JGOODSfA-dfS698LvtvWJYncbA@mail.gmail.com>

Hi Greg, Rob,

thanks a lot for the quick responses and for the fix!

However, I need to wait for the new NREL-binaries to use the fixed version
(or maybe finally step into the CMake thing to get the Windows bins
compiled by myself... ;-) ).

Cheers,
David

2012/4/30 Gregory J. Ward <gregoryjward at gmail.com>

> Hi David,
>
> I found the problem, and can figure out how to fix it.  The code assumes
> that exponents have two digits only, which is still true on most Unix
> machines.  I guess they're making room for "long double's" (128-bit IEEE
> float) and don't have different code for that than the "regular" doubles.
>
> I will check in a fix later today -- thanks so much for spotting this.
>
> Cheers,
> -Greg
>
> > From: "Guglielmetti, Robert" <Robert.Guglielmetti at nrel.gov>
> > Date: April 30, 2012 8:41:17 AM PDT
> >
> > Hi David,
> >
> > AFAIK, the sources for those two programs were not touched in the
> Windows binary project. I don't fully understand the behavior of this
> program right now. I will check with Kitware to see if any changes were in
> fact made to that source in order to get it to work on Windows.
> >
> > Rob Guglielmetti  IESNA, LEED AP
> >
> >
> > On 4/30/12 6:35 AM, "David Geisler-Moroder" <david.moroder at gmail.com
> <mailto:david.moroder at gmail.com>> wrote:
> >
> > Hi Greg, hi list,
> >
> > from time to time I am using mgf2inv with the "-vrml" option to export
> and view my models.
> >
> > This time I wanted to do the conversion with rad2mgf and mgf2inv -vrml
> on Windows using the
> > NREL binaries. However, the resulting files are corrupt due to bad
> number representations and
> > normal descriptions.
> >
> > For example the description of a face in the VRML-file created with the
> Linux binaries is:
> >
> > DEF ceil_fac_001 Group {
> >  Separator {
> >    USE ceil_mat
> >    Coordinate3 {
> >      point [ -2.000000000e+00 +4.500000000e+00 +2.162119874e+00,
> >              -1.500000000e+00 +4.500000000e+00 +3.000000000e+00,
> >              -1.500000000e+00 +5.000000000e+00 +1.461123454e+00,
> >              -2.000000000e+00 +5.000000000e+00 +6.232433278e-01 ]
> >    }
> >    IndexedFaceSet {
> >      coordIndex [ 0, 1, 2, 3 ]
> >    }
> >  }
> > }
> >
> >
> > In the files created with the Windows version the same face is described
> as:
> >
> > DEF ceil_fac_001 Group {
> >  Separator {
> >    USE ceil_mat
> >    Coordinate3 {
> >      point [ -2.000000000e+000 +4.500000000e+000 +2.162119874e+,
> >              -1.500000000e+000 +4.500000000e+000 +3.000000000e+,
> >              -1.500000000e+000 +5.000000000e+000 +1.461123454e+,
> >              -2.000000000e+000 +5.000000000e+000 +6.232433278e- ]
> >    }
> >    Normal {
> >      vector [ 00
> > +0.000 +0.000 +0.0-1.500000000e+000 +4.500000000e+000 +3.000000000e+,
> >               00
> > +0.000 +0.000 +0.0-1.500000000e+000 +5.000000000e+000 +1.461123454e+,
> >               00
> > +0.000 +0.000 +0.0-2.000000000e+000 +5.000000000e+000 +6.232433278e-,
> >               01
> > +0.000 +0.000 +0.000 ]
> >    }
> >    IndexedFaceSet {
> >      coordIndex [ 0, 1, 2, 3 ]
> >      normalIndex [ 0, 1, 2, 3 ]
> >    }
> >  }
> > }
> >
> >
> > Obviously, two things are corrupt:
> > - the z-coordinates are missing their exponents
> > - the normal vector coordinates are messed up
> >
> > Moreover, for me it's unclear why normal vectors are written (needed ??)
> in the Windows version, while
> > they are completely missing in the Linux version.
> >
> > I believe that all this has something to do with de definition of
> VERTFMT in src/cv/mgf2inv.c
> > #define VERTFMT        "%+16.9e %+16.9e %+16.9e\n%+6.3f %+6.3f %+6.3f"
> >
> > Any ideas how to solve that for both platforms??
> >
> > Cheers,
> > David
>
> _______________________________________________
> Radiance-dev mailing list
> Radiance-dev at radiance-online.org
> http://www.radiance-online.org/mailman/listinfo/radiance-dev
>



-- 
DI Dr. David Geisler-Moroder
Hofwaldweg 14/20
6020 Innsbruck
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-dev/attachments/20120430/6f76fbec/attachment.html>

From Robert.Guglielmetti at nrel.gov  Mon Apr 30 14:27:09 2012
From: Robert.Guglielmetti at nrel.gov (Guglielmetti, Robert)
Date: Mon, 30 Apr 2012 15:27:09 -0600
Subject: [Radiance-dev] mgf2inv VRML export
In-Reply-To: <CAL-bo5F+eJghh=5x4=itNB2+JGOODSfA-dfS698LvtvWJYncbA@mail.gmail.com>
Message-ID: <CBC45F59.1056C%robert.guglielmetti@nrel.gov>

Hi David,

I am trying to sort out two other issues with the Windows binaries, but I can push out a new Windows installer tomorrow morning for you with this fix. We can talk offline if you want to talk about getting up and running with CMake, too.

Rob Guglielmetti  IESNA, LEED AP
Commercial Buildings Research Group
National Renewable Energy Laboratory
15013 Denver West Parkway MS:RSF202
Golden, CO 80401
303.275.4319
robert.guglielmetti at nrel.gov


On 4/30/12 2:11 PM, "David Geisler-Moroder" <david.moroder at gmail.com<mailto:david.moroder at gmail.com>> wrote:

Hi Greg, Rob,

thanks a lot for the quick responses and for the fix!

However, I need to wait for the new NREL-binaries to use the fixed version (or maybe finally step into the CMake thing to get the Windows bins compiled by myself... ;-) ).

Cheers,
David

2012/4/30 Gregory J. Ward <gregoryjward at gmail.com<mailto:gregoryjward at gmail.com>>
Hi David,

I found the problem, and can figure out how to fix it.  The code assumes that exponents have two digits only, which is still true on most Unix machines.  I guess they're making room for "long double's" (128-bit IEEE float) and don't have different code for that than the "regular" doubles.

I will check in a fix later today -- thanks so much for spotting this.

Cheers,
-Greg

> From: "Guglielmetti, Robert" <Robert.Guglielmetti at nrel.gov<mailto:Robert.Guglielmetti at nrel.gov>>
> Date: April 30, 2012 8:41:17 AM PDT
>
> Hi David,
>
> AFAIK, the sources for those two programs were not touched in the Windows binary project. I don't fully understand the behavior of this program right now. I will check with Kitware to see if any changes were in fact made to that source in order to get it to work on Windows.
>
> Rob Guglielmetti  IESNA, LEED AP
>
>
> On 4/30/12 6:35 AM, "David Geisler-Moroder" <david.moroder at gmail.com<mailto:david.moroder at gmail.com><mailto:david.moroder at gmail.com<mailto:david.moroder at gmail.com>>> wrote:
>
> Hi Greg, hi list,
>
> from time to time I am using mgf2inv with the "-vrml" option to export and view my models.
>
> This time I wanted to do the conversion with rad2mgf and mgf2inv -vrml on Windows using the
> NREL binaries. However, the resulting files are corrupt due to bad number representations and
> normal descriptions.
>
> For example the description of a face in the VRML-file created with the Linux binaries is:
>
> DEF ceil_fac_001 Group {
>  Separator {
>    USE ceil_mat
>    Coordinate3 {
>      point [ -2.000000000e+00 +4.500000000e+00 +2.162119874e+00,
>              -1.500000000e+00 +4.500000000e+00 +3.000000000e+00,
>              -1.500000000e+00 +5.000000000e+00 +1.461123454e+00,
>              -2.000000000e+00 +5.000000000e+00 +6.232433278e-01 ]
>    }
>    IndexedFaceSet {
>      coordIndex [ 0, 1, 2, 3 ]
>    }
>  }
> }
>
>
> In the files created with the Windows version the same face is described as:
>
> DEF ceil_fac_001 Group {
>  Separator {
>    USE ceil_mat
>    Coordinate3 {
>      point [ -2.000000000e+000 +4.500000000e+000 +2.162119874e+,
>              -1.500000000e+000 +4.500000000e+000 +3.000000000e+,
>              -1.500000000e+000 +5.000000000e+000 +1.461123454e+,
>              -2.000000000e+000 +5.000000000e+000 +6.232433278e- ]
>    }
>    Normal {
>      vector [ 00
> +0.000 +0.000 +0.0-1.500000000e+000 +4.500000000e+000 +3.000000000e+,
>               00
> +0.000 +0.000 +0.0-1.500000000e+000 +5.000000000e+000 +1.461123454e+,
>               00
> +0.000 +0.000 +0.0-2.000000000e+000 +5.000000000e+000 +6.232433278e-,
>               01
> +0.000 +0.000 +0.000 ]
>    }
>    IndexedFaceSet {
>      coordIndex [ 0, 1, 2, 3 ]
>      normalIndex [ 0, 1, 2, 3 ]
>    }
>  }
> }
>
>
> Obviously, two things are corrupt:
> - the z-coordinates are missing their exponents
> - the normal vector coordinates are messed up
>
> Moreover, for me it's unclear why normal vectors are written (needed ??) in the Windows version, while
> they are completely missing in the Linux version.
>
> I believe that all this has something to do with de definition of VERTFMT in src/cv/mgf2inv.c
> #define VERTFMT        "%+16.9e %+16.9e %+16.9e\n%+6.3f %+6.3f %+6.3f"
>
> Any ideas how to solve that for both platforms??
>
> Cheers,
> David

_______________________________________________
Radiance-dev mailing list
Radiance-dev at radiance-online.org<mailto:Radiance-dev at radiance-online.org>
http://www.radiance-online.org/mailman/listinfo/radiance-dev



--
DI Dr. David Geisler-Moroder
Hofwaldweg 14/20
6020 Innsbruck



