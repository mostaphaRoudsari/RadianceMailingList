From pally.sandher at iesve.com  Thu Nov  1 09:15:20 2012
From: pally.sandher at iesve.com (Pally Sandher)
Date: Thu, 1 Nov 2012 16:15:20 +0000
Subject: [Radiance-dev] The curious case of the Ghost Luminaire
Message-ID: <A7E25FADF831E94DBBD5904D7E5848651BE34E@GL-EXC-01.iesve.com>

Hi,
We've noticed some strange "ghost" luminaires in Radiance 4.2 (nothing to do with Halloween yesterday).
I've uploaded a file with a sample .pic file and the files used to generate it at http://upload.iesve.com/downloads/radiance_issues/ghost_luminaire.zip

As you can see from the .pic file there's a "ghost" luminaire to the centre left of the image which appears to be generated by the luminaire visible in the centre of the image (turning off the others while leaving it on still shows the ghost while vice-versa doesn't). Rotating the view to the right also removes the "ghost".
The commands we're running to generate the image are as follows:

oconv -f Monday.map Monday.rad > ghost_lum.oct
rpict -w -t 2 -vtv -vp 6.300 8.100 1.800 -vd -2.800 -3.600 0.000 -vu 0 0 1 -vh 80.000 -vv 60.000 -x 1600 -y 1600 -x 64 -y 64 -ps 6 -pt 0.100 -pj 1.0 -dj 0.350 -ds 0.300 -dt 0.250 -dc 0.350 -dr 2 -dp 128 -st 0.500 -ab 2 -aa 0.150 -ar 64 -ad 128 -as 64 -lr 6 -lw 0.005 -av 0.000 0.000 0.000 -af temp.amb ghost_lum.oct >amb.raw
rpict -w -t 2 -vtv -vp 6.300 8.100 1.800 -vd -2.800 -3.600 0.000 -vu 0 0 1 -vh 80.000 -vv 60.000 -x 1600 -y 1600 -ps 6 -pt 0.100 -pj 1.0 -dj 0.350 -ds 0.300 -dt 0.250 -dc 0.350 -dr 2 -dp 128 -st 0.500 -ab 2 -aa 0.150 -ar 64 -ad 128 -as 64 -lr 6 -lw 0.005 -av 0.000 0.000 0.000 -af temp.amb ghost_lum.oct >ghost_lum.raw
pfilt -m 0.25 -x /2 -y /2 ghost_lum.raw >ghost_lum.pic

If anyone has a few minutes to run this image on their systems & let me know if the "ghost" luminaire also appears for you it would be most appreciated (I'm using Radiance HEAD built from source on Windows 7 SP1).

Thanks,

Palbinder Sandher 
Software Platform Engineer 
T: +44 (0) 141 945 8500
F: +44 (0) 141 945 8501
http://www.iesve.com 

**Design, Simulate + Innovate with the <Virtual Environment>** 
Integrated Environmental Solutions Limited. Registered in Scotland No. SC151456
Registered Office - Helix Building, West Of Scotland Science Park, Glasgow G20 0SP
Email Disclaimer 




From gregoryjward at gmail.com  Thu Nov  1 09:32:17 2012
From: gregoryjward at gmail.com (Gregory J. Ward)
Date: Thu, 1 Nov 2012 09:32:17 -0700
Subject: [Radiance-dev] The curious case of the Ghost Luminaire
In-Reply-To: <A7E25FADF831E94DBBD5904D7E5848651BE34E@GL-EXC-01.iesve.com>
References: <A7E25FADF831E94DBBD5904D7E5848651BE34E@GL-EXC-01.iesve.com>
Message-ID: <ABF0A859-4A62-4DB7-960C-6FAFA0242467@gmail.com>

Hi Pally,

I don't know who or what is setting your rendering parameters, but they are not something I would recommend.  The "rad" program is a good way to get sane rendering options if you don't like the defaults.  Setting -dt .25 -dc .35 is causing the strange contours around your light sources as well as numerous other inaccuracies.  You are telling Radiance that you are fine with 25% error in the direct calculation, meaning everything else is worse.

The ghosts you are seeing are due most likely to a glazing surface that extends over your wall surface(s).  I can't tell you for sure because the zip file you uploaded doesn't contain a complete model -- there are many referenced files that are missing.

What system are you using to assemble all this?

-Greg

> From: Pally Sandher <pally.sandher at iesve.com>
> Date: November 1, 2012 9:15:20 AM PDT
> 
> Hi,
> We've noticed some strange "ghost" luminaires in Radiance 4.2 (nothing to do with Halloween yesterday).
> I've uploaded a file with a sample .pic file and the files used to generate it at http://upload.iesve.com/downloads/radiance_issues/ghost_luminaire.zip
> 
> As you can see from the .pic file there's a "ghost" luminaire to the centre left of the image which appears to be generated by the luminaire visible in the centre of the image (turning off the others while leaving it on still shows the ghost while vice-versa doesn't). Rotating the view to the right also removes the "ghost".
> The commands we're running to generate the image are as follows:
> 
> oconv -f Monday.map Monday.rad > ghost_lum.oct
> rpict -w -t 2 -vtv -vp 6.300 8.100 1.800 -vd -2.800 -3.600 0.000 -vu 0 0 1 -vh 80.000 -vv 60.000 -x 1600 -y 1600 -x 64 -y 64 -ps 6 -pt 0.100 -pj 1.0 -dj 0.350 -ds 0.300 -dt 0.250 -dc 0.350 -dr 2 -dp 128 -st 0.500 -ab 2 -aa 0.150 -ar 64 -ad 128 -as 64 -lr 6 -lw 0.005 -av 0.000 0.000 0.000 -af temp.amb ghost_lum.oct >amb.raw
> rpict -w -t 2 -vtv -vp 6.300 8.100 1.800 -vd -2.800 -3.600 0.000 -vu 0 0 1 -vh 80.000 -vv 60.000 -x 1600 -y 1600 -ps 6 -pt 0.100 -pj 1.0 -dj 0.350 -ds 0.300 -dt 0.250 -dc 0.350 -dr 2 -dp 128 -st 0.500 -ab 2 -aa 0.150 -ar 64 -ad 128 -as 64 -lr 6 -lw 0.005 -av 0.000 0.000 0.000 -af temp.amb ghost_lum.oct >ghost_lum.raw
> pfilt -m 0.25 -x /2 -y /2 ghost_lum.raw >ghost_lum.pic
> 
> If anyone has a few minutes to run this image on their systems & let me know if the "ghost" luminaire also appears for you it would be most appreciated (I'm using Radiance HEAD built from source on Windows 7 SP1).
> 
> Thanks,
> 
> Palbinder Sandher 
> Software Platform Engineer 
> T: +44 (0) 141 945 8500
> F: +44 (0) 141 945 8501
> http://www.iesve.com 


From david.moroder at gmail.com  Wed Nov  7 05:20:10 2012
From: david.moroder at gmail.com (David Geisler-Moroder)
Date: Wed, 7 Nov 2012 14:20:10 +0100
Subject: [Radiance-dev] Error using BSDF material (ezxml.c)
In-Reply-To: <37060127-1C0A-4D60-AF78-5084580A7F1B@gmail.com>
References: <CAL-bo5FHUrvGn9wH-zKnuF0zhmSkbf7H6z62cne4YWB_chZAsg@mail.gmail.com>
	<13CD1EB7-F250-44DC-963D-B4D03960F5DF@gmail.com>
	<CAL-bo5EuixLmfnk6uStHifEEmuTDm6Y9OT-_SC6Z-ohyHeA+vg@mail.gmail.com>
	<6D524669-7DF1-4F4D-A616-0E06BAD2E7B9@gmail.com>
	<CAL-bo5GfuqPjXYVgFai+Q=VR9-hz+guM+0Q_iko1RZoGPD6Duw@mail.gmail.com>
	<CAL-bo5FwVRWMeZi4ho1ja8OH27i-+6Cu86FiC0dx1k8GMLNUow@mail.gmail.com>
	<9541D400-0962-4681-A226-0A7B657FB765@gmail.com>
	<CAL-bo5G7mxDDAd7AGxraF0ps-W738RhueRExatN57qZQn55EQA@mail.gmail.com>
	<4E7BF85F-F2D1-4067-BC85-F9B73C3A75D5@gmail.com>
	<CAL-bo5EdT2rHr_MyHWw7nO3TnCTp5Ot=zT2HGGW2uUngh1DFQQ@mail.gmail.com>
	<37060127-1C0A-4D60-AF78-5084580A7F1B@gmail.com>
Message-ID: <CAL-bo5Gd2OouwHBqm3wk0x60nqcCPYSjmMc5M=t3Yw+P=rpirA@mail.gmail.com>

Hi Greg, hi list,

a short follow-up on the NOMMAP-issue I had in April.

When re-compiling a HEAD version currently I forgot to add the NOMMAP
compile flag. Again, I ended up with the same error that I had in April,
but not always...
To cut a long story short, I could trace back the problem to something that
probably has nothing to do with RADIANCE and 32 or 64 bit. I'm running
RADIANCE on Ubuntu in a VirtualBox on a Win7 host system. Whenever the
XML-file to load is in a shared folder (via a VirtualBox guest addition)
and physically stored on the network directory, the error occurs. However,
copying the same file to a local directory in Ubuntu and using this one
everything works fine.

I have no idea why this EZXML MMAP doesn't work on shared folders or if
this has something to do with the formatting (NTFS vs. EXT4)??

Anyway, as a work-around specifying the NOMMAP compile flag or just working
on the local disk works...

Cheers,
David


2012/4/26 Gregory J. Ward <gregoryjward at gmail.com>

> Hi David,
>
> I'm pretty sure the guys who developed the build system for NREL didn't
> use the NOMMAP #define, so must be their system doesn't have whatever
> header issues yours is running afoul of in 32-bit mode.
>
> Thanks for the update -- glad it's working for you now!
>
> Cheers,
> -Greg
>
> P.S.  A side note on ezxml is that I found a problem after the 4.1 release
> that caused very long XML files with DOS eol (CR-LF) to be impossibly slow
> to load.  This is fixed in the latest HEAD, which NREL is using.
>
> *From: *David Geisler-Moroder <david.moroder at gmail.com>
>
> *Date: *April 25, 2012 11:28:47 PM PDT
>
> *
> *
>
> Hi Greg,
>
> I recompiled the head with the NOMMAP define and everything works fine now.
> Thanks again for all your help!!
>
> By the way, I just ran the same rvu-command using the 32bit Windows
> binaries provided
> by NREL on
> http://openstudio.nrel.gov/getting-started-developer/getting-started-radiance
> (Rob G. - thanks a lot for offering those!!) -- no problems there as well.
>
> Cheers,
> David
>
> Am 25. April 2012 19:29 schrieb Gregory J. Ward <gregoryjward at gmail.com>:
>
>> Hi David,
>>
>> I tend to agree that the easiest fix is to take out the mmap() call for
>> your system.  We should log a bug to the Ubuntu developers, though.
>>
>> You can put a -DEZXML_NOMMAP option in your rmake if you don't want to
>> mess with the header.
>>
>> Best,
>> -Greg
>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-dev/attachments/20121107/5588885e/attachment.html>

From gregoryjward at gmail.com  Wed Nov  7 08:27:17 2012
From: gregoryjward at gmail.com (Gregory J. Ward)
Date: Wed, 7 Nov 2012 08:27:17 -0800
Subject: [Radiance-dev] Error using BSDF material (ezxml.c)
In-Reply-To: <CAL-bo5Gd2OouwHBqm3wk0x60nqcCPYSjmMc5M=t3Yw+P=rpirA@mail.gmail.com>
References: <CAL-bo5FHUrvGn9wH-zKnuF0zhmSkbf7H6z62cne4YWB_chZAsg@mail.gmail.com>
	<13CD1EB7-F250-44DC-963D-B4D03960F5DF@gmail.com>
	<CAL-bo5EuixLmfnk6uStHifEEmuTDm6Y9OT-_SC6Z-ohyHeA+vg@mail.gmail.com>
	<6D524669-7DF1-4F4D-A616-0E06BAD2E7B9@gmail.com>
	<CAL-bo5GfuqPjXYVgFai+Q=VR9-hz+guM+0Q_iko1RZoGPD6Duw@mail.gmail.com>
	<CAL-bo5FwVRWMeZi4ho1ja8OH27i-+6Cu86FiC0dx1k8GMLNUow@mail.gmail.com>
	<9541D400-0962-4681-A226-0A7B657FB765@gmail.com>
	<CAL-bo5G7mxDDAd7AGxraF0ps-W738RhueRExatN57qZQn55EQA@mail.gmail.com>
	<4E7BF85F-F2D1-4067-BC85-F9B73C3A75D5@gmail.com>
	<CAL-bo5EdT2rHr_MyHWw7nO3TnCTp5Ot=zT2HGGW2uUngh1DFQQ@mail.gmail.com>
	<37060127-1C0A-4D60-AF78-5084580A7F1B@gmail.com>
	<CAL-bo5Gd2OouwHBqm3wk0x60nqcCPYSjmMc5M=t3Yw+P=rpirA@mail.gmail.com>
Message-ID: <FBA5C7B6-4419-4230-90DD-0CC25B6EAE50@gmail.com>

Hi David,

That's an interesting find -- excellent sleuth work!  It makes sense that a networked drive working through a Win7 virtual machine layer might run into troubles.  I'm not sure what Unix does when mapping network drives in general, so it doesn't surprise me that having a Windows layer in there would mess things up.

Poking around with google leads me to articles saying that memory-mapping of networked files should be OK, even under Windows.  So, it may be a problem with the implementation of VirtualBox.  I didn't look for that issue, specifically.

Cheers,
-Greg

> From: David Geisler-Moroder <david.moroder at gmail.com>
> Date: November 7, 2012 5:20:10 AM PST
> 
> Hi Greg, hi list,
> 
> a short follow-up on the NOMMAP-issue I had in April. 
> 
> When re-compiling a HEAD version currently I forgot to add the NOMMAP compile flag. Again, I ended up with the same error that I had in April, but not always...
> To cut a long story short, I could trace back the problem to something that probably has nothing to do with RADIANCE and 32 or 64 bit. I'm running RADIANCE on Ubuntu in a VirtualBox on a Win7 host system. Whenever the XML-file to load is in a shared folder (via a VirtualBox guest addition) and physically stored on the network directory, the error occurs. However, copying the same file to a local directory in Ubuntu and using this one everything works fine.
> 
> I have no idea why this EZXML MMAP doesn't work on shared folders or if this has something to do with the formatting (NTFS vs. EXT4)??
> 
> Anyway, as a work-around specifying the NOMMAP compile flag or just working on the local disk works...
> 
> Cheers,
> David
> 
> 
> 2012/4/26 Gregory J. Ward <gregoryjward at gmail.com>
> Hi David,
> 
> I'm pretty sure the guys who developed the build system for NREL didn't use the NOMMAP #define, so must be their system doesn't have whatever header issues yours is running afoul of in 32-bit mode.
> 
> Thanks for the update -- glad it's working for you now!
> 
> Cheers,
> -Greg
> 
> P.S.  A side note on ezxml is that I found a problem after the 4.1 release that caused very long XML files with DOS eol (CR-LF) to be impossibly slow to load.  This is fixed in the latest HEAD, which NREL is using.
> 
>> From: David Geisler-Moroder <david.moroder at gmail.com>
>> Date: April 25, 2012 11:28:47 PM PDT
>> 
>> Hi Greg,
>> 
>> I recompiled the head with the NOMMAP define and everything works fine now.
>> Thanks again for all your help!!
>> 
>> By the way, I just ran the same rvu-command using the 32bit Windows binaries provided 
>> by NREL on http://openstudio.nrel.gov/getting-started-developer/getting-started-radiance
>> (Rob G. - thanks a lot for offering those!!) -- no problems there as well.
>> 
>> Cheers,
>> David
>> 
>> Am 25. April 2012 19:29 schrieb Gregory J. Ward <gregoryjward at gmail.com>:
>> Hi David,
>> 
>> I tend to agree that the easiest fix is to take out the mmap() call for your system.  We should log a bug to the Ubuntu developers, though.
>> 
>> You can put a -DEZXML_NOMMAP option in your rmake if you don't want to mess with the header.
>> 
>> Best,
>> -Greg
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-dev/attachments/20121107/103a191f/attachment.html>

From apian at pab.eu  Sat Nov 24 03:17:04 2012
From: apian at pab.eu (Peter Apian-Bennewitz)
Date: Sat, 24 Nov 2012 12:17:04 +0100
Subject: [Radiance-dev] focal distance (-vd length) and front clipping plane
	(-vo)
Message-ID: <201211241117.qAOBH8oQ018409@mta2.lbl.gov>

Dear Greg,

there's probably a reason why the focal length is measured from the 
front clipping plane and not from eye point ?
Shifting the front clipping (-vo) shifts the focus too (given as -vd 
vector length), which is not quite what one would expect, or is it just me ?
Example use: To set the focal point at an object behind a glass pane, 
the latter is first removed in rvu using -vo , then the front clipping 
in rpict is set back. -> mis-focused image.
(head release as of 19.11.2012)

TIA1e6
Peter

-- 
pab advanced technologies Ltd, http://www.pab.eu



From gregoryjward at gmail.com  Sat Nov 24 13:44:34 2012
From: gregoryjward at gmail.com (Gregory J. Ward)
Date: Sat, 24 Nov 2012 13:44:34 -0800
Subject: [Radiance-dev] focal distance (-vd length) and front clipping
	plane (-vo)
In-Reply-To: <201211241117.qAOBH8oQ018409@mta2.lbl.gov>
References: <201211241117.qAOBH8oQ018409@mta2.lbl.gov>
Message-ID: <2FACB086-6BCF-4C3B-951F-C890D3643F69@gmail.com>

Hi Peter,

I never really thought about this case, but now that you mention it, having the fore clipping plane affect the view distance doesn't make a whole lot of sense.  There are some changes I need to make to get this to work, which will take a while.  I need to think it through.

Cheers,
-Greg


> From: Peter Apian-Bennewitz <apian at pab.eu>
> Date: November 24, 2012 3:17:04 AM PST
> 
> Dear Greg,
> 
> there's probably a reason why the focal length is measured from the front clipping plane and not from eye point ?
> Shifting the front clipping (-vo) shifts the focus too (given as -vd vector length), which is not quite what one would expect, or is it just me ?
> Example use: To set the focal point at an object behind a glass pane, the latter is first removed in rvu using -vo , then the front clipping in rpict is set back. -> mis-focused image.
> (head release as of 19.11.2012)
> 
> TIA1e6
> Peter
> 
> -- 
> pab advanced technologies Ltd, http://www.pab.eu


From gregoryjward at gmail.com  Sun Nov 25 23:06:50 2012
From: gregoryjward at gmail.com (Gregory J. Ward)
Date: Sun, 25 Nov 2012 21:06:50 -1000
Subject: [Radiance-dev] focal distance (-vd length) and front clipping
	plane (-vo)
In-Reply-To: <201211241117.qAOBH8oQ018409@mta2.lbl.gov>
References: <201211241117.qAOBH8oQ018409@mta2.lbl.gov>
Message-ID: <B91B7AF6-8172-4A7C-99C8-049C281A8693@gmail.com>

Hi Peter,

I've checked in a new version of rpict.c that I'm hoping fixes this problem.  Let me know if you get a chance to try it.

Thanks for spotting the problem!

Cheers,
-Greg

> From: Peter Apian-Bennewitz <apian at pab.eu>
> Date: November 24, 2012 1:17:04 AM HST
> 
> Dear Greg,
> 
> there's probably a reason why the focal length is measured from the front clipping plane and not from eye point ?
> Shifting the front clipping (-vo) shifts the focus too (given as -vd vector length), which is not quite what one would expect, or is it just me ?
> Example use: To set the focal point at an object behind a glass pane, the latter is first removed in rvu using -vo , then the front clipping in rpict is set back. -> mis-focused image.
> (head release as of 19.11.2012)
> 
> TIA1e6
> Peter


