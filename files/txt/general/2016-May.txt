From tej.immadi at samsung.com  Mon May 16 00:54:41 2016
From: tej.immadi at samsung.com (Prudhvitej Immadi)
Date: Mon, 16 May 2016 07:54:41 +0000 (GMT)
Subject: [Radiance-general] Fwd: Re:  Dimming the artificial luminaire
Message-ID: <BA.79.05247.1CC79375@epcpsbgx2.samsung.com>

An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20160516/b01d1fb6/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 201605161654472_Z5JE7EUA.gif
Type: image/gif
Size: 13168 bytes
Desc: not available
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20160516/b01d1fb6/attachment-0001.gif>

From weiss at stahl-sonnenenergie.de  Mon May 16 07:52:11 2016
From: weiss at stahl-sonnenenergie.de (weiss at stahl-sonnenenergie.de)
Date: Mon, 16 May 2016 14:52:11 +0000
Subject: [Radiance-general] AUTOREPLY Radiance-general Digest, Vol 147,
	Issue 1
Message-ID: <064E4EF7.5739FAB8@smtprelaypool.ispgateway.de>


Sehr geehrte Damen und Herren,

vielen Dank fr Ihre Nachricht.
ich bin bis einschlielich 27.5. im Urlaub, in dieser Zeit werden Mails nicht bearbeitet oder automatisch weitergeleitet.
Bitte wenden Sie sich in dringenden Fllen an unsere Zentrale.

Mit freundlichen Gren

Volker Wei

Stahl+Wei
Basler Strae 55
D-79100 Freiburg

Tel.   +49-(0)761-38909-32
Zentrale                     -30
Fax.  +49-(0)761-38909-39

weiss at stahl-weiss.de
www.stahl-weiss.de


Send Radiance-general mailing list submissions to
	radiance-general at radiance-online.org

To subscribe or unsubscribe via the World Wide Web, visit
	http://www.radiance-online.org/mailman/listinfo/radiance-general
or, via email, send a message with subject or body 'help' to
	radiance-general-request at radiance-online.org

You can reach the person managing the list at
	radiance-general-owner at radiance-online.org

When replying, please edit your Subject line so it is more specific
than "Re: Contents of Radiance-general digest..."


Today's Topics:

   1. Fwd: Re:  Dimming the artificial luminaire (Prudhvitej Immadi)


----------------------------------------------------------------------

Message: 1
Date: Mon, 16 May 2016 07:54:41 +0000 (GMT)
From: Prudhvitej Immadi <tej.immadi at samsung.com>
To: "Gregory J. Ward" <gregoryjward at gmail.com>,	Prudhvitej Immadi
	<tej.immadi at samsung.com>
Cc: Radiance general discussion <radiance-general at radiance-online.org>
Subject: [Radiance-general] Fwd: Re:  Dimming the artificial luminaire
Message-ID: <BA.79.05247.1CC79375 at epcpsbgx2.samsung.com>
Content-Type: text/plain; charset="us-ascii"

An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20160516/b01d1fb6/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 201605161654472_Z5JE7EUA.gif
Type: image/gif
Size: 13168 bytes
Desc: not available
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20160516/b01d1fb6/attachment.gif>

------------------------------

_______________________________________________
Radiance-general mailing list
Radiance-general at radiance-online.org
http://www.radiance-online.org/mailman/listinfo/radiance-general


End of Radiance-general Digest, Vol 147, Issue 1
************************************************
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20160516/4bd91b3c/attachment.html>

From gregoryjward at gmail.com  Mon May 16 11:13:39 2016
From: gregoryjward at gmail.com (Gregory J. Ward)
Date: Mon, 16 May 2016 11:13:39 -0700
Subject: [Radiance-general] Dimming the artificial luminaire
In-Reply-To: <BA.79.05247.1CC79375@epcpsbgx2.samsung.com>
References: <BA.79.05247.1CC79375@epcpsbgx2.samsung.com>
Message-ID: <5158E5ED-DA62-4883-9511-CF7F8C8E1932@gmail.com>

Hi Prudhvitej,

The rcontrib calculation proceeds differently from rtrace, since it cannot use the indirect irradiance cache.  Therefore, the -aa setting is overridden in rcontrib to "-aa 0" and the rest of your parameters should change to compensate.  Try the following settings instead of the -a* settings you have for rcontrib:

	-ab 2 -ad 50000 -lw 1e-5

The -lw setting is important to change so that all the initial samples get sent.  Your results may still change a little from run to run, but they should resemble the rtrace results more closely.

Best,
-Greg

> From: Prudhvitej Immadi <tej.immadi at samsung.com>
> Subject: [Radiance-general] Fwd: Re:  Dimming the artificial luminaire
> Date: May 16, 2016 12:54:41 AM PDT
> 
> Revisting the thread after long,
> Thanks for the awesome advice in the previous queries. They were very helpful but I'm stuck in a new problem.
>  
> I wanted to use rtcontrib to find out individual contributions of each luminaire at each point in the plane.
> So, I used
> rcontrib.exe -V- -I -h -ab 2 -aa 0.1 -ad 1024 -M file .oct <input.dat >output.dat
> where input.dat has location(x,y,z) in the form x y z 0 0 1
> since I'm trying to find illuminance when measured in (0,0,1) direction.
>  
> The values  of illuminance I get from rcontrib and the values I get from rtrace and surprisngly rcontrib finishes it's calculations in far less time than rtrace.
> More interesting part is that the output from rcontrib changes everytime I run it though the change is very small. I'm curious why it should change ?
>  
> Am I doing something wrong ? Can you guide me from here ? I prefer to get values  similar to rtrace.
>  
> I've searched the forum for similar issues and I found out that rtcontrib uses pure monte carlo and rtrace uses ambient interpolation
> 
> How do I decide on which values are correct/reliable ?
>  
> Thanks a lot,
> Prudhvitej Immadi.
> ------- Original Message -------
> Sender : Gregory J. Ward<gregoryjward at gmail.com>
> Date : Apr 26, 2016 12:02 (GMT+09:00)
> Title : Re: [Radiance-general] Dimming the artificial luminaire
>  
> You will need to use a spreadsheet or custom program to add together illuminance values rather than pcomb, which is for images.  As for computing the dimming levels to achieve the desired illuminance on the work plane, that's a linear optimization problem that shouldn't be too hard to solve using least-squares or similar, but I don't have a ready-made tool to help with that.  Again, Excel or Matlab might be useful for that.
> 
> Cheers,
> -Greg
> 
>> From: Prudhvitej Immadi <tej.immadi at samsung.com>
>> Subject: Re: Re: [Radiance-general] Dimming the artificial luminaire
>> Date: April 25, 2016 7:49:44 PM PDT
>> 
>> Hi Greg,
>> Thanks a lot for the helpful response. I've been using rtrace -I for my illuminance calculations than radiance picures and can pcomb be used here ?
>> Also, my bigger concern was that I have to do complex mathematics to find out my dimming factors to get the required illuminance value since I need to ensure minimum certain illuminance at all points in the work plane. Is there a way that I can reverse-engineer this, i.e., find out dimming coefficients for a certain level of illuminance rather than finding out illuminance for certain dimming coefficients.
>>  
>> Thank you,
>> Prudhvitej Immadi.
>>  
>> ------- Original Message -------
>> Sender : Greg Ward<gregoryjward at gmail.com>
>> Date : Apr 26, 2016 02:06 (GMT+09:00)
>> Title : Re: [Radiance-general] Dimming the artificial luminaire
>>  
>> Hi Prudhvi,
>> 
>> You are correct that changing the luminaire output with ies2rad would be a very inefficient way to go about things.
>> 
>> The best method is to add together illuminance or image results for your separately controllable luminaires using the appropriate dimming factors.  If all of your luminaires are controlled by a single sensor, then this is equivalent to adding a scaled "electric lighting only" component to a "daylight only" component.  This can be accomplished with pcomb like so:
>> 
>> pcomb -o daylight.hdr -s 0.7 -o electric.hdr > total.hdr
>> 
>> In this example, I assume that your dimming level is set to 70% output.  If you have three separately controlled luminaire banks, your command might look like this:
>> 
>> pcomb -o daylight.hdr -s 0.25 -o bank1.hdr -s 0.5 -o bank2.hdr -s 0.65 -o bank3.hdr > total.hdr
>> 
>> Here, I have set bank1 to 25%, bank2 to 50%, and bank3 to 65% output.  To compute each of these banks, you will need to render your scene without daylight and with the other banks turned off, somehow.
>> 
>> If you are computing illuminances rather that images, you can use a spreadsheet or similar to apply your dimming factors to the calculated illuminance components in a similar fashion.
>> 
>> If you have individually controlled luminaires, it might be more efficient to use rcontrib to compute the contribution of each luminaire without having to perform multiple rendering calculations.  This is a bit more involved, but you might be able to figure it out from the examples given in my talk from the 2012 Radiance workshop:
>> 
>> http://www.radiance-online.org/community/workshops/2012-copenhagen/Day1/Ward/Rtcontrib_tut1.pdf
>> 
>> I hope this is enough to get you started.
>> 
>> Best,
>> -Greg
>> 
>>> From: Prudhvitej Immadi <tej.immadi at samsung.com>
>>> Subject: [Radiance-general] Dimming the artificial luminaire
>>> Date: April 25, 2016 1:24:23 AM PDT
>>> Hi,
>>> I'm trying to simulate an open office environment using radiance. These days, there are luminaires which have photosensors installed available in the market. They dim automatically to the 500lux illuminance level (Standard for office spaces) when daylight is available. 
>>> Is it possible to simulate such a scenario using radiance. My aim is to find the dimming level when the 500lux is achieved on the work plane. 
>>> 1. How is dimming the luminaries achieved ?
>>> From what I gathered, I can have a multiplication factor in ies2rad. I think this is ineffecient because I will need to generate an octree again. I couldn't find a better alternative.
>>> 2. Is there a way to automatically dim the luminaire to meet a certain criteria on illuminance ?
>>> 
>>> I'm relatively new to radiance and pardon me if this is a trivial issue. 
>>> 
>>> Any help would be greatly appreciated.
>>> Thank you,
>>> Prudhvi Tej.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20160516/eb2cc824/attachment-0001.html>

From stephen at coolshadow.com  Tue May 17 10:33:44 2016
From: stephen at coolshadow.com (Stephen Wasilewski)
Date: Tue, 17 May 2016 10:33:44 -0700
Subject: [Radiance-general] transfunc with measured data (poor man's BSDF)
Message-ID: <CAK5mS-8A6wogMwgft_C7+OcDEvf5bi5Ckq5=PjrNUu8AcGtANg@mail.gmail.com>

I'm trying to set up a transfunc material to approximate some rough
measured data I have.  Assume my material is isotropic and I have a
unscaled transmission profile from 0-90 degrees.

here is my material:

void transfunc pane
2 tdis distribution.cal
0
7 .9 .9 .9 0 .8 1 12

.8 is my measured total VLT, and 12 is a magical factor that fits the
simulation with a physical model (this number is different for every
material, which is why I know I'm missing something, mostly likely math
skills)

and here is the contents of distribution.cal:

tcoef = .5*90*A7;

ang(x,y,z) = acos(x*Dx+y*Dy+z*Dz)/DEGREE;

bound2(x,y,z) = if(ang(x,y,z)-90,90,ang(x,y,z));

tdis(ix,iy,iz) = tcoef*tdat(91-floor(bound2(ix,iy,iz)));

tdat(i) : select(i,
0.000310656,
0.000312042,
0.000315021,
0.00032472,
0.000326868,
0.000330262,
0.000332341,
0.000343634,
0.00034689,
0.000354026,
0.00035749,
0.000359083,
0.000361647,
0.00036906,
0.000371554,
0.000377512,
0.000380076,
0.000389082,
0.000392061,
0.000394902,
0.000402315,
0.000408758,
0.000407857,
0.000420743,
0.000421228,
0.000429542,
0.0004346,
0.000436401,
0.000447971,
0.000449356,
0.000454414,
0.000458086,
0.000478385,
0.000477,
0.00048947,
0.000499585,
0.000507414,
0.000521339,
0.000536512,
0.000545726,
0.000556811,
0.000570598,
0.000586741,
0.000594084,
0.000607941,
0.000625399,
0.000634129,
0.000651241,
0.000673411,
0.000703202,
0.000728143,
0.000735071,
0.000774561,
0.000804352,
0.000824444,
0.000845921,
0.000895803,
0.000942914,
0.000982404,
0.001031594,
0.001085633,
0.001198561,
0.001237358,
0.00129694,
0.00136345,
0.001465293,
0.001581685,
0.001673136,
0.001792299,
0.001928783,
0.002159488,
0.002343776,
0.002594573,
0.002836364,
0.003092703,
0.00343218,
0.003813226,
0.004396572,
0.005160741,
0.006019825,
0.006495786,
0.008431496,
0.009456855,
0.011265089,
0.013821557,
0.017729005,
0.022952792,
0.052383356,
0.11064174,
0.238534447,
0.426770895)

Im getting the expected distribution for direct light sources (at least for
near normal incidence, which is all I am worried about for now), but glows
and indirect light seem to revert to a lambertian.   I have no idea how to
scale these values to insure the right transmittance or as the reference
manual puts it "The function brtd should integrate to 1 over each projected
hemisphere".

Help with integration, what is going on with diffuse transmission, anything
else I may be missing and/or that I am barking up the wrong tree entirely
would be greatly appreciated.

Thanks,

Stephen Wasilewski
*LOISOS *+* UBBELOHDE*
- - - - - - - - - - - - - - - - - - - - - - - - - - -
1917 Clement Avenue  Building 10A
Alameda, CA  94501 USA
- - - - - - - - - - - - - - - - - - - - - - - - - - -
510 521 3800 VOICE
510 521 3820 FAX
- - - - - - - - - - - - - - - - - - - - - - - - - - -
www.coolshadow.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20160517/9d346cb3/attachment.html>

From gregoryjward at gmail.com  Tue May 17 11:23:52 2016
From: gregoryjward at gmail.com (Greg Ward)
Date: Tue, 17 May 2016 11:23:52 -0700
Subject: [Radiance-general] transfunc with measured data (poor man's
	BSDF)
In-Reply-To: <CAK5mS-8A6wogMwgft_C7+OcDEvf5bi5Ckq5=PjrNUu8AcGtANg@mail.gmail.com>
References: <CAK5mS-8A6wogMwgft_C7+OcDEvf5bi5Ckq5=PjrNUu8AcGtANg@mail.gmail.com>
Message-ID: <8728FE95-7734-4414-AA8B-EE93B49C7E27@lmi.net>

Hi Stephen,

This would probably be a little easier to set up using transdata, which is meant for this kind of input.  However, none of the older types handle soft-specular interactions from non-sources.  This is a big caveat with these material types and one of the main motivations for implementing the more general BSDF framework.

Since you already have this function implemented, you can use it to create an XML file for the BSDF primitive (see refman.pdf pp.10-11) using either bsdf2klems or bsdf2ttree, which take functional descriptions.  To given an example, we can define the following wgmdiso.cal file:

{ Ward-Geisler-Moroder-Duer isotropic BRDF model }

rho_d = 0.095;
rho_s = 0.05;
a = 0.08;

exfunc(hx,hy,hz) = exp(-(hx*hx + hy*hy)/(hz*hz*a*a)) *
			(hx*hx + hy*hy + hz*hz) /
			(PI*a*a*hz*hz*hz*hz);

{ Note that we assume i and o vectors are normalized }

wgmdiso(ix,iy,iz,ox,oy,oz) = if( -iz*oz, 0,
			rho_d/PI + rho_s*exfunc(ix+ox,iy+oy,iz+oz) );
----------

This can then be passed to bsdf2ttree to create an XML representation:

	bsdf2ttree -t3 -f wgmdiso.cal wgmdiso > wgmdiso.xml

The "-t3" option tells bsdf2ttree that the function is isotropic.  There's no such choice for the Klems representation, where you would use:

	bsdf2klems -f wgmdiso.cal wgmdiso > wgmdisok.xml

It's a homework assignment to convert your function into one that takes incident and exiting vectors (both pointing away from the surface), and remember that you need to include same-side vectors for reflection, which should return 0.2*0.9 for the diffuse portion in your case.

The reward should be a BSDF description that does proper sampling of the transmitted light!

Best of luck!
-Greg

P.S.  Apropos to this discussion, Peter Apian-Bennewitz wrote an excellent review of different Radiance materials and how best to apply them a few years back, including the transfunc type.  His paper is available as at <http://arxiv.org/abs/1307.4214>.

> From: Stephen Wasilewski <stephen at coolshadow.com>
> Date: May 17, 2016 10:33:44 AM PDT
> 
> I'm trying to set up a transfunc material to approximate some rough measured data I have.  Assume my material is isotropic and I have a unscaled transmission profile from 0-90 degrees.
> 
> here is my material:
> 
> void transfunc pane
> 2 tdis distribution.cal
> 0
> 7 .9 .9 .9 0 .8 1 12
> 
> .8 is my measured total VLT, and 12 is a magical factor that fits the simulation with a physical model (this number is different for every material, which is why I know I'm missing something, mostly likely math skills)
> 
> and here is the contents of distribution.cal:
> 
> tcoef = .5*90*A7;
> 
> ang(x,y,z) = acos(x*Dx+y*Dy+z*Dz)/DEGREE;
> 
> bound2(x,y,z) = if(ang(x,y,z)-90,90,ang(x,y,z));
> 
> tdis(ix,iy,iz) = tcoef*tdat(91-floor(bound2(ix,iy,iz)));
> 
> tdat(i) : select(i,
> 0.000310656,
> 0.000312042,
> ...
> 0.238534447,
> 0.426770895)
> 
> Im getting the expected distribution for direct light sources (at least for near normal incidence, which is all I am worried about for now), but glows and indirect light seem to revert to a lambertian.   I have no idea how to scale these values to insure the right transmittance or as the reference manual puts it "The function brtd should integrate to 1 over each projected hemisphere". 
> 
> Help with integration, what is going on with diffuse transmission, anything else I may be missing and/or that I am barking up the wrong tree entirely would be greatly appreciated.
> 
> Thanks,
> 
> Stephen Wasilewski
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20160517/ba1a12e7/attachment.html>

From stephen at coolshadow.com  Tue May 17 14:12:18 2016
From: stephen at coolshadow.com (Stephen Wasilewski)
Date: Tue, 17 May 2016 14:12:18 -0700
Subject: [Radiance-general] transfunc with measured data (poor man's BSDF)
Message-ID: <CAK5mS-8zduMCzhXc7J9AVikAegWP1vbNat7ngAdNpkO=cWJJqA@mail.gmail.com>

Thanks Greg,

bsdf2klems is doing what I wanted perfectly but bsdf2ttree is doing
something a little weird.  I used t4 just so I could view the output with
Andy's BSDF viewer and when I run it with the defaults the "front" in the
BSDF viewer (which i think is made from +backward with bsdf2ttree) looks
good, but when I include +forward the "back" transmission is too high.
This does not happen with the klems bsdf.

The hemispherical transmission for a normal ray is 75% for both klems
directions and ttree front, but ttree back is 91.6.  Any idea whats going
on?  I can probably get around this by paying attention to surface normals,
but I am looking at a multi layered assembly where I expect backface
reflection and transmission to matter.

Thanks,

Stephen
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20160517/c826f552/attachment.html>

From gregoryjward at gmail.com  Tue May 17 14:29:14 2016
From: gregoryjward at gmail.com (Greg Ward)
Date: Tue, 17 May 2016 14:29:14 -0700
Subject: [Radiance-general] transfunc with measured data (poor man's
	BSDF)
In-Reply-To: <CAK5mS-8zduMCzhXc7J9AVikAegWP1vbNat7ngAdNpkO=cWJJqA@mail.gmail.com>
References: <CAK5mS-8zduMCzhXc7J9AVikAegWP1vbNat7ngAdNpkO=cWJJqA@mail.gmail.com>
Message-ID: <32AF211C-2030-4945-8DAF-62F6941BE03A@lmi.net>

Hi Stephen,

You got that working pretty quickly!  Can you send me a private message with your .cal file and commands, so I can reproduce the issue?

Thanks,
-Greg

> From: Stephen Wasilewski <stephen at coolshadow.com>
> Date: May 17, 2016 2:12:18 PM PDT
> 
> Thanks Greg,
> 
> bsdf2klems is doing what I wanted perfectly but bsdf2ttree is doing something a little weird.  I used t4 just so I could view the output with Andy's BSDF viewer and when I run it with the defaults the "front" in the BSDF viewer (which i think is made from +backward with bsdf2ttree) looks good, but when I include +forward the "back" transmission is too high.  This does not happen with the klems bsdf.
> 
> The hemispherical transmission for a normal ray is 75% for both klems directions and ttree front, but ttree back is 91.6.  Any idea whats going on?  I can probably get around this by paying attention to surface normals, but I am looking at a multi layered assembly where I expect backface reflection and transmission to matter.
> 
> Thanks,
> 
> Stephen
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20160517/6e8016ff/attachment.html>

From achim.geissler at intergga.ch  Fri May 20 01:01:30 2016
From: achim.geissler at intergga.ch (Achim.geissler)
Date: Fri, 20 May 2016 10:01:30 +0200
Subject: [Radiance-general] Skyvector from gensky vs. gendaylit
In-Reply-To: <32AF211C-2030-4945-8DAF-62F6941BE03A@lmi.net>
References: <CAK5mS-8zduMCzhXc7J9AVikAegWP1vbNat7ngAdNpkO=cWJJqA@mail.gmail.com>
	<32AF211C-2030-4945-8DAF-62F6941BE03A@lmi.net>
Message-ID: <ecb2fff9521b09345c6cf013bf7e610a@intergga.ch>

Hi all,

a probably small and stupid (on my part) issue. I am generating sky 
patch vectors via genskyvec ?m 1 (e.g.). Input is either a sky generated 
by gensky 6 21 12 (e.g.) or gendaylit <lots of options>.

Now, my problem is that genskyvec produces different output for these 
sky definition options which is quite a nuisance when trying to 
postprocess the sky vectors. For gensky, the output is a triplet (r g b) 
on an individual line per patch, 146 lines in total. For gendaylit, 
however, the output is a single line!

Of course, I can reorganise the output, somehow. However, I would be 
interested what I am doing wrong, here.

Thanks for any ideas!

Best
Achim




From gregoryjward at gmail.com  Fri May 20 08:39:07 2016
From: gregoryjward at gmail.com (Greg Ward)
Date: Fri, 20 May 2016 08:39:07 -0700
Subject: [Radiance-general] Skyvector from gensky vs. gendaylit
In-Reply-To: <ecb2fff9521b09345c6cf013bf7e610a@intergga.ch>
References: <CAK5mS-8zduMCzhXc7J9AVikAegWP1vbNat7ngAdNpkO=cWJJqA@mail.gmail.com>
	<32AF211C-2030-4945-8DAF-62F6941BE03A@lmi.net>
	<ecb2fff9521b09345c6cf013bf7e610a@intergga.ch>
Message-ID: <FA481CEC-546F-463D-B077-C8CBE75A5F64@lmi.net>

Hi Achim,

This is impossible to debug without your long list of gendaylit options.  The genskyvec script should produce something for any valid sky input, so I suspect something is going wrong on the gendaylit side.

-Greg

> From: "Achim.geissler" <achim.geissler at intergga.ch>
> Subject: [Radiance-general] Skyvector from gensky vs. gendaylit
> Date: May 20, 2016 1:01:30 AM PDT
> 
> Hi all,
> 
> a probably small and stupid (on my part) issue. I am generating sky patch vectors via genskyvec ?m 1 (e.g.). Input is either a sky generated by gensky 6 21 12 (e.g.) or gendaylit <lots of options>.
> 
> Now, my problem is that genskyvec produces different output for these sky definition options which is quite a nuisance when trying to postprocess the sky vectors. For gensky, the output is a triplet (r g b) on an individual line per patch, 146 lines in total. For gendaylit, however, the output is a single line!
> 
> Of course, I can reorganise the output, somehow. However, I would be interested what I am doing wrong, here.
> 
> Thanks for any ideas!
> 
> Best
> Achim


From achim.geissler at intergga.ch  Fri May 20 10:27:43 2016
From: achim.geissler at intergga.ch (Achim Geissler)
Date: Fri, 20 May 2016 19:27:43 +0200
Subject: [Radiance-general] Skyvector from gensky vs. gendaylit
In-Reply-To: <FA481CEC-546F-463D-B077-C8CBE75A5F64@lmi.net>
References: <CAK5mS-8zduMCzhXc7J9AVikAegWP1vbNat7ngAdNpkO=cWJJqA@mail.gmail.com>
	<32AF211C-2030-4945-8DAF-62F6941BE03A@lmi.net>
	<ecb2fff9521b09345c6cf013bf7e610a@intergga.ch>
	<FA481CEC-546F-463D-B077-C8CBE75A5F64@lmi.net>
Message-ID: <28E1257B-F623-4613-B5A9-2B093D0A4E48@intergga.ch>

Hi Greg,

in the mean time, I have been experimenting quite a bit and the problem seems to have been that my approaches weren?t actually really identical (the stupid part). This is what I did:

===
Setting up:
===
# Assemble gendaylit command line components
month='6'
day='21'
time="12"
datetime="$month $day $time"
lat='47.5'
lon='-7.6'     # west +, east -
meridian='-1'  # "hours diff from UTC", west +, east -
diffhor='334'
dirnorm='541'
mer=$(echo $meridian |rcalc -e '$1=$1*15')
radiation="$dirnorm $diffhor"

# Build command lines ...
# ... for gendaylit / -O 1 is solar spectrum, -O 0 is visual spectrum
gdlcmd="$datetime -a $lat -o $lon -m $mer -W $radiation -O 1"

# ... for gensky
gskcmd="$datetime -a $lat -o $lon -m $mer -B $diffhor"

# and for genskyvec
#gsvcmd=" "
gsvcmd="-c 1 1 1"

===
Now use:
===
# Generate sky description with gendaylit and generate sky views
skyvec=$(gendaylit $gdlcmd | genskyvec $gsvcmd -m 1)
echo $skyvec > gendaylit_vec.skv

# Now generate sky with gensky and repeat view generation
gensky $gskcmd | genskyvec $gsvcmd -m 1 > gensky_vec.skv

===
? that was were I wrote below initial post. Now, if I either do

gendaylit $gdlcmd | genskyvec $gsvcmd -m 1 > gendaylit_vec.skv

directly or ?indirectly? write the gensky-based output via ?skyvec=$(?? both approaches behave the same, after all. However, with the ?indirect? procedure, I end up with a single line. Luckily, I have found a way to re-order the data via sed (long live the net!).

Is there a logical explanation, why the ?EOLs? get lost for the ?indirect? procedure?

Thanks.
Best
Achim




> On 20 May 2016, at 17:39, Greg Ward <gregoryjward at gmail.com> wrote:
> 
> Hi Achim,
> 
> This is impossible to debug without your long list of gendaylit options.  The genskyvec script should produce something for any valid sky input, so I suspect something is going wrong on the gendaylit side.
> 
> -Greg
> 
>> From: "Achim.geissler" <achim.geissler at intergga.ch>
>> Subject: [Radiance-general] Skyvector from gensky vs. gendaylit
>> Date: May 20, 2016 1:01:30 AM PDT
>> 
>> Hi all,
>> 
>> a probably small and stupid (on my part) issue. I am generating sky patch vectors via genskyvec ?m 1 (e.g.). Input is either a sky generated by gensky 6 21 12 (e.g.) or gendaylit <lots of options>.
>> 
>> Now, my problem is that genskyvec produces different output for these sky definition options which is quite a nuisance when trying to postprocess the sky vectors. For gensky, the output is a triplet (r g b) on an individual line per patch, 146 lines in total. For gendaylit, however, the output is a single line!
>> 
>> Of course, I can reorganise the output, somehow. However, I would be interested what I am doing wrong, here.
>> 
>> Thanks for any ideas!
>> 
>> Best
>> Achim

achim.geissler at intergga.ch




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20160520/74aae00c/attachment.html>

From gregoryjward at gmail.com  Fri May 20 11:18:09 2016
From: gregoryjward at gmail.com (Gregory J. Ward)
Date: Fri, 20 May 2016 11:18:09 -0700
Subject: [Radiance-general] Skyvector from gensky vs. gendaylit
In-Reply-To: <28E1257B-F623-4613-B5A9-2B093D0A4E48@intergga.ch>
References: <CAK5mS-8zduMCzhXc7J9AVikAegWP1vbNat7ngAdNpkO=cWJJqA@mail.gmail.com>
	<32AF211C-2030-4945-8DAF-62F6941BE03A@lmi.net>
	<ecb2fff9521b09345c6cf013bf7e610a@intergga.ch>
	<FA481CEC-546F-463D-B077-C8CBE75A5F64@lmi.net>
	<28E1257B-F623-4613-B5A9-2B093D0A4E48@intergga.ch>
Message-ID: <027657BF-9588-4C73-A42C-5D2DF9FA9FAA@gmail.com>

Hi Achim,

The "indirect" call is effectively an inlining method, and the EOL's get converted to spaces in case you are passing the output to another command.  The subsequent programs don't really care, except that the header needs to have its lines preserved ahead of the data, so it knows how to interpret the latter.

-Greg

> From: Achim Geissler <achim.geissler at intergga.ch>
> Date: May 20, 2016 10:27:43 AM PDT
> 
> Hi Greg,
> 
> in the mean time, I have been experimenting quite a bit and the problem seems to have been that my approaches weren?t actually really identical (the stupid part). This is what I did:
> 
> ===
> Setting up:
> ===
> # Assemble gendaylit command line components
> month='6'
> day='21'
> time="12"
> datetime="$month $day $time"
> lat='47.5'
> lon='-7.6'     # west +, east -
> meridian='-1'  # "hours diff from UTC", west +, east -
> diffhor='334'
> dirnorm='541'
> mer=$(echo $meridian |rcalc -e '$1=$1*15')
> radiation="$dirnorm $diffhor"
> 
> # Build command lines ...
> # ... for gendaylit / -O 1 is solar spectrum, -O 0 is visual spectrum
> gdlcmd="$datetime -a $lat -o $lon -m $mer -W $radiation -O 1"
> 
> # ... for gensky
> gskcmd="$datetime -a $lat -o $lon -m $mer -B $diffhor"
> 
> # and for genskyvec
> #gsvcmd=" "
> gsvcmd="-c 1 1 1"
> 
> ===
> Now use:
> ===
> # Generate sky description with gendaylit and generate sky views
> skyvec=$(gendaylit $gdlcmd | genskyvec $gsvcmd -m 1)
> echo $skyvec > gendaylit_vec.skv
> 
> # Now generate sky with gensky and repeat view generation
> gensky $gskcmd | genskyvec $gsvcmd -m 1 > gensky_vec.skv
> 
> ===
> ? that was were I wrote below initial post. Now, if I either do
> 
> gendaylit $gdlcmd | genskyvec $gsvcmd -m 1 > gendaylit_vec.skv
> 
> directly or ?indirectly? write the gensky-based output via ?skyvec=$(?? both approaches behave the same, after all. However, with the ?indirect? procedure, I end up with a single line. Luckily, I have found a way to re-order the data via sed (long live the net!).
> 
> Is there a logical explanation, why the ?EOLs? get lost for the ?indirect? procedure?
> 
> Thanks.
> Best
> Achim
> 
> 
>> On 20 May 2016, at 17:39, Greg Ward <gregoryjward at gmail.com> wrote:
>> 
>> Hi Achim,
>> 
>> This is impossible to debug without your long list of gendaylit options.  The genskyvec script should produce something for any valid sky input, so I suspect something is going wrong on the gendaylit side.
>> 
>> -Greg
>> 
>>> From: "Achim.geissler" <achim.geissler at intergga.ch>
>>> Subject: [Radiance-general] Skyvector from gensky vs. gendaylit
>>> Date: May 20, 2016 1:01:30 AM PDT
>>> 
>>> Hi all,
>>> 
>>> a probably small and stupid (on my part) issue. I am generating sky patch vectors via genskyvec ?m 1 (e.g.). Input is either a sky generated by gensky 6 21 12 (e.g.) or gendaylit <lots of options>.
>>> 
>>> Now, my problem is that genskyvec produces different output for these sky definition options which is quite a nuisance when trying to postprocess the sky vectors. For gensky, the output is a triplet (r g b) on an individual line per patch, 146 lines in total. For gendaylit, however, the output is a single line!
>>> 
>>> Of course, I can reorganise the output, somehow. However, I would be interested what I am doing wrong, here.
>>> 
>>> Thanks for any ideas!
>>> 
>>> Best
>>> Achim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20160520/57700742/attachment-0001.html>

From achim.geissler at intergga.ch  Fri May 20 11:56:11 2016
From: achim.geissler at intergga.ch (Achim Geissler)
Date: Fri, 20 May 2016 20:56:11 +0200
Subject: [Radiance-general] Skyvector from gensky vs. gendaylit
In-Reply-To: <027657BF-9588-4C73-A42C-5D2DF9FA9FAA@gmail.com>
References: <CAK5mS-8zduMCzhXc7J9AVikAegWP1vbNat7ngAdNpkO=cWJJqA@mail.gmail.com>
	<32AF211C-2030-4945-8DAF-62F6941BE03A@lmi.net>
	<ecb2fff9521b09345c6cf013bf7e610a@intergga.ch>
	<FA481CEC-546F-463D-B077-C8CBE75A5F64@lmi.net>
	<28E1257B-F623-4613-B5A9-2B093D0A4E48@intergga.ch>
	<027657BF-9588-4C73-A42C-5D2DF9FA9FAA@gmail.com>
Message-ID: <E419E2D5-3313-46AE-BAD8-3F2EAA67913D@intergga.ch>

Hi Greg,

thanks for the clarification. The issue arose due to my trying to use a perl script from Wouter (found it in the archive from last December) and this script required the vector data to come in the ?triplet lines? format.

while ( <$fh> ) {
  my @a = split /\s+/;
  push @sky_patches, ($a[0]*0.265+$a[1]*0.67+$a[2]*0.065);
}

By and by, I got the script up and running (thanks, Wouter).

Best
Achim


> On 20 May 2016, at 20:18, Gregory J. Ward <gregoryjward at gmail.com> wrote:
> 
> Hi Achim,
> 
> The "indirect" call is effectively an inlining method, and the EOL's get converted to spaces in case you are passing the output to another command.  The subsequent programs don't really care, except that the header needs to have its lines preserved ahead of the data, so it knows how to interpret the latter.
> 
> -Greg
> 
>> From: Achim Geissler <achim.geissler at intergga.ch <mailto:achim.geissler at intergga.ch>>
>> Date: May 20, 2016 10:27:43 AM PDT
>> 
>> Hi Greg,
>> 
>> in the mean time, I have been experimenting quite a bit and the problem seems to have been that my approaches weren?t actually really identical (the stupid part). This is what I did:
>> 
>> ===
>> Setting up:
>> ===
>> # Assemble gendaylit command line components
>> month='6'
>> day='21'
>> time="12"
>> datetime="$month $day $time"
>> lat='47.5'
>> lon='-7.6'     # west +, east -
>> meridian='-1'  # "hours diff from UTC", west +, east -
>> diffhor='334'
>> dirnorm='541'
>> mer=$(echo $meridian |rcalc -e '$1=$1*15')
>> radiation="$dirnorm $diffhor"
>> 
>> # Build command lines ...
>> # ... for gendaylit / -O 1 is solar spectrum, -O 0 is visual spectrum
>> gdlcmd="$datetime -a $lat -o $lon -m $mer -W $radiation -O 1"
>> 
>> # ... for gensky
>> gskcmd="$datetime -a $lat -o $lon -m $mer -B $diffhor"
>> 
>> # and for genskyvec
>> #gsvcmd=" "
>> gsvcmd="-c 1 1 1"
>> 
>> ===
>> Now use:
>> ===
>> # Generate sky description with gendaylit and generate sky views
>> skyvec=$(gendaylit $gdlcmd | genskyvec $gsvcmd -m 1)
>> echo $skyvec > gendaylit_vec.skv
>> 
>> # Now generate sky with gensky and repeat view generation
>> gensky $gskcmd | genskyvec $gsvcmd -m 1 > gensky_vec.skv
>> 
>> ===
>> ? that was were I wrote below initial post. Now, if I either do
>> 
>> gendaylit $gdlcmd | genskyvec $gsvcmd -m 1 > gendaylit_vec.skv
>> 
>> directly or ?indirectly? write the gensky-based output via ?skyvec=$(?? both approaches behave the same, after all. However, with the ?indirect? procedure, I end up with a single line. Luckily, I have found a way to re-order the data via sed (long live the net!).
>> 
>> Is there a logical explanation, why the ?EOLs? get lost for the ?indirect? procedure?
>> 
>> Thanks.
>> Best
>> Achim
>> 
>> 
>>> On 20 May 2016, at 17:39, Greg Ward <gregoryjward at gmail.com <mailto:gregoryjward at gmail.com>> wrote:
>>> 
>>> Hi Achim,
>>> 
>>> This is impossible to debug without your long list of gendaylit options.  The genskyvec script should produce something for any valid sky input, so I suspect something is going wrong on the gendaylit side.
>>> 
>>> -Greg
>>> 
>>>> From: "Achim.geissler" <achim.geissler at intergga.ch <mailto:achim.geissler at intergga.ch>>
>>>> Subject: [Radiance-general] Skyvector from gensky vs. gendaylit
>>>> Date: May 20, 2016 1:01:30 AM PDT
>>>> 
>>>> Hi all,
>>>> 
>>>> a probably small and stupid (on my part) issue. I am generating sky patch vectors via genskyvec ?m 1 (e.g.). Input is either a sky generated by gensky 6 21 12 (e.g.) or gendaylit <lots of options>.
>>>> 
>>>> Now, my problem is that genskyvec produces different output for these sky definition options which is quite a nuisance when trying to postprocess the sky vectors. For gensky, the output is a triplet (r g b) on an individual line per patch, 146 lines in total. For gendaylit, however, the output is a single line!
>>>> 
>>>> Of course, I can reorganise the output, somehow. However, I would be interested what I am doing wrong, here.
>>>> 
>>>> Thanks for any ideas!
>>>> 
>>>> Best
>>>> Achim
> _______________________________________________
> Radiance-general mailing list
> Radiance-general at radiance-online.org
> http://www.radiance-online.org/mailman/listinfo/radiance-general

achim.geissler at intergga.ch




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20160520/1827f8cc/attachment.html>

From tito_ at mit.edu  Sun May 22 19:02:53 2016
From: tito_ at mit.edu (Christoph Reinhart)
Date: Mon, 23 May 2016 02:02:53 +0000
Subject: [Radiance-general] DIVA-4.0 Beta is out
Message-ID: <1B23446CBF250648A2FC775DE3FE7E80F40B5464@OC11expo28.exchange.mit.edu>

[http://api.ning.com/files/JPrUh3-6xrSUBF85UYv4JQD2LvgkfVnq7RXnt3m3y5Uzc*gZKs3bG-dUohTAB8PEBCgOHAmER6EKCDxfRsm-rZ2bD6PvsW0t/DIVA_22.jpg]

Dear colleagues,

We are very pleased to announce the availability of DIVA-4.0 beta for download<http://solemma.net/DIVA-for-Rhino/download.html>. The DIVA Grasshopper<http://diva4rhino.com/> tools have been completely revamped for this release. We have also added the Archsim<http://archsim.com/> multi-zone thermal modelling environment in Grasshopper to the DIVA suite and fully coupled our lighting and energy simulations. Other workflow improvements include hybrid luminance images with illuminance contours, inclusion of the Utah colored sky model by Mark Stock on Windows and the photon mapping forward ray tracing module by Roland Schregle.
We will be offering a series of training opportunities over the coming months including at PLEA in Los Angeles<http://diva4rhino.com/profiles/blogs/diva-at-plea-2016> on July 10 and 13 and at the University of Toronto, Canada, on Sep 29. Please go to http://diva4rhino.com/news for details.

Happy simulations,

The Solemma Team

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20160523/27751c01/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.jpg
Type: image/jpeg
Size: 26087 bytes
Desc: image003.jpg
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20160523/27751c01/attachment-0001.jpg>

From stefan.bohren at stud.unibas.ch  Mon May 23 05:32:45 2016
From: stefan.bohren at stud.unibas.ch (Stefan Bohren)
Date: Mon, 23 May 2016 12:32:45 +0000
Subject: [Radiance-general] Heavily different sensor values with different
	(rcontrib?) versions
Message-ID: <02E87BCFFBFEF24FA753A60796712863D4326F81@urz-mbx-4.urz.unibas.ch>

Dear Radiance community

I am doing my master thesis about the relevance of reflections on solar fassades, for what I want to make some simulations with radiance, and also testing it with a little live experiment.

After having worked myself through most radiance tutorials and the book (very helpful), my prof helped me to put a script together, which in the end should be able to return radiation values at several sensor points, and opt on different ambient settings, surfaces and sensor point locations.

And now where we are stuck atm: His results with the script are reasonable (on OSX 10.9, likely with radiance 4.1), but if I use exactly the same script and files (on Ubuntu 16 with newest radiance), I get values that are far away from realistic (three to ten times too high radiation values, and slightly different to physically impossible rgb-tripplets), without any error messages. I searched through the archive, but didn't find a similar issue.

As the results of gendaylit -> genskyvec are identical, I think the problems are starting with rcontrib, which we use to produce the sensor radiation readings for each sky patch:

  cat $sensors |rcontrib -h -I -fo @scene.opt -ab 4 -ad 100000 -lw 0.000004 -e MF:1 -f reinhart.cal \
    -b rbin -bn Nrbins -o results/p%04d.dat -m sky_glow -w scene.oct

and are getting worse where we set them all together:

  for i in $(seq -f "%04g" 0 145); do
    cat results/p${i}.dat |rcalc -e '$1=($1*0.265+$2*0.67+$3*0.065)' |tr '\n' '\t' >> $sensors_vec
    echo >> $sensors_vec
  done

As the results are fine with the older version, and not the other way around, we'd really be happy if you helped us on how to adapt the script to the current radiance version - or told us if  we are doing something completely wrong!

Looking ahead this issue, we also are wondering which will be the important ambient settings to optimise, in the end it will be a large (several buildings) outdoor setting, and I'd be glad if you could hint me into the right direction with that as well!

Thank you very much,
Stefan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20160523/dddb1c42/attachment.html>

From mcneil.andrew at gmail.com  Tue May 24 16:49:13 2016
From: mcneil.andrew at gmail.com (Andy McNeil)
Date: Tue, 24 May 2016 16:49:13 -0700
Subject: [Radiance-general] Heavily different sensor values with
 different (rcontrib?) versions
In-Reply-To: <02E87BCFFBFEF24FA753A60796712863D4326F81@urz-mbx-4.urz.unibas.ch>
References: <02E87BCFFBFEF24FA753A60796712863D4326F81@urz-mbx-4.urz.unibas.ch>
Message-ID: <CAEFJVk8RwvJGy4M93-fDqsnB-C8RzS++OhNBbRtd=TNncbr75w@mail.gmail.com>

Stefan,

The only major change to rcontrib I know of was the addition of extra
details in the header, but you're not writing the header so that can't be
the problem. The only thing I can think of is that there are some
differences in shell tools between BSD and Linux, so perhaps test seq and
tr independently to make sure they are doing what you expect. Other than
that I don't know what could be happening.

Now that you're using a recent version of Radiance instead of the for loop
you could use a single inline rmtxop command like this:

cat $sensors | rcontrib -I -fo @scene.opt -ab 4 -ad 100000 -lw 0.000004 -y
$numsensors -e MF:1 -f reinhart.cal \
    -b rbin -bn Nrbins -m sky_glow -w scene.oct | rmtxop -c 0.265 0.67 0.065
- > $sensors_vec

just make sure you define $numsensors as your number of sensors.

As for settings to consider, if you're interested in specular reflections
you probably want to set -st 0. And you'll probably need to reduce -lw
further to something lower than your facade reflectance divided by ad
setting. For example, if your facade VLT is 5% it would have to be less
than 0.05/100000=0.0000005 or 5e-7 (you currently have 4e-6).

Best,
Andy






On Mon, May 23, 2016 at 5:32 AM, Stefan Bohren <stefan.bohren at stud.unibas.ch
> wrote:

> Dear Radiance community
>
> I am doing my master thesis about the relevance of reflections on solar
> fassades, for what I want to make some simulations with radiance, and also
> testing it with a little live experiment.
>
> After having worked myself through most radiance tutorials and the book
> (very helpful), my prof helped me to put a script together, which in the
> end should be able to return radiation values at several sensor points, and
> opt on different ambient settings, surfaces and sensor point locations.
>
> And now where we are stuck atm: His results with the script are reasonable
> (on OSX 10.9, likely with radiance 4.1), but if I use exactly the same
> script and files (on Ubuntu 16 with newest radiance), I get values that are
> far away from realistic (three to ten times too high radiation values, and
> slightly different to physically impossible rgb-tripplets), without any
> error messages. I searched through the archive, but didn't find a similar
> issue.
>
> As the results of gendaylit -> genskyvec are identical, I think the
> problems are starting with rcontrib, which we use to produce the sensor
> radiation readings for each sky patch:
>
>   cat $sensors |rcontrib -h -I -fo @scene.opt -ab 4 -ad 100000 -lw
> 0.000004 -e MF:1 -f reinhart.cal \
>     -b rbin -bn Nrbins -o results/p%04d.dat -m sky_glow -w scene.oct
>
> and are getting worse where we set them all together:
>
>   for i in $(seq -f "%04g" 0 145); do
>     cat results/p${i}.dat |rcalc -e '$1=($1*0.265+$2*0.67+$3*0.065)' |tr
> '\n' '\t' >> $sensors_vec
>     echo >> $sensors_vec
>   done
>
> As the results are fine with the older version, and not the other way
> around, we'd really be happy if you helped us on how to adapt the script to
> the current radiance version - or told us if  we are doing something
> completely wrong!
>
> Looking ahead this issue, we also are wondering which will be the
> important ambient settings to optimise, in the end it will be a large
> (several buildings) outdoor setting, and I'd be glad if you could hint me
> into the right direction with that as well!
>
> Thank you very much,
> Stefan
>
> _______________________________________________
> Radiance-general mailing list
> Radiance-general at radiance-online.org
> http://www.radiance-online.org/mailman/listinfo/radiance-general
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20160524/1b93542c/attachment.html>

From stefan.bohren at stud.unibas.ch  Wed May 25 08:42:46 2016
From: stefan.bohren at stud.unibas.ch (Stefan Bohren)
Date: Wed, 25 May 2016 15:42:46 +0000
Subject: [Radiance-general] Heavily different sensor values with
 different (rcontrib?) versions
In-Reply-To: <CAEFJVk8RwvJGy4M93-fDqsnB-C8RzS++OhNBbRtd=TNncbr75w@mail.gmail.com>
References: <02E87BCFFBFEF24FA753A60796712863D4326F81@urz-mbx-4.urz.unibas.ch>,
	<CAEFJVk8RwvJGy4M93-fDqsnB-C8RzS++OhNBbRtd=TNncbr75w@mail.gmail.com>
Message-ID: <02E87BCFFBFEF24FA753A60796712863D432705F@urz-mbx-4.urz.unibas.ch>

Dear Andy

Thank you very much for your answer and help, especially also for the hints about the abbreviation with rmtxop and the settings.

I finally found the issue, with another old script that not just produced bad results, but refused to work. And it actually is a header-issue, but not because of rcontrib: It looks like genskyvec didn't use to write a header, but nowadays it does. So as soon as I told it not to write a header, I got reasonable results too :)

Cheers,
Stefan

________________________________
Von: Andy McNeil [mcneil.andrew at gmail.com]
Gesendet: Mittwoch, 25. Mai 2016 01:49
An: Radiance general discussion
Betreff: Re: [Radiance-general] Heavily different sensor values with different (rcontrib?) versions

Stefan,

The only major change to rcontrib I know of was the addition of extra details in the header, but you're not writing the header so that can't be the problem. The only thing I can think of is that there are some differences in shell tools between BSD and Linux, so perhaps test seq and tr independently to make sure they are doing what you expect. Other than that I don't know what could be happening.

Now that you're using a recent version of Radiance instead of the for loop you could use a single inline rmtxop command like this:

cat $sensors | rcontrib -I -fo @scene.opt -ab 4 -ad 100000 -lw 0.000004 -y $numsensors -e MF:1 -f reinhart.cal \
    -b rbin -bn Nrbins -m sky_glow -w scene.oct | rmtxop -c 0.265 0.67 0.065 - > $sensors_vec

just make sure you define $numsensors as your number of sensors.

As for settings to consider, if you're interested in specular reflections you probably want to set -st 0. And you'll probably need to reduce -lw further to something lower than your facade reflectance divided by ad setting. For example, if your facade VLT is 5% it would have to be less than 0.05/100000=0.0000005 or 5e-7 (you currently have 4e-6).

Best,
Andy






On Mon, May 23, 2016 at 5:32 AM, Stefan Bohren <stefan.bohren at stud.unibas.ch<redir.aspx?REF=8RQxChPI4tTaam-L0w9llHpKX9_axdFoZ1HokCx4bXnJ4a2esITTCAFtYWlsdG86c3RlZmFuLmJvaHJlbkBzdHVkLnVuaWJhcy5jaA..>> wrote:
Dear Radiance community

I am doing my master thesis about the relevance of reflections on solar fassades, for what I want to make some simulations with radiance, and also testing it with a little live experiment.

After having worked myself through most radiance tutorials and the book (very helpful), my prof helped me to put a script together, which in the end should be able to return radiation values at several sensor points, and opt on different ambient settings, surfaces and sensor point locations.

And now where we are stuck atm: His results with the script are reasonable (on OSX 10.9, likely with radiance 4.1), but if I use exactly the same script and files (on Ubuntu 16 with newest radiance), I get values that are far away from realistic (three to ten times too high radiation values, and slightly different to physically impossible rgb-tripplets), without any error messages. I searched through the archive, but didn't find a similar issue.

As the results of gendaylit -> genskyvec are identical, I think the problems are starting with rcontrib, which we use to produce the sensor radiation readings for each sky patch:

  cat $sensors |rcontrib -h -I -fo @scene.opt -ab 4 -ad 100000 -lw 0.000004 -e MF:1 -f reinhart.cal \
    -b rbin -bn Nrbins -o results/p%04d.dat -m sky_glow -w scene.oct

and are getting worse where we set them all together:

  for i in $(seq -f "%04g" 0 145); do
    cat results/p${i}.dat |rcalc -e '$1=($1*0.265+$2*0.67+$3*0.065)' |tr '\n' '\t' >> $sensors_vec
    echo >> $sensors_vec
  done

As the results are fine with the older version, and not the other way around, we'd really be happy if you helped us on how to adapt the script to the current radiance version - or told us if  we are doing something completely wrong!

Looking ahead this issue, we also are wondering which will be the important ambient settings to optimise, in the end it will be a large (several buildings) outdoor setting, and I'd be glad if you could hint me into the right direction with that as well!

Thank you very much,
Stefan

_______________________________________________
Radiance-general mailing list
Radiance-general at radiance-online.org<redir.aspx?REF=okBVF0SQVmfq9p1DI6dq-4Je4Vgc6ytOtkp6IIMl0uDJ4a2esITTCAFtYWlsdG86UmFkaWFuY2UtZ2VuZXJhbEByYWRpYW5jZS1vbmxpbmUub3Jn>
http://www.radiance-online.org/mailman/listinfo/radiance-general<redir.aspx?REF=Y44plK10NT3zQLV-SAX6Zm48ARY3K-YHEL3mkvSn0ZvJ4a2esITTCAFodHRwOi8vd3d3LnJhZGlhbmNlLW9ubGluZS5vcmcvbWFpbG1hbi9saXN0aW5mby9yYWRpYW5jZS1nZW5lcmFs>


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20160525/d7a5f6ef/attachment-0001.html>

From achim.geissler at intergga.ch  Fri May 27 12:29:35 2016
From: achim.geissler at intergga.ch (Achim Geissler)
Date: Fri, 27 May 2016 21:29:35 +0200
Subject: [Radiance-general] genskyvec with HDR sky view?
Message-ID: <AFCAEC0C-40CC-46AD-A28E-AEAD6276E961@intergga.ch>

Hi all,

after searching high and low without clear results apart from a lot of pointers that ?everybody seems to be doing it? (so it should actually be easy and I am probably missing the forest due to seeing trees, as they say) a short question: The goal is to use HDR (fisheye) views of the sky for radiance calculations. All I could manage to date are pretty pictures with HDR skies. Ideally, the workflow would be ?the same? as when using a sky from gensky or gendaylit. E.g., it would be nice to be able to generate the sky vectors (genskyvec) from the HDR sky view. Is that possible? How? Trying to simply pipe a sky definition along the lines of

void colorpict skyfunc_hdr
7 red green blue sky_image.hdr map_sky.cal u v
0
0

skyfunc_hdr glow sky_glow_hdr
0
0
4 1 1 1 0

sky_glow_hdr source sky_hdr
0
0
4 0 0 1 180

into genskyvec didn?t work - well, would have been too simple (the map_sky.cal is from the PhD by Coralie Cauwerts, 2013). The following approaches resulted in the ?pretty pictures? (replacing ?source? above)

sky_glow_hdr bubble sky_hdr
0
0
4 0 0 0 2000

or

!genbox sky_glow_hdr boxenv 2000 2000 1000 -i | xform -t -1000 -1000 -500

A further topic will be a ?calibration? of the HDR sky views - we have global horizontal and diffuse horizontal radiation values available. The current idea of a (possibly slightly rough) method of calibration would be to use the HDR sky to calculate the corresponding sensor value with radiance and ?somehow? introduce a scaling factor into the HDR sky such that the measured and calculated global horizontal radiation values tally.

Thanks for any hints & ideas!

Best
Achim

achim.geissler at intergga.ch






From gregoryjward at gmail.com  Fri May 27 16:26:41 2016
From: gregoryjward at gmail.com (Greg Ward)
Date: Fri, 27 May 2016 16:26:41 -0700
Subject: [Radiance-general] genskyvec with HDR sky view?
In-Reply-To: <AFCAEC0C-40CC-46AD-A28E-AEAD6276E961@intergga.ch>
References: <AFCAEC0C-40CC-46AD-A28E-AEAD6276E961@intergga.ch>
Message-ID: <DCBD49C2-94A3-4545-A5D0-A9669F311BC9@lmi.net>

Hi Achim,

I wouldn't call what you are trying to do "easy," even if others have done it.  Your HDR file has to be in the correct units or scaled by the right amount to get calibrated radiance values, and even then, the sun is usually out of range(clipped) and won't be properly sampled if it is a clear sky.

As you noted, such a sky cannot be given as input to genskyvec, which expects a very specific set of primitives output by gensky or gendaylit.  Specifically, you need to name your colorpict pattern "skyfunc" and add a solar source if the sky is sunny.  You could try to modify your description to match, but you'd have to look at the Perl script src/util/genskyvec.pl to figure out how to satisfy the input requirements.

Once you have a sky description, you can use rtrace with the -I option to compute hemispherical irradiance, from which you can create an adjustment factor to apply to your glow based on horizontal irradiance.

It's all possible, but the details are not very straightforward.

Best,
-Greg

> From: Achim Geissler <achim.geissler at intergga.ch>
> Date: May 27, 2016 12:29:35 PM PDT
> 
> Hi all,
> 
> after searching high and low without clear results apart from a lot of pointers that ?everybody seems to be doing it? (so it should actually be easy and I am probably missing the forest due to seeing trees, as they say) a short question: The goal is to use HDR (fisheye) views of the sky for radiance calculations. All I could manage to date are pretty pictures with HDR skies. Ideally, the workflow would be ?the same? as when using a sky from gensky or gendaylit. E.g., it would be nice to be able to generate the sky vectors (genskyvec) from the HDR sky view. Is that possible? How? Trying to simply pipe a sky definition along the lines of
> 
> void colorpict skyfunc_hdr
> 7 red green blue sky_image.hdr map_sky.cal u v
> 0
> 0
> 
> skyfunc_hdr glow sky_glow_hdr
> 0
> 0
> 4 1 1 1 0
> 
> sky_glow_hdr source sky_hdr
> 0
> 0
> 4 0 0 1 180
> 
> into genskyvec didn?t work - well, would have been too simple (the map_sky.cal is from the PhD by Coralie Cauwerts, 2013). The following approaches resulted in the ?pretty pictures? (replacing ?source? above)
> 
> sky_glow_hdr bubble sky_hdr
> 0
> 0
> 4 0 0 0 2000
> 
> or
> 
> !genbox sky_glow_hdr boxenv 2000 2000 1000 -i | xform -t -1000 -1000 -500
> 
> A further topic will be a ?calibration? of the HDR sky views - we have global horizontal and diffuse horizontal radiation values available. The current idea of a (possibly slightly rough) method of calibration would be to use the HDR sky to calculate the corresponding sensor value with radiance and ?somehow? introduce a scaling factor into the HDR sky such that the measured and calculated global horizontal radiation values tally.
> 
> Thanks for any hints & ideas!
> 
> Best
> Achim
> 
> achim.geissler at intergga.ch


From kynthia.chamilothori at epfl.ch  Mon May 30 06:09:23 2016
From: kynthia.chamilothori at epfl.ch (Chamilothori Kynthia)
Date: Mon, 30 May 2016 13:09:23 +0000
Subject: [Radiance-general] [HDRI] Photosphere (or equivalent) in Linux or
	Windows?
Message-ID: <515fe390129247e48bda953ae366c334@rexb.intranet.epfl.ch>

Dear Radiance community,

There was a great effort a couple of years ago to create a cross-platform version of Photosphere by Greg and Helena Eydelberg. Is this version perhaps stable enough for distribution?
Otherwise, what would you use as an alternative if not Photosphere? Has anyone used successfully any other workaround (e.g. an OS X virtual box)?

Thanks for any ideas!

Best,
Kynthia Chamilothori

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20160530/c8ce7e06/attachment.html>

From achim.geissler at intergga.ch  Mon May 30 08:05:25 2016
From: achim.geissler at intergga.ch (Achim Geissler)
Date: Mon, 30 May 2016 17:05:25 +0200
Subject: [Radiance-general] genskyvec with HDR sky view?
In-Reply-To: <DCBD49C2-94A3-4545-A5D0-A9669F311BC9@lmi.net>
References: <AFCAEC0C-40CC-46AD-A28E-AEAD6276E961@intergga.ch>
	<DCBD49C2-94A3-4545-A5D0-A9669F311BC9@lmi.net>
Message-ID: <001201d1ba84$b372a720$1a57f560$@intergga.ch>

Hi Greg,

thanks for the pointers. I am afraid, though, that I was unable to really
make heads or tails of them.
a) HDR file (Photosphere)
	i, the (test) HDR gives min/max values in falsecolor view of 39 to
2900, whatever the unit, there
	ii, it gives histogram min/max values  for Luminance of 34.8 to
4.43E+06
	iii, it does not seem to be clipped
b) There is a sun (albeit behind a thin cloud cover). Simply adding a sun
definition to my sky description did not really change anything, though.
Also, at this point I do not know which r,g,b radiance values to use for the
solar "light" material and do these influence the result? And, actually, how
to exactly position the HDR so that the sun positions tally.
c) I took a look at the genskyvec.pl script, however, I am not perl-literate
so that is a bit difficult. I seem to be missing out on where this script
>could< use values from the HDR file to generate the sky vectors. Part of
the code seems to be a copy of the setting up of patches from reinhart.cal.
Also, the "skyfunc glow skyglow" and "skyglow source sky" are written to the
(an) octree in the script. Can I ignore that? Or does that let me leave
these definitions out of my sky description? Which definition has precedent?
I can't really see where the "skybright.cal" values from a standard gensky
sky would come into play - this should be what is replaced by values from
the HDR?
d) using the sky description as below but with "skyfunc" gives 
rpict: warning - compute error for colorpict "skyfunc"
rpict: Division by zero
 when trying to generate a view of a scene.

I must admit the flow of data (input / output) in all the definitions is a
bit of a mystery, for me. I did find a kind of description for colorpict in
p_data.c, but that didn't really help, sadly. Looking at your code, I get
the feeling I am not literate in any programming language ... :o(

If you (or, of course, anyone else out there that has done this before) can
give any further help or tips, it would be much appreciated.

Best
Achim


-----Urspr?ngliche Nachricht-----
Von: Greg Ward [mailto:gregoryjward at gmail.com] 
Gesendet: Samstag, 28. Mai 2016 01:27
An: Radiance general discussion
Betreff: Re: [Radiance-general] genskyvec with HDR sky view?

Hi Achim,

I wouldn't call what you are trying to do "easy," even if others have done
it.  Your HDR file has to be in the correct units or scaled by the right
amount to get calibrated radiance values, and even then, the sun is usually
out of range(clipped) and won't be properly sampled if it is a clear sky.

As you noted, such a sky cannot be given as input to genskyvec, which
expects a very specific set of primitives output by gensky or gendaylit.
Specifically, you need to name your colorpict pattern "skyfunc" and add a
solar source if the sky is sunny.  You could try to modify your description
to match, but you'd have to look at the Perl script src/util/genskyvec.pl to
figure out how to satisfy the input requirements.

Once you have a sky description, you can use rtrace with the -I option to
compute hemispherical irradiance, from which you can create an adjustment
factor to apply to your glow based on horizontal irradiance.

It's all possible, but the details are not very straightforward.

Best,
-Greg

> From: Achim Geissler <achim.geissler at intergga.ch>
> Date: May 27, 2016 12:29:35 PM PDT
> 
> Hi all,
> 
> after searching high and low without clear results apart from a lot of
pointers that ?everybody seems to be doing it? (so it should actually be
easy and I am probably missing the forest due to seeing trees, as they say)
a short question: The goal is to use HDR (fisheye) views of the sky for
radiance calculations. All I could manage to date are pretty pictures with
HDR skies. Ideally, the workflow would be ?the same? as when using a sky
from gensky or gendaylit. E.g., it would be nice to be able to generate the
sky vectors (genskyvec) from the HDR sky view. Is that possible? How? Trying
to simply pipe a sky definition along the lines of
> 
> void colorpict skyfunc_hdr
> 7 red green blue sky_image.hdr map_sky.cal u v
> 0
> 0
> 
> skyfunc_hdr glow sky_glow_hdr
> 0
> 0
> 4 1 1 1 0
> 
> sky_glow_hdr source sky_hdr
> 0
> 0
> 4 0 0 1 180
> 
> into genskyvec didn?t work - well, would have been too simple (the
map_sky.cal is from the PhD by Coralie Cauwerts, 2013). The following
approaches resulted in the ?pretty pictures? (replacing ?source? above)
> 
> sky_glow_hdr bubble sky_hdr
> 0
> 0
> 4 0 0 0 2000
> 
> or
> 
> !genbox sky_glow_hdr boxenv 2000 2000 1000 -i | xform -t -1000 -1000 -500
> 
> A further topic will be a ?calibration? of the HDR sky views - we have
global horizontal and diffuse horizontal radiation values available. The
current idea of a (possibly slightly rough) method of calibration would be
to use the HDR sky to calculate the corresponding sensor value with radiance
and ?somehow? introduce a scaling factor into the HDR sky such that the
measured and calculated global horizontal radiation values tally.
> 
> Thanks for any hints & ideas!
> 
> Best
> Achim
> 
> achim.geissler at intergga.ch

_______________________________________________
Radiance-general mailing list
Radiance-general at radiance-online.org
http://www.radiance-online.org/mailman/listinfo/radiance-general



From gregoryjward at gmail.com  Mon May 30 08:40:58 2016
From: gregoryjward at gmail.com (Greg Ward)
Date: Mon, 30 May 2016 08:40:58 -0700
Subject: [Radiance-general] [HDRI] Photosphere (or equivalent) in Linux
	or Windows?
In-Reply-To: <515fe390129247e48bda953ae366c334@rexb.intranet.epfl.ch>
References: <515fe390129247e48bda953ae366c334@rexb.intranet.epfl.ch>
Message-ID: <519C9544-A8CF-430D-8857-27537814B93B@lmi.net>

Hi Kynthia,

To recover the costs related to developing a Windows version, we have been charging a site license fee of $250 US to institutions that want to use Elena's port of Photosphere.  It does appear to be stable inasmuch as we have received no complaints about its behavior from any of the licensees.

The long-term goal is to port her version, which is based on the cross-platform wxWidgets API, back to newer versions of Mac OS X and even Linux.  Unfortunately, I have not had time to pursue this activity.  I am unsure at this point when I will ever get to it....

Cheers,
-Greg

> From: Chamilothori Kynthia <kynthia.chamilothori at epfl.ch>
> Date: May 30, 2016 6:09:23 AM PDT
> 
> Dear Radiance community,
>  
> There was a great effort a couple of years ago to create a cross-platform version of Photosphere by Greg and Helena Eydelberg. Is this version perhaps stable enough for distribution?
> Otherwise, what would you use as an alternative if not Photosphere? Has anyone used successfully any other workaround (e.g. an OS X virtual box)?
>  
> Thanks for any ideas!
>  
> Best,
> Kynthia Chamilothori
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20160530/915e41c1/attachment.html>

From kynthia.chamilothori at epfl.ch  Tue May 31 05:45:26 2016
From: kynthia.chamilothori at epfl.ch (Chamilothori Kynthia)
Date: Tue, 31 May 2016 12:45:26 +0000
Subject: [Radiance-general] [HDRI] Photosphere (or equivalent) in Linux
 or Windows?
Message-ID: <b49672ce1db1498bb95a65050f96f1e8@rexb.intranet.epfl.ch>

Hi Greg,

Thanks for your answer! Great to hear that the Windows port is stable and working!
I completely understand the difficulty of continuing the porting work - thanks for all the work you have already put into this. I think that for what I want to do hdrgen and pcomb will do fine for now.

Cheers,
Kynthia 
------------------------------

Message: 3
Date: Mon, 30 May 2016 08:40:58 -0700
From: Greg Ward <gregoryjward at gmail.com>
To: Radiance general discussion <radiance-general at radiance-online.org>
Subject: Re: [Radiance-general] [HDRI] Photosphere (or equivalent) in
	Linux	or Windows?
Message-ID: <519C9544-A8CF-430D-8857-27537814B93B at lmi.net>
Content-Type: text/plain; charset="us-ascii"

Hi Kynthia,

To recover the costs related to developing a Windows version, we have been charging a site license fee of $250 US to institutions that want to use Elena's port of Photosphere.  It does appear to be stable inasmuch as we have received no complaints about its behavior from any of the licensees.

The long-term goal is to port her version, which is based on the cross-platform wxWidgets API, back to newer versions of Mac OS X and even Linux.  Unfortunately, I have not had time to pursue this activity.  I am unsure at this point when I will ever get to it....

Cheers,
-Greg

> From: Chamilothori Kynthia <kynthia.chamilothori at epfl.ch>
> Date: May 30, 2016 6:09:23 AM PDT
> 
> Dear Radiance community,
>  
> There was a great effort a couple of years ago to create a cross-platform version of Photosphere by Greg and Helena Eydelberg. Is this version perhaps stable enough for distribution?
> Otherwise, what would you use as an alternative if not Photosphere? Has anyone used successfully any other workaround (e.g. an OS X virtual box)?
>  
> Thanks for any ideas!
>  
> Best,
> Kynthia Chamilothori
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20160530/915e41c1/attachment-0001.html>

------------------------------

_______________________________________________
Radiance-general mailing list
Radiance-general at radiance-online.org
http://www.radiance-online.org/mailman/listinfo/radiance-general


End of Radiance-general Digest, Vol 147, Issue 11
*************************************************


From stephen at coolshadow.com  Tue May 31 09:36:11 2016
From: stephen at coolshadow.com (Stephen Wasilewski)
Date: Tue, 31 May 2016 09:36:11 -0700
Subject: [Radiance-general] get pixel value
Message-ID: <CAK5mS-9E9Wbvx1AeZtSTpi+yZgN+cQx5u6JaQqRDcJiYJVu5=g@mail.gmail.com>

What is the fastest (computationally) way to look up a single pixel value
in a radiance picture?
currently I'm doing it like this:

pcompos -x 1 -y 1 pic.hdr -300 -450 | pvalue -o -h -b -H -d

is there a better way?


Thanks,

Stephen Wasilewski
*LOISOS *+* UBBELOHDE*
- - - - - - - - - - - - - - - - - - - - - - - - - - -
1917 Clement Avenue  Building 10A
Alameda, CA  94501 USA
- - - - - - - - - - - - - - - - - - - - - - - - - - -
510 521 3800 VOICE
510 521 3820 FAX
- - - - - - - - - - - - - - - - - - - - - - - - - - -
www.coolshadow.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20160531/d0364f8d/attachment.html>

From gregoryjward at gmail.com  Tue May 31 09:48:49 2016
From: gregoryjward at gmail.com (Greg Ward)
Date: Tue, 31 May 2016 09:48:49 -0700
Subject: [Radiance-general] get pixel value
In-Reply-To: <CAK5mS-9E9Wbvx1AeZtSTpi+yZgN+cQx5u6JaQqRDcJiYJVu5=g@mail.gmail.com>
References: <CAK5mS-9E9Wbvx1AeZtSTpi+yZgN+cQx5u6JaQqRDcJiYJVu5=g@mail.gmail.com>
Message-ID: <CEDEE0AD-3EC4-4323-BDA3-32E56897DA22@lmi.net>

Hi Stephen,

This is what I would do -- pcompos doesn't do any processing on pixels, so it would be difficult to come up with something faster.

The only issue with your method is that pcompos shifts header lines on the input, so any EXPOSURE= settings are lost.  As a result, you won't get the desired absolute value from your command if an exposure change has been applied.  This is also why pcompos is problematic when processing HDR images from Photosphere or hdrgen, which typically include the calibration factor as an EXPOSURE= line in the header.

The following fix for this problem is ugly, but quicker than processing the entire image to correct the exposure:

	set val=`pcompos -x 1 -y 1 pic.hdr -300 -450 | pvalue -h -b -H -d`
	set expos=`getinfo < pic.hdr | sed -n 's/EXPOSURE=//p' | total -p'
	set result = `ev "$val / $expos"`

The second line allows for multiple EXPOSURE= lines, which can happen when you process the image with pfilt, for example.

Cheers,
-Greg

> From: Stephen Wasilewski <stephen at coolshadow.com>
> Date: May 31, 2016 9:36:11 AM PDT
> 
> What is the fastest (computationally) way to look up a single pixel value in a radiance picture?  
> currently I'm doing it like this:
> 
> pcompos -x 1 -y 1 pic.hdr -300 -450 | pvalue -o -h -b -H -d
> 
> is there a better way?
> 
> 
> Thanks,
> 
> Stephen Wasilewski
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20160531/ef531345/attachment.html>

From gregoryjward at gmail.com  Tue May 31 15:17:55 2016
From: gregoryjward at gmail.com (Greg Ward)
Date: Tue, 31 May 2016 15:17:55 -0700
Subject: [Radiance-general] genskyvec with HDR sky view?
In-Reply-To: <001201d1ba84$b372a720$1a57f560$@intergga.ch>
References: <AFCAEC0C-40CC-46AD-A28E-AEAD6276E961@intergga.ch>
	<DCBD49C2-94A3-4545-A5D0-A9669F311BC9@lmi.net>
	<001201d1ba84$b372a720$1a57f560$@intergga.ch>
Message-ID: <49291F00-43FF-4140-8950-B53712BAC512@lmi.net>

Hi Achim,

I'll answer inline again, making a bad formatting job look even worse....

> From: "Achim Geissler" <achim.geissler at intergga.ch>
> Date: May 30, 2016 8:05:25 AM PDT
> 
> Hi Greg,
> 
> thanks for the pointers. I am afraid, though, that I was unable to really
> make heads or tails of them.
> a) HDR file (Photosphere)
> 	i, the (test) HDR gives min/max values in falsecolor view of 39 to
> 2900, whatever the unit, there
> 	ii, it gives histogram min/max values  for Luminance of 34.8 to
> 4.43E+06
> 	iii, it does not seem to be clipped

I don't know what (i), (ii) and (iii) refer to, if anything.  Are these particular processes you have tried?  If so, what are they?

Typically, falsecolor and Photosphere report photometric values (i.e., radiance values times 179 lumens/watt efficacy).

> b) There is a sun (albeit behind a thin cloud cover). Simply adding a sun
> definition to my sky description did not really change anything, though.
> Also, at this point I do not know which r,g,b radiance values to use for the
> solar "light" material and do these influence the result? And, actually, how
> to exactly position the HDR so that the sun positions tally.

If you have your sky turned the right way around, so that the Z-axis points up, Y-axis points north, and X-axis points east, then positioning the sun is a matter of running gensky with the appropriate date/time and global position parameters, and extracting the description it generates.  You can adjust the solar radiance values to match the global-diffuse measured that day using the -R option to gensky.

> c) I took a look at the genskyvec.pl script, however, I am not perl-literate
> so that is a bit difficult. I seem to be missing out on where this script >could<
> use values from the HDR file to generate the sky vectors. Part of
> the code seems to be a copy of the setting up of patches from reinhart.cal.
> Also, the "skyfunc glow skyglow" and "skyglow source sky" are written to the
> (an) octree in the script. Can I ignore that? Or does that let me leave
> these definitions out of my sky description? Which definition has precedent?
> I can't really see where the "skybright.cal" values from a standard gensky
> sky would come into play - this should be what is replaced by values from
> the HDR?

I'm not suggesting you rewrite genskyvec.  Rather, I'm suggesting that you prepare a sky file it will accept and run it on that file.  If this doesn't make sense, then I suggest you give up.

> d) using the sky description as below but with "skyfunc" gives 
> rpict: warning - compute error for colorpict "skyfunc"
> rpict: Division by zero
> when trying to generate a view of a scene.

I don't know why globally replacing "skyfunc_hdr" with "skyfunc" in your file should cause new errors.  You must have done something else, or the original run would have generated the same errors.  I don't know what's in "map_sky.cal", which is the likely cause.

> I must admit the flow of data (input / output) in all the definitions is a
> bit of a mystery, for me. I did find a kind of description for colorpict in
> p_data.c, but that didn't really help, sadly. Looking at your code, I get
> the feeling I am not literate in any programming language ... :o(

Well, it's not particularly transparent, I will grant you.  There's this back-and-forth between the ray tracing and the scene description, such that when a material is intersected, it queries its modifiers, which calls back to your map_sky.cal file in a rather convoluted fashion.

You should look through Chapter 4 of "Rendering with Radiance."  Starting at Section 4.1.4, we talk about how the interaction between rendering and .cal files operates.

> If you (or, of course, anyone else out there that has done this before) can
> give any further help or tips, it would be much appreciated.
> 
> Best
> Achim
> 
> 
> -----Urspr?ngliche Nachricht-----
> Von: Greg Ward [mailto:gregoryjward at gmail.com] 
> Gesendet: Samstag, 28. Mai 2016 01:27
> An: Radiance general discussion
> Betreff: Re: [Radiance-general] genskyvec with HDR sky view?
> 
> Hi Achim,
> 
> I wouldn't call what you are trying to do "easy," even if others have done
> it.  Your HDR file has to be in the correct units or scaled by the right
> amount to get calibrated radiance values, and even then, the sun is usually
> out of range(clipped) and won't be properly sampled if it is a clear sky.
> 
> As you noted, such a sky cannot be given as input to genskyvec, which
> expects a very specific set of primitives output by gensky or gendaylit.
> Specifically, you need to name your colorpict pattern "skyfunc" and add a
> solar source if the sky is sunny.  You could try to modify your description
> to match, but you'd have to look at the Perl script src/util/genskyvec.pl to
> figure out how to satisfy the input requirements.
> 
> Once you have a sky description, you can use rtrace with the -I option to
> compute hemispherical irradiance, from which you can create an adjustment
> factor to apply to your glow based on horizontal irradiance.
> 
> It's all possible, but the details are not very straightforward.
> 
> Best,
> -Greg
> 
>> From: Achim Geissler <achim.geissler at intergga.ch>
>> Date: May 27, 2016 12:29:35 PM PDT
>> 
>> Hi all,
>> 
>> after searching high and low without clear results apart from a lot of
> pointers that ?everybody seems to be doing it? (so it should actually be
> easy and I am probably missing the forest due to seeing trees, as they say)
> a short question: The goal is to use HDR (fisheye) views of the sky for
> radiance calculations. All I could manage to date are pretty pictures with
> HDR skies. Ideally, the workflow would be ?the same? as when using a sky
> from gensky or gendaylit. E.g., it would be nice to be able to generate the
> sky vectors (genskyvec) from the HDR sky view. Is that possible? How? Trying
> to simply pipe a sky definition along the lines of
>> 
>> void colorpict skyfunc_hdr
>> 7 red green blue sky_image.hdr map_sky.cal u v
>> 0
>> 0
>> 
>> skyfunc_hdr glow sky_glow_hdr
>> 0
>> 0
>> 4 1 1 1 0
>> 
>> sky_glow_hdr source sky_hdr
>> 0
>> 0
>> 4 0 0 1 180
>> 
>> into genskyvec didn?t work - well, would have been too simple (the
> map_sky.cal is from the PhD by Coralie Cauwerts, 2013). The following
> approaches resulted in the ?pretty pictures? (replacing ?source? above)
>> 
>> sky_glow_hdr bubble sky_hdr
>> 0
>> 0
>> 4 0 0 0 2000
>> 
>> or
>> 
>> !genbox sky_glow_hdr boxenv 2000 2000 1000 -i | xform -t -1000 -1000 -500
>> 
>> A further topic will be a ?calibration? of the HDR sky views - we have
> global horizontal and diffuse horizontal radiation values available. The
> current idea of a (possibly slightly rough) method of calibration would be
> to use the HDR sky to calculate the corresponding sensor value with radiance
> and ?somehow? introduce a scaling factor into the HDR sky such that the
> measured and calculated global horizontal radiation values tally.
>> 
>> Thanks for any hints & ideas!
>> 
>> Best
>> Achim
>> 
>> achim.geissler at intergga.ch


From mcneil.andrew at gmail.com  Tue May 31 15:42:47 2016
From: mcneil.andrew at gmail.com (Andy McNeil)
Date: Tue, 31 May 2016 15:42:47 -0700
Subject: [Radiance-general] genskyvec with HDR sky view?
In-Reply-To: <49291F00-43FF-4140-8950-B53712BAC512@lmi.net>
References: <AFCAEC0C-40CC-46AD-A28E-AEAD6276E961@intergga.ch>
	<DCBD49C2-94A3-4545-A5D0-A9669F311BC9@lmi.net>
	<001201d1ba84$b372a720$1a57f560$@intergga.ch>
	<49291F00-43FF-4140-8950-B53712BAC512@lmi.net>
Message-ID: <CAEFJVk-tkMufSQyQkgHjB5+M1tfU_svVmtiAFj8GgBWV5byiqQ@mail.gmail.com>

>
> > d) using the sky description as below but with "skyfunc" gives
> > rpict: warning - compute error for colorpict "skyfunc"
> > rpict: Division by zero
> > when trying to generate a view of a scene.
> I don't know why globally replacing "skyfunc_hdr" with "skyfunc" in your
> file should cause new errors.  You must have done something else, or the
> original run would have generated the same errors.  I don't know what's in
> "map_sky.cal", which is the likely cause.


Maybe this has something to do with your image only being 180 degrees and
genskyvec creating a 360 degree source?
I'd suggest testing by temporarily changing line 120 of genkskyvec.pl from:
print OCONV "skyglow source sky 0 0 4 0 0 1 360\n";

to:
print OCONV "skyglow source sky 0 0 4 0 0 1 180\n";

If this works your ground patch will be zero, so you'll have to do
something about that.

Andy

On Tue, May 31, 2016 at 3:17 PM, Greg Ward <gregoryjward at gmail.com> wrote:

> Hi Achim,
>
> I'll answer inline again, making a bad formatting job look even worse....
>
> > From: "Achim Geissler" <achim.geissler at intergga.ch>
> > Date: May 30, 2016 8:05:25 AM PDT
> >
> > Hi Greg,
> >
> > thanks for the pointers. I am afraid, though, that I was unable to really
> > make heads or tails of them.
> > a) HDR file (Photosphere)
> >       i, the (test) HDR gives min/max values in falsecolor view of 39 to
> > 2900, whatever the unit, there
> >       ii, it gives histogram min/max values  for Luminance of 34.8 to
> > 4.43E+06
> >       iii, it does not seem to be clipped
>
> I don't know what (i), (ii) and (iii) refer to, if anything.  Are these
> particular processes you have tried?  If so, what are they?
>
> Typically, falsecolor and Photosphere report photometric values (i.e.,
> radiance values times 179 lumens/watt efficacy).
>
> > b) There is a sun (albeit behind a thin cloud cover). Simply adding a sun
> > definition to my sky description did not really change anything, though.
> > Also, at this point I do not know which r,g,b radiance values to use for
> the
> > solar "light" material and do these influence the result? And, actually,
> how
> > to exactly position the HDR so that the sun positions tally.
>
> If you have your sky turned the right way around, so that the Z-axis
> points up, Y-axis points north, and X-axis points east, then positioning
> the sun is a matter of running gensky with the appropriate date/time and
> global position parameters, and extracting the description it generates.
> You can adjust the solar radiance values to match the global-diffuse
> measured that day using the -R option to gensky.
>
> > c) I took a look at the genskyvec.pl script, however, I am not
> perl-literate
> > so that is a bit difficult. I seem to be missing out on where this
> script >could<
> > use values from the HDR file to generate the sky vectors. Part of
> > the code seems to be a copy of the setting up of patches from
> reinhart.cal.
> > Also, the "skyfunc glow skyglow" and "skyglow source sky" are written to
> the
> > (an) octree in the script. Can I ignore that? Or does that let me leave
> > these definitions out of my sky description? Which definition has
> precedent?
> > I can't really see where the "skybright.cal" values from a standard
> gensky
> > sky would come into play - this should be what is replaced by values from
> > the HDR?
>
> I'm not suggesting you rewrite genskyvec.  Rather, I'm suggesting that you
> prepare a sky file it will accept and run it on that file.  If this doesn't
> make sense, then I suggest you give up.
>
> > d) using the sky description as below but with "skyfunc" gives
> > rpict: warning - compute error for colorpict "skyfunc"
> > rpict: Division by zero
> > when trying to generate a view of a scene.
>
> I don't know why globally replacing "skyfunc_hdr" with "skyfunc" in your
> file should cause new errors.  You must have done something else, or the
> original run would have generated the same errors.  I don't know what's in
> "map_sky.cal", which is the likely cause.
>
> > I must admit the flow of data (input / output) in all the definitions is
> a
> > bit of a mystery, for me. I did find a kind of description for colorpict
> in
> > p_data.c, but that didn't really help, sadly. Looking at your code, I get
> > the feeling I am not literate in any programming language ... :o(
>
> Well, it's not particularly transparent, I will grant you.  There's this
> back-and-forth between the ray tracing and the scene description, such that
> when a material is intersected, it queries its modifiers, which calls back
> to your map_sky.cal file in a rather convoluted fashion.
>
> You should look through Chapter 4 of "Rendering with Radiance."  Starting
> at Section 4.1.4, we talk about how the interaction between rendering and
> .cal files operates.
>
> > If you (or, of course, anyone else out there that has done this before)
> can
> > give any further help or tips, it would be much appreciated.
> >
> > Best
> > Achim
> >
> >
> > -----Urspr?ngliche Nachricht-----
> > Von: Greg Ward [mailto:gregoryjward at gmail.com]
> > Gesendet: Samstag, 28. Mai 2016 01:27
> > An: Radiance general discussion
> > Betreff: Re: [Radiance-general] genskyvec with HDR sky view?
> >
> > Hi Achim,
> >
> > I wouldn't call what you are trying to do "easy," even if others have
> done
> > it.  Your HDR file has to be in the correct units or scaled by the right
> > amount to get calibrated radiance values, and even then, the sun is
> usually
> > out of range(clipped) and won't be properly sampled if it is a clear sky.
> >
> > As you noted, such a sky cannot be given as input to genskyvec, which
> > expects a very specific set of primitives output by gensky or gendaylit.
> > Specifically, you need to name your colorpict pattern "skyfunc" and add a
> > solar source if the sky is sunny.  You could try to modify your
> description
> > to match, but you'd have to look at the Perl script src/util/
> genskyvec.pl to
> > figure out how to satisfy the input requirements.
> >
> > Once you have a sky description, you can use rtrace with the -I option to
> > compute hemispherical irradiance, from which you can create an adjustment
> > factor to apply to your glow based on horizontal irradiance.
> >
> > It's all possible, but the details are not very straightforward.
> >
> > Best,
> > -Greg
> >
> >> From: Achim Geissler <achim.geissler at intergga.ch>
> >> Date: May 27, 2016 12:29:35 PM PDT
> >>
> >> Hi all,
> >>
> >> after searching high and low without clear results apart from a lot of
> > pointers that ?everybody seems to be doing it? (so it should actually be
> > easy and I am probably missing the forest due to seeing trees, as they
> say)
> > a short question: The goal is to use HDR (fisheye) views of the sky for
> > radiance calculations. All I could manage to date are pretty pictures
> with
> > HDR skies. Ideally, the workflow would be ?the same? as when using a sky
> > from gensky or gendaylit. E.g., it would be nice to be able to generate
> the
> > sky vectors (genskyvec) from the HDR sky view. Is that possible? How?
> Trying
> > to simply pipe a sky definition along the lines of
> >>
> >> void colorpict skyfunc_hdr
> >> 7 red green blue sky_image.hdr map_sky.cal u v
> >> 0
> >> 0
> >>
> >> skyfunc_hdr glow sky_glow_hdr
> >> 0
> >> 0
> >> 4 1 1 1 0
> >>
> >> sky_glow_hdr source sky_hdr
> >> 0
> >> 0
> >> 4 0 0 1 180
> >>
> >> into genskyvec didn?t work - well, would have been too simple (the
> > map_sky.cal is from the PhD by Coralie Cauwerts, 2013). The following
> > approaches resulted in the ?pretty pictures? (replacing ?source? above)
> >>
> >> sky_glow_hdr bubble sky_hdr
> >> 0
> >> 0
> >> 4 0 0 0 2000
> >>
> >> or
> >>
> >> !genbox sky_glow_hdr boxenv 2000 2000 1000 -i | xform -t -1000 -1000
> -500
> >>
> >> A further topic will be a ?calibration? of the HDR sky views - we have
> > global horizontal and diffuse horizontal radiation values available. The
> > current idea of a (possibly slightly rough) method of calibration would
> be
> > to use the HDR sky to calculate the corresponding sensor value with
> radiance
> > and ?somehow? introduce a scaling factor into the HDR sky such that the
> > measured and calculated global horizontal radiation values tally.
> >>
> >> Thanks for any hints & ideas!
> >>
> >> Best
> >> Achim
> >>
> >> achim.geissler at intergga.ch
>
> _______________________________________________
> Radiance-general mailing list
> Radiance-general at radiance-online.org
> http://www.radiance-online.org/mailman/listinfo/radiance-general
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://www.radiance-online.org/pipermail/radiance-general/attachments/20160531/a9d6ff92/attachment-0001.html>

