<html>
	<head>
		<meta http-equiv="Content-type" content="text/html; charset=utf-8">
		<title>AutoTags - Tag Suggestion Algorithm</title>
		<script type="text/javascript" src="javascript/lib/autotags-js-core.js" charset="utf-8"></script>
		<script type="text/javascript" src="javascript/lib/en/autotags-js-en-blacklist-generic.js" charset="utf-8"></script>
		<script type="text/javascript" src="javascript/lib/custom/autotags-js-whitelist.js" charset="utf-8"></script>
		<script type="text/javascript" src="javascript/lib/custom/autotags-js-constants.js" charset="utf-8"></script>
		<script type="text/javascript" src="javascript/lib/PorterStemmer.js" charset="utf-8"></script>
		<script type="text/javascript" src="javascript/demo_ui.js" charset="utf-8"></script>
		<script src="javascript/lib/d3.v3.min.js" charset="utf-8"></script>

		<style type="text/css">
			body {
 			 	font: sans-serif;
				}
		</style>
	</head>

	<body>

		<div>
			Here is the first try to auto-tag RADIANCE's email list. Input a number between  1 and 9719. The email will show up and tags will be generated automatically.
		<p></p>
		<form>
  			Input Email ID [1-9719] <input type="text" id= "emailID" name="emailID"><br>
		</form>
		</div>

		<p></p>
		<div id="subject"><h2></h2></div>
		<p></p>
		<div id="msg"></div>
		<p></p>
		<div id="tags" style="color:red">
			<h3></h3>
		</div>

		<div>
			credits and next steps:
			<br>Iâ€™m using <a href="https://github.com/mrolafsson/autotags" target="_blank">autotags library</a> to generate the tags.
			<br>For the next steps I need to make an interface that let users review auto-generated tags.
			<br>I should also double check the parser. Not everything is working fine.
			<br>
			Parsed emails are <a href="https://github.com/mostaphaRoudsari/RadianceMailingList/tree/master/files/json" target="_blank">here</a> as json objects.
		</div>
	</body>

	<script type="text/javascript">

		d3.select("#emailID").on("input", function() {
  			loadEmail(+this.value);
		});

		function loadEmail(emailID){

			
			jsonpath = "https://raw.githubusercontent.com/mostaphaRoudsari/RadianceMailingList/master/files/json/" + emailID + ".json";
			
			d3.json(jsonpath, function(email) {

	    		var subject = email.subject.replace("[Radiance-general] ", "");
				console.log(subject);
				
				var inputText = subject + "\n" + subject + "\n" + email.body;

				var autoTags = new AUTOTAGS.createTagger({});

				var tagset = autoTags.analyzeText(inputText, 7);

				var defTags = tagset.tags.map(function(d){return d._term;});
			
				var tags = defTags.filter(function(d){return d!="news" && d!="research" && d!="favourite"})
				
				var tagsStr = ""

				tags.forEach(function(d){tagsStr += d + ", "})

				d3.select("div#subject").select("h2").text(email.subject);
				d3.select("div#msg").text(email.body);

				d3.select("div#tags").select("h3").text("Auto Tags: " + tagsStr);
				//console.log(tags);

			});
		}

		// initita the page when open
		var onloadID = 9718;
		loadEmail(onloadID);
		d3.select("input#emailId").attr("value", onloadID);

	</script>
</html>

